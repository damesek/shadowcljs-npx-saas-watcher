var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(array){var index=0;return function(){return index<array.length?{done:!1,value:array[index++]}:{done:!0}}};$jscomp.arrayIterator=function(array){return{next:$jscomp.arrayIteratorImpl(array)}};$jscomp.makeIterator=function(iterable){var iteratorFunction="undefined"!=typeof Symbol&&Symbol.iterator&&iterable[Symbol.iterator];return iteratorFunction?iteratorFunction.call(iterable):$jscomp.arrayIterator(iterable)};
$jscomp.arrayFromIterator=function(iterator){for(var i,arr=[];!(i=iterator.next()).done;)arr.push(i.value);return arr};$jscomp.arrayFromIterable=function(iterable){return iterable instanceof Array?iterable:$jscomp.arrayFromIterator($jscomp.makeIterator(iterable))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(prototype){var ctor=function(){};ctor.prototype=prototype;return new ctor};$jscomp.underscoreProtoCanBeSet=function(){var x={a:!0},y={};try{return y.__proto__=x,y.a}catch(e){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(target,proto){target.__proto__=proto;if(target.__proto__!==proto)throw new TypeError(target+" is not extensible");return target}:null;
$jscomp.inherits=function(childCtor,parentCtor){childCtor.prototype=$jscomp.objectCreate(parentCtor.prototype);childCtor.prototype.constructor=childCtor;if($jscomp.setPrototypeOf){var setPrototypeOf=$jscomp.setPrototypeOf;setPrototypeOf(childCtor,parentCtor)}else for(setPrototypeOf in parentCtor)if("prototype"!=setPrototypeOf)if(Object.defineProperties){var descriptor=Object.getOwnPropertyDescriptor(parentCtor,setPrototypeOf);descriptor&&Object.defineProperty(childCtor,setPrototypeOf,descriptor)}else childCtor[setPrototypeOf]=
parentCtor[setPrototypeOf];childCtor.superClass_=parentCtor.prototype};$jscomp.getGlobal=function(maybeGlobal){return"undefined"!=typeof window&&window===maybeGlobal?maybeGlobal:"undefined"!=typeof global&&null!=global?global:maybeGlobal};$jscomp.global=$jscomp.getGlobal(this);$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(target,property,descriptor){target!=Array.prototype&&target!=Object.prototype&&(target[property]=descriptor.value)};
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var counter=0;return function(opt_description){return $jscomp.SYMBOL_PREFIX+(opt_description||"")+counter++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var symbolIterator=$jscomp.global.Symbol.iterator;symbolIterator||(symbolIterator=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[symbolIterator]&&$jscomp.defineProperty(Array.prototype,symbolIterator,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var symbolAsyncIterator=$jscomp.global.Symbol.asyncIterator;symbolAsyncIterator||(symbolAsyncIterator=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(next){$jscomp.initSymbolIterator();next={next:next};next[$jscomp.global.Symbol.iterator]=function(){return this};return next};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(result){if(!(result instanceof Object))throw new TypeError("Iterator result "+result+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(value){this.yieldResult=value};
$jscomp.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(value){this.abruptCompletion_={return:value};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(nextAddress){this.abruptCompletion_={jumpTo:nextAddress};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.yield=function(value,resumeAddress){this.nextAddress=resumeAddress;return{value:value}};$jscomp.generator.Context.prototype.yieldAll=function(iterable,resumeAddress){iterable=$jscomp.makeIterator(iterable);var result=iterable.next();$jscomp.generator.ensureIteratorResultIsObject_(result);if(result.done)this.yieldResult=result.value,this.nextAddress=resumeAddress;else return this.yieldAllIterator_=iterable,this.yield(result.value,resumeAddress)};
$jscomp.generator.Context.prototype.jumpTo=function(nextAddress){this.nextAddress=nextAddress};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(catchAddress,finallyAddress){this.catchAddress_=catchAddress;void 0!=finallyAddress&&(this.finallyAddress_=finallyAddress)};$jscomp.generator.Context.prototype.setFinallyBlock=function(finallyAddress){this.catchAddress_=0;this.finallyAddress_=finallyAddress||0};
$jscomp.generator.Context.prototype.leaveTryBlock=function(nextAddress,catchAddress){this.nextAddress=nextAddress;this.catchAddress_=catchAddress||0};$jscomp.generator.Context.prototype.enterCatchBlock=function(nextCatchBlockAddress){this.catchAddress_=nextCatchBlockAddress||0;nextCatchBlockAddress=this.abruptCompletion_.exception;this.abruptCompletion_=null;return nextCatchBlockAddress};
$jscomp.generator.Context.prototype.enterFinallyBlock=function(nextCatchAddress,nextFinallyAddress,finallyDepth){finallyDepth?this.finallyContexts_[finallyDepth]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=nextCatchAddress||0;this.finallyAddress_=nextFinallyAddress||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(nextAddress,finallyDepth){finallyDepth=this.finallyContexts_.splice(finallyDepth||0)[0];if(finallyDepth=this.abruptCompletion_=this.abruptCompletion_||finallyDepth){if(finallyDepth.isException)return this.jumpToErrorHandler_();void 0!=finallyDepth.jumpTo&&this.finallyAddress_<finallyDepth.jumpTo?(this.nextAddress=finallyDepth.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=nextAddress};
$jscomp.generator.Context.prototype.forIn=function(object){return new $jscomp.generator.Context.PropertyIterator(object)};$jscomp.generator.Context.PropertyIterator=function(object){this.object_=object;this.properties_=[];for(var property in object)this.properties_.push(property);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var property=this.properties_.pop();if(property in this.object_)return property}return null};
$jscomp.generator.Engine_=function(program){this.context_=new $jscomp.generator.Context;this.program_=program};$jscomp.generator.Engine_.prototype.next_=function(value){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,value,this.context_.next_);this.context_.next_(value);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(value){this.context_.start_();var yieldAllIterator=this.context_.yieldAllIterator_;if(yieldAllIterator)return this.yieldAllStep_("return"in yieldAllIterator?yieldAllIterator["return"]:function(v){return{value:v,done:!0}},value,this.context_.return);this.context_.return(value);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(exception){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],exception,this.context_.next_);this.context_.throw_(exception);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(action,value,nextAction){try{var result=action.call(this.context_.yieldAllIterator_,value);$jscomp.generator.ensureIteratorResultIsObject_(result);if(!result.done)return this.context_.stop_(),result;var resultValue=result.value}catch(e){return this.context_.yieldAllIterator_=null,this.context_.throw_(e),this.nextStep_()}this.context_.yieldAllIterator_=null;nextAction.call(this.context_,resultValue);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var yieldValue=this.program_(this.context_);if(yieldValue)return this.context_.stop_(),{value:yieldValue.value,done:!1}}catch(e){this.context_.yieldResult=void 0,this.context_.throw_(e)}this.context_.stop_();if(this.context_.abruptCompletion_){yieldValue=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(yieldValue.isException)throw yieldValue.exception;return{value:yieldValue.return,
done:!0}}return{value:void 0,done:!0}};$jscomp.generator.Generator_=function(engine){this.next=function(opt_value){return engine.next_(opt_value)};this.throw=function(exception){return engine.throw_(exception)};this.return=function(value){return engine.return_(value)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};
$jscomp.generator.createGenerator=function(generator,program){program=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(program));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(program,generator.prototype);return program};
shadow$provide.module$node_modules$vega_lite$build$vega_lite=function(global$jscomp$0,process,require,module,exports,shadow$shims){(function(global,factory){"object"===typeof exports&&"undefined"!==typeof module?factory(exports):"function"===typeof define&&define.amd?define(["exports"],factory):(global=global||self,factory(global.vl={}))})(this,function(exports){function accessor(fn,fields,name){fn.fields=fields||[];fn.fname=name;return fn}function splitAccessPath(p){function push(){path.push(s+p.substring(i,
j));s="";i=j+1}var path=[],q=null,b=0,n=p.length,s="",i,j;p+="";for(i=j=0;j<n;++j){var c=p[j];if("\\"===c)s+=p.substring(i,j),i=++j;else if(c===q)push(),q=null,b=-1;else if(!q)if(i===b&&'"'===c)i=j+1,q=c;else if(i===b&&"'"===c)i=j+1,q=c;else if("."===c&&!b)j>i?push():i=j+1;else if("["===c)j>i&&push(),b=i=j+1;else if("]"===c){if(!b)throw Error("Access path missing open bracket: "+p);0<b&&push();b=0;i=j+1}}if(b)throw Error("Access path missing closing bracket: "+p);if(q)throw Error("Access path missing closing quote: "+
p);j>i&&(j++,push());return path}function isObject(_){return _===Object(_)}function isString(_){return"string"===typeof _}function $(x){return isArray(x)?"["+x.map($)+"]":isObject(x)||isString(x)?JSON.stringify(x).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):x}function log(method,level,input){level=[level].concat([].slice.call(input));console[method].apply(null,$jscomp.arrayFromIterable(level))}function array$jscomp$0(_){return null!=_?isArray(_)?_:[_]:[]}function isBoolean(_){return"boolean"===
typeof _}function isNumber(_){return"number"===typeof _}function toSet(_){for(var s={},i=0,n=_.length;i<n;++i)s[_[i]]=!0;return s}function forEachLeaf(op,fn){if(op.not)forEachLeaf(op.not,fn);else if(op.and){var $jscomp$iter$35=$jscomp.makeIterator(op.and);for(op=$jscomp$iter$35.next();!op.done;op=$jscomp$iter$35.next())forEachLeaf(op.value,fn)}else if(op.or)for($jscomp$iter$35=$jscomp.makeIterator(op.or),op=$jscomp$iter$35.next();!op.done;op=$jscomp$iter$35.next())forEachLeaf(op.value,fn);else fn(op)}
function normalizeLogicalOperand(op,normalizer){return op.not?{not:normalizeLogicalOperand(op.not,normalizer)}:op.and?{and:op.and.map(function(o){return normalizeLogicalOperand(o,normalizer)})}:op.or?{or:op.or.map(function(o){return normalizeLogicalOperand(o,normalizer)})}:normalizer(op)}function pick(obj,props){var copy={};props=$jscomp.makeIterator(props);for(var $jscomp$key$prop=props.next();!$jscomp$key$prop.done;$jscomp$key$prop=props.next())$jscomp$key$prop=$jscomp$key$prop.value,obj.hasOwnProperty($jscomp$key$prop)&&
(copy[$jscomp$key$prop]=obj[$jscomp$key$prop]);return copy}function omit(obj,props){obj=Object.assign({},obj);props=$jscomp.makeIterator(props);for(var $jscomp$key$prop=props.next();!$jscomp$key$prop.done;$jscomp$key$prop=props.next())delete obj[$jscomp$key$prop.value];return obj}function hash(a){if(isNumber(a))return a;a=isString(a)?a:fastJsonStableStringify(a);if(250>a.length)return a;for(var h=0,i=0;i<a.length;i++){var char=a.charCodeAt(i);h=(h<<5)-h+char;h&=h}return h}function isNullOrFalse(x){return!1===
x||null===x}function contains(array,item){return-1<array.indexOf(item)}function some(arr,f){var i=0;arr=$jscomp.makeIterator(arr.entries());for(var $jscomp$key$=arr.next();!$jscomp$key$.done;$jscomp$key$=arr.next()){var $jscomp$destructuring$var1=$jscomp.makeIterator($jscomp$key$.value);$jscomp$key$=$jscomp$destructuring$var1.next().value;$jscomp$destructuring$var1=$jscomp$destructuring$var1.next().value;if(f($jscomp$destructuring$var1,$jscomp$key$,i++))return!0}return!1}function every(arr,f){var i=
0;arr=$jscomp.makeIterator(arr.entries());for(var $jscomp$key$=arr.next();!$jscomp$key$.done;$jscomp$key$=arr.next()){var $jscomp$destructuring$var3=$jscomp.makeIterator($jscomp$key$.value);$jscomp$key$=$jscomp$destructuring$var3.next().value;$jscomp$destructuring$var3=$jscomp$destructuring$var3.next().value;if(!f($jscomp$destructuring$var3,$jscomp$key$,i++))return!1}return!0}function flatten(arrays){return[].concat.apply([],$jscomp.arrayFromIterable(arrays))}function mergeDeep(dest$jscomp$0,src){for(var $jscomp$restParams=
[],$jscomp$restIndex=1;$jscomp$restIndex<arguments.length;++$jscomp$restIndex)$jscomp$restParams[$jscomp$restIndex-1]=arguments[$jscomp$restIndex];$jscomp$restParams=$jscomp.makeIterator($jscomp$restParams);for($jscomp$restIndex=$jscomp$restParams.next();!$jscomp$restIndex.done;$jscomp$restIndex=$jscomp$restParams.next()){$jscomp$restIndex=$jscomp$restIndex.value;var p=void 0,dest=dest$jscomp$0;if("object"===typeof $jscomp$restIndex&&null!==$jscomp$restIndex)for(p in $jscomp$restIndex)$jscomp$restIndex.hasOwnProperty(p)&&
void 0!==$jscomp$restIndex[p]&&("object"!==typeof $jscomp$restIndex[p]||isArray($jscomp$restIndex[p])||null===$jscomp$restIndex[p]?dest[p]=$jscomp$restIndex[p]:"object"!==typeof dest[p]||null===dest[p]?dest[p]=mergeDeep(isArray($jscomp$restIndex[p].constructor)?[]:{},$jscomp$restIndex[p]):mergeDeep(dest[p],$jscomp$restIndex[p]));dest$jscomp$0=dest}return dest$jscomp$0}function unique(values,f){var results=[],u={},v;values=$jscomp.makeIterator(values);for(v=values.next();!v.done;v=values.next()){var val=
v.value;v=f(val);v in u||(u[v]=1,results.push(val))}return results}function hasIntersection(a,b){a=$jscomp.makeIterator(a);for(var $jscomp$key$key=a.next();!$jscomp$key$key.done;$jscomp$key$key=a.next())if(b.has($jscomp$key$key.value))return!0;return!1}function prefixGenerator(a){var prefixes=new Set,$jscomp$loop$332={};a=$jscomp.makeIterator(a);for(var $jscomp$key$x=a.next();!$jscomp$key$x.done;$jscomp$loop$332={$jscomp$loop$prop$wrappedWithAccessors$333:$jscomp$loop$332.$jscomp$loop$prop$wrappedWithAccessors$333},
$jscomp$key$x=a.next())$jscomp$key$x=splitAccessPath($jscomp$key$x.value),$jscomp$loop$332.$jscomp$loop$prop$wrappedWithAccessors$333=$jscomp$key$x.map(function(y,i){return 0===i?y:"["+y+"]"}),$jscomp$loop$332.$jscomp$loop$prop$wrappedWithAccessors$333.map(function($jscomp$loop$332){return function(_,i){return $jscomp$loop$332.$jscomp$loop$prop$wrappedWithAccessors$333.slice(0,i+1).join("")}}($jscomp$loop$332)).forEach(function(y){return prefixes.add(y)});return prefixes}function vals(x){var _vals=
[],k;for(k in x)x.hasOwnProperty(k)&&_vals.push(x[k]);return _vals}function varName(s){var alphanumericS=s.replace(/\W/g,"_");return(s.match(/^\d+/)?"_":"")+alphanumericS}function logicalExpr(op,cb){return op.not?"!("+logicalExpr(op.not,cb)+")":op.and?"("+op.and.map(function(and){return logicalExpr(and,cb)}).join(") \x26\x26 (")+")":op.or?"("+op.or.map(function(or){return logicalExpr(or,cb)}).join(") || (")+")":cb(op)}function deleteNestedProperty(obj,orderedProps){if(0===orderedProps.length)return!0;
var prop=orderedProps.shift();deleteNestedProperty(obj[prop],orderedProps)&&delete obj[prop];return 0===keys(obj).length}function titlecase(s){return s.charAt(0).toUpperCase()+s.substr(1)}function accessPathWithDatum(path,datum){datum=void 0===datum?"datum":datum;path=splitAccessPath(path);for(var prefixes=[],i=1;i<=path.length;i++){var prefix="["+path.slice(0,i).map($).join("][")+"]";prefixes.push(""+datum+prefix)}return prefixes.join(" \x26\x26 ")}function replacePathInField(path){return""+splitAccessPath(path).map(function(p){return p.replace(".",
"\\.")}).join("\\.")}function accessPathDepth(path){return path?splitAccessPath(path).length:0}function getFirstDefined(args){for(var $jscomp$restParams=[],$jscomp$restIndex=0;$jscomp$restIndex<arguments.length;++$jscomp$restIndex)$jscomp$restParams[$jscomp$restIndex-0]=arguments[$jscomp$restIndex];$jscomp$restParams=$jscomp.makeIterator($jscomp$restParams);for($jscomp$restIndex=$jscomp$restParams.next();!$jscomp$restIndex.done;$jscomp$restIndex=$jscomp$restParams.next())if($jscomp$restIndex=$jscomp$restIndex.value,
void 0!==$jscomp$restIndex)return $jscomp$restIndex}function isPathMark(m){return contains(["line","area","trail"],m)}function isMarkDef(mark){return mark.type}function isUnitSpec(spec){return!!spec.mark}function __rest(s,e){var t={},p;for(p in s)Object.prototype.hasOwnProperty.call(s,p)&&0>e.indexOf(p)&&(t[p]=s[p]);if(null!=s&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)0>e.indexOf(p[i])&&Object.prototype.propertyIsEnumerable.call(s,
p[i])&&(t[p[i]]=s[p[i]])}return t}function isArgminDef(a){return!!a&&!!a.argmin}function isArgmaxDef(a){return!!a&&!!a.argmax}function getPositionChannelFromLatLong(channel){switch(channel){case "latitude":return"y";case "latitude2":return"y2";case "longitude":return"x";case "longitude2":return"x2"}}function isColorChannel(channel){return"color"===channel||"fill"===channel||"stroke"===channel}function isSecondaryRangeChannel(c){return getMainRangeChannel(c)!==c}function getMainRangeChannel(channel){switch(channel){case "x2":return"x";
case "y2":return"y";case "latitude2":return"latitude";case "longitude2":return"longitude"}return channel}function getSupportedMark(channel){switch(channel){case "color":case "fill":case "stroke":case "detail":case "key":case "tooltip":case "href":case "order":case "opacity":case "fillOpacity":case "strokeOpacity":case "strokeWidth":case "facet":case "row":case "column":return ALL_MARKS;case "x":case "y":case "latitude":case "longitude":return ALL_MARKS_EXCEPT_GEOSHAPE;case "x2":case "y2":case "latitude2":case "longitude2":return{rule:"always",
bar:"always",rect:"always",area:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case "size":return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case "shape":return{point:"always",geoshape:"always"};case "text":return{text:"always"}}}function rangeType(channel){switch(channel){case "x":case "y":case "size":case "strokeWidth":case "opacity":case "fillOpacity":case "strokeOpacity":case "x2":case "y2":return;
case "facet":case "row":case "column":case "shape":case "text":case "tooltip":case "href":return"discrete";case "color":case "fill":case "stroke":return"flexible";case "latitude":case "longitude":case "latitude2":case "longitude2":case "detail":case "key":case "order":return}throw Error("rangeType not implemented for "+channel);}function warn(_){for(var $jscomp$restIndex=0;$jscomp$restIndex<arguments.length;++$jscomp$restIndex);current.warn.apply(current,arguments)}function debug(_){for(var $jscomp$restIndex=
0;$jscomp$restIndex<arguments.length;++$jscomp$restIndex);current.debug.apply(current,arguments)}function isDateTime(o){return!!o&&(!!o.year||!!o.quarter||!!o.month||!!o.date||!!o.day||!!o.hours||!!o.minutes||!!o.seconds||!!o.milliseconds)}function dateTimeExpr(d,normalize,toJSON){normalize=void 0===normalize?!1:normalize;toJSON=void 0===toJSON?!1:toJSON;var units=[];normalize&&void 0!==d.day&&1<keys(d).length&&(warn(message$jscomp$0.droppedDay(d)),d=duplicate(d),delete d.day);void 0!==d.year?units.push(d.year):
void 0!==d.day?units.push(2006):units.push(0);if(void 0!==d.month){if(normalize){var JSCompiler_temp=d.month;if(isNumber(JSCompiler_temp))JSCompiler_temp=(JSCompiler_temp-1).toString();else{var lowerM=JSCompiler_temp.toLowerCase(),monthIndex=MONTHS.indexOf(lowerM);if(-1!==monthIndex)JSCompiler_temp=monthIndex+"";else if(lowerM=lowerM.substr(0,3),lowerM=SHORT_MONTHS.indexOf(lowerM),-1!==lowerM)JSCompiler_temp=lowerM+"";else throw Error(message$jscomp$0.invalidTimeUnit("month",JSCompiler_temp));}}else JSCompiler_temp=
d.month;units.push(JSCompiler_temp)}else if(void 0!==d.quarter){if(normalize)if(JSCompiler_temp=d.quarter,isNumber(JSCompiler_temp))4<JSCompiler_temp&&warn(message$jscomp$0.invalidTimeUnit("quarter",JSCompiler_temp)),JSCompiler_temp=(JSCompiler_temp-1).toString();else throw Error(message$jscomp$0.invalidTimeUnit("quarter",JSCompiler_temp));else JSCompiler_temp=d.quarter;units.push(JSCompiler_temp+"*3")}else units.push(0);if(void 0!==d.date)units.push(d.date);else if(void 0!==d.day){if(normalize)if(normalize=
d.day,isNumber(normalize))normalize=normalize%7+"";else if(JSCompiler_temp=normalize.toLowerCase(),lowerM=DAYS.indexOf(JSCompiler_temp),-1!==lowerM)normalize=lowerM+"";else if(JSCompiler_temp=JSCompiler_temp.substr(0,3),JSCompiler_temp=SHORT_DAYS.indexOf(JSCompiler_temp),-1!==JSCompiler_temp)normalize=JSCompiler_temp+"";else throw Error(message$jscomp$0.invalidTimeUnit("day",normalize));else normalize=d.day;units.push(normalize+"+1")}else units.push(1);normalize=$jscomp.makeIterator(["hours","minutes",
"seconds","milliseconds"]);for(JSCompiler_temp=normalize.next();!JSCompiler_temp.done;JSCompiler_temp=normalize.next())JSCompiler_temp=JSCompiler_temp.value,void 0!==d[JSCompiler_temp]?units.push(d[JSCompiler_temp]):units.push(0);units=units.join(", ");return toJSON?d.utc?(new Function("return new Date(Date.UTC("+units+"))"))().toJSON():(new Function("return new Date("+units+")"))().toJSON():d.utc?"utc("+units+")":"datetime("+units+")"}function isFacetMapping(f){return!!f.row||!!f.column}function getTimeUnitParts(timeUnit){return TIMEUNIT_PARTS.reduce(function(parts,
part){return containsTimeUnit(timeUnit,part)?[].concat($jscomp.arrayFromIterable(parts),[part]):parts},[])}function containsTimeUnit(fullTimeUnit,timeUnit){var index=fullTimeUnit.indexOf(timeUnit);return-1<index&&(timeUnit!==TimeUnit.SECONDS||0===index||"i"!==fullTimeUnit.charAt(index-1))}function fieldExpr(fullTimeUnit,field){var fieldRef=accessPathWithDatum(field),utc=UTC_TIMEUNIT_INDEX[fullTimeUnit]?"utc":"";field=TIMEUNIT_PARTS.reduce(function(dateExpr,tu){if(containsTimeUnit(fullTimeUnit,tu)){var JSCompiler_inline_result=
tu===TimeUnit.QUARTER?"("+utc+"quarter("+fieldRef+")-1)":""+utc+tu+"("+fieldRef+")";dateExpr[tu]=JSCompiler_inline_result}return dateExpr},{});return dateTimeExpr(field)}function getDateTimeComponents(timeUnit,shortTimeLabels){if(timeUnit){var dateComponents=[],hasYear=containsTimeUnit(timeUnit,TimeUnit.YEAR);containsTimeUnit(timeUnit,TimeUnit.MONTH)&&dateComponents.push(!1!==shortTimeLabels?"%b":"%B");containsTimeUnit(timeUnit,TimeUnit.DAY)?dateComponents.push(shortTimeLabels?"%a":"%A"):containsTimeUnit(timeUnit,
TimeUnit.DATE)&&dateComponents.push("%d"+(hasYear?",":""));hasYear&&dateComponents.push(shortTimeLabels?"%y":"%Y");shortTimeLabels=[];containsTimeUnit(timeUnit,TimeUnit.HOURS)&&shortTimeLabels.push("%H");containsTimeUnit(timeUnit,TimeUnit.MINUTES)&&shortTimeLabels.push("%M");containsTimeUnit(timeUnit,TimeUnit.SECONDS)&&shortTimeLabels.push("%S");containsTimeUnit(timeUnit,TimeUnit.MILLISECONDS)&&shortTimeLabels.push("%L");timeUnit=[];0<dateComponents.length&&timeUnit.push(dateComponents.join(" "));
0<shortTimeLabels.length&&timeUnit.push(shortTimeLabels.join(":"));return timeUnit}}function normalizeTimeUnit(timeUnit){return"day"!==timeUnit&&0<=timeUnit.indexOf("day")?(warn(message$jscomp$0.dayReplacedWithDate(timeUnit)),timeUnit.replace("day","date")):timeUnit}function getFullName(type){if(type)switch(type=type.toLowerCase(),type){case "q":case "quantitative":return"quantitative";case "t":case "temporal":return"temporal";case "o":case "ordinal":return"ordinal";case "n":case "nominal":return"nominal";
case "geojson":return"geojson"}}function toFieldDefBase(fieldDef){var timeUnit=fieldDef.timeUnit,bin=fieldDef.bin,aggregate=fieldDef.aggregate;return Object.assign({},timeUnit?{timeUnit:timeUnit}:{},bin?{bin:bin}:{},aggregate?{aggregate:aggregate}:{},{field:fieldDef.field})}function hasConditionalFieldDef(channelDef){return!!channelDef&&!!channelDef.condition&&!isArray(channelDef.condition)&&isFieldDef(channelDef.condition)}function isFieldDef(channelDef){return!!channelDef&&(!!channelDef.field||
"count"===channelDef.aggregate)}function isTypedFieldDef(channelDef){return!!channelDef&&(!!channelDef.field&&!!channelDef.type||"count"===channelDef.aggregate)}function isValueDef(channelDef){return channelDef&&"value"in channelDef&&void 0!==channelDef.value}function isScaleFieldDef(channelDef){return!!channelDef&&(!!channelDef.scale||!!channelDef.sort)}function vgField(fieldDef,opt){opt=void 0===opt?{}:opt;var field=fieldDef.field,prefix=opt.prefix,suffix=opt.suffix,argAccessor="";if("count"===
fieldDef.aggregate)field="__count";else{if(!opt.nofn)if(fieldDef.op)var fn=fieldDef.op;else{var bin$210=fieldDef.bin,aggregate=fieldDef.aggregate;fieldDef=fieldDef.timeUnit;isBinning(bin$210)?(fn=binToString(bin$210),suffix=(opt.binSuffix||"")+(opt.suffix||"")):aggregate?isArgmaxDef(aggregate)?(argAccessor="."+field,field="argmax_"+aggregate.argmax):isArgminDef(aggregate)?(argAccessor="."+field,field="argmin_"+aggregate.argmin):fn=String(aggregate):fieldDef&&(fn=String(fieldDef))}fn&&(field=field?
fn+"_"+field:fn)}suffix&&(field=field+"_"+suffix);prefix&&(field=prefix+"_"+field);return opt.forAs?field:opt.expr?(opt=opt.expr,(void 0===opt?"datum":opt)+"["+$(splitAccessPath(field).join("."))+"]"+argAccessor):replacePathInField(field)+argAccessor}function isDiscrete(fieldDef){switch(fieldDef.type){case "nominal":case "ordinal":case "geojson":return!0;case "quantitative":return!!fieldDef.bin;case "temporal":return!1}throw Error(message$jscomp$0.invalidFieldType(fieldDef.type));}function verbalTitleFormatter(fieldDef,
config){var field=fieldDef.field,timeUnit=fieldDef.timeUnit,aggregate=fieldDef.aggregate;return"count"===aggregate?config.countTitle:isBinning(fieldDef.bin)?field+" (binned)":timeUnit?(fieldDef=getTimeUnitParts(timeUnit).join("-"),field+" ("+fieldDef+")"):aggregate?isArgmaxDef(aggregate)?field+" for max "+aggregate.argmax:isArgminDef(aggregate)?field+" for min "+aggregate.argmin:titlecase(aggregate)+" of "+field:field}function title$jscomp$0(fieldDef,config,$jscomp$destructuring$var10){var allowDisabling=
$jscomp$destructuring$var10.allowDisabling,includeDefault=void 0===$jscomp$destructuring$var10.includeDefault?!0:$jscomp$destructuring$var10.includeDefault;$jscomp$destructuring$var10=(getGuide(fieldDef)||{}).title;config=includeDefault?titleFormatter(fieldDef,config):void 0;return allowDisabling?getFirstDefined($jscomp$destructuring$var10,fieldDef.title,config):$jscomp$destructuring$var10||fieldDef.title||config}function getGuide(fieldDef){if(fieldDef&&(fieldDef.axis||fieldDef.stack||fieldDef.impute)&&
fieldDef.axis)return fieldDef.axis;if(fieldDef&&fieldDef.legend&&fieldDef.legend)return fieldDef.legend;if(fieldDef&&fieldDef.header&&fieldDef.header)return fieldDef.header}function format$jscomp$0(fieldDef){return fieldDef&&fieldDef.format&&fieldDef.format?fieldDef.format:(getGuide(fieldDef)||{}).format}function defaultType(fieldDef,channel){if(fieldDef.timeUnit)return"temporal";if(isBinning(fieldDef.bin))return"quantitative";switch(rangeType(channel)){case "continuous":return"quantitative";case "discrete":return"nominal";
case "flexible":return"nominal";default:return"quantitative"}}function getFieldDef(channelDef){if(isFieldDef(channelDef))return channelDef;if(hasConditionalFieldDef(channelDef))return channelDef.condition}function getTypedFieldDef(channelDef){if(isFieldDef(channelDef))return channelDef;if(hasConditionalFieldDef(channelDef))return channelDef.condition}function normalize(channelDef,channel){if(isString(channelDef)||isNumber(channelDef)||isBoolean(channelDef)){var primitiveType=isString(channelDef)?
"string":isNumber(channelDef)?"number":"boolean";warn(message$jscomp$0.primitiveChannelDef(channel,primitiveType,channelDef));return{value:channelDef}}return isFieldDef(channelDef)?normalizeFieldDef(channelDef,channel):hasConditionalFieldDef(channelDef)?Object.assign({},channelDef,{condition:normalizeFieldDef(channelDef.condition,channel)}):channelDef}function normalizeFieldDef(fieldDef,channel){var $jscomp$destructuring$var12=fieldDef,aggregate=$jscomp$destructuring$var12.aggregate,timeUnit=$jscomp$destructuring$var12.timeUnit;
$jscomp$destructuring$var12=$jscomp$destructuring$var12.bin;!aggregate||isString(aggregate)&&AGGREGATE_OP_INDEX[aggregate]||isArgmaxDef(aggregate)||isArgminDef(aggregate)||(fieldDef=__rest(fieldDef,["aggregate"]),warn(message$jscomp$0.invalidAggregate(aggregate)));timeUnit&&(fieldDef=Object.assign({},fieldDef,{timeUnit:normalizeTimeUnit(timeUnit)}));isBinning($jscomp$destructuring$var12)&&(fieldDef=Object.assign({},fieldDef,{bin:normalizeBin($jscomp$destructuring$var12,channel)}));isBinned($jscomp$destructuring$var12)&&
!contains(POSITION_SCALE_CHANNELS,channel)&&warn("Channel "+channel+' should not be used with "binned" bin');isTypedFieldDef(fieldDef)?(timeUnit=fieldDef.type,$jscomp$destructuring$var12=getFullName(timeUnit),timeUnit!==$jscomp$destructuring$var12&&(fieldDef=Object.assign({},fieldDef,{type:$jscomp$destructuring$var12})),"quantitative"!==timeUnit&&aggregate&&isString(aggregate)&&contains(COUNTING_OPS,aggregate)&&(warn(message$jscomp$0.invalidFieldTypeForCountAggregate(timeUnit,aggregate)),fieldDef=
Object.assign({},fieldDef,{type:"quantitative"}))):isSecondaryRangeChannel(channel)||(aggregate=defaultType(fieldDef,channel),warn(message$jscomp$0.missingFieldType(channel,aggregate)),fieldDef=Object.assign({},fieldDef,{type:aggregate}));isTypedFieldDef(fieldDef)&&(channel=channelCompatibility(fieldDef,channel),aggregate=channel.warning,channel.compatible||warn(aggregate));return Object.assign({},fieldDef,void 0!==fieldDef.field?{field:""+fieldDef.field}:{})}function normalizeBin(bin,channel){return isBoolean(bin)?
{maxbins:autoMaxBins(channel)}:"binned"===bin?{binned:!0}:bin.maxbins||bin.step?bin:Object.assign({},bin,{maxbins:autoMaxBins(channel)})}function channelCompatibility(fieldDef,channel){var type=fieldDef.type;if("geojson"===type&&"shape"!==channel)return{compatible:!1,warning:"Channel "+channel+" should not be used with a geojson data."};switch(channel){case "row":case "column":case "facet":return isDiscrete(fieldDef)?COMPATIBLE:{compatible:!1,warning:message$jscomp$0.facetChannelShouldBeDiscrete(channel)};
case "x":case "y":case "color":case "fill":case "stroke":case "text":case "detail":case "key":case "tooltip":case "href":return COMPATIBLE;case "longitude":case "longitude2":case "latitude":case "latitude2":return"quantitative"!==type?{compatible:!1,warning:"Channel "+channel+" should be used with a quantitative field only, not "+fieldDef.type+" field."}:COMPATIBLE;case "opacity":case "fillOpacity":case "strokeOpacity":case "strokeWidth":case "size":case "x2":case "y2":return"nominal"!==type||fieldDef.sort?
COMPATIBLE:{compatible:!1,warning:"Channel "+channel+" should not be used with an unsorted discrete field."};case "shape":return contains(["ordinal","nominal","geojson"],fieldDef.type)?COMPATIBLE:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case "order":return"nominal"!==fieldDef.type||"sort"in fieldDef?COMPATIBLE:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}throw Error("channelCompatability not implemented for channel "+
channel);}function isTimeFormatFieldDef(fieldDef){var guide=getGuide(fieldDef);guide=guide&&guide.formatType||!!fieldDef&&!!fieldDef.format&&fieldDef.formatType;return"time"===guide||!guide&&("temporal"===fieldDef.type||!!fieldDef.timeUnit)}function valueExpr(v,$jscomp$destructuring$var15){var timeUnit=$jscomp$destructuring$var15.timeUnit,type=$jscomp$destructuring$var15.type,time=$jscomp$destructuring$var15.time;$jscomp$destructuring$var15=$jscomp$destructuring$var15.undefinedIfExprNotRequired;if(isDateTime(v))var expr=
dateTimeExpr(v,!0);else if(isString(v)||isNumber(v))if(timeUnit||"temporal"===type)LOCAL_SINGLE_TIMEUNIT_INDEX[timeUnit]?(type={},expr=dateTimeExpr((type[timeUnit]=v,type),!0)):expr=UTC_SINGLE_TIMEUNIT_INDEX[timeUnit]?valueExpr(v,{timeUnit:timeUnit.substr(3)}):"datetime("+JSON.stringify(v)+")";return expr?time?"time("+expr+")":expr:$jscomp$destructuring$var15?void 0:JSON.stringify(v)}function valueArray(fieldDef,values){var timeUnit=fieldDef.timeUnit,type=fieldDef.type;return values.map(function(v){var expr=
valueExpr(v,{timeUnit:timeUnit,type:type,undefinedIfExprNotRequired:!0});return void 0!==expr?{signal:expr}:v})}function binRequiresRange(fieldDef,channel){return isBinning(fieldDef.bin)?!!SCALE_CHANNEL_INDEX[channel]&&contains(["ordinal","nominal"],fieldDef.type):(console.warn("Only use this method with binned field defs"),!1)}function binToString(bin){isBoolean(bin)&&(bin=normalizeBin(bin,void 0));return"bin"+keys(bin).map(function(p){return varName("_"+p+"_"+bin[p])}).join("")}function isBinning(bin){return!0===
bin||isObject(bin)&&!bin.binned}function isBinned(bin){return"binned"===bin||isObject(bin)&&bin.binned}function autoMaxBins(channel){switch(channel){case "row":case "column":case "size":case "color":case "fill":case "stroke":case "strokeWidth":case "opacity":case "fillOpacity":case "strokeOpacity":case "shape":return 6;default:return 10}}function channelHasField(encoding,channel){return(encoding=encoding&&encoding[channel])?isArray(encoding)?some(encoding,function(fieldDef){return!!fieldDef.field}):
isFieldDef(encoding)||hasConditionalFieldDef(encoding):!1}function isAggregate(encoding){return some(CHANNELS,function(channel){return channelHasField(encoding,channel)?(channel=encoding[channel],isArray(channel)?some(channel,function(fieldDef){return!!fieldDef.aggregate}):(channel=getFieldDef(channel))&&!!channel.aggregate):!1})}function extractTransformsFromEncoding(oldEncoding,config){var groupby=[],bins=[],timeUnits=[],aggregate=[],encoding={};forEach(oldEncoding,function(channelDef,channel){if(isFieldDef(channelDef)){var field$212=
channelDef.field,aggOp=channelDef.aggregate,timeUnit=channelDef.timeUnit,bin$213=channelDef.bin,remaining=__rest(channelDef,["field","aggregate","timeUnit","bin"]);if(aggOp||timeUnit||bin$213){var guide=getGuide(channelDef),isTitleDefined=guide&&guide.title;guide=vgField(channelDef,{forAs:!0});remaining=Object.assign({},isTitleDefined?[]:{title:title$jscomp$0(channelDef,config,{allowDisabling:!0})},remaining,{field:guide});isTitleDefined="x"===channel||"y"===channel;if(aggOp){if(isArgmaxDef(aggOp)){var op=
"argmax";guide=vgField({aggregate:"argmax",field:aggOp.argmax},{forAs:!0});remaining.field=guide+"."+field$212}else isArgminDef(aggOp)?(op="argmin",guide=vgField({aggregate:"argmin",field:aggOp.argmin},{forAs:!0}),remaining.field=guide+"."+field$212):"boxplot"!==aggOp&&"errorbar"!==aggOp&&"errorband"!==aggOp&&(op=aggOp);op&&(channelDef={op:op,as:guide},field$212&&(channelDef.field=field$212),aggregate.push(channelDef))}else groupby.push(guide),isTypedFieldDef(channelDef)&&isBinning(bin$213)?(bins.push({bin:bin$213,
field:field$212,as:guide}),groupby.push(vgField(channelDef,{binSuffix:"end"})),binRequiresRange(channelDef,channel)&&groupby.push(vgField(channelDef,{binSuffix:"range"})),isTitleDefined&&(encoding[channel+"2"]={field:guide+"_end"}),remaining.bin="binned",isSecondaryRangeChannel(channel)||(remaining.type="quantitative")):timeUnit&&(timeUnits.push({timeUnit:timeUnit,field:field$212,as:guide}),field$212=getDateTimeComponents(timeUnit,config.axis.shortTimeLabels).join(" "),channelDef=isTypedFieldDef(channelDef)&&
"temporal"!==channelDef.type&&"time","text"===channel||"tooltip"===channel?(remaining.format=remaining.format||field$212,channelDef&&(remaining.formatType=channelDef)):NONPOSITION_CHANNEL_INDEX[channel]?remaining.legend=Object.assign({format:field$212},channelDef?{formatType:channelDef}:{},remaining.legend):isTitleDefined&&(remaining.axis=Object.assign({format:field$212},channelDef?{formatType:channelDef}:{},remaining.axis)));encoding[channel]=remaining}else groupby.push(field$212),encoding[channel]=
oldEncoding[channel]}else encoding[channel]=oldEncoding[channel]});return{bins:bins,timeUnits:timeUnits,aggregate:aggregate,groupby:groupby,encoding:encoding}}function markChannelCompatible(encoding,channel,mark){mark=getSupportedMark(channel)[mark];return mark&&("binned"!==mark||(mark=encoding["x2"===channel?"x":"y"],isFieldDef(mark)&&isFieldDef(encoding[channel])&&isBinned(mark.bin)))?!0:!1}function normalizeEncoding(encoding,mark){return keys(encoding).reduce(function(normalizedEncoding,channel){if(!CHANNEL_INDEX[channel])return warn(message$jscomp$0.invalidEncodingChannel(channel)),
normalizedEncoding;if(!markChannelCompatible(encoding,channel,mark))return warn(message$jscomp$0.incompatibleChannel(channel,mark)),normalizedEncoding;if("size"===channel&&"line"===mark){var fieldDef$jscomp$0=getTypedFieldDef(encoding[channel]);if(fieldDef$jscomp$0&&fieldDef$jscomp$0.aggregate)return warn(message$jscomp$0.LINE_WITH_VARYING_SIZE),normalizedEncoding}if("color"===channel&&("fill"in encoding||"stroke"in encoding))return warn(message$jscomp$0.droppingColor("encoding",{fill:"fill"in encoding,
stroke:"stroke"in encoding})),normalizedEncoding;fieldDef$jscomp$0=encoding[channel];if("detail"===channel||"order"===channel&&!isArray(fieldDef$jscomp$0)&&!isValueDef(fieldDef$jscomp$0)||"tooltip"===channel&&isArray(fieldDef$jscomp$0))fieldDef$jscomp$0&&(normalizedEncoding[channel]=(isArray(fieldDef$jscomp$0)?fieldDef$jscomp$0:[fieldDef$jscomp$0]).reduce(function(defs,fieldDef){isFieldDef(fieldDef)?defs.push(normalizeFieldDef(fieldDef,channel)):warn(message$jscomp$0.emptyFieldDef(fieldDef,channel));
return defs},[]));else{if("tooltip"===channel&&null===fieldDef$jscomp$0)normalizedEncoding[channel]=null;else if(!(isFieldDef(fieldDef$jscomp$0)||isValueDef(fieldDef$jscomp$0)||fieldDef$jscomp$0&&fieldDef$jscomp$0.condition))return warn(message$jscomp$0.emptyFieldDef(fieldDef$jscomp$0,channel)),normalizedEncoding;normalizedEncoding[channel]=normalize(fieldDef$jscomp$0,channel)}return normalizedEncoding},{})}function fieldDefs(encoding){for(var arr=[],$jscomp$iter$48=$jscomp.makeIterator(keys(encoding)),
$jscomp$key$channel=$jscomp$iter$48.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$48.next())$jscomp$key$channel=$jscomp$key$channel.value,channelHasField(encoding,$jscomp$key$channel)&&($jscomp$key$channel=encoding[$jscomp$key$channel],(isArray($jscomp$key$channel)?$jscomp$key$channel:[$jscomp$key$channel]).forEach(function(def){isFieldDef(def)?arr.push(def):hasConditionalFieldDef(def)&&arr.push(def.condition)}));return arr}function forEach(mapping,f,thisArg){if(mapping)for(var $jscomp$loop$334=
{},$jscomp$iter$49=$jscomp.makeIterator(keys(mapping)),$jscomp$key$channel=$jscomp$iter$49.next();!$jscomp$key$channel.done;$jscomp$loop$334={$jscomp$loop$prop$channel$335:$jscomp$loop$334.$jscomp$loop$prop$channel$335},$jscomp$key$channel=$jscomp$iter$49.next())$jscomp$loop$334.$jscomp$loop$prop$channel$335=$jscomp$key$channel.value,$jscomp$key$channel=mapping[$jscomp$loop$334.$jscomp$loop$prop$channel$335],isArray($jscomp$key$channel)?$jscomp$key$channel.forEach(function($jscomp$loop$334){return function(channelDef){f.call(thisArg,
channelDef,$jscomp$loop$334.$jscomp$loop$prop$channel$335)}}($jscomp$loop$334)):f.call(thisArg,$jscomp$key$channel,$jscomp$loop$334.$jscomp$loop$prop$channel$335)}function reduce(mapping,f,init,thisArg){return mapping?keys(mapping).reduce(function(r,channel){var map=mapping[channel];return isArray(map)?map.reduce(function(r1,channelDef){return f.call(thisArg,r1,channelDef,channel)},r):f.call(thisArg,r,map,channel)},init):init}function pathGroupingFields(mark,encoding){return keys(encoding).reduce(function(details,
channel){switch(channel){case "x":case "y":case "href":case "x2":case "y2":case "latitude":case "longitude":case "latitude2":case "longitude2":case "text":case "shape":case "tooltip":return details;case "order":if("line"===mark||"trail"===mark)return details;case "detail":case "key":return channel=encoding[channel],(isArray(channel)||isFieldDef(channel))&&(isArray(channel)?channel:[channel]).forEach(function(fieldDef){fieldDef.aggregate||details.push(vgField(fieldDef,{}))}),details;case "size":if("trail"===
mark)return details;case "color":case "fill":case "stroke":case "opacity":case "fillOpacity":case "strokeOpacity":case "strokeWidth":return(channel=getTypedFieldDef(encoding[channel]))&&!channel.aggregate&&details.push(vgField(channel,{})),details}},[])}function filterTooltipWithAggregatedField(oldEncoding){var tooltip=oldEncoding.tooltip,filteredEncoding=__rest(oldEncoding,["tooltip"]);if(!tooltip)return{filteredEncoding:oldEncoding};var customTooltipWithAggregatedField,customTooltipWithoutAggregatedField;
isArray(tooltip)?(tooltip.forEach(function(t){t.aggregate?(customTooltipWithAggregatedField||(customTooltipWithAggregatedField=[]),customTooltipWithAggregatedField.push(t)):(customTooltipWithoutAggregatedField||(customTooltipWithoutAggregatedField=[]),customTooltipWithoutAggregatedField.push(t))}),customTooltipWithAggregatedField&&(filteredEncoding.tooltip=customTooltipWithAggregatedField)):tooltip.aggregate?filteredEncoding.tooltip=tooltip:customTooltipWithoutAggregatedField=tooltip;isArray(customTooltipWithoutAggregatedField)&&
1===customTooltipWithoutAggregatedField.length&&(customTooltipWithoutAggregatedField=customTooltipWithoutAggregatedField[0]);return{customTooltipWithoutAggregatedField:customTooltipWithoutAggregatedField,filteredEncoding:filteredEncoding}}function getCompositeMarkTooltip(tooltipSummary,continuousAxisChannelDef,encodingWithoutContinuousAxis,withFieldName){withFieldName=void 0===withFieldName?!0:withFieldName;if("tooltip"in encodingWithoutContinuousAxis)return{tooltip:encodingWithoutContinuousAxis.tooltip};
tooltipSummary=tooltipSummary.map(function($jscomp$destructuring$var20){return{field:$jscomp$destructuring$var20.fieldPrefix+continuousAxisChannelDef.field,type:continuousAxisChannelDef.type,title:$jscomp$destructuring$var20.titlePrefix+(withFieldName?" of "+continuousAxisChannelDef.field:"")}});return{tooltip:[].concat($jscomp.arrayFromIterable(tooltipSummary),$jscomp.arrayFromIterable(fieldDefs(encodingWithoutContinuousAxis)))}}function makeCompositeAggregatePartFactory(compositeMarkDef,continuousAxis,
continuousAxisChannelDef,sharedEncoding,compositeMarkConfig){var scale=continuousAxisChannelDef.scale,axis=continuousAxisChannelDef.axis;return function($jscomp$destructuring$var23){var endPositionPrefix=void 0===$jscomp$destructuring$var23.endPositionPrefix?void 0:$jscomp$destructuring$var23.endPositionPrefix,extraEncoding=void 0===$jscomp$destructuring$var23.extraEncoding?{}:$jscomp$destructuring$var23.extraEncoding,title=axis&&void 0!==axis.title?void 0:void 0!==continuousAxisChannelDef.title?
continuousAxisChannelDef.title:continuousAxisChannelDef.field,$jscomp$compprop1={},$jscomp$compprop2={};return partLayerMixins(compositeMarkDef,$jscomp$destructuring$var23.partName,compositeMarkConfig,{mark:$jscomp$destructuring$var23.mark,encoding:Object.assign(($jscomp$compprop1[continuousAxis]=Object.assign({field:$jscomp$destructuring$var23.positionPrefix+"_"+continuousAxisChannelDef.field,type:continuousAxisChannelDef.type},title?{title:title}:{},scale?{scale:scale}:{},axis?{axis:axis}:{}),$jscomp$compprop1),
isString(endPositionPrefix)?($jscomp$compprop2[continuousAxis+"2"]={field:endPositionPrefix+"_"+continuousAxisChannelDef.field,type:continuousAxisChannelDef.type},$jscomp$compprop2):{},sharedEncoding,extraEncoding)})}}function partLayerMixins(markDef,part,compositeMarkConfig,partBaseSpec){var clip=markDef.clip,color=markDef.color,opacity=markDef.opacity,mark=markDef.type;return markDef[part]||void 0===markDef[part]&&compositeMarkConfig[part]?[Object.assign({},partBaseSpec,{mark:Object.assign({},compositeMarkConfig[part],
clip?{clip:clip}:{},color?{color:color}:{},opacity?{opacity:opacity}:{},isMarkDef(partBaseSpec.mark)?partBaseSpec.mark:{type:partBaseSpec.mark},{style:mark+"-"+part},isBoolean(markDef[part])?{}:markDef[part])})]:[]}function compositeMarkContinuousAxis(spec,orient,compositeMark){spec=spec.encoding;orient="vertical"===orient?"y":"x";var continuousAxisChannelDef2=spec[orient+"2"],continuousAxisChannelDefError=spec[orient+"Error"],continuousAxisChannelDefError2=spec[orient+"Error2"];return{continuousAxisChannelDef:filterAggregateFromChannelDef(spec[orient],
compositeMark),continuousAxisChannelDef2:filterAggregateFromChannelDef(continuousAxisChannelDef2,compositeMark),continuousAxisChannelDefError:filterAggregateFromChannelDef(continuousAxisChannelDefError,compositeMark),continuousAxisChannelDefError2:filterAggregateFromChannelDef(continuousAxisChannelDefError2,compositeMark),continuousAxis:orient}}function filterAggregateFromChannelDef(continuousAxisChannelDef,compositeMark){if(continuousAxisChannelDef&&continuousAxisChannelDef.aggregate){var aggregate=
continuousAxisChannelDef.aggregate;continuousAxisChannelDef=__rest(continuousAxisChannelDef,["aggregate"]);aggregate!==compositeMark&&warn(message$jscomp$0.errorBarContinuousAxisHasCustomizedAggregate(aggregate,compositeMark))}return continuousAxisChannelDef}function compositeMarkOrient(spec,compositeMark){var mark=spec.mark;spec=spec.encoding;if(isFieldDef(spec.x)&&!isDiscrete(spec.x)){if(isFieldDef(spec.y)&&!isDiscrete(spec.y)){if(void 0===spec.x.aggregate&&spec.y.aggregate===compositeMark)return"vertical";
if(void 0!==spec.y.aggregate||spec.x.aggregate!==compositeMark){if(spec.x.aggregate===compositeMark&&spec.y.aggregate===compositeMark)throw Error("Both x and y cannot have aggregate");return isMarkDef(mark)&&mark.orient?mark.orient:"vertical"}}return"horizontal"}if(isFieldDef(spec.y)&&!isDiscrete(spec.y))return"vertical";throw Error("Need a valid continuous axis for "+compositeMark+"s");}function normalizeBoxPlot(spec,$jscomp$destructuring$var29){var config=$jscomp$destructuring$var29.config,mark=
spec.mark,selection=spec.selection;$jscomp$destructuring$var29=__rest(spec,["mark","encoding","selection","projection"]);mark=isMarkDef(mark)?mark:{type:mark};selection&&warn(message$jscomp$0.selectionNotSupported("boxplot"));var extent=mark.extent||config.boxplot.extent,sizeValue=getFirstDefined(mark.size,config.boxplot.size),boxPlotType=isNumber(extent)?"tukey":extent;var JSCompiler_object_inline_transform_1300=compositeMarkOrient(spec,"boxplot");var $jscomp$inline_1155=compositeMarkContinuousAxis(spec,
JSCompiler_object_inline_transform_1300,"boxplot");selection=$jscomp$inline_1155.continuousAxisChannelDef;$jscomp$inline_1155=$jscomp$inline_1155.continuousAxis;var continuousFieldName=selection.field,boxPlotType$jscomp$0=isNumber(extent)?"tukey":extent,boxplotSpecificAggregate=[].concat($jscomp.arrayFromIterable(boxParamsQuartiles(continuousFieldName)),[{op:"median",field:continuousFieldName,as:"mid_box_"+continuousFieldName},{op:"min",field:continuousFieldName,as:("min-max"===boxPlotType$jscomp$0?
"lower_whisker_":"min_")+continuousFieldName},{op:"max",field:continuousFieldName,as:("min-max"===boxPlotType$jscomp$0?"upper_whisker_":"max_")+continuousFieldName}]),postAggregateCalculates="min-max"===boxPlotType$jscomp$0||"tukey"===boxPlotType$jscomp$0?[]:[{calculate:'datum["upper_box_'+continuousFieldName+'"] - datum["lower_box_'+continuousFieldName+'"]',as:"iqr_"+continuousFieldName},{calculate:'min(datum["upper_box_'+continuousFieldName+'"] + datum["iqr_'+continuousFieldName+'"] * '+extent+
', datum["max_'+continuousFieldName+'"])',as:"upper_whisker_"+continuousFieldName},{calculate:'max(datum["lower_box_'+continuousFieldName+'"] - datum["iqr_'+continuousFieldName+'"] * '+extent+', datum["min_'+continuousFieldName+'"])',as:"lower_whisker_"+continuousFieldName}];spec=__rest(spec.encoding,["symbol"===typeof $jscomp$inline_1155?$jscomp$inline_1155:$jscomp$inline_1155+""]);continuousFieldName=filterTooltipWithAggregatedField(spec);spec=continuousFieldName.customTooltipWithoutAggregatedField;
var $jscomp$inline_1166=extractTransformsFromEncoding(continuousFieldName.filteredEncoding,config),timeUnits=$jscomp$inline_1166.timeUnits;continuousFieldName=$jscomp$inline_1166.aggregate;boxPlotType$jscomp$0=$jscomp$inline_1166.groupby;var encodingWithoutContinuousAxis=$jscomp$inline_1166.encoding,ticksOrient="vertical"===JSCompiler_object_inline_transform_1300?"horizontal":"vertical";JSCompiler_object_inline_transform_1300=[].concat($jscomp.arrayFromIterable($jscomp$inline_1166.bins),$jscomp.arrayFromIterable(timeUnits),
[{aggregate:[].concat($jscomp.arrayFromIterable(continuousFieldName),$jscomp.arrayFromIterable(boxplotSpecificAggregate)),groupby:boxPlotType$jscomp$0}],$jscomp.arrayFromIterable(postAggregateCalculates));timeUnits=encodingWithoutContinuousAxis.size;boxplotSpecificAggregate=__rest(encodingWithoutContinuousAxis,["color","size"]);$jscomp$inline_1166=makeCompositeAggregatePartFactory(mark,$jscomp$inline_1155,selection,boxplotSpecificAggregate,config.boxplot);postAggregateCalculates=makeCompositeAggregatePartFactory(mark,
$jscomp$inline_1155,selection,encodingWithoutContinuousAxis,config.boxplot);timeUnits=makeCompositeAggregatePartFactory(mark,$jscomp$inline_1155,selection,Object.assign({},boxplotSpecificAggregate,timeUnits?{size:timeUnits}:{}),config.boxplot);var fiveSummaryTooltipEncoding=getCompositeMarkTooltip([{fieldPrefix:"min-max"===boxPlotType?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},
{fieldPrefix:"min-max"===boxPlotType?"lower_whisker_":"min_",titlePrefix:"Min"}],selection,encodingWithoutContinuousAxis),endTick={type:"tick",color:"black",opacity:1,orient:ticksOrient};encodingWithoutContinuousAxis="min-max"===boxPlotType?fiveSummaryTooltipEncoding:getCompositeMarkTooltip([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],selection,encodingWithoutContinuousAxis);encodingWithoutContinuousAxis=[].concat($jscomp.arrayFromIterable($jscomp$inline_1166({partName:"rule",
mark:"rule",positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:encodingWithoutContinuousAxis})),$jscomp.arrayFromIterable($jscomp$inline_1166({partName:"rule",mark:"rule",positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:encodingWithoutContinuousAxis})),$jscomp.arrayFromIterable($jscomp$inline_1166({partName:"ticks",mark:endTick,positionPrefix:"lower_whisker",extraEncoding:encodingWithoutContinuousAxis})),$jscomp.arrayFromIterable($jscomp$inline_1166({partName:"ticks",
mark:endTick,positionPrefix:"upper_whisker",extraEncoding:encodingWithoutContinuousAxis})));sizeValue=[].concat($jscomp.arrayFromIterable("tukey"!==boxPlotType?encodingWithoutContinuousAxis:[]),$jscomp.arrayFromIterable(postAggregateCalculates({partName:"box",mark:Object.assign({type:"bar"},sizeValue?{size:sizeValue}:{}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:fiveSummaryTooltipEncoding})),$jscomp.arrayFromIterable(timeUnits({partName:"median",mark:Object.assign({type:"tick"},
isObject(config.boxplot.median)&&config.boxplot.median.color?{color:config.boxplot.median.color}:{},sizeValue?{size:sizeValue}:{},{orient:ticksOrient}),positionPrefix:"mid_box",extraEncoding:fiveSummaryTooltipEncoding})));if("min-max"!==boxPlotType)if(ticksOrient='datum["lower_box_'+selection.field+'"]',postAggregateCalculates='datum["upper_box_'+selection.field+'"]',$jscomp$inline_1166="("+postAggregateCalculates+" - "+ticksOrient+")",ticksOrient=ticksOrient+" - "+extent+" * "+$jscomp$inline_1166,
$jscomp$inline_1166=postAggregateCalculates+" + "+extent+" * "+$jscomp$inline_1166,timeUnits='datum["'+selection.field+'"]',extent={joinaggregate:boxParamsQuartiles(selection.field),groupby:boxPlotType$jscomp$0},postAggregateCalculates=void 0,"tukey"===boxPlotType&&(postAggregateCalculates={transform:[{filter:"("+ticksOrient+" \x3c\x3d "+timeUnits+") \x26\x26 ("+timeUnits+" \x3c\x3d "+$jscomp$inline_1166+")"},{aggregate:[{op:"min",field:selection.field,as:"lower_whisker_"+selection.field},{op:"max",
field:selection.field,as:"upper_whisker_"+selection.field},{op:"min",field:"lower_box_"+selection.field,as:"lower_box_"+selection.field},{op:"max",field:"upper_box_"+selection.field,as:"upper_box_"+selection.field}].concat($jscomp.arrayFromIterable(continuousFieldName)),groupby:boxPlotType$jscomp$0}],layer:encodingWithoutContinuousAxis}),boxPlotType=__rest(boxplotSpecificAggregate,["tooltip"]),continuousFieldName={},(config=partLayerMixins(mark,"outliers",config.boxplot,{transform:[{filter:"("+timeUnits+
" \x3c "+ticksOrient+") || ("+timeUnits+" \x3e "+$jscomp$inline_1166+")"}],mark:"point",encoding:Object.assign((continuousFieldName[$jscomp$inline_1155]={field:selection.field,type:selection.type},continuousFieldName),boxPlotType,spec?{tooltip:spec}:{})})[0])&&postAggregateCalculates)var filteredLayersMixins={transform:[extent],layer:[config,postAggregateCalculates]};else config?(filteredLayersMixins=config,filteredLayersMixins.transform.unshift(extent)):postAggregateCalculates&&(filteredLayersMixins=
postAggregateCalculates,filteredLayersMixins.transform.unshift(extent));return filteredLayersMixins?Object.assign({},$jscomp$destructuring$var29,{layer:[].concat($jscomp.arrayFromIterable(filteredLayersMixins?[filteredLayersMixins]:[]),[{transform:JSCompiler_object_inline_transform_1300,layer:sizeValue}])}):Object.assign({},$jscomp$destructuring$var29,{transform:($jscomp$destructuring$var29.transform||[]).concat(JSCompiler_object_inline_transform_1300),layer:sizeValue})}function boxParamsQuartiles(continousAxisField){return[{op:"q1",
field:continousAxisField,as:"lower_box_"+continousAxisField},{op:"q3",field:continousAxisField,as:"upper_box_"+continousAxisField}]}function normalizeErrorBar(spec,$jscomp$destructuring$var37){var config=$jscomp$destructuring$var37.config,$jscomp$destructuring$var39=errorBarParams(spec,"errorbar",config);spec=$jscomp$destructuring$var39.transform;var ticksOrient=$jscomp$destructuring$var39.ticksOrient;$jscomp$destructuring$var37=$jscomp$destructuring$var39.outerSpec;var tooltipEncoding=$jscomp$destructuring$var39.tooltipEncoding;
config=makeCompositeAggregatePartFactory($jscomp$destructuring$var39.markDef,$jscomp$destructuring$var39.continuousAxis,$jscomp$destructuring$var39.continuousAxisChannelDef,$jscomp$destructuring$var39.encodingWithoutContinuousAxis,config.errorbar);ticksOrient={type:"tick",orient:ticksOrient};return Object.assign({},$jscomp$destructuring$var37,{transform:spec,layer:[].concat($jscomp.arrayFromIterable(config({partName:"ticks",mark:ticksOrient,positionPrefix:"lower",extraEncoding:tooltipEncoding})),
$jscomp.arrayFromIterable(config({partName:"ticks",mark:ticksOrient,positionPrefix:"upper",extraEncoding:tooltipEncoding})),$jscomp.arrayFromIterable(config({partName:"rule",mark:"rule",positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:tooltipEncoding})))})}function errorBarOrientAndInputType(spec,compositeMark){var encoding=spec.encoding;if(!(!isFieldDef(encoding.x)&&!isFieldDef(encoding.y)||isFieldDef(encoding.x2)||isFieldDef(encoding.y2)||isFieldDef(encoding.xError)||isFieldDef(encoding.xError2)||
isFieldDef(encoding.yError)||isFieldDef(encoding.yError2)))return{orient:compositeMarkOrient(spec,compositeMark),inputType:"raw"};var isTypeAggregatedUpperLower=isFieldDef(encoding.x2)||isFieldDef(encoding.y2),isTypeAggregatedError=isFieldDef(encoding.xError)||isFieldDef(encoding.xError2)||isFieldDef(encoding.yError)||isFieldDef(encoding.yError2);spec=encoding.x;var y=encoding.y;if(isTypeAggregatedUpperLower){if(isTypeAggregatedError)throw Error(compositeMark+" cannot be both type aggregated-upper-lower and aggregated-error");
isTypeAggregatedUpperLower=encoding.x2;encoding=encoding.y2;if(isFieldDef(isTypeAggregatedUpperLower)&&isFieldDef(encoding))throw Error(compositeMark+" cannot have both x2 and y2");if(isFieldDef(isTypeAggregatedUpperLower)){if(isFieldDef(spec)&&!isDiscrete(spec))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw Error("Both x and x2 have to be quantitative in "+compositeMark);}if(isFieldDef(encoding)){if(isFieldDef(y)&&!isDiscrete(y))return{orient:"vertical",inputType:"aggregated-upper-lower"};
throw Error("Both y and y2 have to be quantitative in "+compositeMark);}}else{isTypeAggregatedUpperLower=encoding.xError;isTypeAggregatedError=encoding.yError;var yError2=encoding.yError2;if(isFieldDef(encoding.xError2)&&!isFieldDef(isTypeAggregatedUpperLower))throw Error(compositeMark+" cannot have xError2 without xError");if(isFieldDef(yError2)&&!isFieldDef(isTypeAggregatedError))throw Error(compositeMark+" cannot have yError2 without yError");if(isFieldDef(isTypeAggregatedUpperLower)&&isFieldDef(isTypeAggregatedError))throw Error(compositeMark+
" cannot have both xError and yError with both are quantiative");if(isFieldDef(isTypeAggregatedUpperLower)){if(isFieldDef(spec)&&!isDiscrete(spec))return{orient:"horizontal",inputType:"aggregated-error"};throw Error("All x, xError, and xError2 (if exist) have to be quantitative");}if(isFieldDef(isTypeAggregatedError)){if(isFieldDef(y)&&!isDiscrete(y))return{orient:"vertical",inputType:"aggregated-error"};throw Error("All y, yError, and yError2 (if exist) have to be quantitative");}}throw Error("No ranged axis");
}function errorBarParams(spec,compositeMark,config){var mark=spec.mark,encoding=spec.encoding,selection=spec.selection,outerSpec=__rest(spec,["mark","encoding","selection","projection"]);mark=isMarkDef(mark)?mark:{type:mark};selection&&warn(message$jscomp$0.selectionNotSupported(compositeMark));var $jscomp$destructuring$var42=errorBarOrientAndInputType(spec,compositeMark);selection=$jscomp$destructuring$var42.orient;$jscomp$destructuring$var42=$jscomp$destructuring$var42.inputType;var $jscomp$destructuring$var43=
compositeMarkContinuousAxis(spec,selection,compositeMark);spec=$jscomp$destructuring$var43.continuousAxisChannelDef;var continuousAxisChannelDef2=$jscomp$destructuring$var43.continuousAxisChannelDef2,continuousAxisChannelDefError=$jscomp$destructuring$var43.continuousAxisChannelDefError,continuousAxisChannelDefError2=$jscomp$destructuring$var43.continuousAxisChannelDefError2;$jscomp$destructuring$var43=$jscomp$destructuring$var43.continuousAxis;var JSCompiler_object_inline_errorBarSpecificAggregate_1103=
[];var JSCompiler_object_inline_postAggregateCalculates_1102=[];var continuousFieldName=spec.field,tooltipTitleWithFieldName=!1;if("raw"===$jscomp$destructuring$var42){var JSCompiler_object_inline_tooltipSummary_1104=mark.center?mark.center:mark.extent?"iqr"===mark.extent?"median":"mean":config.errorbar.center;continuousAxisChannelDef2=mark.extent?mark.extent:"mean"===JSCompiler_object_inline_tooltipSummary_1104?"stderr":"iqr";"median"===JSCompiler_object_inline_tooltipSummary_1104!==("iqr"===continuousAxisChannelDef2)&&
warn(message$jscomp$0.errorBarCenterIsUsedWithWrongExtent(JSCompiler_object_inline_tooltipSummary_1104,continuousAxisChannelDef2,compositeMark));"stderr"===continuousAxisChannelDef2||"stdev"===continuousAxisChannelDef2?(JSCompiler_object_inline_errorBarSpecificAggregate_1103=[{op:continuousAxisChannelDef2,field:continuousFieldName,as:"extent_"+continuousFieldName},{op:JSCompiler_object_inline_tooltipSummary_1104,field:continuousFieldName,as:"center_"+continuousFieldName}],JSCompiler_object_inline_postAggregateCalculates_1102=
[{calculate:'datum["center_'+continuousFieldName+'"] + datum["extent_'+continuousFieldName+'"]',as:"upper_"+continuousFieldName},{calculate:'datum["center_'+continuousFieldName+'"] - datum["extent_'+continuousFieldName+'"]',as:"lower_"+continuousFieldName}],JSCompiler_object_inline_tooltipSummary_1104=[{fieldPrefix:"center_",titlePrefix:titlecase(JSCompiler_object_inline_tooltipSummary_1104)},{fieldPrefix:"upper_",titlePrefix:titlecase(JSCompiler_object_inline_tooltipSummary_1104)+" + "+continuousAxisChannelDef2},
{fieldPrefix:"lower_",titlePrefix:titlecase(JSCompiler_object_inline_tooltipSummary_1104)+" - "+continuousAxisChannelDef2}],tooltipTitleWithFieldName=!0):(mark.center&&mark.extent&&warn(message$jscomp$0.errorBarCenterIsNotNeeded(mark.extent,compositeMark)),"ci"===continuousAxisChannelDef2?(JSCompiler_object_inline_tooltipSummary_1104="mean",compositeMark="ci0",continuousAxisChannelDef2="ci1"):(JSCompiler_object_inline_tooltipSummary_1104="median",compositeMark="q1",continuousAxisChannelDef2="q3"),
JSCompiler_object_inline_errorBarSpecificAggregate_1103=[{op:compositeMark,field:continuousFieldName,as:"lower_"+continuousFieldName},{op:continuousAxisChannelDef2,field:continuousFieldName,as:"upper_"+continuousFieldName},{op:JSCompiler_object_inline_tooltipSummary_1104,field:continuousFieldName,as:"center_"+continuousFieldName}],JSCompiler_object_inline_tooltipSummary_1104=[{fieldPrefix:"upper_",titlePrefix:title$jscomp$0({field:continuousFieldName,aggregate:continuousAxisChannelDef2,type:"quantitative"},
config,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:title$jscomp$0({field:continuousFieldName,aggregate:compositeMark,type:"quantitative"},config,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:title$jscomp$0({field:continuousFieldName,aggregate:JSCompiler_object_inline_tooltipSummary_1104,type:"quantitative"},config,{allowDisabling:!1})}])}else for((mark.center||mark.extent)&&warn(message$jscomp$0.errorBarCenterAndExtentAreNotNeeded(mark.center,mark.extent)),"aggregated-upper-lower"===
$jscomp$destructuring$var42?(JSCompiler_object_inline_tooltipSummary_1104=[],JSCompiler_object_inline_postAggregateCalculates_1102=[{calculate:'datum["'+continuousAxisChannelDef2.field+'"]',as:"upper_"+continuousFieldName},{calculate:'datum["'+continuousFieldName+'"]',as:"lower_"+continuousFieldName}]):"aggregated-error"===$jscomp$destructuring$var42&&(JSCompiler_object_inline_tooltipSummary_1104=[{fieldPrefix:"",titlePrefix:continuousFieldName}],JSCompiler_object_inline_postAggregateCalculates_1102=
[{calculate:'datum["'+continuousFieldName+'"] + datum["'+continuousAxisChannelDefError.field+'"]',as:"upper_"+continuousFieldName}],continuousAxisChannelDefError2?JSCompiler_object_inline_postAggregateCalculates_1102.push({calculate:'datum["'+continuousFieldName+'"] + datum["'+continuousAxisChannelDefError2.field+'"]',as:"lower_"+continuousFieldName}):JSCompiler_object_inline_postAggregateCalculates_1102.push({calculate:'datum["'+continuousFieldName+'"] - datum["'+continuousAxisChannelDefError.field+
'"]',as:"lower_"+continuousFieldName})),compositeMark=$jscomp.makeIterator(JSCompiler_object_inline_postAggregateCalculates_1102),continuousFieldName=compositeMark.next();!continuousFieldName.done;continuousFieldName=compositeMark.next())continuousFieldName=continuousFieldName.value,JSCompiler_object_inline_tooltipSummary_1104.push({fieldPrefix:continuousFieldName.as.substring(0,6),titlePrefix:continuousFieldName.calculate.replace(/datum\[\"/g,"").replace(/\"\]/g,"")});compositeMark="x"===$jscomp$destructuring$var43?
"x2":"y2";continuousFieldName="x"===$jscomp$destructuring$var43?"xError":"yError";continuousAxisChannelDef2="x"===$jscomp$destructuring$var43?"xError2":"yError2";encoding=__rest(encoding,["symbol"===typeof $jscomp$destructuring$var43?$jscomp$destructuring$var43:$jscomp$destructuring$var43+"","symbol"===typeof compositeMark?compositeMark:compositeMark+"","symbol"===typeof continuousFieldName?continuousFieldName:continuousFieldName+"","symbol"===typeof continuousAxisChannelDef2?continuousAxisChannelDef2:
continuousAxisChannelDef2+""]);continuousAxisChannelDef2=extractTransformsFromEncoding(encoding,config);config=continuousAxisChannelDef2.bins;encoding=continuousAxisChannelDef2.timeUnits;continuousFieldName=continuousAxisChannelDef2.groupby;compositeMark=continuousAxisChannelDef2.encoding;JSCompiler_object_inline_errorBarSpecificAggregate_1103=[].concat($jscomp.arrayFromIterable(continuousAxisChannelDef2.aggregate),$jscomp.arrayFromIterable(JSCompiler_object_inline_errorBarSpecificAggregate_1103));
$jscomp$destructuring$var42="raw"!==$jscomp$destructuring$var42?[]:continuousFieldName;tooltipTitleWithFieldName=getCompositeMarkTooltip(JSCompiler_object_inline_tooltipSummary_1104,spec,compositeMark,tooltipTitleWithFieldName);return{transform:[].concat($jscomp.arrayFromIterable(outerSpec.transform||[]),$jscomp.arrayFromIterable(config),$jscomp.arrayFromIterable(encoding),$jscomp.arrayFromIterable(JSCompiler_object_inline_errorBarSpecificAggregate_1103.length?[{aggregate:JSCompiler_object_inline_errorBarSpecificAggregate_1103,
groupby:$jscomp$destructuring$var42}]:[]),$jscomp.arrayFromIterable(JSCompiler_object_inline_postAggregateCalculates_1102)),groupby:$jscomp$destructuring$var42,continuousAxisChannelDef:spec,continuousAxis:$jscomp$destructuring$var43,encodingWithoutContinuousAxis:compositeMark,ticksOrient:"vertical"===selection?"horizontal":"vertical",markDef:mark,outerSpec:outerSpec,tooltipEncoding:tooltipTitleWithFieldName}}function normalizeErrorBand(spec,$jscomp$destructuring$var46){var config=$jscomp$destructuring$var46.config,
$jscomp$destructuring$var48=errorBarParams(spec,"errorband",config);$jscomp$destructuring$var46=$jscomp$destructuring$var48.transform;var outerSpec=$jscomp$destructuring$var48.outerSpec,tooltipEncoding=$jscomp$destructuring$var48.tooltipEncoding,errorBandDef=$jscomp$destructuring$var48.markDef;config=makeCompositeAggregatePartFactory(errorBandDef,$jscomp$destructuring$var48.continuousAxis,$jscomp$destructuring$var48.continuousAxisChannelDef,$jscomp$destructuring$var48.encodingWithoutContinuousAxis,
config.errorband);spec=void 0!==spec.encoding.x&&void 0!==spec.encoding.y;$jscomp$destructuring$var48={type:spec?"area":"rect"};var bordersMark={type:spec?"line":"rule"},interpolate=Object.assign({},errorBandDef.interpolate?{interpolate:errorBandDef.interpolate}:{},errorBandDef.tension&&errorBandDef.interpolate?{interpolate:errorBandDef.tension}:{});spec?($jscomp$destructuring$var48=Object.assign({},$jscomp$destructuring$var48,interpolate),bordersMark=Object.assign({},bordersMark,interpolate)):errorBandDef.interpolate?
warn(message$jscomp$0.errorBand1DNotSupport("interpolate")):errorBandDef.tension&&warn(message$jscomp$0.errorBand1DNotSupport("tension"));return Object.assign({},outerSpec,{transform:$jscomp$destructuring$var46,layer:[].concat($jscomp.arrayFromIterable(config({partName:"band",mark:$jscomp$destructuring$var48,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:tooltipEncoding})),$jscomp.arrayFromIterable(config({partName:"borders",mark:bordersMark,positionPrefix:"lower",extraEncoding:tooltipEncoding})),
$jscomp.arrayFromIterable(config({partName:"borders",mark:bordersMark,positionPrefix:"upper",extraEncoding:tooltipEncoding})))})}function add(mark,run,parts){run=new CompositeMarkNormalizer(mark,run);compositeMarkRegistry[mark]={normalizer:run,parts:parts}}function scaleTypeSupportProperty(scaleType,propName){switch(propName){case "type":case "domain":case "reverse":case "range":return!0;case "scheme":case "interpolate":return!contains(["point","band","identity"],scaleType);case "bins":return!contains(["point",
"band","identity","ordinal"],scaleType);case "round":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX||"band"===scaleType||"point"===scaleType;case "padding":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX||contains(["point","band"],scaleType);case "paddingOuter":case "rangeStep":case "align":return contains(["point","band"],scaleType);case "paddingInner":return"band"===scaleType;case "clamp":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX;case "nice":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX||
"quantize"===scaleType||"threshold"===scaleType;case "exponent":return"pow"===scaleType;case "base":return"log"===scaleType;case "constant":return"symlog"===scaleType;case "zero":return scaleType in CONTINUOUS_DOMAIN_INDEX&&!contains(["log","time","utc","threshold","quantile"],scaleType)}}function channelScalePropertyIncompatability(channel,propName){switch(propName){case "interpolate":case "scheme":if(!isColorChannel(channel))return message$jscomp$0.cannotUseScalePropertyWithNonColor(channel)}}function scaleTypeSupportDataType(specifiedType,
fieldDefType){return contains(["ordinal","nominal"],fieldDefType)?void 0===specifiedType||specifiedType in DISCRETE_DOMAIN_INDEX:"temporal"===fieldDefType?contains([ScaleType.TIME,ScaleType.UTC,void 0],specifiedType):"quantitative"===fieldDefType?contains([ScaleType.LOG,ScaleType.POW,ScaleType.SQRT,ScaleType.SYMLOG,ScaleType.QUANTILE,ScaleType.QUANTIZE,ScaleType.THRESHOLD,ScaleType.LINEAR,void 0],specifiedType):!0}function channelSupportScaleType(channel,scaleType){switch(channel){case "x":case "y":return scaleType in
CONTINUOUS_TO_CONTINUOUS_INDEX||contains(["band","point"],scaleType);case "size":case "strokeWidth":case "opacity":case "fillOpacity":case "strokeOpacity":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX||scaleType in CONTINUOUS_TO_DISCRETE_INDEX||contains(["band","point"],scaleType);case "color":case "fill":case "stroke":return"band"!==scaleType;case "shape":return"ordinal"===scaleType}return!1}function isVConcatSpec(spec){return void 0!==spec.vconcat}function isHConcatSpec(spec){return void 0!==
spec.hconcat}function extractCompositionLayout(spec,specType,config){var layout={};config=config[specType];specType=config.spacing;config=config.columns;void 0!==specType&&(layout.spacing=specType);void 0!==config&&(void 0!==spec.facet&&!isFacetMapping(spec.facet)||void 0!==spec.repeat&&isArray(spec.repeat)||void 0!==spec.concat)&&(layout.columns=config);config=$jscomp.makeIterator(COMPOSITION_LAYOUT_PROPERTIES);for(var $jscomp$key$prop=config.next();!$jscomp$key$prop.done;$jscomp$key$prop=config.next())if($jscomp$key$prop=
$jscomp$key$prop.value,void 0!==spec[$jscomp$key$prop])if("spacing"===$jscomp$key$prop){var spacing=spec[$jscomp$key$prop];layout[$jscomp$key$prop]=isNumber(spacing)?spacing:{row:spacing.row||specType,column:spacing.column||specType}}else layout[$jscomp$key$prop]=spec[$jscomp$key$prop];return layout}function extractTitleConfig(titleConfig){var anchor=titleConfig.anchor,frame=titleConfig.frame,offset=titleConfig.offset,orient=titleConfig.orient,color=titleConfig.color;titleConfig=__rest(titleConfig,
["anchor","frame","offset","orient","color"]);color=Object.assign({},titleConfig,color?{fill:color}:{});anchor=Object.assign({},anchor?{anchor:anchor}:{},frame?{frame:frame}:{},offset?{offset:offset}:{},orient?{orient:orient}:{});return{mark:color,nonMark:anchor}}function initConfig(config){return mergeDeep(duplicate(defaultConfig$1),config)}function stripAndRedirectConfig(config){config=duplicate(config);for(var $jscomp$iter$55=$jscomp.makeIterator(VL_ONLY_CONFIG_PROPERTIES),$jscomp$key$prop=$jscomp$iter$55.next();!$jscomp$key$prop.done;$jscomp$key$prop=
$jscomp$iter$55.next())delete config[$jscomp$key$prop.value];if(config.axis)for($jscomp$iter$55=$jscomp.makeIterator(VL_ONLY_GUIDE_CONFIG),$jscomp$key$prop=$jscomp$iter$55.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$55.next())delete config.axis[$jscomp$key$prop.value];if(config.legend){$jscomp$iter$55=$jscomp.makeIterator(VL_ONLY_GUIDE_CONFIG);for($jscomp$key$prop=$jscomp$iter$55.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$55.next())delete config.legend[$jscomp$key$prop.value];
$jscomp$iter$55=$jscomp.makeIterator(VL_ONLY_LEGEND_CONFIG);for($jscomp$key$prop=$jscomp$iter$55.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$55.next())delete config.legend[$jscomp$key$prop.value]}if(config.mark)for($jscomp$iter$55=$jscomp.makeIterator(VL_ONLY_MARK_CONFIG_PROPERTIES),$jscomp$key$prop=$jscomp$iter$55.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$55.next())delete config.mark[$jscomp$key$prop.value];$jscomp$iter$55=$jscomp.makeIterator(MARK_STYLES);for($jscomp$key$prop=
$jscomp$iter$55.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$55.next()){var markType=$jscomp$key$prop.value,$jscomp$iter$60=$jscomp.makeIterator(VL_ONLY_MARK_CONFIG_PROPERTIES);for($jscomp$key$prop=$jscomp$iter$60.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$60.next())delete config[markType][$jscomp$key$prop.value];if($jscomp$key$prop=VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX[markType])for($jscomp$iter$60=$jscomp.makeIterator($jscomp$key$prop),$jscomp$key$prop=
$jscomp$iter$60.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$60.next())delete config[markType][$jscomp$key$prop.value];redirectConfig(config,markType)}$jscomp$key$prop=$jscomp.makeIterator(keys(compositeMarkRegistry));for($jscomp$iter$55=$jscomp$key$prop.next();!$jscomp$iter$55.done;$jscomp$iter$55=$jscomp$key$prop.next())delete config[$jscomp$iter$55.value];redirectConfig(config,"title","group-title");for(var prop$223 in config)isObject(config[prop$223])&&0===keys(config[prop$223]).length&&
delete config[prop$223];return 0<keys(config).length?config:void 0}function redirectConfig(config,prop,toProp,compositeMarkPart){var propConfig="title"===prop?extractTitleConfig(config.title).mark:compositeMarkPart?config[prop][compositeMarkPart]:config[prop];"view"===prop&&(toProp="cell");propConfig=Object.assign({},propConfig,config.style[prop]);0<keys(propConfig).length&&(config.style[toProp||prop]=propConfig);compositeMarkPart||delete config[prop]}function isLayerSpec(spec){return void 0!==spec.layer}
function potentialStackedChannel(encoding){var xDef=encoding.x;encoding=encoding.y;if(isFieldDef(xDef)&&isFieldDef(encoding))if("quantitative"===xDef.type&&"quantitative"===encoding.type){if(xDef.stack)return"x";if(encoding.stack)return"y";if(!!xDef.aggregate!==!!encoding.aggregate)return xDef.aggregate?"x":"y"}else{if("quantitative"===xDef.type)return"x";if("quantitative"===encoding.type)return"y"}else{if(isFieldDef(xDef)&&"quantitative"===xDef.type)return"x";if(isFieldDef(encoding)&&"quantitative"===
encoding.type)return"y"}}function stack(m,encoding,stackConfig,opt){opt=void 0===opt?{}:opt;m=isMarkDef(m)?m.type:m;if(!contains(STACKABLE_MARKS,m))return null;var fieldChannel=potentialStackedChannel(encoding);if(!fieldChannel)return null;var stackedFieldDef=encoding[fieldChannel],stackedField=isFieldDef(stackedFieldDef)&&isString(stackedFieldDef.field)?vgField(stackedFieldDef,{}):void 0,dimensionChannel="x"===fieldChannel?"y":"x",dimensionDef=encoding[dimensionChannel],dimensionField=isFieldDef(dimensionDef)&&
isString(dimensionDef.field)?vgField(dimensionDef,{}):void 0,stackBy=NONPOSITION_CHANNELS.reduce(function(sc,channel){if("tooltip"!==channel&&channelHasField(encoding,channel)){var channelDef=encoding[channel];(isArray(channelDef)?channelDef:[channelDef]).forEach(function(cDef){cDef=getTypedFieldDef(cDef);if(!cDef.aggregate){var f=isFieldDef(cDef)&&isString(cDef.field)?vgField(cDef,{}):void 0;(!f||f!==dimensionField&&f!==stackedField)&&sc.push({channel:channel,fieldDef:cDef})}})}return sc},[]),offset;
void 0!==stackedFieldDef.stack?offset=isBoolean(stackedFieldDef.stack)?stackedFieldDef.stack?"zero":null:stackedFieldDef.stack:0<stackBy.length&&(offset=contains(STACK_BY_DEFAULT_MARKS,m)?getFirstDefined(stackConfig,"zero"):stackConfig);if(!offset||!STACK_OFFSET_INDEX[offset])return null;if(stackedFieldDef.scale&&stackedFieldDef.scale.type&&stackedFieldDef.scale.type!==ScaleType.LINEAR){if(opt.disallowNonLinearStack)return null;warn(message$jscomp$0.cannotStackNonLinearScale(stackedFieldDef.scale.type))}if(channelHasField(encoding,
"x"===fieldChannel?"x2":"y2"))return void 0!==stackedFieldDef.stack&&warn(message$jscomp$0.cannotStackRangedMark(fieldChannel)),null;stackedFieldDef.aggregate&&!contains(SUM_OPS,stackedFieldDef.aggregate)&&warn(message$jscomp$0.stackNonSummativeAggregate(stackedFieldDef.aggregate));return{groupbyChannel:dimensionDef?dimensionChannel:void 0,fieldChannel:fieldChannel,impute:isPathMark(m),stackBy:stackBy,offset:offset}}function dropLineAndPoint(markDef){markDef=__rest(markDef,["point","line"]);return 1<
keys(markDef).length?markDef:markDef.type}function dropLineAndPointFromConfig(config){for(var $jscomp$iter$64=$jscomp.makeIterator(["line","area","rule","trail"]),$jscomp$key$mark=$jscomp$iter$64.next();!$jscomp$key$mark.done;$jscomp$key$mark=$jscomp$iter$64.next())if($jscomp$key$mark=$jscomp$key$mark.value,config[$jscomp$key$mark]){var $jscomp$compprop4={};config=Object.assign({},config,($jscomp$compprop4[$jscomp$key$mark]=omit(config[$jscomp$key$mark],["point","line"]),$jscomp$compprop4))}return config}
function getPointOverlay(markDef,markConfig,encoding){markConfig=void 0===markConfig?{}:markConfig;if("transparent"===markDef.point)return{opacity:0};if(markDef.point)return isObject(markDef.point)?markDef.point:{};if(void 0!==markDef.point)return null;if(markConfig.point||encoding.shape)return isObject(markConfig.point)?markConfig.point:{}}function getLineOverlay(markDef,markConfig){markConfig=void 0===markConfig?{}:markConfig;if(markDef.line)return!0===markDef.line?{}:markDef.line;if(void 0!==markDef.line)return null;
if(markConfig.line)return!0===markConfig.line?{}:markConfig.line}function mergeEncoding(opt){var parentEncoding=opt.parentEncoding,encoding=opt.encoding;parentEncoding&&encoding&&(opt=keys(parentEncoding).reduce(function(o,key){encoding[key]&&o.push(key);return o},[]),0<opt.length&&warn(message$jscomp$0.encodingOverridden(opt)));parentEncoding=Object.assign({},parentEncoding||{},encoding||{});return 0<keys(parentEncoding).length?parentEncoding:void 0}function mergeProjection(opt){var parentProjection=
opt.parentProjection;opt=opt.projection;parentProjection&&opt&&warn(message$jscomp$0.projectionOverridden({parentProjection:parentProjection,projection:opt}));return opt||parentProjection}function normalize$1(spec,config){void 0===config&&(config=initConfig(spec.config));config=void 0===config?{}:config;return normalizer.map(spec,{config:config})}function _normalizeAutoSize(autosize){return isString(autosize)?{type:autosize}:autosize||{}}function extractTopLevelProperties(t){return TOP_LEVEL_PROPERTIES.reduce(function(o,
p){t&&void 0!==t[p]&&(o[p]=t[p]);return o},{})}function isNamedData(data){return!!data.name&&!data.url&&!data.values&&!isGenerator(data)}function isGenerator(data){return data&&(!!data.sequence||!!data.sphere||!!data.graticule)}function isFieldEqualPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.equal}function isFieldRangePredicate(predicate){return predicate&&predicate.field&&isArray(predicate.range)&&2===predicate.range.length?!0:!1}function isFieldOneOfPredicate(predicate){return predicate&&
!!predicate.field&&(isArray(predicate.oneOf)||isArray(predicate.in))}function isFieldPredicate(predicate){return isFieldOneOfPredicate(predicate)||isFieldEqualPredicate(predicate)||isFieldRangePredicate(predicate)||predicate&&!!predicate.field&&void 0!==predicate.lt||predicate&&!!predicate.field&&void 0!==predicate.gt||predicate&&!!predicate.field&&void 0!==predicate.lte||predicate&&!!predicate.field&&void 0!==predicate.gte}function predicateValueExpr(v,timeUnit){return valueExpr(v,{timeUnit:timeUnit,
time:!0})}function predicateValuesExpr(vals,timeUnit){return vals.map(function(v){return predicateValueExpr(v,timeUnit)})}function fieldFilterExpression(predicate,useInRange){useInRange=void 0===useInRange?!0:useInRange;var field=predicate.field,timeUnit=predicate.timeUnit;field=timeUnit?"time("+fieldExpr(timeUnit,field)+")":vgField(predicate,{expr:"datum"});if(isFieldEqualPredicate(predicate))return field+"\x3d\x3d\x3d"+predicateValueExpr(predicate.equal,timeUnit);if(predicate&&predicate.field&&
void 0!==predicate.lt)return field+"\x3c"+predicateValueExpr(predicate.lt,timeUnit);if(predicate&&predicate.field&&void 0!==predicate.gt)return field+"\x3e"+predicateValueExpr(predicate.gt,timeUnit);if(predicate&&predicate.field&&void 0!==predicate.lte)return field+"\x3c\x3d"+predicateValueExpr(predicate.lte,timeUnit);if(predicate&&predicate.field&&void 0!==predicate.gte)return field+"\x3e\x3d"+predicateValueExpr(predicate.gte,timeUnit);if(isFieldOneOfPredicate(predicate))return"indexof(["+predicateValuesExpr(predicate.oneOf,
timeUnit).join(",")+"], "+field+") !\x3d\x3d -1";if(predicate&&predicate.field&&void 0!==predicate.valid)return predicate.valid?field+"!\x3d\x3dnull\x26\x26!isNaN("+field+")":field+"\x3d\x3d\x3dnull||isNaN("+field+")";if(isFieldRangePredicate(predicate)){var lower$226=predicate.range[0];predicate=predicate.range[1];if(null!==lower$226&&null!==predicate&&useInRange)return"inrange("+field+", ["+predicateValueExpr(lower$226,timeUnit)+", "+predicateValueExpr(predicate,timeUnit)+"])";useInRange=[];null!==
lower$226&&useInRange.push(field+" \x3e\x3d "+predicateValueExpr(lower$226,timeUnit));null!==predicate&&useInRange.push(field+" \x3c\x3d "+predicateValueExpr(predicate,timeUnit));return 0<useInRange.length?useInRange.join(" \x26\x26 "):"true"}throw Error("Invalid field predicate: "+JSON.stringify(predicate));}function normalizePredicate(f){return isFieldPredicate(f)&&f.timeUnit?Object.assign({},f,{timeUnit:normalizeTimeUnit(f.timeUnit)}):f}function normalizeTransform(transform){return transform.map(function(t){return void 0!==
t.filter?{filter:normalizeLogicalOperand(t.filter,normalizePredicate)}:t})}function isVgRangeStep(range){return!!range.step}function isDataRefDomain(domain){return isArray(domain)?!1:"field"in domain&&"data"in domain}function assembleTitle(title,config){return isArray(title)?title.map(function(fieldDef){return titleFormatter(fieldDef,config)}).join(", "):title}function assembleAxis(axisCmpt,kind,config,opt){opt=void 0===opt?{header:!1}:opt;var _a=axisCmpt.combine(),orient=_a.orient,scale=_a.scale,
title=_a.title,zindex=_a.zindex,axis=__rest(_a,["orient","scale","title","zindex"]);keys(axis).forEach(function(key){var propType=AXIS_PROPERTY_TYPE[key];propType&&propType!==kind&&"both"!==propType&&delete axis[key]});if("grid"===kind){if(axis.grid)return axis.encode&&(axisCmpt=axis.encode.grid,axis.encode=Object.assign({},axisCmpt?{grid:axisCmpt}:{}),0===keys(axis.encode).length&&delete axis.encode),Object.assign({scale:scale,orient:orient},axis,{domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,
zindex:getFirstDefined(zindex,0)})}else if(opt.header||!axisCmpt.mainExtracted){if(axis.encode){opt=$jscomp.makeIterator(AXIS_PARTS);for(_a=opt.next();!_a.done;_a=opt.next())_a=_a.value,axisCmpt.hasAxisPart(_a)||delete axis.encode[_a];0===keys(axis.encode).length&&delete axis.encode}axisCmpt=assembleTitle(title,config);return Object.assign({scale:scale,orient:orient,grid:!1},axisCmpt?{title:axisCmpt}:{},axis,{zindex:getFirstDefined(zindex,1)})}}function assembleAxisSignals(model){for(var axes=model.component.axes,
$jscomp$iter$69=$jscomp.makeIterator(POSITION_SCALE_CHANNELS),$jscomp$key$channel=$jscomp$iter$69.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$69.next())if($jscomp$key$channel=$jscomp$key$channel.value,axes[$jscomp$key$channel])for(var $jscomp$iter$68=$jscomp.makeIterator(axes[$jscomp$key$channel]),$jscomp$key$axis=$jscomp$iter$68.next();!$jscomp$key$axis.done;$jscomp$key$axis=$jscomp$iter$68.next())if(!$jscomp$key$axis.value.get("gridScale"))return axes="x"===$jscomp$key$channel?
"height":"width",[{name:axes,update:model.getSizeSignalRef(axes).signal}];return[]}function assembleAxes(axisComponents,config){var x=void 0===axisComponents.x?[]:axisComponents.x;axisComponents=void 0===axisComponents.y?[]:axisComponents.y;return[].concat($jscomp.arrayFromIterable(x.map(function(a){return assembleAxis(a,"main",config)})),$jscomp.arrayFromIterable(x.map(function(a){return assembleAxis(a,"grid",config)})),$jscomp.arrayFromIterable(axisComponents.map(function(a){return assembleAxis(a,
"main",config)})),$jscomp.arrayFromIterable(axisComponents.map(function(a){return assembleAxis(a,"grid",config)}))).filter(function(a){return a})}function isSortField(sort){return!!sort&&("count"===sort.op||!!sort.field)}function isSortArray(sort){return!!sort&&isArray(sort)}function getAxisConfig(property,config,channel,orient,scaleType){channel=[].concat($jscomp.arrayFromIterable("band"===scaleType?["axisBand"]:[]),["x"===channel?"axisX":"axisY"],$jscomp.arrayFromIterable(orient?["axis"+orient.substr(0,
1).toUpperCase()+orient.substr(1)]:[]),["axis"]);channel=$jscomp.makeIterator(channel);for(orient=channel.next();!orient.done;orient=channel.next())if(orient=orient.value,config[orient]&&void 0!==config[orient][property])return config[orient][property]}function defaultLabelBaseline(angle,axisOrient){if(void 0!==angle)return angle=(angle%360+360)%360,"top"===axisOrient||"bottom"===axisOrient?45>=angle||315<=angle?"top"===axisOrient?"bottom":"top":135<=angle&&225>=angle?"top"===axisOrient?"top":"bottom":
"middle":45>=angle||315<=angle||135<=angle&&225>=angle?"middle":45<=angle&&135>=angle?"left"===axisOrient?"top":"bottom":"left"===axisOrient?"bottom":"top"}function defaultLabelAlign(angle,axisOrient){if(void 0!==angle)return angle=(angle%360+360)%360,"top"===axisOrient||"bottom"===axisOrient?0===angle%180?"center":0<angle&&180>angle?"top"===axisOrient?"right":"left":"top"===axisOrient?"left":"right":0===(angle+90)%180?"center":90<=angle&&270>angle?"left"===axisOrient?"left":"right":"left"===axisOrient?
"right":"left"}function orient(channel){switch(channel){case "x":return"bottom";case "y":return"left"}throw Error(message$jscomp$0.INVALID_CHANNEL_FOR_AXIS);}function applyMarkConfig(e,model,propsList){propsList=$jscomp.makeIterator(propsList);for(var $jscomp$key$property=propsList.next();!$jscomp$key$property.done;$jscomp$key$property=propsList.next()){$jscomp$key$property=$jscomp$key$property.value;var value=getMarkConfig($jscomp$key$property,model.markDef,model.config);void 0!==value&&(e[$jscomp$key$property]=
{value:value})}return e}function getMarkConfig(channel,mark,config,$jscomp$destructuring$var76){$jscomp$destructuring$var76=(void 0===$jscomp$destructuring$var76?{}:$jscomp$destructuring$var76).vgChannel;return getFirstDefined($jscomp$destructuring$var76?getStyleConfig(channel,mark,config.style):void 0,getStyleConfig(channel,mark,config.style),$jscomp$destructuring$var76?config[mark.type][$jscomp$destructuring$var76]:void 0,config[mark.type][channel],$jscomp$destructuring$var76?config.mark[$jscomp$destructuring$var76]:
config.mark[channel])}function getStyleConfig(prop,mark,styleConfigIndex){mark=[].concat(mark.type,mark.style||[]);var value;mark=$jscomp.makeIterator(mark);for(var $jscomp$key$style=mark.next();!$jscomp$key$style.done;$jscomp$key$style=mark.next()){$jscomp$key$style=styleConfigIndex[$jscomp$key$style.value];var p=prop;$jscomp$key$style&&void 0!==$jscomp$key$style[p]&&(value=$jscomp$key$style[p])}return value}function formatSignalRef(fieldDef,specifiedFormat,expr,config){if(isTimeFormatFieldDef(fieldDef)){var isUTCScale=
isScaleFieldDef(fieldDef)&&fieldDef.scale&&fieldDef.scale.type===ScaleType.UTC;return{signal:timeFormatExpression(vgField(fieldDef,{expr:expr}),fieldDef.timeUnit,specifiedFormat,config.text.shortTimeLabels,config.timeFormat,isUTCScale,!0)}}specifiedFormat=numberFormat(fieldDef,specifiedFormat,config);return isBinning(fieldDef.bin)?(isUTCScale=vgField(fieldDef,{expr:expr}),fieldDef=vgField(fieldDef,{expr:expr,binSuffix:"end"}),{signal:binFormatExpression(isUTCScale,fieldDef,specifiedFormat,config)}):
"quantitative"===fieldDef.type||specifiedFormat?{signal:""+formatExpr(vgField(fieldDef,{expr:expr,binSuffix:"range"}),specifiedFormat)}:{signal:"''+"+vgField(fieldDef,{expr:expr})}}function numberFormat(fieldDef,specifiedFormat,config){if(specifiedFormat)return specifiedFormat;if("quantitative"===fieldDef.type)return config.numberFormat}function formatExpr(field,format){return"format("+field+', "'+(format||"")+'")'}function binFormatExpression(startField,endField,format,config){return startField+
" \x3d\x3d\x3d null || isNaN("+startField+') ? "null" : '+formatExpr(startField,format||config.numberFormat)+' + " - " + '+formatExpr(endField,format||config.numberFormat)}function timeFormatExpression(field,timeUnit,format,shortTimeLabels,rawTimeFormat,isUTCScale,alwaysReturn){alwaysReturn=void 0===alwaysReturn?!1:alwaysReturn;if(!timeUnit||format){if((format=format||rawTimeFormat)||alwaysReturn)return(isUTCScale?"utc":"time")+"Format("+field+", '"+format+"')"}else return timeUnit?(format=getDateTimeComponents(timeUnit,
shortTimeLabels),shortTimeLabels="",containsTimeUnit(timeUnit,TimeUnit.QUARTER)&&(shortTimeLabels="'Q' + quarter("+field+")"),0<format.length&&(shortTimeLabels&&(shortTimeLabels+=" + ' ' + "),shortTimeLabels=isUTCScale?shortTimeLabels+("utcFormat("+field+", '"+format.join(" ")+"')"):shortTimeLabels+("timeFormat("+field+", '"+format.join(" ")+"')")),field=shortTimeLabels||void 0):field=void 0,field}function sortParams(orderDef,fieldRefOption){return(isArray(orderDef)?orderDef:[orderDef]).reduce(function(s,
orderChannelDef){s.field.push(vgField(orderChannelDef,fieldRefOption));s.order.push(orderChannelDef.sort||"ascending");return s},{field:[],order:[]})}function mergeTitleFieldDefs(f1,f2){var merged=[].concat($jscomp.arrayFromIterable(f1));f2.forEach(function(fdToMerge){for(var $jscomp$iter$73=$jscomp.makeIterator(merged),$jscomp$key$fieldDef1=$jscomp$iter$73.next();!$jscomp$key$fieldDef1.done;$jscomp$key$fieldDef1=$jscomp$iter$73.next())if(stringify($jscomp$key$fieldDef1.value)===stringify(fdToMerge))return;
merged.push(fdToMerge)});return merged}function mergeTitleComponent(v1,v2){if(isArray(v1.value)&&isArray(v2.value))return{explicit:v1.explicit,value:mergeTitleFieldDefs(v1.value,v2.value)};if(!isArray(v1.value)&&!isArray(v2.value)){var title1=v1.value;v2=v2.value;return{explicit:v1.explicit,value:title1!==v2&&v2?title1?title1+", "+v2:v2:title1}}throw Error("It should never reach here");}function ASTNode(type){this.type=type}function children(node){switch(node.type){case "ArrayExpression":return node.elements;
case "BinaryExpression":case "LogicalExpression":return[node.left,node.right];case "CallExpression":var args=node.arguments.slice();args.unshift(node.callee);return args;case "ConditionalExpression":return[node.test,node.consequent,node.alternate];case "MemberExpression":return[node.object,node.property];case "ObjectExpression":return node.properties;case "Property":return[node.key,node.value];case "UnaryExpression":return[node.argument];default:return[]}}function assert(condition,message){if(!condition)throw Error("ASSERT: "+
message);}function isDecimalDigit(ch){return 48<=ch&&57>=ch}function isHexDigit(ch){return 0<="0123456789abcdefABCDEF".indexOf(ch)}function isOctalDigit(ch){return 0<="01234567".indexOf(ch)}function isLineTerminator(ch){return 10===ch||13===ch||8232===ch||8233===ch}function isIdentifierStart(ch){return 36===ch||95===ch||65<=ch&&90>=ch||97<=ch&&122>=ch||92===ch||128<=ch&&RegexNonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return 36===ch||95===ch||65<=ch&&90>=ch||
97<=ch&&122>=ch||48<=ch&&57>=ch||92===ch||128<=ch&&RegexNonAsciiIdentifierPart.test(String.fromCharCode(ch))}function skipComment(){for(var ch;index$jscomp$0<length$jscomp$0;)if(ch=source$jscomp$0.charCodeAt(index$jscomp$0),32===ch||9===ch||11===ch||12===ch||160===ch||5760<=ch&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)||isLineTerminator(ch))++index$jscomp$0;else break}function scanHexEscape(prefix){var code=0;var len="u"===prefix?4:2;for(prefix=
0;prefix<len;++prefix)if(index$jscomp$0<length$jscomp$0&&isHexDigit(source$jscomp$0[index$jscomp$0])){var ch=source$jscomp$0[index$jscomp$0++];code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase())}else throwError({},"Unexpected token %0","ILLEGAL");return String.fromCharCode(code)}function getEscapedIdentifier(){var ch=source$jscomp$0.charCodeAt(index$jscomp$0++);var id=String.fromCharCode(ch);92===ch&&(117!==source$jscomp$0.charCodeAt(index$jscomp$0)&&throwError({},"Unexpected token %0","ILLEGAL"),
++index$jscomp$0,(ch=scanHexEscape("u"))&&"\\"!==ch&&isIdentifierStart(ch.charCodeAt(0))||throwError({},"Unexpected token %0","ILLEGAL"),id=ch);for(;index$jscomp$0<length$jscomp$0;){ch=source$jscomp$0.charCodeAt(index$jscomp$0);if(!isIdentifierPart(ch))break;++index$jscomp$0;id+=String.fromCharCode(ch);92===ch&&(id=id.substr(0,id.length-1),117!==source$jscomp$0.charCodeAt(index$jscomp$0)&&throwError({},"Unexpected token %0","ILLEGAL"),++index$jscomp$0,(ch=scanHexEscape("u"))&&"\\"!==ch&&isIdentifierPart(ch.charCodeAt(0))||
throwError({},"Unexpected token %0","ILLEGAL"),id+=ch)}return id}function scanPunctuator(){var start=index$jscomp$0,code=source$jscomp$0.charCodeAt(index$jscomp$0),ch1=source$jscomp$0[index$jscomp$0];switch(code){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++index$jscomp$0,{type:7,value:String.fromCharCode(code),start:start,end:index$jscomp$0};default:var code2=source$jscomp$0.charCodeAt(index$jscomp$0+1);if(61===code2)switch(code){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return index$jscomp$0+=
2,{type:7,value:String.fromCharCode(code)+String.fromCharCode(code2),start:start,end:index$jscomp$0};case 33:case 61:return index$jscomp$0+=2,61===source$jscomp$0.charCodeAt(index$jscomp$0)&&++index$jscomp$0,{type:7,value:source$jscomp$0.slice(start,index$jscomp$0),start:start,end:index$jscomp$0}}}code=source$jscomp$0.substr(index$jscomp$0,4);if("\x3e\x3e\x3e\x3d"===code)return index$jscomp$0+=4,{type:7,value:code,start:start,end:index$jscomp$0};code=code.substr(0,3);if("\x3e\x3e\x3e"===code||"\x3c\x3c\x3d"===
code||"\x3e\x3e\x3d"===code)return index$jscomp$0+=3,{type:7,value:code,start:start,end:index$jscomp$0};code=code.substr(0,2);if(ch1===code[1]&&0<="+-\x3c\x3e\x26|".indexOf(ch1)||"\x3d\x3e"===code)return index$jscomp$0+=2,{type:7,value:code,start:start,end:index$jscomp$0};if(0<="\x3c\x3e\x3d!+-*%\x26|^/".indexOf(ch1))return++index$jscomp$0,{type:7,value:ch1,start:start,end:index$jscomp$0};throwError({},"Unexpected token %0","ILLEGAL")}function scanNumericLiteral(){var ch=source$jscomp$0[index$jscomp$0];
assert(isDecimalDigit(ch.charCodeAt(0))||"."===ch,"Numeric literal must start with a decimal digit or a decimal point");var start=index$jscomp$0;var number="";if("."!==ch){number=source$jscomp$0[index$jscomp$0++];ch=source$jscomp$0[index$jscomp$0];if("0"===number){if("x"===ch||"X"===ch){++index$jscomp$0;for(number="";index$jscomp$0<length$jscomp$0&&isHexDigit(source$jscomp$0[index$jscomp$0]);)number+=source$jscomp$0[index$jscomp$0++];0===number.length&&throwError({},"Unexpected token %0","ILLEGAL");
isIdentifierStart(source$jscomp$0.charCodeAt(index$jscomp$0))&&throwError({},"Unexpected token %0","ILLEGAL");return{type:6,value:parseInt("0x"+number,16),start:start,end:index$jscomp$0}}if(isOctalDigit(ch)){for(number="0"+source$jscomp$0[index$jscomp$0++];index$jscomp$0<length$jscomp$0&&isOctalDigit(source$jscomp$0[index$jscomp$0]);)number+=source$jscomp$0[index$jscomp$0++];(isIdentifierStart(source$jscomp$0.charCodeAt(index$jscomp$0))||isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0)))&&
throwError({},"Unexpected token %0","ILLEGAL");return{type:6,value:parseInt(number,8),octal:!0,start:start,end:index$jscomp$0}}ch&&isDecimalDigit(ch.charCodeAt(0))&&throwError({},"Unexpected token %0","ILLEGAL")}for(;isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0));)number+=source$jscomp$0[index$jscomp$0++];ch=source$jscomp$0[index$jscomp$0]}if("."===ch){for(number+=source$jscomp$0[index$jscomp$0++];isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0));)number+=source$jscomp$0[index$jscomp$0++];
ch=source$jscomp$0[index$jscomp$0]}if("e"===ch||"E"===ch){number+=source$jscomp$0[index$jscomp$0++];ch=source$jscomp$0[index$jscomp$0];if("+"===ch||"-"===ch)number+=source$jscomp$0[index$jscomp$0++];if(isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0)))for(;isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0));)number+=source$jscomp$0[index$jscomp$0++];else throwError({},"Unexpected token %0","ILLEGAL")}isIdentifierStart(source$jscomp$0.charCodeAt(index$jscomp$0))&&throwError({},"Unexpected token %0",
"ILLEGAL");return{type:6,value:parseFloat(number),start:start,end:index$jscomp$0}}function testRegExp(pattern,flags){var tmp=pattern;0<=flags.indexOf("u")&&(tmp=tmp.replace(/\\u\{([0-9a-fA-F]+)\}/g,function($0,$1){if(1114111>=parseInt($1,16))return"x";throwError({},"Invalid regular expression")}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(tmp)}catch(e){throwError({},"Invalid regular expression")}try{return new RegExp(pattern,flags)}catch(exception){return null}}function advance(){skipComment();
if(index$jscomp$0>=length$jscomp$0)return{type:2,start:index$jscomp$0,end:index$jscomp$0};var ch=source$jscomp$0.charCodeAt(index$jscomp$0);if(isIdentifierStart(ch)){ch=index$jscomp$0;if(92===source$jscomp$0.charCodeAt(index$jscomp$0))var id=getEscapedIdentifier();else a:{for(id=index$jscomp$0++;index$jscomp$0<length$jscomp$0;){var ch$jscomp$0=source$jscomp$0.charCodeAt(index$jscomp$0);if(92===ch$jscomp$0){index$jscomp$0=id;id=getEscapedIdentifier();break a}if(isIdentifierPart(ch$jscomp$0))++index$jscomp$0;
else break}id=source$jscomp$0.slice(id,index$jscomp$0)}return{type:1===id.length?3:keywords.hasOwnProperty(id)?4:"null"===id?5:"true"===id||"false"===id?1:3,value:id,start:ch,end:index$jscomp$0}}if(40===ch||41===ch||59===ch)return scanPunctuator();if(39===ch||34===ch){var str="";ch$jscomp$0=!1;ch=source$jscomp$0[index$jscomp$0];assert("'"===ch||'"'===ch,"String literal must starts with a quote");id=index$jscomp$0;for(++index$jscomp$0;index$jscomp$0<length$jscomp$0;){var ch$jscomp$1=source$jscomp$0[index$jscomp$0++];
if(ch$jscomp$1===ch){ch="";break}else if("\\"===ch$jscomp$1)if((ch$jscomp$1=source$jscomp$0[index$jscomp$0++])&&isLineTerminator(ch$jscomp$1.charCodeAt(0)))"\r"===ch$jscomp$1&&"\n"===source$jscomp$0[index$jscomp$0]&&++index$jscomp$0;else switch(ch$jscomp$1){case "u":case "x":if("{"===source$jscomp$0[index$jscomp$0]){++index$jscomp$0;var code=source$jscomp$0[index$jscomp$0];ch$jscomp$1=0;for("}"===code&&throwError({},"Unexpected token %0","ILLEGAL");index$jscomp$0<length$jscomp$0;){code=source$jscomp$0[index$jscomp$0++];
if(!isHexDigit(code))break;ch$jscomp$1=16*ch$jscomp$1+"0123456789abcdef".indexOf(code.toLowerCase())}(1114111<ch$jscomp$1||"}"!==code)&&throwError({},"Unexpected token %0","ILLEGAL");ch$jscomp$1=65535>=ch$jscomp$1?String.fromCharCode(ch$jscomp$1):String.fromCharCode((ch$jscomp$1-65536>>10)+55296,(ch$jscomp$1-65536&1023)+56320);str+=ch$jscomp$1}else str+=scanHexEscape(ch$jscomp$1);break;case "n":str+="\n";break;case "r":str+="\r";break;case "t":str+="\t";break;case "b":str+="\b";break;case "f":str+=
"\f";break;case "v":str+="\x0B";break;default:isOctalDigit(ch$jscomp$1)?(code="01234567".indexOf(ch$jscomp$1),0!==code&&(ch$jscomp$0=!0),index$jscomp$0<length$jscomp$0&&isOctalDigit(source$jscomp$0[index$jscomp$0])&&(ch$jscomp$0=!0,code=8*code+"01234567".indexOf(source$jscomp$0[index$jscomp$0++]),0<="0123".indexOf(ch$jscomp$1)&&index$jscomp$0<length$jscomp$0&&isOctalDigit(source$jscomp$0[index$jscomp$0])&&(code=8*code+"01234567".indexOf(source$jscomp$0[index$jscomp$0++]))),str+=String.fromCharCode(code)):
str+=ch$jscomp$1}else if(isLineTerminator(ch$jscomp$1.charCodeAt(0)))break;else str+=ch$jscomp$1}""!==ch&&throwError({},"Unexpected token %0","ILLEGAL");return{type:8,value:str,octal:ch$jscomp$0,start:id,end:index$jscomp$0}}return 46===ch?isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0+1))?scanNumericLiteral():scanPunctuator():isDecimalDigit(ch)?scanNumericLiteral():scanPunctuator()}function lex(){var token=lookahead;index$jscomp$0=token.end;lookahead=advance();index$jscomp$0=token.end;return token}
function peek(){var pos=index$jscomp$0;lookahead=advance();index$jscomp$0=pos}function finishBinaryExpression(operator,left,right){var node=new ASTNode("||"===operator||"\x26\x26"===operator?"LogicalExpression":"BinaryExpression");node.operator=operator;node.left=left;node.right=right;return node}function finishIdentifier(name){var node=new ASTNode("Identifier");node.name=name;return node}function finishLiteral(token){var node=new ASTNode("Literal");node.value=token.value;node.raw=source$jscomp$0.slice(token.start,
token.end);token.regex&&("//"===node.raw&&(node.raw="/(?:)/"),node.regex=token.regex);return node}function finishMemberExpression(accessor,object,property){var node=new ASTNode("MemberExpression");node.computed="["===accessor;node.object=object;node.property=property;node.computed||(property.member=!0);return node}function finishProperty(kind,key,value){var node=new ASTNode("Property");node.key=key;node.value=value;node.kind=kind;return node}function throwError(token,messageFormat){var args=Array.prototype.slice.call(arguments,
2),msg=messageFormat.replace(/%(\d)/g,function(whole,index){assert(index<args.length,"Message reference must be in range");return args[index]});var error=Error(msg);error.index=index$jscomp$0;error.description=msg;throw error;}function throwUnexpected(token){2===token.type&&throwError(token,"Unexpected end of input");6===token.type&&throwError(token,"Unexpected number");8===token.type&&throwError(token,"Unexpected string");3===token.type&&throwError(token,"Unexpected identifier");4===token.type&&
throwError(token,"Unexpected reserved word");throwError(token,"Unexpected token %0",token.value)}function expect(value){var token=lex();7===token.type&&token.value===value||throwUnexpected(token)}function match(value){return 7===lookahead.type&&lookahead.value===value}function parseObjectPropertyKey(){index$jscomp$0=lookahead.start;var token=lex();return 8===token.type||6===token.type?(token.octal&&throwError(token,"Octal literals are not allowed in strict mode."),finishLiteral(token)):finishIdentifier(token.value)}
function parsePrimaryExpression(){if(match("(")){expect("(");var type=parseExpression();expect(")");return type}if(match("[")){type=[];index$jscomp$0=lookahead.start;for(expect("[");!match("]");)match(",")?(lex(),type.push(null)):(type.push(parseConditionalExpression()),match("]")||expect(","));lex();var JSCompiler_object_inline_value_1308=new ASTNode("ArrayExpression");JSCompiler_object_inline_value_1308.elements=type;return JSCompiler_object_inline_value_1308}if(match("{")){type=[];JSCompiler_object_inline_value_1308=
{};var JSCompiler_object_inline_literal_1309=String;index$jscomp$0=lookahead.start;for(expect("{");!match("}");){index$jscomp$0=lookahead.start;var JSCompiler_object_inline_value_1310=lookahead;if(3===JSCompiler_object_inline_value_1310.type){var JSCompiler_object_inline_literal_1311=parseObjectPropertyKey();expect(":");JSCompiler_object_inline_value_1310=parseConditionalExpression();JSCompiler_object_inline_value_1310=finishProperty("init",JSCompiler_object_inline_literal_1311,JSCompiler_object_inline_value_1310)}else 2===
JSCompiler_object_inline_value_1310.type||7===JSCompiler_object_inline_value_1310.type?(throwUnexpected(JSCompiler_object_inline_value_1310),JSCompiler_object_inline_value_1310=void 0):(JSCompiler_object_inline_literal_1311=parseObjectPropertyKey(),expect(":"),JSCompiler_object_inline_value_1310=parseConditionalExpression(),JSCompiler_object_inline_value_1310=finishProperty("init",JSCompiler_object_inline_literal_1311,JSCompiler_object_inline_value_1310));JSCompiler_object_inline_literal_1311="Identifier"===
JSCompiler_object_inline_value_1310.key.type?JSCompiler_object_inline_value_1310.key.name:JSCompiler_object_inline_literal_1309(JSCompiler_object_inline_value_1310.key.value);JSCompiler_object_inline_literal_1311="$"+JSCompiler_object_inline_literal_1311;Object.prototype.hasOwnProperty.call(JSCompiler_object_inline_value_1308,JSCompiler_object_inline_literal_1311)?throwError({},"Duplicate data property in object literal not allowed in strict mode"):JSCompiler_object_inline_value_1308[JSCompiler_object_inline_literal_1311]=
!0;type.push(JSCompiler_object_inline_value_1310);match("}")||expect(",")}expect("}");JSCompiler_object_inline_value_1308=new ASTNode("ObjectExpression");JSCompiler_object_inline_value_1308.properties=type;return JSCompiler_object_inline_value_1308}type=lookahead.type;index$jscomp$0=lookahead.start;if(3===type||legalKeywords[lookahead.value])JSCompiler_object_inline_value_1308=finishIdentifier(lex().value);else if(8===type||6===type)lookahead.octal&&throwError(lookahead,"Octal literals are not allowed in strict mode."),
JSCompiler_object_inline_value_1308=finishLiteral(lex());else{if(4===type)throw Error("Disabled.");if(1===type)type=lex(),type.value="true"===type.value,JSCompiler_object_inline_value_1308=finishLiteral(type);else if(5===type)type=lex(),type.value=null,JSCompiler_object_inline_value_1308=finishLiteral(type);else if(match("/")||match("/\x3d")){var value;lookahead=null;skipComment();type=index$jscomp$0;JSCompiler_object_inline_value_1308=source$jscomp$0[index$jscomp$0];assert("/"===JSCompiler_object_inline_value_1308,
"Regular expression literal must start with a slash");JSCompiler_object_inline_literal_1309=source$jscomp$0[index$jscomp$0++];for(JSCompiler_object_inline_literal_1311=JSCompiler_object_inline_value_1310=!1;index$jscomp$0<length$jscomp$0;)if(JSCompiler_object_inline_value_1308=source$jscomp$0[index$jscomp$0++],JSCompiler_object_inline_literal_1309+=JSCompiler_object_inline_value_1308,"\\"===JSCompiler_object_inline_value_1308)JSCompiler_object_inline_value_1308=source$jscomp$0[index$jscomp$0++],isLineTerminator(JSCompiler_object_inline_value_1308.charCodeAt(0))&&
throwError({},"Invalid regular expression: missing /"),JSCompiler_object_inline_literal_1309+=JSCompiler_object_inline_value_1308;else if(isLineTerminator(JSCompiler_object_inline_value_1308.charCodeAt(0)))throwError({},"Invalid regular expression: missing /");else if(JSCompiler_object_inline_value_1310)"]"===JSCompiler_object_inline_value_1308&&(JSCompiler_object_inline_value_1310=!1);else if("/"===JSCompiler_object_inline_value_1308){JSCompiler_object_inline_literal_1311=!0;break}else"["===JSCompiler_object_inline_value_1308&&
(JSCompiler_object_inline_value_1310=!0);JSCompiler_object_inline_literal_1311||throwError({},"Invalid regular expression: missing /");JSCompiler_object_inline_value_1308=JSCompiler_object_inline_literal_1309.substr(1,JSCompiler_object_inline_literal_1309.length-2);for(value=JSCompiler_object_inline_literal_1311="";index$jscomp$0<length$jscomp$0;){JSCompiler_object_inline_value_1310=source$jscomp$0[index$jscomp$0];if(!isIdentifierPart(JSCompiler_object_inline_value_1310.charCodeAt(0)))break;++index$jscomp$0;
"\\"===JSCompiler_object_inline_value_1310&&index$jscomp$0<length$jscomp$0?throwError({},"Unexpected token %0","ILLEGAL"):(value+=JSCompiler_object_inline_value_1310,JSCompiler_object_inline_literal_1311+=JSCompiler_object_inline_value_1310)}0<=value.search(/[^gimuy]/g)&&throwError({},"Invalid regular expression",value);JSCompiler_object_inline_value_1310=value;value=testRegExp(JSCompiler_object_inline_value_1308,JSCompiler_object_inline_value_1310);JSCompiler_object_inline_value_1308=finishLiteral({literal:JSCompiler_object_inline_literal_1309+
JSCompiler_object_inline_literal_1311,value:value,regex:{pattern:JSCompiler_object_inline_value_1308,flags:JSCompiler_object_inline_value_1310},start:type,end:index$jscomp$0});peek()}else throwUnexpected(lex())}return JSCompiler_object_inline_value_1308}function parsePostfixExpression(){var expr;for(expr=parsePrimaryExpression();;)if(match(".")){expect(".");index$jscomp$0=lookahead.start;var args=lex();3===args.type||4===args.type||1===args.type||5===args.type||throwUnexpected(args);args=finishIdentifier(args.value);
expr=finishMemberExpression(".",expr,args)}else if(match("(")){args=[];expect("(");if(!match(")"))for(;index$jscomp$0<length$jscomp$0;){args.push(parseConditionalExpression());if(match(")"))break;expect(",")}expect(")");var node=new ASTNode("CallExpression");node.callee=expr;node.arguments=args;expr=node}else if(match("["))expect("["),args=parseExpression(),expect("]"),expr=finishMemberExpression("[",expr,args);else break;if(7===lookahead.type&&(match("++")||match("--")))throw Error("Disabled.");
return expr}function parseUnaryExpression(){if(7!==lookahead.type&&4!==lookahead.type)var expr=parsePostfixExpression();else{if(match("++")||match("--"))throw Error("Disabled.");if(match("+")||match("-")||match("~")||match("!")){var token=lex();expr=parseUnaryExpression();token=token.value;var node=new ASTNode("UnaryExpression");node.operator=token;node.argument=expr;node.prefix=!0;expr=node}else{if(4===lookahead.type&&"delete"===lookahead.value||4===lookahead.type&&"void"===lookahead.value||4===
lookahead.type&&"typeof"===lookahead.value)throw Error("Disabled.");expr=parsePostfixExpression()}}return expr}function binaryPrecedence(token){var prec=0;if(7!==token.type&&4!==token.type)return 0;switch(token.value){case "||":prec=1;break;case "\x26\x26":prec=2;break;case "|":prec=3;break;case "^":prec=4;break;case "\x26":prec=5;break;case "\x3d\x3d":case "!\x3d":case "\x3d\x3d\x3d":case "!\x3d\x3d":prec=6;break;case "\x3c":case "\x3e":case "\x3c\x3d":case "\x3e\x3d":case "instanceof":case "in":prec=
7;break;case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":prec=8;break;case "+":case "-":prec=9;break;case "*":case "/":case "%":prec=11}return prec}function parseConditionalExpression(){var consequent=lookahead;var expr=parseUnaryExpression();var token=lookahead;var alternate=binaryPrecedence(token);if(0===alternate)var expr$jscomp$0=expr;else{token.prec=alternate;lex();consequent=[consequent,lookahead];var right=parseUnaryExpression();for(expr$jscomp$0=[expr,token,right];0<(alternate=binaryPrecedence(lookahead));){for(;2<
expr$jscomp$0.length&&alternate<=expr$jscomp$0[expr$jscomp$0.length-2].prec;)right=expr$jscomp$0.pop(),token=expr$jscomp$0.pop().value,expr=expr$jscomp$0.pop(),consequent.pop(),expr=finishBinaryExpression(token,expr,right),expr$jscomp$0.push(expr);token=lex();token.prec=alternate;expr$jscomp$0.push(token);consequent.push(lookahead);expr=parseUnaryExpression();expr$jscomp$0.push(expr)}alternate=expr$jscomp$0.length-1;expr=expr$jscomp$0[alternate];for(consequent.pop();1<alternate;)consequent.pop(),
expr=finishBinaryExpression(expr$jscomp$0[alternate-1].value,expr$jscomp$0[alternate-2],expr),alternate-=2;expr$jscomp$0=expr}match("?")&&(lex(),consequent=parseConditionalExpression(),expect(":"),alternate=parseConditionalExpression(),expr=new ASTNode("ConditionalExpression"),expr.test=expr$jscomp$0,expr.consequent=consequent,expr.alternate=alternate,expr$jscomp$0=expr);return expr$jscomp$0}function parseExpression(){var expr=parseConditionalExpression();if(match(","))throw Error("Disabled.");return expr}
function parse(code){source$jscomp$0=code;index$jscomp$0=0;length$jscomp$0=source$jscomp$0.length;lookahead=null;peek();code=parseExpression();if(2!==lookahead.type)throw Error("Unexpect token after expression.");return code}function getName(node){var name=[];if("Identifier"===node.type)return[node.name];if("Literal"===node.type)return[node.value];"MemberExpression"===node.type&&(name.push.apply(name,$jscomp.arrayFromIterable(getName(node.object))),name.push.apply(name,$jscomp.arrayFromIterable(getName(node.property))));
return name}function startsWithDatum(node){return"MemberExpression"===node.object.type?startsWithDatum(node.object):"datum"===node.object.name}function getDependentFields(expression){expression=parse(expression);var dependents=new Set;expression.visit(function(node){"MemberExpression"===node.type&&startsWithDatum(node)&&dependents.add(getName(node).slice(1).join("."))});return dependents}function sortArrayIndexField(fieldDef,channel,opt){return vgField(fieldDef,Object.assign({prefix:channel,suffix:"sort_index"},
opt||{}))}function getHeaderChannel(channel,orient){return contains(["top","bottom"],orient)?"column":contains(["left","right"],orient)?"row":"row"===channel?"row":"column"}function getHeaderProperty(prop,facetFieldDef,config,channel){return getFirstDefined(facetFieldDef&&facetFieldDef.header?facetFieldDef.header[prop]:void 0,("row"===channel?config.headerRow:"column"===channel?config.headerColumn:config.headerFacet)[prop],config.header[prop])}function getHeaderProperties(properties,facetFieldDef,
config,channel){var props={};properties=$jscomp.makeIterator(properties);for(var $jscomp$key$prop=properties.next();!$jscomp$key$prop.done;$jscomp$key$prop=properties.next()){$jscomp$key$prop=$jscomp$key$prop.value;var value=getHeaderProperty($jscomp$key$prop,facetFieldDef,config,channel);void 0!==value&&(props[$jscomp$key$prop]=value)}return props}function assembleTitleGroup(model,channel){var title=model.component.layoutHeaders[channel].title,config=model.config?model.config:void 0;model=model.component.layoutHeaders[channel].facetFieldDef?
model.component.layoutHeaders[channel].facetFieldDef:void 0;var $jscomp$destructuring$var79=getHeaderProperties(["titleAnchor","titleAngle","titleOrient"],model,config,channel),titleAnchor=$jscomp$destructuring$var79.titleAnchor,titleAngle=$jscomp$destructuring$var79.titleAngle;$jscomp$destructuring$var79=getHeaderChannel(channel,$jscomp$destructuring$var79.titleOrient);return{name:channel+"-title",type:"group",role:$jscomp$destructuring$var79+"-title",title:Object.assign({text:title},"row"===channel?
{orient:"left"}:{},{style:"guide-title"},defaultHeaderGuideBaseline(titleAngle,$jscomp$destructuring$var79),defaultHeaderGuideAlign($jscomp$destructuring$var79,titleAngle,titleAnchor),assembleHeaderProperties(config,model,channel,HEADER_TITLE_PROPERTIES,HEADER_TITLE_PROPERTIES_MAP))}}function defaultHeaderGuideAlign(headerChannel,angle,anchor){switch(void 0===anchor?"middle":anchor){case "start":return{align:"left"};case "end":return{align:"right"}}return(headerChannel=defaultLabelAlign(angle,"row"===
headerChannel?"left":"top"))?{align:headerChannel}:{}}function defaultHeaderGuideBaseline(angle,channel){return(angle=defaultLabelBaseline(angle,"row"===channel?"left":"top"))?{baseline:angle}:{}}function assembleHeaderGroups(model,channel){for(var layoutHeader=model.component.layoutHeaders[channel],groups=[],$jscomp$iter$78=$jscomp.makeIterator(HEADER_TYPES),$jscomp$key$headerType=$jscomp$iter$78.next();!$jscomp$key$headerType.done;$jscomp$key$headerType=$jscomp$iter$78.next())if($jscomp$key$headerType=
$jscomp$key$headerType.value,layoutHeader[$jscomp$key$headerType])for(var $jscomp$iter$77=$jscomp.makeIterator(layoutHeader[$jscomp$key$headerType]),$jscomp$key$headerCmpt=$jscomp$iter$77.next();!$jscomp$key$headerCmpt.done;$jscomp$key$headerCmpt=$jscomp$iter$77.next())groups.push(assembleHeaderGroup(model,channel,$jscomp$key$headerType,layoutHeader,$jscomp$key$headerCmpt.value));return groups}function getSort(facetFieldDef,channel){var sort=facetFieldDef.sort;return isSortField(sort)?{field:vgField(sort,
{expr:"datum"}),order:sort.order||"ascending"}:isArray(sort)?{field:sortArrayIndexField(facetFieldDef,channel,{expr:"datum"}),order:"ascending"}:{field:vgField(facetFieldDef,{expr:"datum"}),order:sort||"ascending"}}function assembleLabelTitle(facetFieldDef,channel,config){var $jscomp$destructuring$var81=getHeaderProperties(["format","labelAngle","labelAnchor","labelOrient"],facetFieldDef,config,channel),format=$jscomp$destructuring$var81.format,labelAngle=$jscomp$destructuring$var81.labelAngle,labelAnchor=
$jscomp$destructuring$var81.labelAnchor;$jscomp$destructuring$var81=getHeaderChannel(channel,$jscomp$destructuring$var81.labelOrient);return Object.assign({text:formatSignalRef(facetFieldDef,format,"parent",config)},"row"===channel?{orient:"left"}:{},{style:"guide-label",frame:"group"},defaultHeaderGuideBaseline(labelAngle,$jscomp$destructuring$var81),defaultHeaderGuideAlign($jscomp$destructuring$var81,labelAngle,labelAnchor),assembleHeaderProperties(config,facetFieldDef,channel,HEADER_LABEL_PROPERTIES,
HEADER_LABEL_PROPERTIES_MAP))}function assembleHeaderGroup(model,channel,headerType,layoutHeader,headerCmpt){if(headerCmpt){var title$230=null,facetFieldDef=layoutHeader.facetFieldDef,config=model.config?model.config:void 0;if(facetFieldDef&&headerCmpt.labels){var labelOrient=getHeaderProperties(["labelOrient"],facetFieldDef,config,channel).labelOrient;if("row"===channel&&!contains(["top","bottom"],labelOrient)||"column"===channel&&!contains(["left","right"],labelOrient))title$230=assembleLabelTitle(facetFieldDef,
channel,config)}config=isFacetModel(model)&&!isFacetMapping(model.facet);var hasAxes=(labelOrient=headerCmpt.axes)&&0<labelOrient.length;if(title$230||hasAxes){var sizeChannel="row"===channel?"height":"width",$jscomp$compprop6={};return Object.assign({name:model.getName(channel+"_"+headerType),type:"group",role:channel+"-"+headerType},layoutHeader.facetFieldDef?{from:{data:model.getName(channel+"_domain")},sort:getSort(facetFieldDef,channel)}:{},hasAxes&&config?{from:{data:model.getName("facet_domain_"+
channel)}}:{},title$230?{title:title$230}:{},headerCmpt.sizeSignal?{encode:{update:($jscomp$compprop6[sizeChannel]=headerCmpt.sizeSignal,$jscomp$compprop6)}}:{},hasAxes?{axes:labelOrient}:{})}}return null}function assembleHeaderProperties(config,facetFieldDef,channel,properties,propertiesMap){var props={};properties=$jscomp.makeIterator(properties);for(var $jscomp$key$prop=properties.next();!$jscomp$key$prop.done;$jscomp$key$prop=properties.next())if($jscomp$key$prop=$jscomp$key$prop.value,propertiesMap[$jscomp$key$prop]){var value=
getHeaderProperty($jscomp$key$prop,facetFieldDef,config,channel);void 0!==value&&(props[propertiesMap[$jscomp$key$prop]]=value)}return props}function assembleLayoutSignals(model){return[].concat($jscomp.arrayFromIterable(sizeSignals(model,"width")),$jscomp.arrayFromIterable(sizeSignals(model,"height")))}function sizeSignals(model,sizeType){var channel="width"===sizeType?"x":"y",size=model.component.layoutSize.get(sizeType);if(!size||"merged"===size)return[];sizeType=model.getSizeSignalRef(sizeType).signal;
if("range-step"===size){if(size=model.getScaleComponent(channel)){var type$231=size.get("type"),range=size.get("range");if(type$231 in DISCRETE_DOMAIN_INDEX&&isVgRangeStep(range))return type$231=model.scaleName(channel),isFacetModel(model.parent)&&"independent"===model.parent.component.resolve.scale[channel]?[{name:type$231+"_step",value:range.step}]:[{name:type$231+"_step",value:range.step},{name:sizeType,update:sizeExpr(type$231,size,"domain('"+type$231+"').length")}]}throw Error("layout size is range step although there is no rangeStep.");
}return[{name:sizeType,value:size}]}function sizeExpr(scaleName,scaleComponent,cardinality){var type=scaleComponent.get("type"),padding=scaleComponent.get("padding"),paddingOuter=getFirstDefined(scaleComponent.get("paddingOuter"),padding);scaleComponent=scaleComponent.get("paddingInner");return"bandspace("+cardinality+", "+("band"===type?void 0!==scaleComponent?scaleComponent:padding:1)+", "+paddingOuter+") * "+scaleName+"_step"}function parseSelector(selector,source,marks){DEFAULT_SOURCE=source||
VIEW;MARKS=marks||DEFAULT_MARKS;return parseMerge(selector.trim()).map(parseSelector$1)}function find(s,i,endChar,pushChar,popChar){for(var count=0,n=s.length,c;i<n;++i)if(c=s[i],count||c!==endChar)popChar&&0<=popChar.indexOf(c)?--count:pushChar&&0<=pushChar.indexOf(c)&&++count;else break;return i}function parseMerge(s){for(var output=[],start=0,n=s.length,i=0;i<n;)i=find(s,i,COMMA,LBRACK+LBRACE,RBRACK+RBRACE),output.push(s.substring(start,i).trim()),start=++i;if(0===output.length)throw"Empty event selector: "+
s;return output}function parseSelector$1(s){if("["===s[0]){var JSCompiler_temp=s;var n=JSCompiler_temp.length;s=find(JSCompiler_temp,1,RBRACK,LBRACK,RBRACK);if(s===n)throw"Empty between selector: "+JSCompiler_temp;n=parseMerge(JSCompiler_temp.substring(1,s));if(2!==n.length)throw"Between selector must have two elements: "+JSCompiler_temp;JSCompiler_temp=JSCompiler_temp.slice(s+1).trim();if(JSCompiler_temp[0]!==GT)throw"Expected '\x3e' after between selector: "+JSCompiler_temp;n=n.map(parseSelector$1);
JSCompiler_temp=parseSelector$1(JSCompiler_temp.slice(1).trim());JSCompiler_temp.between?JSCompiler_temp={between:n,stream:JSCompiler_temp}:JSCompiler_temp.between=n}else{n={source:DEFAULT_SOURCE};var source=[],throttle=[0,0],markname=0,start=0,n$jscomp$0=s.length,i=0;if(s[n$jscomp$0-1]===RBRACE){i=s.lastIndexOf(LBRACE);if(0<=i){try{throttle=parseThrottle(s.substring(i+1,n$jscomp$0-1))}catch(e){throw"Invalid throttle specification: "+s;}s=s.slice(0,i).trim();n$jscomp$0=s.length}else throw"Unmatched right brace: "+
s;i=0}if(!n$jscomp$0)throw s;s[0]===NAME&&(markname=++i);var j=find(s,i,COLON);j<n$jscomp$0&&(source.push(s.substring(start,j).trim()),start=i=++j);i=find(s,i,LBRACK);if(i===n$jscomp$0)source.push(s.substring(start,n$jscomp$0).trim());else if(source.push(s.substring(start,i).trim()),JSCompiler_temp=[],start=++i,start===n$jscomp$0)throw"Unmatched left bracket: "+s;for(;i<n$jscomp$0;){i=find(s,i,RBRACK);if(i===n$jscomp$0)throw"Unmatched left bracket: "+s;JSCompiler_temp.push(s.substring(start,i).trim());
if(i<n$jscomp$0-1&&s[++i]!==LBRACK)throw"Expected left bracket: "+s;start=++i}if(!(n$jscomp$0=source.length)||ILLEGAL$1.test(source[n$jscomp$0-1]))throw"Invalid event selector: "+s;1<n$jscomp$0?(n.type=source[1],markname?n.markname=source[0].slice(1):MARKS.hasOwnProperty(source[0])?n.marktype=source[0]:n.source=source[0]):n.type=source[0];"!"===n.type.slice(-1)&&(n.consume=!0,n.type=n.type.slice(0,-1));null!=JSCompiler_temp&&(n.filter=JSCompiler_temp);throttle[0]&&(n.throttle=throttle[0]);throttle[1]&&
(n.debounce=throttle[1]);JSCompiler_temp=n}return JSCompiler_temp}function parseThrottle(s){var a=s.split(COMMA);if(!s.length||2<a.length)throw s;return a.map(function(_){_=+_;if(_!==_)throw s;return _})}function channelSignals(model,selCmpt,proj,init){var channel=proj.channel,vname=proj.signals.visual;proj=proj.signals.data;var hasScales=scaleBindings.has(selCmpt),scaleName=$(model.scaleName(channel)),scale=model.getScaleComponent(channel);scale=scale?scale.get("type"):void 0;var scaled=function(str){return"scale("+
scaleName+", "+str+")"},size=model.getSizeSignalRef("x"===channel?"width":"height").signal,coord=channel+"(unit)";model=events(selCmpt,function(def,evt){return[].concat($jscomp.arrayFromIterable(def),[{events:evt.between[0],update:"["+coord+", "+coord+"]"},{events:evt,update:"["+vname+"[0], clamp("+coord+", 0, "+size+")]"}])});model.push({events:{signal:selCmpt.name+"_scale_trigger"},update:scale in CONTINUOUS_DOMAIN_INDEX?"["+scaled(proj+"[0]")+", "+scaled(proj+"[1]")+"]":"[0, 0]"});return hasScales?
[{name:proj,on:[]}]:[Object.assign({name:vname},init?{init:assembleInit(init,scaled)}:{value:[]},{on:model}),Object.assign({name:proj},init?{init:assembleInit(init)}:{},{on:[{events:{signal:vname},update:vname+"[0] \x3d\x3d\x3d "+vname+"[1] ? null : invert("+scaleName+", "+vname+")"}]})]}function events(selCmpt,cb){return selCmpt.events.reduce(function(on,evt){return evt.between?cb(on,evt):(warn(evt+" is not an ordered event stream for interval selections"),on)},[])}function singleOrMultiSignals(model,
selCmpt){var name=selCmpt.name,fieldsSg=name+"_tuple_fields",values=selCmpt.project.items.map(function(p){var fieldDef=model.fieldDef(p.channel);return fieldDef&&fieldDef.bin?"["+accessPathWithDatum(model.vgField(p.channel,{}),"(item().isVoronoi ? datum.datum : datum)")+", "+(accessPathWithDatum(model.vgField(p.channel,{binSuffix:"end"}),"(item().isVoronoi ? datum.datum : datum)")+"]"):""+accessPathWithDatum(p.field,"(item().isVoronoi ? datum.datum : datum)")}).join(", ");fieldsSg="unit: "+unitName(model)+
", fields: "+fieldsSg+", values";return[{name:name+"_tuple",on:[{events:selCmpt.events,update:"datum \x26\x26 item().mark.marktype !\x3d\x3d 'group' ? {"+fieldsSg+": ["+values+"]} : null",force:!0}]}]}function forEachSelection(model,cb){model=model.component.selection;for(var name$240 in model)if(model.hasOwnProperty(name$240)){var sel=model[name$240];cb(sel,compilers[sel.type])}}function unitName(model){var name=$(model.name);for(model=model.parent;model&&!isFacetModel(model);)model=model.parent;
if(model)for(var facet=model.facet,$jscomp$iter$90=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$90.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$90.next())$jscomp$key$channel=$jscomp$key$channel.value,facet[$jscomp$key$channel]&&(name+=" + '__facet_"+$jscomp$key$channel+"_' + ("+accessPathWithDatum(model.vgField($jscomp$key$channel),"facet")+")");return name}function requiresSelectionId(model){var identifier=!1;forEachSelection(model,function(selCmpt){identifier=
identifier||selCmpt.project.items.some(function(proj){return"_vgsid_"===proj.field})});return identifier}function onDelta(model,selCmpt,proj,size,signals){var name=selCmpt.name,anchor=name+"_translate_anchor";name+="_translate_delta";var channel=proj.channel,hasScales=scaleBindings.has(selCmpt);selCmpt=signals.filter(function(s){return s.name===proj.signals[hasScales?"data":"visual"]})[0];size=model.getSizeSignalRef(size).signal;model=model.getScaleComponent(channel);signals=model.get("type");anchor=
anchor+".extent_"+channel;anchor=(hasScales?"log"===signals?"panLog":"pow"===signals?"panPow":"panLinear":"panLinear")+"("+anchor+", "+((hasScales&&"x"===channel?"-":"")+name+"."+channel+" / "+(hasScales?""+size:"span("+anchor+")"))+(hasScales&&"pow"===signals?", "+(model.get("exponent")||1):"")+")";selCmpt.on.push({events:{signal:name},update:hasScales?anchor:"clampRange("+anchor+", 0, "+size+")"})}function onDelta$1(model,selCmpt,proj,size,signals){var name=selCmpt.name,channel=proj.channel,hasScales=
scaleBindings.has(selCmpt);selCmpt=signals.filter(function(s){return s.name===proj.signals[hasScales?"data":"visual"]})[0];size=model.getSizeSignalRef(size).signal;signals=model.getScaleComponent(channel);var scaleType=signals.get("type"),base=hasScales?"domain("+$(model.scaleName(channel))+")":selCmpt.name;model=name+"_zoom_delta";name=(hasScales?"log"===scaleType?"zoomLog":"pow"===scaleType?"zoomPow":"zoomLinear":"zoomLinear")+"("+base+", "+(""+name+"_zoom_anchor."+channel)+", "+model+(hasScales&&
"pow"===scaleType?", "+(signals.get("exponent")||1):"")+")";selCmpt.on.push({events:{signal:model},update:hasScales?name:"clampRange("+name+", 0, "+size+")"})}function forEachTransform(selCmpt,cb){for(var $jscomp$iter$91=$jscomp.makeIterator(compilers$1),$jscomp$key$t=$jscomp$iter$91.next();!$jscomp$key$t.done;$jscomp$key$t=$jscomp$iter$91.next())$jscomp$key$t=$jscomp$key$t.value,$jscomp$key$t.has(selCmpt)&&cb($jscomp$key$t)}function assembleInit(init,wrap){wrap=void 0===wrap?identity:wrap;return isArray(init)?
"["+init.map(function(v){return assembleInit(v,wrap)}).join(", ")+"]":isDateTime(init)?wrap(dateTimeExpr(init)):wrap(JSON.stringify(init))}function assembleInitData(init){return isArray(init)?init.map(function(v){return assembleInitData(v)}):isDateTime(init)?dateTimeExpr(init,!1,!0):init}function assembleUnitSelectionSignals(model,signals){forEachSelection(model,function(selCmpt,selCompiler){var name=selCmpt.name,modifyExpr=selCompiler.modifyExpr(model,selCmpt);signals.push.apply(signals,$jscomp.arrayFromIterable(selCompiler.signals(model,
selCmpt)));forEachTransform(selCmpt,function(txCompiler){txCompiler.signals&&(signals=txCompiler.signals(model,selCmpt,signals));txCompiler.modifyExpr&&(modifyExpr=txCompiler.modifyExpr(model,selCmpt,modifyExpr))});signals.push({name:name+"_modify",update:"modify("+$(selCmpt.name+"_store")+", "+modifyExpr+")"})});return signals}function assembleFacetSignals(model,signals){model.component.selection&&keys(model.component.selection).length&&(model=$(model.getName("cell")),signals.unshift({name:"facet",
value:{},on:[{events:parseSelector("mousemove","scope"),update:"isTuple(facet) ? facet : group("+model+").datum"}]}));return signals}function assembleTopLevelSignals(model,signals){var hasSelections=!1;forEachSelection(model,function(selCmpt,selCompiler){var name=selCmpt.name,store=$(name+"_store");signals.filter(function(s){return s.name===name}).length||signals.push({name:selCmpt.name,update:"vlSelectionResolve("+store+("global"===selCmpt.resolve?")":", "+$(selCmpt.resolve)+")")});hasSelections=
!0;selCompiler.topLevelSignals&&(signals=selCompiler.topLevelSignals(model,selCmpt,signals));forEachTransform(selCmpt,function(txCompiler){txCompiler.topLevelSignals&&(signals=txCompiler.topLevelSignals(model,selCmpt,signals))})});hasSelections&&(signals.filter(function(s){return"unit"===s.name}).length||signals.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}));return signals}function assembleUnitSelectionData(model,data){forEachSelection(model,
function(selCmpt){var init={name:selCmpt.name+"_store"};if(selCmpt.init){var fields=selCmpt.project.items.map(function(proj){return __rest(proj,["signals"])}),insert=selCmpt.init.map(function(i){return assembleInitData(i)});init.values="interval"===selCmpt.type?[{unit:unitName(model),fields:fields,values:insert}]:insert.map(function(i){return{unit:unitName(model),fields:fields,values:i}})}data.filter(function(d){return d.name===selCmpt.name+"_store"}).length||data.push(init)});return data}function assembleUnitSelectionMarks(model,
marks){forEachSelection(model,function(selCmpt,selCompiler){marks=selCompiler.marks?selCompiler.marks(model,selCmpt,marks):marks;forEachTransform(selCmpt,function(txCompiler){txCompiler.marks&&(marks=txCompiler.marks(model,selCmpt,marks))})});return marks}function assembleLayerSelectionMarks(model,marks){model=$jscomp.makeIterator(model.children);for(var $jscomp$key$child=model.next();!$jscomp$key$child.done;$jscomp$key$child=model.next())$jscomp$key$child=$jscomp$key$child.value,isUnitModel($jscomp$key$child)&&
(marks=assembleUnitSelectionMarks($jscomp$key$child,marks));return marks}function assembleSelectionPredicate(model,selections,dfnode){var stores=[];selections=logicalExpr(selections,function(name){var vname=varName(name);name=model.getSelectionComponent(vname,name);vname=$(vname+"_store");if(name.project.timeUnit){var child=dfnode||model.component.data.raw,tunode=name.project.timeUnit.clone();child.parent?tunode.insertAsParentOf(child):child.parent=tunode}"none"!==name.empty&&stores.push(vname);return"vlSelectionTest("+
vname+", datum"+("global"===name.resolve?")":", "+$(name.resolve)+")")});return(stores.length?"!("+stores.map(function(s){return"length(data("+s+"))"}).join(" || ")+") || ":"")+("("+selections+")")}function assembleSelectionScaleDomain(model,domainRaw){domainRaw=JSON.parse(domainRaw.signal.replace("_selection_domain_",""));var name=varName(domainRaw.selection),encoding=domainRaw.encoding,field=domainRaw.field,selCmpt=model.component.selection&&model.component.selection[name];if(selCmpt)warn('Use "bind": "scales" to setup a binding for scales and selections within the same view.');
else return selCmpt=model.getSelectionComponent(name,domainRaw.selection),encoding||field?encoding&&!field&&(model=selCmpt.project.items.filter(function(p){return p.channel===encoding}),!model.length||1<model.length?(field=selCmpt.project.items[0].field,warn((model.length?"Multiple ":"No ")+("matching "+$(encoding)+" encoding found for selection "+$(domainRaw.selection)+". ")+('Using "field": '+$(field)+"."))):field=model[0].field):(field=selCmpt.project.items[0].field,1<selCmpt.project.items.length&&
warn('A "field" or "encoding" must be specified when using a selection as a scale domain. '+('Using "field": '+$(field)+"."))),{signal:accessPathWithDatum(field,name)};return{signal:"null"}}function expression$jscomp$0(model,filterOp,node){return logicalExpr(filterOp,function(predicate){return isString(predicate)?predicate:predicate&&predicate.selection?assembleSelectionPredicate(model,predicate.selection,node):fieldFilterExpression(predicate)})}function midPointWithPositionInvalidTest(params){var channel=
params.channel,channelDef=params.channelDef,mark=params.mark,scale=params.scale;params=midPoint(params);var JSCompiler_temp;if(JSCompiler_temp=isFieldDef(channelDef))JSCompiler_temp=channelDef.aggregate,JSCompiler_temp=!(JSCompiler_temp&&isString(JSCompiler_temp)&&contains(COUNTING_OPS,JSCompiler_temp));return JSCompiler_temp&&scale&&scale.get("type")in CONTINUOUS_TO_CONTINUOUS_INDEX&&!1===scale.get("zero")?wrapPositionInvalidTest({fieldDef:channelDef,channel:channel,mark:mark,ref:params}):params}
function wrapPositionInvalidTest($jscomp$destructuring$var93){var fieldDef=$jscomp$destructuring$var93.fieldDef,channel=$jscomp$destructuring$var93.channel,ref=$jscomp$destructuring$var93.ref;return isPathMark($jscomp$destructuring$var93.mark)?ref:($jscomp$destructuring$var93=fieldInvalidPredicate(fieldDef,!0),channel="x"===getMainRangeChannel(channel)?{value:0}:{field:{group:"height"}},[Object.assign({test:$jscomp$destructuring$var93},channel),ref])}function fieldInvalidPredicate(field,invalid){invalid=
void 0===invalid?!0:invalid;field=isString(field)?field:vgField(field,{expr:"datum"});return field+" "+(invalid?"\x3d\x3d\x3d":"!\x3d\x3d")+" null "+(invalid?"||":"\x26\x26")+" "+(invalid?"":"!")+"isNaN("+field+")"}function getOffset(channel,markDef){if(channel=markDef[channel+"Offset"])return channel}function bin$1($jscomp$destructuring$var98){var channel=$jscomp$destructuring$var98.channel,fieldDef=$jscomp$destructuring$var98.fieldDef,mark=$jscomp$destructuring$var98.mark,offset=$jscomp$destructuring$var98.offset;
$jscomp$destructuring$var98=fieldRef(fieldDef,$jscomp$destructuring$var98.scaleName,{binSuffix:"start"===$jscomp$destructuring$var98.side?void 0:"end"},offset?{offset:offset}:{});return wrapPositionInvalidTest({fieldDef:fieldDef,channel:channel,mark:mark,ref:$jscomp$destructuring$var98})}function fieldRef(fieldDef,scaleName,opt,mixins){fieldDef=Object.assign({},scaleName?{scale:scaleName}:{},{field:vgField(fieldDef,opt)});return mixins?(scaleName=mixins.offset,mixins=mixins.band,Object.assign({},
fieldDef,scaleName?{offset:scaleName}:{},mixins?{band:mixins}:{})):fieldDef}function bandRef(scaleName,band){return{scale:scaleName,band:void 0===band?!0:band}}function binMidSignal($jscomp$destructuring$var101){var scaleName=$jscomp$destructuring$var101.scaleName,fieldDef=$jscomp$destructuring$var101.fieldDef,fieldDef2=$jscomp$destructuring$var101.fieldDef2,offset=$jscomp$destructuring$var101.offset;$jscomp$destructuring$var101=$jscomp$destructuring$var101.band;$jscomp$destructuring$var101=getFirstDefined($jscomp$destructuring$var101,
.5);var start=vgField(fieldDef,{expr:"datum"});fieldDef=void 0!==fieldDef2?vgField(fieldDef2,{expr:"datum"}):vgField(fieldDef,{binSuffix:"end",expr:"datum"});return Object.assign({signal:'scale("'+scaleName+'", '+$jscomp$destructuring$var101+" * "+start+" + "+(1-$jscomp$destructuring$var101)+" * "+fieldDef+")"},offset?{offset:offset}:{})}function midPoint($jscomp$destructuring$var103){var channel=$jscomp$destructuring$var103.channel,channelDef=$jscomp$destructuring$var103.channelDef,channel2Def=$jscomp$destructuring$var103.channel2Def,
scaleName=$jscomp$destructuring$var103.scaleName,scale=$jscomp$destructuring$var103.scale,stack=$jscomp$destructuring$var103.stack,offset=$jscomp$destructuring$var103.offset;$jscomp$destructuring$var103=$jscomp$destructuring$var103.defaultRef;if(channelDef){if(isFieldDef(channelDef)){if(isTypedFieldDef(channelDef)){if(isBinning(channelDef.bin))return contains(["x","y"],channel)&&"quantitative"===channelDef.type?stack&&stack.impute?fieldRef(channelDef,scaleName,{binSuffix:"mid"},{offset:offset}):binMidSignal({scaleName:scaleName,
fieldDef:channelDef,offset:offset}):fieldRef(channelDef,scaleName,binRequiresRange(channelDef,channel)?{binSuffix:"range"}:{},{offset:offset});if(isBinned(channelDef.bin)){if(isFieldDef(channel2Def))return binMidSignal({scaleName:scaleName,fieldDef:channelDef,fieldDef2:channel2Def,offset:offset});warn(message$jscomp$0.channelRequiredForBinned("x"===channel?"x2":"y2"))}}return scale&&(channel=scale.get("type"),channel in DISCRETE_DOMAIN_INDEX)?"band"===channel?fieldRef(channelDef,scaleName,{binSuffix:"range"},
{band:.5,offset:offset}):fieldRef(channelDef,scaleName,{binSuffix:"range"},{offset:offset}):fieldRef(channelDef,scaleName,{},{offset:offset})}if(isValueDef(channelDef))return scaleName=offset?{offset:offset}:{},Object.assign({},vgValueRef(channel,channelDef.value),scaleName)}return"function"===typeof $jscomp$destructuring$var103?$jscomp$destructuring$var103():$jscomp$destructuring$var103}function vgValueRef(channel,value){return contains(["x","x2"],channel)&&"width"===value?{field:{group:"width"}}:
contains(["y","y2"],channel)&&"height"===value?{field:{group:"height"}}:{value:value}}function tooltipForEncoding(encoding,config,$jscomp$destructuring$var105){function add(fDef,channel){var mainChannel=getMainRangeChannel(channel);fDef=isTypedFieldDef(fDef)?fDef:Object.assign({},fDef,{type:encoding[mainChannel].type});mainChannel=title$jscomp$0(fDef,config,{allowDisabling:!1});var value=text$jscomp$0(fDef,config,expr).signal;if("x"===channel||"y"===channel){var channel2="x"===channel?"x2":"y2",fieldDef2=
getFieldDef(encoding[channel2]);isBinned(fDef.bin)&&fieldDef2&&(value=vgField(fDef,{expr:expr}),fieldDef2=vgField(fieldDef2,{expr:expr}),value=binFormatExpression(value,fieldDef2,format$jscomp$0(fDef),config),toSkip[channel2]=!0)}tooltipTuples.push({channel:channel,key:mainChannel,value:value})}var keyValues=[],usedKey={},toSkip={},expr=(void 0===$jscomp$destructuring$var105?{}:$jscomp$destructuring$var105).reactiveGeom?"datum.datum":"datum",tooltipTuples=[];forEach(encoding,function(channelDef,channel){isFieldDef(channelDef)?
add(channelDef,channel):hasConditionalFieldDef(channelDef)&&add(channelDef.condition,channel)});$jscomp$destructuring$var105=$jscomp.makeIterator(tooltipTuples);for(var $jscomp$key$=$jscomp$destructuring$var105.next();!$jscomp$key$.done;$jscomp$key$=$jscomp$destructuring$var105.next()){$jscomp$key$=$jscomp$key$.value;var key=$jscomp$key$.key,value$jscomp$0=$jscomp$key$.value;toSkip[$jscomp$key$.channel]||usedKey[key]||(keyValues.push($(key)+": "+value$jscomp$0),usedKey[key]=!0)}return keyValues.length?
{signal:"{"+keyValues.join(", ")+"}"}:void 0}function text$jscomp$0(channelDef,config,expr){expr=void 0===expr?"datum":expr;if(channelDef){if(isValueDef(channelDef))return{value:channelDef.value};if(isTypedFieldDef(channelDef))return formatSignalRef(channelDef,format$jscomp$0(channelDef),expr,config)}}function mid(sizeRef){return Object.assign({},sizeRef,{mult:.5})}function positionDefault($jscomp$destructuring$var109){var markDef=$jscomp$destructuring$var109.markDef,config=$jscomp$destructuring$var109.config,
defaultRef=$jscomp$destructuring$var109.defaultRef,channel=$jscomp$destructuring$var109.channel,scaleName=$jscomp$destructuring$var109.scaleName,scale=$jscomp$destructuring$var109.scale,mark=$jscomp$destructuring$var109.mark,checkBarAreaWithZero=$jscomp$destructuring$var109.checkBarAreaWithoutZero;return function(){var mainChannel=getMainRangeChannel(channel),definedValueOrConfig=getFirstDefined(markDef[channel],getMarkConfig(channel,markDef,config));if(void 0!==definedValueOrConfig)return vgValueRef(channel,
definedValueOrConfig);if(isString(defaultRef)){if(scaleName)if(definedValueOrConfig=scale.get("type"),contains([ScaleType.LOG,ScaleType.TIME,ScaleType.UTC],definedValueOrConfig))!checkBarAreaWithZero||"bar"!==mark&&"area"!==mark||warn(message$jscomp$0.nonZeroScaleUsedWithLengthMark(mark,mainChannel,{scaleType:definedValueOrConfig}));else{if(scale.domainDefinitelyIncludesZero())return{scale:scaleName,value:0};!checkBarAreaWithZero||"bar"!==mark&&"area"!==mark||warn(message$jscomp$0.nonZeroScaleUsedWithLengthMark(mark,
mainChannel,{zeroFalse:!1===scale.explicit.zero}))}return"zeroOrMin"===defaultRef?"x"===mainChannel?{value:0}:{field:{group:"height"}}:"x"===mainChannel?{field:{group:"width"}}:{value:0}}return defaultRef}}function isVisible(c){return"transparent"!==c&&null!==c&&void 0!==c}function color$jscomp$0(model){var markDef=model.markDef,encoding=model.encoding,config=model.config,filled=markDef.filled,markType=markDef.type;config={fill:getMarkConfig("fill",markDef,config),stroke:getMarkConfig("stroke",markDef,
config),color:getMarkConfig("color",markDef,config)};var transparentIfNeeded=contains(["bar","point","circle","square","geoshape"],markType)?"transparent":void 0,defaultFill=getFirstDefined(markDef.fill,config.fill,transparentIfNeeded),defaultStroke=getFirstDefined(markDef.stroke,config.stroke);markType=filled?"fill":"stroke";var fillStrokeMarkDefAndConfig=Object.assign({},defaultFill?{fill:{value:defaultFill}}:{},defaultStroke?{stroke:{value:defaultStroke}}:{});return encoding.fill||encoding.stroke?
(markDef.color&&warn(message$jscomp$0.droppingColor("property",{fill:"fill"in encoding,stroke:"stroke"in encoding})),Object.assign({},nonPosition("fill",model,{defaultValue:getFirstDefined(defaultFill,transparentIfNeeded)}),nonPosition("stroke",model,{defaultValue:defaultStroke}))):encoding.color?Object.assign({},fillStrokeMarkDefAndConfig,nonPosition("color",model,{vgChannel:markType,defaultValue:getFirstDefined(markDef[markType],markDef.color,config[markType],config.color,filled?transparentIfNeeded:
void 0)})):isVisible(markDef.fill)||isVisible(markDef.stroke)?(markDef.color&&warn(message$jscomp$0.droppingColor("property",{fill:"fill"in markDef,stroke:"stroke"in markDef})),fillStrokeMarkDefAndConfig):markDef.color?(model={},Object.assign({},fillStrokeMarkDefAndConfig,(model[markType]={value:markDef.color},model))):isVisible(config.fill)||isVisible(config.stroke)?fillStrokeMarkDefAndConfig:config.color?(markDef={},Object.assign({},transparentIfNeeded?{fill:{value:"transparent"}}:{},(markDef[markType]=
{value:config.color},markDef))):{}}function baseEncodeEntry(model,ignore){var $jscomp$destructuring$var113=color$jscomp$0(model),fill=$jscomp$destructuring$var113.fill;$jscomp$destructuring$var113=$jscomp$destructuring$var113.stroke;return Object.assign({},markDefProperties(model.markDef,ignore),wrapAllFieldsInvalid(model,"fill",fill),wrapAllFieldsInvalid(model,"stroke",$jscomp$destructuring$var113),nonPosition("opacity",model),nonPosition("fillOpacity",model),nonPosition("strokeOpacity",model),nonPosition("strokeWidth",
model),tooltip(model),text$1(model,"href"))}function wrapAllFieldsInvalid(model,channel,valueRef){var mark=model.mark;if("hide"===model.config.invalidValues&&valueRef&&!isPathMark(mark)&&(model=allFieldsInvalidPredicate(model,{invalid:!0,channels:SCALE_CHANNELS})))return mark={},mark[channel]=[{test:model,value:null}].concat($jscomp.arrayFromIterable(array$jscomp$0(valueRef))),mark;model={};return valueRef?(model[channel]=valueRef,model):{}}function markDefProperties(mark,ignore){return VG_MARK_CONFIGS.reduce(function(m,
prop){void 0!==mark[prop]&&"ignore"!==ignore[prop]&&(m[prop]={value:mark[prop]});return m},{})}function valueIfDefined(prop,value){if(void 0!==value){var $jscomp$compprop13={};return $jscomp$compprop13[prop]={value:value},$jscomp$compprop13}}function allFieldsInvalidPredicate(model,$jscomp$destructuring$var115){var invalid=void 0===$jscomp$destructuring$var115.invalid?!1:$jscomp$destructuring$var115.invalid;$jscomp$destructuring$var115=$jscomp$destructuring$var115.channels.reduce(function(aggregator,
channel){var scaleComponent=model.getScaleComponent(channel);scaleComponent&&(scaleComponent=scaleComponent.get("type"),(channel=model.vgField(channel,{expr:"datum"}))&&scaleComponent in CONTINUOUS_DOMAIN_INDEX&&(aggregator[channel]=!0));return aggregator},{});$jscomp$destructuring$var115=keys($jscomp$destructuring$var115);if(0<$jscomp$destructuring$var115.length){var op=invalid?"||":"\x26\x26";return $jscomp$destructuring$var115.map(function(field){return fieldInvalidPredicate(field,invalid)}).join(" "+
op+" ")}}function defined(model){return model.config.invalidValues&&(model=allFieldsInvalidPredicate(model,{channels:["x","y"]}))?{defined:{signal:model}}:{}}function nonPosition(channel,model,opt){opt=void 0===opt?{}:opt;var markDef=model.markDef,encoding=model.encoding,config=model.config,$jscomp$destructuring$var118=opt;$jscomp$destructuring$var118=void 0===$jscomp$destructuring$var118.vgChannel?channel:$jscomp$destructuring$var118.vgChannel;var defaultRef=opt.defaultRef;opt=opt.defaultValue;void 0===
defaultRef&&(defaultRef=(opt=opt||($jscomp$destructuring$var118===channel?markDef[channel]:getFirstDefined(markDef[channel],markDef[$jscomp$destructuring$var118],getMarkConfig(channel,markDef,config,{vgChannel:$jscomp$destructuring$var118}))))?{value:opt}:void 0);return wrapCondition(model,encoding[channel],$jscomp$destructuring$var118,function(cDef){return midPoint({channel:channel,channelDef:cDef,scaleName:model.scaleName(channel),scale:model.getScaleComponent(channel),stack:null,defaultRef:defaultRef})})}
function wrapCondition(model,channelDef,vgChannel,refFn){var condition=channelDef&&channelDef.condition;channelDef=refFn(channelDef);if(condition){condition=(isArray(condition)?condition:[condition]).map(function(c){var conditionValueRef=refFn(c);c=c.selection?assembleSelectionPredicate(model,c.selection):expression$jscomp$0(model,c.test);return Object.assign({test:c},conditionValueRef)});var $jscomp$compprop14={};return $jscomp$compprop14[vgChannel]=[].concat($jscomp.arrayFromIterable(condition),
$jscomp.arrayFromIterable(void 0!==channelDef?[channelDef]:[])),$jscomp$compprop14}condition={};return void 0!==channelDef?(condition[vgChannel]=channelDef,condition):{}}function tooltip(model,opt){opt=void 0===opt?{}:opt;var encoding=model.encoding,markDef=model.markDef,config=model.config,channelDef=encoding.tooltip;return isArray(channelDef)?{tooltip:tooltipForEncoding({tooltip:channelDef},config,opt)}:wrapCondition(model,channelDef,"tooltip",function(cDef){var tooltipRefFromChannelDef=text$jscomp$0(cDef,
model.config,opt.reactiveGeom?"datum.datum":"datum");if(tooltipRefFromChannelDef)return tooltipRefFromChannelDef;if(null!==cDef){cDef=getFirstDefined(markDef.tooltip,getMarkConfig("tooltip",markDef,config));if(isString(cDef))return{value:cDef};if(isObject(cDef))return"encoding"===cDef.content?tooltipForEncoding(encoding,config,opt):{signal:"datum"}}})}function text$1(model,channel){channel=void 0===channel?"text":channel;return wrapCondition(model,model.encoding[channel],channel,function(cDef){return text$jscomp$0(cDef,
model.config)})}function pointPosition(channel,model,defaultRef,vgChannel){var encoding=model.encoding,mark=model.mark,markDef=model.markDef,config=model.config,stack=model.stack,channelDef=encoding[channel],channel2Def=encoding["x"===channel?"x2":"y2"],scaleName=model.scaleName(channel),scale=model.getScaleComponent(channel),offset=getOffset(channel,model.markDef);channelDef||!encoding.latitude&&!encoding.longitude?(model={channel:channel,channelDef:channelDef,channel2Def:channel2Def,scaleName:scaleName,
scale:scale,stack:stack,mark:mark,offset:offset,defaultRef:positionDefault({markDef:markDef,config:config,defaultRef:defaultRef,channel:channel,scaleName:scaleName,scale:scale,mark:mark,checkBarAreaWithoutZero:!channel2Def})},defaultRef=model.channel,encoding=model.channelDef,mark=model.scaleName,markDef=model.stack,config=model.offset,model=isFieldDef(encoding)&&markDef&&defaultRef===markDef.fieldChannel?fieldRef(encoding,mark,{suffix:"end"},{offset:config}):midPointWithPositionInvalidTest(model)):
model={field:model.getName(channel)};defaultRef={};return defaultRef[vgChannel||channel]=model,defaultRef}function pointPosition2(model,defaultRef,channel){var encoding=model.encoding,mark=model.mark,markDef=model.markDef,stack=model.stack,config=model.config,baseChannel="x2"===channel?"x":"y",sizeChannel="x2"===channel?"width":"height",channelDef=encoding[baseChannel],scaleName=model.scaleName(baseChannel);baseChannel=model.getScaleComponent(baseChannel);var offset=getOffset(channel,model.markDef);
if(!channelDef&&(encoding.latitude||encoding.longitude))return defaultRef={},defaultRef[channel]={field:model.getName(channel)},defaultRef;model=encoding[channel];model=isFieldDef(channelDef)&&stack&&channel.charAt(0)===stack.fieldChannel.charAt(0)?fieldRef(channelDef,scaleName,{suffix:"start"},{offset:offset}):midPointWithPositionInvalidTest({channel:channel,channelDef:model,scaleName:scaleName,scale:baseChannel,stack:stack,mark:mark,offset:offset,defaultRef:void 0});if(void 0!==model)return defaultRef=
{},defaultRef[channel]=model,defaultRef;model={};stack={};return getFirstDefined(position2orSize(channel,markDef),position2orSize(channel,(model[channel]=getStyleConfig(channel,markDef,config.style),model[sizeChannel]=getStyleConfig(sizeChannel,markDef,config.style),model)),position2orSize(channel,config[mark]),position2orSize(channel,config.mark),(stack[channel]=positionDefault({markDef:markDef,config:config,defaultRef:defaultRef,channel:channel,scaleName:scaleName,scale:baseChannel,mark:mark,checkBarAreaWithoutZero:!encoding[channel]})(),
stack))}function position2orSize(channel,markDef){var sizeChannel="x2"===channel?"width":"height";if(markDef[channel])return sizeChannel={},sizeChannel[channel]=vgValueRef(channel,markDef[channel]),sizeChannel;if(markDef[sizeChannel])return channel={},channel[sizeChannel]={value:markDef[sizeChannel]},channel}function guideEncodeEntry(encoding,model){return keys(encoding).reduce(function(encode,channel){return Object.assign({},encode,wrapCondition(model,encoding[channel],channel,function(x){return{value:x.value}}))},
{})}function parseGuideResolve(resolve,channel){var channelScaleResolve=resolve.scale[channel],guide=contains(POSITION_SCALE_CHANNELS,channel)?"axis":"legend";return"independent"===channelScaleResolve?("shared"===resolve[guide][channel]&&warn(message$jscomp$0.independentScaleMeansIndependentGuide(channel)),"independent"):resolve[guide][channel]||"shared"}function makeExplicit(value){return{explicit:!0,value:value}}function makeImplicit(value){return{explicit:!1,value:value}}function tieBreakByComparing(compare){return function(v1,
v2,property,propertyOf){var diff=compare(v1.value,v2.value);return 0<diff?v1:0>diff?v2:defaultTieBreaker(v1,v2,property,propertyOf)}}function defaultTieBreaker(v1,v2,property,propertyOf){v1.explicit&&v2.explicit&&warn(message$jscomp$0.mergeConflictingProperty(property,propertyOf,v1.value,v2.value));return v1}function mergeValuesWithExplicit(v1,v2,property,propertyOf,tieBreaker){tieBreaker=void 0===tieBreaker?defaultTieBreaker:tieBreaker;return void 0===v1||void 0===v1.value?v2:v1.explicit&&!v2.explicit?
v1:v2.explicit&&!v1.explicit?v2:stringify(v1.value)===stringify(v2.value)?v1:tieBreaker(v1,v2,property,propertyOf)}function type$jscomp$0(params){return getFirstDefined(params.legend.type,defaultType$1(params))}function defaultType$1($jscomp$destructuring$var126){var timeUnit=$jscomp$destructuring$var126.timeUnit,scaleType=$jscomp$destructuring$var126.scaleType,alwaysReturn=$jscomp$destructuring$var126.alwaysReturn;if(isColorChannel($jscomp$destructuring$var126.channel)){if(contains(["quarter","month",
"day"],timeUnit))return"symbol";if(scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX)return alwaysReturn?"gradient":void 0}return alwaysReturn?"symbol":void 0}function direction($jscomp$destructuring$var128){var legend=$jscomp$destructuring$var128.legend,legendConfig=$jscomp$destructuring$var128.legendConfig,timeUnit=$jscomp$destructuring$var128.timeUnit,channel=$jscomp$destructuring$var128.channel,scaleType=$jscomp$destructuring$var128.scaleType;$jscomp$destructuring$var128=getFirstDefined(legend.orient,
legendConfig.orient,"right");timeUnit=type$jscomp$0({legend:legend,channel:channel,timeUnit:timeUnit,scaleType:scaleType,alwaysReturn:!0});legend=legend.direction;legendConfig=legendConfig[timeUnit?"gradientDirection":"symbolDirection"];a:switch($jscomp$destructuring$var128){case "top":case "bottom":$jscomp$destructuring$var128="horizontal";break a;case "left":case "right":case "none":case void 0:$jscomp$destructuring$var128=void 0;break a;default:$jscomp$destructuring$var128="gradient"===timeUnit?
"horizontal":void 0}return getFirstDefined(legend,legendConfig,$jscomp$destructuring$var128)}function type$1(legendCmp,model,channel){model=model.getScaleComponent(channel).get("type");return getFirstDefined(legendCmp.get("type"),defaultType$1({channel:channel,scaleType:model,alwaysReturn:!0}))}function getMaxValue(channelDef){return getConditionValue(channelDef,function(v,conditionalDef){return Math.max(v,conditionalDef.value)})}function getFirstConditionValue(channelDef){return getConditionValue(channelDef,
function(v,conditionalDef){return getFirstDefined(v,conditionalDef.value)})}function getConditionValue(channelDef,reducer){if(channelDef&&channelDef.condition&&(isArray(channelDef.condition)||isValueDef(channelDef.condition)))return(isArray(channelDef.condition)?channelDef.condition:[channelDef.condition]).reduce(reducer,channelDef.value);if(isValueDef(channelDef))return channelDef.value}function parseLegend(model){isUnitModel(model)?model.component.legends=parseUnitLegend(model):model.component.legends=
parseNonUnitLegend(model)}function parseUnitLegend(model){var encoding=model.encoding;return"color fill stroke strokeWidth size shape opacity fillOpacity strokeOpacity".split(" ").reduce(function(legendComponent,channel){var def=encoding[channel];!model.legend(channel)||!model.getScaleComponent(channel)||isFieldDef(def)&&"shape"===channel&&"geojson"===def.type||(legendComponent[channel]=parseLegendForChannel(model,channel));return legendComponent},{})}function getLegendDefWithScale(model,channel){var scale=
model.scaleName("color");if("color"===channel)return model.markDef.filled?{fill:scale}:{stroke:scale};scale={};return scale[channel]=model.scaleName(channel),scale}function parseLegendForChannel(model,channel){for(var fieldDef=model.fieldDef(channel),legend=model.legend(channel),legendCmpt=new LegendComponent({},getLegendDefWithScale(model,channel)),$jscomp$iter$95=$jscomp.makeIterator(LEGEND_PROPERTIES),$jscomp$key$property=$jscomp$iter$95.next();!$jscomp$key$property.done;$jscomp$key$property=$jscomp$iter$95.next()){$jscomp$key$property=
$jscomp$key$property.value;var value=getProperty($jscomp$key$property,legend,channel,model);if(void 0!==value){a:{switch($jscomp$key$property){case "values":var JSCompiler_inline_result=!!legend.values;break a;case "title":if("title"===$jscomp$key$property&&value===fieldDef.title){JSCompiler_inline_result=!0;break a}}JSCompiler_inline_result=value===legend[$jscomp$key$property]}(JSCompiler_inline_result||void 0===model.config.legend[$jscomp$key$property])&&legendCmpt.set($jscomp$key$property,value,
JSCompiler_inline_result)}}var legendEncoding=legend.encoding||{};$jscomp$iter$95=["labels","legend","title","symbols","gradient"].reduce(function(e,part){var legendEncodingPart=guideEncodeEntry(legendEncoding[part]||{},model);legendEncodingPart=encode[part]?encode[part](fieldDef,legendEncodingPart,model,channel,legendCmpt):legendEncodingPart;void 0!==legendEncodingPart&&0<keys(legendEncodingPart).length&&(e[part]={update:legendEncodingPart});return e},{});0<keys($jscomp$iter$95).length&&legendCmpt.set("encode",
$jscomp$iter$95,!!legend.encoding);return legendCmpt}function getProperty(property,legend,channel,model){var encoding=model.encoding,mark=model.mark,fieldDef=getTypedFieldDef(encoding[channel]),legendConfig=model.config.legend,timeUnit=fieldDef.timeUnit,scaleType=model.getScaleComponent(channel).get("type");switch(property){case "direction":return direction({legend:legend,legendConfig:legendConfig,timeUnit:timeUnit,channel:channel,scaleType:scaleType});case "format":return isTimeFormatFieldDef(fieldDef)?
void 0:numberFormat(fieldDef,legend.format,model.config);case "formatType":return isTimeFormatFieldDef(fieldDef)?void 0:legend.formatType;case "gradientLength":mark=legend.gradientLength;encoding=legendConfig.gradientLength;fieldDef=legendConfig.gradientHorizontalMaxLength;property=legendConfig.gradientHorizontalMinLength;timeUnit=legendConfig.gradientVerticalMaxLength;var gradientVerticalMinLength=legendConfig.gradientVerticalMinLength;"horizontal"===direction({legend:legend,legendConfig:legendConfig,
channel:channel,scaleType:scaleType})?(channel=getFirstDefined(legend.orient,legendConfig.orient),channel="top"===channel||"bottom"===channel?{signal:"clamp("+model.getSizeSignalRef("width").signal+", "+property+", "+fieldDef+")"}:property):channel={signal:"clamp("+model.getSizeSignalRef("height").signal+", "+gradientVerticalMinLength+", "+timeUnit+")"};return getFirstDefined(mark,encoding,channel);case "labelOverlap":return channel=legend.labelOverlap,model=contains(["quantile","threshold","log"],
scaleType)?"greedy":void 0,getFirstDefined(channel,model);case "symbolType":scaleType=legend.symbolType;a:{model=model.markDef.shape;if("shape"!==channel&&(channel=getFirstConditionValue(encoding.shape)||model))break a;switch(mark){case "bar":case "rect":case "square":channel="square";break a;case "line":case "trail":case "rule":channel="stroke";break a;case "point":case "circle":case "tick":case "geoshape":case "area":case "text":channel="circle";break a}channel=void 0}return getFirstDefined(scaleType,
channel);case "title":return title$jscomp$0(fieldDef,model.config,{allowDisabling:!0})||void 0;case "type":return type$jscomp$0({legend:legend,channel:channel,timeUnit:timeUnit,scaleType:scaleType,alwaysReturn:!1});case "values":return channel=(channel=legend.values)?valueArray(fieldDef,channel):void 0,channel}return legend[property]}function parseNonUnitLegend(model){var $jscomp$destructuring$var137=model.component,legends=$jscomp$destructuring$var137.legends,resolve=$jscomp$destructuring$var137.resolve;
$jscomp$destructuring$var137={};for(var $jscomp$iter$96=$jscomp.makeIterator(model.children),$jscomp$key$child$jscomp$0=$jscomp$iter$96.next();!$jscomp$key$child$jscomp$0.done;$jscomp$destructuring$var137={$jscomp$loop$prop$child$339:$jscomp$destructuring$var137.$jscomp$loop$prop$child$339},$jscomp$key$child$jscomp$0=$jscomp$iter$96.next())$jscomp$destructuring$var137.$jscomp$loop$prop$child$339=$jscomp$key$child$jscomp$0.value,parseLegend($jscomp$destructuring$var137.$jscomp$loop$prop$child$339),
keys($jscomp$destructuring$var137.$jscomp$loop$prop$child$339.component.legends).forEach(function($jscomp$loop$338){return function(channel){resolve.legend[channel]=parseGuideResolve(model.component.resolve,channel);"shared"===resolve.legend[channel]&&(legends[channel]=mergeLegendComponent(legends[channel],$jscomp$loop$338.$jscomp$loop$prop$child$339.component.legends[channel]),legends[channel]||(resolve.legend[channel]="independent",delete legends[channel]))}}($jscomp$destructuring$var137));keys(legends).forEach(function(channel){for(var $jscomp$iter$97=
$jscomp.makeIterator(model.children),$jscomp$key$child=$jscomp$iter$97.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$97.next())$jscomp$key$child=$jscomp$key$child.value,$jscomp$key$child.component.legends[channel]&&"shared"===resolve.legend[channel]&&delete $jscomp$key$child.component.legends[channel]});return legends}function mergeLegendComponent(mergedLegend,childLegend){if(!mergedLegend)return childLegend.clone();var mergedOrient=mergedLegend.getWithExplicit("orient"),childOrient=
childLegend.getWithExplicit("orient");if(!mergedOrient.explicit||!childOrient.explicit||mergedOrient.value===childOrient.value){var typeMerged=!1;mergedOrient={};childOrient=$jscomp.makeIterator(VG_LEGEND_PROPERTIES);for(var $jscomp$key$prop=childOrient.next();!$jscomp$key$prop.done;mergedOrient={$jscomp$loop$prop$prop$341:mergedOrient.$jscomp$loop$prop$prop$341},$jscomp$key$prop=childOrient.next())mergedOrient.$jscomp$loop$prop$prop$341=$jscomp$key$prop.value,$jscomp$key$prop=mergeValuesWithExplicit(mergedLegend.getWithExplicit(mergedOrient.$jscomp$loop$prop$prop$341),
childLegend.getWithExplicit(mergedOrient.$jscomp$loop$prop$prop$341),mergedOrient.$jscomp$loop$prop$prop$341,"legend",function($jscomp$loop$340){return function(v1,v2){switch($jscomp$loop$340.$jscomp$loop$prop$prop$341){case "symbolType":return v1="circle"===v2.value?v2:v1,v1;case "title":return mergeTitleComponent(v1,v2);case "type":return typeMerged=!0,makeImplicit("symbol")}return defaultTieBreaker(v1,v2,$jscomp$loop$340.$jscomp$loop$prop$prop$341,"legend")}}(mergedOrient)),mergedLegend.setWithExplicit(mergedOrient.$jscomp$loop$prop$prop$341,
$jscomp$key$prop);typeMerged&&(((mergedLegend.implicit||{}).encode||{}).gradient&&deleteNestedProperty(mergedLegend.implicit,["encode","gradient"]),((mergedLegend.explicit||{}).encode||{}).gradient&&deleteNestedProperty(mergedLegend.explicit,["encode","gradient"]));return mergedLegend}}function assembleLegends(model){for(var legendComponentIndex=model.component.legends,legendByDomain={},$jscomp$iter$100=$jscomp.makeIterator(keys(legendComponentIndex)),$jscomp$key$channel=$jscomp$iter$100.next();!$jscomp$key$channel.done;$jscomp$key$channel=
$jscomp$iter$100.next()){$jscomp$key$channel=$jscomp$key$channel.value;var scaleComponent=model.getScaleComponent($jscomp$key$channel);scaleComponent=stringify(scaleComponent.get("domains"));if(legendByDomain[scaleComponent])for(var $jscomp$iter$99=$jscomp.makeIterator(legendByDomain[scaleComponent]),$jscomp$key$mergedLegendComponent=$jscomp$iter$99.next();!$jscomp$key$mergedLegendComponent.done;$jscomp$key$mergedLegendComponent=$jscomp$iter$99.next())mergeLegendComponent($jscomp$key$mergedLegendComponent.value,
legendComponentIndex[$jscomp$key$channel])||legendByDomain[scaleComponent].push(legendComponentIndex[$jscomp$key$channel]);else legendByDomain[scaleComponent]=[legendComponentIndex[$jscomp$key$channel].clone()]}return flatten(vals(legendByDomain)).map(function(legendCmpt){legendCmpt=legendCmpt.combine();if(legendCmpt.encode&&legendCmpt.encode.symbols){var out=legendCmpt.encode.symbols.update;!out.fill||"transparent"===out.fill.value||out.stroke||legendCmpt.stroke||(out.stroke={value:"transparent"});
legendCmpt.fill&&delete out.fill}return legendCmpt})}function assembleProjectionsForModelAndChildren(model){return model.children.reduce(function(projections,child){return projections.concat(child.assembleProjections())},assembleProjectionForModel(model))}function assembleProjectionForModel(model){var component=model.component.projection;if(!component||component.merged)return[];var projection=component.combine(),name=projection.name;projection=__rest(projection,["name"]);if(component.data){var size=
{signal:"["+component.size.map(function(ref){return ref.signal}).join(", ")+"]"};component=component.data.reduce(function(sources,data){data=data.signal?data.signal:"data('"+model.lookupDataSource(data)+"')";contains(sources,data)||sources.push(data);return sources},[]);if(0>=component.length)throw Error("Projection's fit didn't find any data sources");return[Object.assign({name:name,size:size,fit:{signal:1<component.length?"["+component.join(", ")+"]":component[0]}},projection)]}return[Object.assign({name:name},
{translate:{signal:"[width / 2, height / 2]"}},projection)]}function parseUnitProjection(model){if(model.hasProjection){var proj=model.specifiedProjection,fit=!(proj&&(null!=proj.scale||null!=proj.translate)),size=fit?[model.getSizeSignalRef("width"),model.getSizeSignalRef("height")]:void 0;fit=fit?gatherFitData(model):void 0;return new ProjectionComponent(model.projectionName(!0),Object.assign({},model.config.projection||{},proj||{}),size,fit)}}function gatherFitData(model){var data=[];[["longitude",
"latitude"],["longitude2","latitude2"]].forEach(function(posssiblePair){(model.channelHasField(posssiblePair[0])||model.channelHasField(posssiblePair[1]))&&data.push({signal:model.getName("geojson_"+data.length)})});model.channelHasField("shape")&&"geojson"===model.fieldDef("shape").type&&data.push({signal:model.getName("geojson_"+data.length)});0===data.length&&data.push(model.requestDataName("main"));return data}function mergeIfNoConflict(first,second){var allPropertiesShared=every(PROJECTION_PROPERTIES,
function(prop){return!first.explicit.hasOwnProperty(prop)&&!second.explicit.hasOwnProperty(prop)||first.explicit.hasOwnProperty(prop)&&second.explicit.hasOwnProperty(prop)&&stringify(first.get(prop))===stringify(second.get(prop))?!0:!1});if(stringify(first.size)===stringify(second.size)){if(allPropertiesShared)return first;if(stringify(first.explicit)===stringify({}))return second;if(stringify(second.explicit)===stringify({}))return first}return null}function parseNonUnitProjections(model){if(0!==
model.children.length){var nonUnitProjection;model.children.forEach(function(child){child.component.projection=isUnitModel(child)?parseUnitProjection(child):parseNonUnitProjections(child)});var mergable=every(model.children,function(child){if(child=child.component.projection){if(nonUnitProjection)return(child=mergeIfNoConflict(nonUnitProjection,child))&&(nonUnitProjection=child),!!child;nonUnitProjection=child}return!0});if(nonUnitProjection&&mergable){var name$249=model.projectionName(!0),modelProjection=
new ProjectionComponent(name$249,nonUnitProjection.specifiedProjection,nonUnitProjection.size,duplicate(nonUnitProjection.data));model.children.forEach(function(child){var projection=child.component.projection;projection&&(projection.isFit&&modelProjection.data.push.apply(modelProjection.data,$jscomp.arrayFromIterable(child.component.projection.data)),child.renameProjection(projection.get("name"),name$249),projection.merged=!0)});return modelProjection}}}function rangeFormula(model,fieldDef,channel,
config){if(binRequiresRange(fieldDef,channel)){model=isUnitModel(model)?model.axis(channel)||model.legend(channel)||{}:{};channel=vgField(fieldDef,{expr:"datum"});var endField=vgField(fieldDef,{expr:"datum",binSuffix:"end"});return{formulaAs:vgField(fieldDef,{binSuffix:"range",forAs:!0}),formula:binFormatExpression(channel,endField,model.format,config)}}return{}}function getBinSignalName(model,field,bin){bin=normalizeBin(bin,void 0)||{};field=binToString(bin)+"_"+field;return model.getName(field+
"_bins")}function createBinComponent(t,bin,model){var as="as"in t?isString(t.as)?[t.as,t.as+"_end"]:[t.as[0],t.as[1]]:[vgField(t,{forAs:!0}),vgField(t,{binSuffix:"end",forAs:!0})];bin=normalizeBin(bin,void 0)||{};var JSCompiler_inline_result=t.field;JSCompiler_inline_result=binToString(bin)+"_"+JSCompiler_inline_result;var JSCompiler_object_inline_signal_1120=model.getName(JSCompiler_inline_result+"_bins");model=model.getName(JSCompiler_inline_result+"_extent");t=Object.assign({bin:bin,field:t.field,
as:[as]},JSCompiler_object_inline_signal_1120?{signal:JSCompiler_object_inline_signal_1120}:{},model?{extentSignal:model}:{});return{key:JSCompiler_inline_result,binComponent:t}}function checkLinks(nodes){nodes=$jscomp.makeIterator(nodes);for(var $jscomp$key$node=nodes.next();!$jscomp$key$node.done;$jscomp$key$node=nodes.next()){$jscomp$key$node=$jscomp$key$node.value;for(var $jscomp$iter$104=$jscomp.makeIterator($jscomp$key$node.children),$jscomp$key$child=$jscomp$iter$104.next();!$jscomp$key$child.done;$jscomp$key$child=
$jscomp$iter$104.next())if($jscomp$key$child=$jscomp$key$child.value,$jscomp$key$child.parent!==$jscomp$key$node)return console.error("Dataflow graph is inconsistent.",$jscomp$key$node,$jscomp$key$child),!1;if(!checkLinks($jscomp$key$node.children))return!1}return!0}function isDataSourceNode(node){return node instanceof SourceNode||node instanceof GraticuleNode||node instanceof SequenceNode}function unquote(pattern){return"'"===pattern[0]&&"'"===pattern[pattern.length-1]||'"'===pattern[0]&&'"'===
pattern[pattern.length-1]?pattern.slice(1,-1):pattern}function parseExpression$1(field,parse){field=accessPathWithDatum(field);if("number"===parse)return"toNumber("+field+")";if("boolean"===parse)return"toBoolean("+field+")";if("string"===parse)return"toString("+field+")";if("date"===parse)return"toDate("+field+")";if("flatten"===parse)return field;if(0===parse.indexOf("date:"))return parse=unquote(parse.slice(5,parse.length)),"timeParse("+field+",'"+parse+"')";if(0===parse.indexOf("utc:"))return parse=
unquote(parse.slice(4,parse.length)),"utcParse("+field+",'"+parse+"')";warn(message$jscomp$0.unrecognizedParse(parse));return null}function getStackByFields(model){return model.stack.stackBy.reduce(function(fields,by){(by=vgField(by.fieldDef))&&fields.push(by);return fields},[])}function isValidAsArray(as){return isArray(as)&&as.every(function(s){return isString(s)})&&1<as.length}function cloneSubtree(facet){function clone(node){if(!(node instanceof FacetNode)){var copy=node.clone();if(copy instanceof
OutputNode){var newName="scale_"+copy.getSource();copy.setSource(newName);facet.model.component.data.outputNodes[newName]=copy}else(copy instanceof AggregateNode||copy instanceof StackNode||copy instanceof WindowTransformNode||copy instanceof JoinAggregateTransformNode)&&copy.addDimensions(facet.fields);flatten(node.children.map(clone)).forEach(function(n){return n.parent=copy});return[copy]}return flatten(node.children.map(clone))}return clone}function moveFacetDown(node){if(node instanceof FacetNode)if(1!==
node.numChildren()||node.children[0]instanceof OutputNode){var facetMain=node.model.component.data.main;moveMainDownToFacet(facetMain);var cloner=cloneSubtree(node);node=flatten(node.children.map(cloner));node=$jscomp.makeIterator(node);for(cloner=node.next();!cloner.done;cloner=node.next())cloner.value.parent=facetMain}else facetMain=node.children[0],(facetMain instanceof AggregateNode||facetMain instanceof StackNode||facetMain instanceof WindowTransformNode||facetMain instanceof JoinAggregateTransformNode)&&
facetMain.addDimensions(node.fields),facetMain.swapWithParent(),moveFacetDown(node);else node.children.map(moveFacetDown)}function moveMainDownToFacet(node){if(node instanceof OutputNode&&"main"===node.type&&1===node.numChildren()){var child=node.children[0];child instanceof FacetNode||(child.swapWithParent(),moveMainDownToFacet(node))}}function getLeaves(roots){function append(node){0===node.numChildren()?leaves.push(node):node.children.forEach(append)}var leaves=[];roots.forEach(append);return leaves}
function isTrue(x){return x}function runOptimizer(optimizer,nodes){return nodes.map(function(node){return optimizer instanceof BottomUpOptimizer?(node=optimizer.optimizeNextFromLeaves(node),optimizer.reset(),node):optimizer.run(node)}).some(isTrue)}function optimizationDataflowHelper(dataComponent,model){var roots=dataComponent.sources,mutatedFlags=new Set;mutatedFlags.add(runOptimizer(new RemoveUnnecessaryNodes,roots));roots=roots.filter(function(r){return 0<r.numChildren()});mutatedFlags.add(runOptimizer(new RemoveUnusedSubtrees,
getLeaves(roots)));roots=roots.filter(function(r){return 0<r.numChildren()});mutatedFlags.add(runOptimizer(new MoveParseUp,getLeaves(roots)));mutatedFlags.add(runOptimizer(new MergeBins(model),getLeaves(roots)));mutatedFlags.add(runOptimizer(new RemoveDuplicateTimeUnits,getLeaves(roots)));mutatedFlags.add(runOptimizer(new MergeParse,getLeaves(roots)));mutatedFlags.add(runOptimizer(new MergeAggregates,getLeaves(roots)));mutatedFlags.add(runOptimizer(new MergeTimeUnits,getLeaves(roots)));mutatedFlags.add(runOptimizer(new MergeIdenticalNodes,
roots));mutatedFlags.add(runOptimizer(new MergeOutputs,getLeaves(roots)));dataComponent.sources=roots;return mutatedFlags.has(!0)}function parseScaleDomain(model){isUnitModel(model)?parseUnitScaleDomain(model):parseNonUnitScaleDomain(model)}function parseUnitScaleDomain(model){var scales=model.specifiedScales,localScaleComponents=model.component.scales;keys(localScaleComponents).forEach(function(channel){var specifiedScale=scales[channel];specifiedScale=specifiedScale?specifiedScale.domain:void 0;
var JSCompiler_inline_result=model.getScaleComponent(channel).get("type");var JSCompiler_inline_result$jscomp$0=model.scaleDomain(channel);var fieldDef=model.fieldDef(channel),scaleConfig=model.config.scale;"unaggregated"===JSCompiler_inline_result$jscomp$0?(fieldDef=canUseUnaggregatedDomain(fieldDef,JSCompiler_inline_result),scaleConfig=fieldDef.reason,fieldDef.valid||(warn(scaleConfig),JSCompiler_inline_result$jscomp$0=void 0)):void 0===JSCompiler_inline_result$jscomp$0&&scaleConfig.useUnaggregatedDomain&&
canUseUnaggregatedDomain(fieldDef,JSCompiler_inline_result).valid&&(JSCompiler_inline_result$jscomp$0="unaggregated");JSCompiler_inline_result$jscomp$0!==model.scaleDomain(channel)&&(model.specifiedScales[channel]=Object.assign({},model.specifiedScales[channel],{domain:JSCompiler_inline_result$jscomp$0}));JSCompiler_inline_result="x"===channel&&model.channelHasField("x2")?model.channelHasField("x")?mergeValuesWithExplicit(parseSingleChannelDomain(JSCompiler_inline_result,JSCompiler_inline_result$jscomp$0,
model,"x"),parseSingleChannelDomain(JSCompiler_inline_result,JSCompiler_inline_result$jscomp$0,model,"x2"),"domain","scale",domainsTieBreaker):parseSingleChannelDomain(JSCompiler_inline_result,JSCompiler_inline_result$jscomp$0,model,"x2"):"y"===channel&&model.channelHasField("y2")?model.channelHasField("y")?mergeValuesWithExplicit(parseSingleChannelDomain(JSCompiler_inline_result,JSCompiler_inline_result$jscomp$0,model,"y"),parseSingleChannelDomain(JSCompiler_inline_result,JSCompiler_inline_result$jscomp$0,
model,"y2"),"domain","scale",domainsTieBreaker):parseSingleChannelDomain(JSCompiler_inline_result,JSCompiler_inline_result$jscomp$0,model,"y2"):parseSingleChannelDomain(JSCompiler_inline_result,JSCompiler_inline_result$jscomp$0,model,channel);JSCompiler_inline_result$jscomp$0=localScaleComponents[channel];JSCompiler_inline_result$jscomp$0.setWithExplicit("domains",JSCompiler_inline_result);specifiedScale&&specifiedScale.selection&&JSCompiler_inline_result$jscomp$0.set("domainRaw",{signal:"_selection_domain_"+
hash(specifiedScale)},!0);if(model.component.data.isFaceted){for(specifiedScale=model;!isFacetModel(specifiedScale)&&specifiedScale.parent;)specifiedScale=specifiedScale.parent;if("shared"===specifiedScale.component.resolve.scale[channel])for(channel=$jscomp.makeIterator(JSCompiler_inline_result.value),specifiedScale=channel.next();!specifiedScale.done;specifiedScale=channel.next())specifiedScale=specifiedScale.value,isDataRefDomain(specifiedScale)&&(specifiedScale.data="scale_"+specifiedScale.data.replace("scale_",
""))}})}function parseNonUnitScaleDomain(model){for(var $jscomp$iter$151=$jscomp.makeIterator(model.children),$jscomp$key$child$jscomp$0=$jscomp$iter$151.next();!$jscomp$key$child$jscomp$0.done;$jscomp$key$child$jscomp$0=$jscomp$iter$151.next())parseScaleDomain($jscomp$key$child$jscomp$0.value);var localScaleComponents=model.component.scales;keys(localScaleComponents).forEach(function(channel){for(var domains,domainRaw=null,$jscomp$iter$152=$jscomp.makeIterator(model.children),$jscomp$key$child=$jscomp$iter$152.next();!$jscomp$key$child.done;$jscomp$key$child=
$jscomp$iter$152.next())if($jscomp$key$child=$jscomp$key$child.value.component.scales[channel])domains=void 0===domains?$jscomp$key$child.getWithExplicit("domains"):mergeValuesWithExplicit(domains,$jscomp$key$child.getWithExplicit("domains"),"domains","scale",domainsTieBreaker),$jscomp$key$child=$jscomp$key$child.get("domainRaw"),domainRaw&&$jscomp$key$child&&domainRaw.signal!==$jscomp$key$child.signal&&warn("The same selection must be used to override scale domains in a layered view."),domainRaw=
$jscomp$key$child;localScaleComponents[channel].setWithExplicit("domains",domains);domainRaw&&localScaleComponents[channel].set("domainRaw",domainRaw,!0)})}function mapDomainToDataSignal(domain,type,timeUnit){return domain.map(function(v){return{signal:"{data: "+valueExpr(v,{timeUnit:timeUnit,type:type})+"}"}})}function parseSingleChannelDomain(scaleType,domain,model,channel){var fieldDef=model.fieldDef(channel);if(domain&&"unaggregated"!==domain&&(!domain||!domain.selection))return channel=fieldDef.type,
fieldDef=fieldDef.timeUnit,"temporal"===channel||fieldDef?makeExplicit(mapDomainToDataSignal(domain,channel,fieldDef)):makeExplicit([domain]);var stack=model.stack;if(stack&&channel===stack.fieldChannel){if("normalize"===stack.offset)return makeImplicit([[0,1]]);fieldDef=model.requestDataName("main");return makeImplicit([{data:fieldDef,field:model.vgField(channel,{suffix:"start"})},{data:fieldDef,field:model.vgField(channel,{suffix:"end"})}])}stack=SCALE_CHANNEL_INDEX[channel]?domainSort(model,channel,
scaleType):void 0;if("unaggregated"===domain)return domain=model.requestDataName("main"),fieldDef=fieldDef.field,makeImplicit([{data:domain,field:vgField({field:fieldDef,aggregate:"min"})},{data:domain,field:vgField({field:fieldDef,aggregate:"max"})}]);if(isBinning(fieldDef.bin)){if(scaleType in DISCRETE_DOMAIN_INDEX)return"bin-ordinal"===scaleType?makeImplicit([]):makeImplicit([{data:!0===stack||!1===stack?model.requestDataName("main"):model.requestDataName("raw"),field:model.vgField(channel,binRequiresRange(fieldDef,
channel)?{binSuffix:"range"}:{}),sort:!0!==stack&&isObject(stack)?stack:{field:model.vgField(channel,{}),op:"min"}}]);domain=fieldDef.bin;if(isBinning(domain)){var binSignal=getBinSignalName(model,fieldDef.field,domain);return makeImplicit([new SignalRefWrapper(function(){var signal=model.getSignalName(binSignal);return"["+signal+".start, "+signal+".stop]"})])}return makeImplicit([{data:model.requestDataName("main"),field:model.vgField(channel,{})}])}return stack?makeImplicit([{data:!0===stack||!1===
stack?model.requestDataName("main"):model.requestDataName("raw"),field:model.vgField(channel),sort:stack}]):makeImplicit([{data:model.requestDataName("main"),field:model.vgField(channel)}])}function normalizeSortField(sort,isStacked){var field=sort.field,order=sort.order;return Object.assign({op:sort.op||(isStacked?"sum":"mean")},field?{field:replacePathInField(field)}:{},order?{order:order}:{})}function domainSort(model,channel,scaleType){if(scaleType in DISCRETE_DOMAIN_INDEX){var fieldDef=model.fieldDef(channel);
scaleType=fieldDef.sort;if(isSortArray(scaleType))return{op:"min",field:sortArrayIndexField(fieldDef,channel),order:"ascending"};fieldDef=null!==model.stack;if(isSortField(scaleType))return normalizeSortField(scaleType,fieldDef);if(scaleType&&scaleType.encoding)return channel=scaleType.order,model=model.fieldDef(scaleType.encoding),normalizeSortField({op:model.aggregate,field:model.field,order:channel},fieldDef);if("descending"===scaleType)return{op:"min",field:model.vgField(channel),order:"descending"};
if(contains(["ascending",void 0],scaleType))return!0}}function canUseUnaggregatedDomain(fieldDef,scaleType){var aggregate=fieldDef.aggregate,type=fieldDef.type;return aggregate?isString(aggregate)&&!SHARED_DOMAIN_OP_INDEX[aggregate]?{valid:!1,reason:message$jscomp$0.unaggregateDomainWithNonSharedDomainOp(aggregate)}:"quantitative"===type&&"log"===scaleType?{valid:!1,reason:message$jscomp$0.unaggregatedDomainWithLogScale(fieldDef)}:{valid:!0}:{valid:!1,reason:message$jscomp$0.unaggregateDomainHasNoEffectForRawField(fieldDef)}}
function domainsTieBreaker(v1,v2,property,propertyOf){v1.explicit&&v2.explicit&&warn(message$jscomp$0.mergeConflictingDomainProperty(property,propertyOf,v1.value,v2.value));return{explicit:v1.explicit,value:[].concat($jscomp.arrayFromIterable(v1.value),$jscomp.arrayFromIterable(v2.value))}}function mergeDomains(domains){var uniqueDomains=unique(domains.map(function(domain){return isDataRefDomain(domain)?__rest(domain,["sort"]):domain}),hash),sorts=unique(domains.map(function(d){if(isDataRefDomain(d))return d=
d.sort,void 0!==d&&!0!==d&&!1!==d&&("count"===d.op&&delete d.field,"ascending"===d.order&&delete d.order),d}).filter(function(s){return void 0!==s}),hash);if(0!==uniqueDomains.length){if(1===uniqueDomains.length){uniqueDomains=domains[0];if(isDataRefDomain(uniqueDomains)&&0<sorts.length){var sort$282=sorts[0];1<sorts.length&&(warn(message$jscomp$0.MORE_THAN_ONE_SORT),sort$282=!0);return Object.assign({},uniqueDomains,{sort:sort$282})}return uniqueDomains}sorts=unique(sorts.map(function(s){if(!0===
s||!1===s||"count"===s.op)return s;warn(message$jscomp$0.domainSortDropped(s));return!0}),hash);1===sorts.length?sort$282=sorts[0]:1<sorts.length&&(warn(message$jscomp$0.MORE_THAN_ONE_SORT),sort$282=!0);sorts=unique(domains.map(function(d){return isDataRefDomain(d)?d.data:null}),function(x){return x});return 1===sorts.length&&null!==sorts[0]?Object.assign({data:sorts[0],fields:uniqueDomains.map(function(d){return d.field})},sort$282?{sort:sort$282}:{}):Object.assign({fields:uniqueDomains},sort$282?
{sort:sort$282}:{})}}function getFieldFromDomain(domain){if(isDataRefDomain(domain)&&isString(domain.field))return domain.field;var JSCompiler_inline_result=isArray(domain)?!1:"fields"in domain&&!("data"in domain);if(JSCompiler_inline_result){domain=$jscomp.makeIterator(domain.fields);for(JSCompiler_inline_result=domain.next();!JSCompiler_inline_result.done;JSCompiler_inline_result=domain.next())if(JSCompiler_inline_result=JSCompiler_inline_result.value,isDataRefDomain(JSCompiler_inline_result)&&
isString(JSCompiler_inline_result.field))if(!field$284)var field$284=JSCompiler_inline_result.field;else if(field$284!==JSCompiler_inline_result.field)return warn("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect."),field$284;warn("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect.");
return field$284}field$284=isArray(domain)?!1:"fields"in domain&&"data"in domain;if(field$284)return warn("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect."),field$284=domain.fields[0],isString(field$284)?field$284:void 0}function assembleDomain(model,channel){channel=model.component.scales[channel].get("domains").map(function(domain){isDataRefDomain(domain)&&(domain.data=model.lookupDataSource(domain.data));
return domain});return mergeDomains(channel)}function assembleScales(model){return isLayerModel(model)||model&&"concat"===model.type||model&&"repeat"===model.type?model.children.reduce(function(scales,child){return scales.concat(assembleScales(child))},assembleScalesForModel(model)):assembleScalesForModel(model)}function assembleScalesForModel(model){return keys(model.component.scales).reduce(function(scales,channel){var scaleComponent=model.component.scales[channel];if(scaleComponent.merged)return scales;
var scale=scaleComponent.combine();scaleComponent=scale.domainRaw;var name=scale.name,type=scale.type,otherScaleProps=__rest(scale,["name","type","domains","domainRaw","range"]);scale=scale.range;scale="x"!==channel&&"y"!==channel||!isVgRangeStep(scale)?scale:{step:{signal:name+"_step"}};scaleComponent&&0<=scaleComponent.signal.indexOf("_selection_domain_")&&(scaleComponent=assembleSelectionScaleDomain(model,scaleComponent));channel=assembleDomain(model,channel);scales.push(Object.assign({name:name,
type:type},channel?{domain:channel}:{},scaleComponent?{domainRaw:scaleComponent}:{},{range:scale},otherScaleProps));return scales},[])}function getSizeType(channel){return"x"===channel?"width":"y"===channel?"height":void 0}function parseUnitScaleRange(model){var localScaleComponents=model.component.scales;SCALE_CHANNELS.forEach(function(channel){var localScaleCmpt=localScaleComponents[channel];if(localScaleCmpt){var mergedScaleCmpt=model.getScaleComponent(channel),specifiedScale=model.specifiedScales[channel],
fieldDef=model.fieldDef(channel),sizeType=getSizeType(channel),sizeSpecified=sizeType?!!model.component.layoutSize.get(sizeType):void 0;mergedScaleCmpt=mergedScaleCmpt.get("type");var rangeStep=contains(["point","band"],mergedScaleCmpt)||!!specifiedScale.rangeStep;sizeType&&model.fit&&!sizeSpecified&&rangeStep&&(warn(message$jscomp$0.CANNOT_FIX_RANGE_STEP_WITH_FIT),sizeSpecified=!0);rangeStep=[];for(var $jscomp$inline_716=$jscomp.makeIterator(POSITION_SCALE_CHANNELS),$jscomp$key$channel=$jscomp$inline_716.next();!$jscomp$key$channel.done;$jscomp$key$channel=
$jscomp$inline_716.next())$jscomp$key$channel=getRangeStep(model,$jscomp$key$channel.value),void 0!==$jscomp$key$channel&&rangeStep.push($jscomp$key$channel);a:{$jscomp$inline_716=model.getSignalName.bind(model);var type=fieldDef.type;fieldDef=model.config;var zero=localScaleCmpt.get("zero");$jscomp$key$channel=model.mark;sizeType=model.getName(sizeType);for(var noRangeStep=sizeSpecified||null===specifiedScale.rangeStep,$jscomp$inline_733=$jscomp.makeIterator(RANGE_PROPERTIES),$jscomp$key$property=
$jscomp$inline_733.next();!$jscomp$key$property.done;$jscomp$key$property=$jscomp$inline_733.next())if($jscomp$key$property=$jscomp$key$property.value,void 0!==specifiedScale[$jscomp$key$property]){var supportedByScaleType=scaleTypeSupportProperty(mergedScaleCmpt,$jscomp$key$property),channelIncompatability=channelScalePropertyIncompatability(channel,$jscomp$key$property);if(supportedByScaleType)if(channelIncompatability)warn(channelIncompatability);else switch($jscomp$key$property){case "range":channel=
makeExplicit(specifiedScale[$jscomp$key$property]);break a;case "scheme":channel=(channel=specifiedScale[$jscomp$key$property])&&channel.name?Object.assign({scheme:channel.name},omit(channel,["name"])):{scheme:channel};channel=makeExplicit(channel);break a;case "rangeStep":if($jscomp$key$property=specifiedScale[$jscomp$key$property],null!==$jscomp$key$property)if(sizeSpecified)warn(message$jscomp$0.rangeStepDropped(channel));else{channel=makeExplicit({step:$jscomp$key$property});break a}}else warn(message$jscomp$0.scalePropertyNotWorkWithScaleType(mergedScaleCmpt,
$jscomp$key$property,channel))}b:{specifiedScale=specifiedScale.domain;switch(channel){case "x":case "y":if(contains(["point","band"],mergedScaleCmpt)&&!noRangeStep)if("x"===channel&&"text"===$jscomp$key$channel){if(fieldDef.scale.textXRangeStep){channel={step:fieldDef.scale.textXRangeStep};break b}}else if(fieldDef.scale.rangeStep){channel={step:fieldDef.scale.rangeStep};break b}channel="y"===channel&&mergedScaleCmpt in CONTINUOUS_DOMAIN_INDEX?[SignalRefWrapper.fromName($jscomp$inline_716,sizeType),
0]:[0,SignalRefWrapper.fromName($jscomp$inline_716,sizeType)];break b;case "size":$jscomp$inline_716=sizeRangeMin($jscomp$key$channel,zero,fieldDef);rangeStep=sizeRangeMax($jscomp$key$channel,rangeStep,fieldDef);if(mergedScaleCmpt in CONTINUOUS_TO_DISCRETE_INDEX){$jscomp$key$channel=interpolateRange;c:{switch(mergedScaleCmpt){case "quantile":channel=fieldDef.scale.quantileCount;break c;case "quantize":channel=fieldDef.scale.quantizeCount;break c;case "threshold":void 0!==specifiedScale&&isArray(specifiedScale)?
channel=specifiedScale.length+1:(warn(message$jscomp$0.domainRequiredForThresholdScale(channel)),channel=3);break c}channel=void 0}channel=$jscomp$key$channel($jscomp$inline_716,rangeStep,channel);break b}channel=[$jscomp$inline_716,rangeStep];break b;case "strokeWidth":channel=[fieldDef.scale.minStrokeWidth,fieldDef.scale.maxStrokeWidth];break b;case "shape":channel="symbol";break b;case "color":case "fill":case "stroke":channel="ordinal"===mergedScaleCmpt?"nominal"===type?"category":"ordinal":"rect"===
$jscomp$key$channel||"geoshape"===$jscomp$key$channel?"heatmap":"ramp";break b;case "opacity":case "fillOpacity":case "strokeOpacity":channel=[fieldDef.scale.minOpacity,fieldDef.scale.maxOpacity];break b}throw Error("Scale range undefined for channel "+channel);}channel=makeImplicit(channel)}localScaleCmpt.setWithExplicit("range",channel)}})}function getRangeStep(model,channel){var scaleCmpt=model.getScaleComponent(channel);if(scaleCmpt){var scaleType=scaleCmpt.get("type"),fieldDef=model.fieldDef(channel);
if(scaleType in DISCRETE_DOMAIN_INDEX){if((channel=scaleCmpt&&scaleCmpt.get("range"))&&isVgRangeStep(channel)&&isNumber(channel.step))return channel.step}else if(fieldDef&&fieldDef.bin&&isBinning(fieldDef.bin)){var binSignal=getBinSignalName(model,fieldDef.field,fieldDef.bin);channel=getSizeType(channel);var sizeSignal=model.getName(channel);return new SignalRefWrapper(function(){var updatedName=model.getSignalName(binSignal);updatedName="("+updatedName+".stop - "+updatedName+".start) / "+updatedName+
".step";return model.getSignalName(sizeSignal)+" / ("+updatedName+")"})}}}function interpolateRange(rangeMin,rangeMax,cardinality){var f=function(){var step="("+(rangeMax.signal?rangeMax.signal:rangeMax)+" - "+rangeMin+") / ("+cardinality+" - 1)";return"sequence("+rangeMin+", "+rangeMax+" + "+step+", "+step+")"};return rangeMax.signal?new SignalRefWrapper(f):{signal:f()}}function sizeRangeMin(mark,zero,config){if(zero)return 0;switch(mark){case "bar":case "tick":return config.scale.minBandSize;case "line":case "trail":case "rule":return config.scale.minStrokeWidth;
case "text":return config.scale.minFontSize;case "point":case "square":case "circle":return config.scale.minSize}throw Error(message$jscomp$0.incompatibleChannel("size",mark));}function sizeRangeMax(mark,xyRangeSteps,config){var scaleConfig=config.scale;switch(mark){case "bar":case "tick":if(void 0!==config.scale.maxBandSize)return config.scale.maxBandSize;var min=minXYRangeStep(xyRangeSteps,config.scale);return isNumber(min)?min-1:new SignalRefWrapper(function(){return min.signal+" - 1"});case "line":case "trail":case "rule":return config.scale.maxStrokeWidth;
case "text":return config.scale.maxFontSize;case "point":case "square":case "circle":if(config.scale.maxSize)return config.scale.maxSize;var pointStep=minXYRangeStep(xyRangeSteps,scaleConfig);return isNumber(pointStep)?Math.pow(.95*pointStep,2):new SignalRefWrapper(function(){return"pow(0.95 * "+pointStep.signal+", 2)"})}throw Error(message$jscomp$0.incompatibleChannel("size",mark));}function minXYRangeStep(xyRangeSteps,scaleConfig){if(0<xyRangeSteps.length){scaleConfig=Infinity;for(var $jscomp$iter$156=
$jscomp.makeIterator(xyRangeSteps),$jscomp$key$step=$jscomp$iter$156.next();!$jscomp$key$step.done;$jscomp$key$step=$jscomp$iter$156.next())$jscomp$key$step=$jscomp$key$step.value,$jscomp$key$step.signal?scaleConfig=void 0:void 0!==scaleConfig&&$jscomp$key$step<scaleConfig&&(scaleConfig=$jscomp$key$step);return void 0!==scaleConfig?scaleConfig:new SignalRefWrapper(function(){return"min("+xyRangeSteps.map(function(e){return e.signal?e.signal:e}).join(", ")+")"})}return scaleConfig.rangeStep?scaleConfig.rangeStep:
21}function parseScaleProperty(model,property){isUnitModel(model)?parseUnitScaleProperty(model,property):parseNonUnitScaleProperty(model,property)}function parseUnitScaleProperty(model,property){var localScaleComponents=model.component.scales;keys(localScaleComponents).forEach(function(channel){var specifiedScale=model.specifiedScales[channel],localScaleCmpt=localScaleComponents[channel],mergedScaleCmpt=model.getScaleComponent(channel),fieldDef=model.fieldDef(channel),config=model.config,specifiedValue=
specifiedScale[property],sType=mergedScaleCmpt.get("type"),supportedByScaleType=scaleTypeSupportProperty(sType,property),channelIncompatability=channelScalePropertyIncompatability(channel,property);void 0!==specifiedValue&&(supportedByScaleType?channelIncompatability&&warn(channelIncompatability):warn(message$jscomp$0.scalePropertyNotWorkWithScaleType(sType,property,channel)));supportedByScaleType&&void 0===channelIncompatability&&(void 0!==specifiedValue?localScaleCmpt.copyKeyFromObject(property,
specifiedScale):(channel=getDefaultValue(property,model,channel,fieldDef,mergedScaleCmpt.get("type"),mergedScaleCmpt.get("padding"),mergedScaleCmpt.get("paddingInner"),specifiedScale.domain,model.markDef,config),void 0!==channel&&localScaleCmpt.set(property,channel,!1)))})}function getDefaultValue(property,model,channel,fieldDef,scaleType,scalePadding,scalePaddingInner,specifiedDomain,markDef,config){var scaleConfig=config.scale,type=fieldDef.type,sort=fieldDef.sort;switch(property){case "bins":return bins(model,
fieldDef);case "interpolate":return scaleConfig=contains(["color","fill","stroke"],channel)&&"nominal"!==type?"hcl":void 0,scaleConfig;case "nice":return scaleConfig=fieldDef.bin||contains([ScaleType.TIME,ScaleType.UTC],scaleType)?void 0:contains(["x","y"],channel)?!0:void 0,scaleConfig;case "padding":a:{scalePaddingInner=config.bar;if(contains(["x","y"],channel)){if(scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX){if(void 0!==scaleConfig.continuousPadding){scaleConfig=scaleConfig.continuousPadding;break a}scalePadding=
markDef.orient;if("bar"===markDef.type&&!fieldDef.bin&&("vertical"===scalePadding&&"x"===channel||"horizontal"===scalePadding&&"y"===channel)){scaleConfig=scalePaddingInner.continuousBandSize;break a}}if(scaleType===ScaleType.POINT){scaleConfig=scaleConfig.pointPadding;break a}}scaleConfig=void 0}return scaleConfig;case "paddingInner":return scaleType=markDef.type,void 0!==scalePadding?scaleConfig=void 0:contains(["x","y"],channel)?(channel=scaleConfig.barBandPaddingInner,scalePaddingInner=scaleConfig.rectBandPaddingInner,
scaleConfig=getFirstDefined(scaleConfig.bandPaddingInner,"bar"===scaleType?channel:scalePaddingInner)):scaleConfig=void 0,scaleConfig;case "paddingOuter":return markDef=markDef.type,void 0!==scalePadding?scaleConfig=void 0:contains(["x","y"],channel)&&scaleType===ScaleType.BAND?(channel=scaleConfig.barBandPaddingOuter,scaleType=scaleConfig.rectBandPaddingOuter,scaleConfig=getFirstDefined(scaleConfig.bandPaddingOuter,"bar"===markDef?channel:scaleType,scalePaddingInner/2)):scaleConfig=void 0,scaleConfig;
case "reverse":return scaleConfig=scaleType in CONTINUOUS_DOMAIN_INDEX&&"descending"===sort?!0:void 0,scaleConfig;case "zero":a:if(specifiedDomain&&"unaggregated"!==specifiedDomain&&scaleType in CONTINUOUS_DOMAIN_INDEX){if(isArray(specifiedDomain)&&(scaleConfig=specifiedDomain[specifiedDomain.length-1],0>=specifiedDomain[0]&&0<=scaleConfig)){scaleConfig=!0;break a}scaleConfig=!1}else"size"!==channel||"quantitative"!==fieldDef.type||scaleType in CONTINUOUS_TO_DISCRETE_INDEX?!fieldDef.bin&&contains(["x",
"y"],channel)?(scaleConfig=markDef.orient,scaleConfig=contains(["bar","area","line","trail"],markDef.type)&&("horizontal"===scaleConfig&&"y"===channel||"vertical"===scaleConfig&&"x"===channel)?!1:!0):scaleConfig=!1:scaleConfig=!0;return scaleConfig}return scaleConfig[property]}function parseNonUnitScaleProperty(model,property){for(var localScaleComponents=model.component.scales,$jscomp$iter$157=$jscomp.makeIterator(model.children),$jscomp$key$child$jscomp$0=$jscomp$iter$157.next();!$jscomp$key$child$jscomp$0.done;$jscomp$key$child$jscomp$0=
$jscomp$iter$157.next())$jscomp$key$child$jscomp$0=$jscomp$key$child$jscomp$0.value,"range"===property?isUnitModel($jscomp$key$child$jscomp$0)?parseUnitScaleRange($jscomp$key$child$jscomp$0):parseNonUnitScaleProperty($jscomp$key$child$jscomp$0,"range"):parseScaleProperty($jscomp$key$child$jscomp$0,property);keys(localScaleComponents).forEach(function(channel){for(var valueWithExplicit,$jscomp$iter$158=$jscomp.makeIterator(model.children),$jscomp$key$child=$jscomp$iter$158.next();!$jscomp$key$child.done;$jscomp$key$child=
$jscomp$iter$158.next())if($jscomp$key$child=$jscomp$key$child.value.component.scales[channel])$jscomp$key$child=$jscomp$key$child.getWithExplicit(property),valueWithExplicit=mergeValuesWithExplicit(valueWithExplicit,$jscomp$key$child,property,"scale",tieBreakByComparing(function(v1,v2){switch(property){case "range":if(v1.step&&v2.step)return v1.step-v2.step}return 0}));localScaleComponents[channel].setWithExplicit(property,valueWithExplicit)})}function bins(model,fieldDef){var bin=fieldDef.bin;if(isBinning(bin)){var binSignal=
getBinSignalName(model,fieldDef.field,bin);return new SignalRefWrapper(function(){return model.getSignalName(binSignal)})}if(isBinned(bin)&&isObject(bin)&&void 0!==bin.step)return{step:bin.step}}function defaultType$2(channel,fieldDef,mark){switch(fieldDef.type){case "nominal":case "ordinal":return isColorChannel(channel)||"discrete"===rangeType(channel)?("shape"===channel&&"ordinal"===fieldDef.type&&warn(message$jscomp$0.discreteChannelCannotEncode(channel,"ordinal")),"ordinal"):contains(["x","y"],
channel)&&(contains(["rect","bar","rule"],mark)||"bar"===mark)?"band":"point";case "temporal":return isColorChannel(channel)||"discrete"!==rangeType(channel)?"time":(warn(message$jscomp$0.discreteChannelCannotEncode(channel,"temporal")),"ordinal");case "quantitative":if(isColorChannel(channel)){if(isBinning(fieldDef.bin))return"bin-ordinal"}else if("discrete"===rangeType(channel))return warn(message$jscomp$0.discreteChannelCannotEncode(channel,"quantitative")),"ordinal";return"linear";case "geojson":return}throw Error(message$jscomp$0.invalidFieldType(fieldDef.type));
}function parseScaleCore(model){isUnitModel(model)?model.component.scales=parseUnitScaleCore(model):model.component.scales=parseNonUnitScaleCore(model)}function parseUnitScaleCore(model){var encoding=model.encoding,mark=model.mark;return SCALE_CHANNELS.reduce(function(scaleComponents,channel){var channelDef=encoding[channel];if(isFieldDef(channelDef)&&"geoshape"===mark&&"shape"===channel&&"geojson"===channelDef.type)return scaleComponents;if(isFieldDef(channelDef)){var fieldDef=channelDef;var specifiedScale=
channelDef.scale}else hasConditionalFieldDef(channelDef)&&(fieldDef=channelDef.condition,specifiedScale=channelDef.condition.scale);if(fieldDef&&null!==specifiedScale&&!1!==specifiedScale){specifiedScale=specifiedScale||{};channelDef=specifiedScale;var defaultScaleType=defaultType$2(channel,fieldDef,mark);channelDef=channelDef.type;SCALE_CHANNEL_INDEX[channel]?void 0!==channelDef?channelSupportScaleType(channel,channelDef)?scaleTypeSupportDataType(channelDef,fieldDef.type)||(warn(message$jscomp$0.scaleTypeNotWorkWithFieldDef(channelDef,
defaultScaleType)),channelDef=defaultScaleType):(warn(message$jscomp$0.scaleTypeNotWorkWithChannel(channel,channelDef,defaultScaleType)),channelDef=defaultScaleType):channelDef=defaultScaleType:channelDef=null;scaleComponents[channel]=new ScaleComponent(model.scaleName(channel+"",!0),{value:channelDef,explicit:specifiedScale.type===channelDef})}return scaleComponents},{})}function parseNonUnitScaleCore(model){for(var scaleComponents=model.component.scales={},scaleTypeWithExplicitIndex={},resolve=
model.component.resolve,$jscomp$loop$342={},$jscomp$iter$160=$jscomp.makeIterator(model.children),$jscomp$key$child$jscomp$0=$jscomp$iter$160.next();!$jscomp$key$child$jscomp$0.done;$jscomp$loop$342={$jscomp$loop$prop$child$343:$jscomp$loop$342.$jscomp$loop$prop$child$343},$jscomp$key$child$jscomp$0=$jscomp$iter$160.next())$jscomp$loop$342.$jscomp$loop$prop$child$343=$jscomp$key$child$jscomp$0.value,parseScaleCore($jscomp$loop$342.$jscomp$loop$prop$child$343),keys($jscomp$loop$342.$jscomp$loop$prop$child$343.component.scales).forEach(function($jscomp$loop$342){return function(channel){var JSCompiler_temp_const=
resolve.scale,JSCompiler_temp;if(!(JSCompiler_temp=resolve.scale[channel]))if(isLayerModel(model)||isFacetModel(model))JSCompiler_temp="shared";else if(model&&"concat"===model.type||model&&"repeat"===model.type)JSCompiler_temp=contains(POSITION_SCALE_CHANNELS,channel)?"independent":"shared";else throw Error("invalid model type for resolve");JSCompiler_temp_const[channel]=JSCompiler_temp;if("shared"===resolve.scale[channel])if(JSCompiler_temp_const=scaleTypeWithExplicitIndex[channel],JSCompiler_temp=
$jscomp$loop$342.$jscomp$loop$prop$child$343.component.scales[channel].getWithExplicit("type"),JSCompiler_temp_const){var scaleCategory1=SCALE_CATEGORY_INDEX[JSCompiler_temp_const.value],scaleCategory2=SCALE_CATEGORY_INDEX[JSCompiler_temp.value];scaleCategory1===scaleCategory2||"ordinal-position"===scaleCategory1&&"time"===scaleCategory2||"ordinal-position"===scaleCategory2&&"time"===scaleCategory1?scaleTypeWithExplicitIndex[channel]=mergeValuesWithExplicit(JSCompiler_temp_const,JSCompiler_temp,"type",
"scale",scaleTypeTieBreaker):(resolve.scale[channel]="independent",delete scaleTypeWithExplicitIndex[channel])}else scaleTypeWithExplicitIndex[channel]=JSCompiler_temp}}($jscomp$loop$342));keys(scaleTypeWithExplicitIndex).forEach(function(channel){var name=model.scaleName(channel,!0);scaleComponents[channel]=new ScaleComponent(name,scaleTypeWithExplicitIndex[channel]);for(var $jscomp$iter$161=$jscomp.makeIterator(model.children),$jscomp$key$child=$jscomp$iter$161.next();!$jscomp$key$child.done;$jscomp$key$child=
$jscomp$iter$161.next()){$jscomp$key$child=$jscomp$key$child.value;var childScale=$jscomp$key$child.component.scales[channel];childScale&&($jscomp$key$child.renameScale(childScale.get("name"),name),childScale.merged=!0)}});return scaleComponents}function isUnitModel(model){return model&&"unit"===model.type}function isFacetModel(model){return model&&"facet"===model.type}function isLayerModel(model){return model&&"layer"===model.type}function makeWalkTree(data){function walkTree(node,dataSource){node instanceof
SourceNode&&!node.isGenerator&&!node.data.url&&(data.push(dataSource),dataSource={name:null,source:dataSource.name,transform:[]});node instanceof ParseNode&&(node.parent instanceof SourceNode&&!dataSource.source?(dataSource.format=Object.assign({},dataSource.format||{},{parse:node.assembleFormatParse()}),dataSource.transform.push.apply(dataSource.transform,$jscomp.arrayFromIterable(node.assembleTransforms(!0)))):dataSource.transform.push.apply(dataSource.transform,$jscomp.arrayFromIterable(node.assembleTransforms())));
if(node instanceof FacetNode)dataSource.name||(dataSource.name="data_"+datasetIndex++),!dataSource.source||0<dataSource.transform.length?(data.push(dataSource),node.data=dataSource.name):node.data=dataSource.source,node.assemble().forEach(function(d){return data.push(d)});else switch((node instanceof GraticuleNode||node instanceof SequenceNode||node instanceof FilterInvalidNode||node instanceof FilterNode||node instanceof CalculateNode||node instanceof GeoPointNode||node instanceof GeoJSONNode||node instanceof
AggregateNode||node instanceof LookupNode||node instanceof WindowTransformNode||node instanceof JoinAggregateTransformNode||node instanceof FoldTransformNode||node instanceof FlattenTransformNode||node instanceof IdentifierNode||node instanceof SampleTransformNode)&&dataSource.transform.push(node.assemble()),(node instanceof BinNode||node instanceof TimeUnitNode||node instanceof ImputeNode||node instanceof StackNode)&&dataSource.transform.push.apply(dataSource.transform,$jscomp.arrayFromIterable(node.assemble())),
node instanceof OutputNode&&(dataSource.source&&0===dataSource.transform.length?node.setSource(dataSource.source):node.parent instanceof OutputNode?node.setSource(dataSource.name):(dataSource.name||(dataSource.name="data_"+datasetIndex++),node.setSource(dataSource.name),1===node.numChildren()&&(data.push(dataSource),dataSource={name:null,source:dataSource.name,transform:[]}))),node.numChildren()){case 0:node instanceof OutputNode&&(!dataSource.source||0<dataSource.transform.length)&&data.push(dataSource);
break;case 1:walkTree(node.children[0],dataSource);break;default:dataSource.name||(dataSource.name="data_"+datasetIndex++);var source$299=dataSource.name;!dataSource.source||0<dataSource.transform.length?data.push(dataSource):source$299=dataSource.source;node.children.forEach(function(child){walkTree(child,{name:null,source:source$299,transform:[]})})}}var datasetIndex=0;return walkTree}function assembleFacetData(root){var data=[],walkTree=makeWalkTree(data);root.children.forEach(function(child){return walkTree(child,
{source:root.name,name:null,transform:[]})});return data}function assembleRootData(dataComponent,datasets){var data=[],walkTree=makeWalkTree(data),sourceIndex=0;dataComponent.sources.forEach(function(root){root.hasName()||(root.dataName="source_"+sourceIndex++);var newData=root.assemble();walkTree(root,newData)});data.forEach(function(d){0===d.transform.length&&delete d.transform});for(var whereTo=0,$jscomp$iter$165=$jscomp.makeIterator(data.entries()),$jscomp$key$=$jscomp$iter$165.next();!$jscomp$key$.done;$jscomp$key$=
$jscomp$iter$165.next()){var $jscomp$destructuring$var191=$jscomp.makeIterator($jscomp$key$.value);$jscomp$key$=$jscomp$destructuring$var191.next().value;$jscomp$destructuring$var191=$jscomp$destructuring$var191.next().value;0!==($jscomp$destructuring$var191.transform||[]).length||$jscomp$destructuring$var191.source||data.splice(whereTo++,0,data.splice($jscomp$key$,1)[0])}whereTo=$jscomp.makeIterator(data);for($jscomp$iter$165=whereTo.next();!$jscomp$iter$165.done;$jscomp$iter$165=whereTo.next())for($jscomp$iter$165=
$jscomp.makeIterator($jscomp$iter$165.value.transform||[]),$jscomp$key$=$jscomp$iter$165.next();!$jscomp$key$.done;$jscomp$key$=$jscomp$iter$165.next())$jscomp$key$=$jscomp$key$.value,"lookup"===$jscomp$key$.type&&($jscomp$key$.from=dataComponent.outputNodes[$jscomp$key$.from].getSource());dataComponent=$jscomp.makeIterator(data);for($jscomp$iter$165=dataComponent.next();!$jscomp$iter$165.done;$jscomp$iter$165=dataComponent.next())whereTo=$jscomp$iter$165.value,whereTo.name in datasets&&(whereTo.values=
datasets[whereTo.name]);return data}function makeHeaderComponent(model,channel,labels){channel="row"===channel?"height":"width";return{labels:labels,sizeSignal:model.child.component.layoutSize.get(channel)?model.child.getSizeSignalRef(channel):void 0,axes:[]}}function mergeChildAxis(model,channel){var child=model.child;if(child.component.axes[channel]){var $jscomp$destructuring$var193=model.component,layoutHeaders=$jscomp$destructuring$var193.layoutHeaders;$jscomp$destructuring$var193=$jscomp$destructuring$var193.resolve;
$jscomp$destructuring$var193.axis[channel]=parseGuideResolve($jscomp$destructuring$var193,channel);if("shared"===$jscomp$destructuring$var193.axis[channel])for($jscomp$destructuring$var193="x"===channel?"column":"row",layoutHeaders=layoutHeaders[$jscomp$destructuring$var193],channel=$jscomp.makeIterator(child.component.axes[channel]),child=channel.next();!child.done;child=channel.next()){child=child.value;var JSCompiler_inline_result=child.get("orient");JSCompiler_inline_result="top"===JSCompiler_inline_result||
"left"===JSCompiler_inline_result?"header":"footer";layoutHeaders[JSCompiler_inline_result]=layoutHeaders[JSCompiler_inline_result]||[makeHeaderComponent(model,$jscomp$destructuring$var193,!1)];var mainAxis=assembleAxis(child,"main",model.config,{header:!0});layoutHeaders[JSCompiler_inline_result][0].axes.push(mainAxis);child.mainExtracted=!0}}}function parseLayerLayoutSize(model){parseChildrenLayoutSize(model);var layoutSizeCmpt=model.component.layoutSize;layoutSizeCmpt.setWithExplicit("width",parseNonUnitLayoutSizeForChannel(model,
"width"));layoutSizeCmpt.setWithExplicit("height",parseNonUnitLayoutSizeForChannel(model,"height"))}function parseChildrenLayoutSize(model){model=$jscomp.makeIterator(model.children);for(var $jscomp$key$child=model.next();!$jscomp$key$child.done;$jscomp$key$child=model.next())$jscomp$key$child.value.parseLayoutSize()}function parseNonUnitLayoutSizeForChannel(model,sizeType){for(var channel="width"===sizeType?"x":"y",resolve=model.component.resolve,mergedSize,$jscomp$iter$172=$jscomp.makeIterator(model.children),
$jscomp$key$child=$jscomp$iter$172.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$172.next()){$jscomp$key$child=$jscomp$key$child.value.component.layoutSize.getWithExplicit(sizeType);var scaleResolve=resolve.scale[channel];if("independent"===scaleResolve&&"range-step"===$jscomp$key$child.value){mergedSize=void 0;break}if(mergedSize){if("independent"===scaleResolve&&mergedSize.value!==$jscomp$key$child.value){mergedSize=void 0;break}mergedSize=mergeValuesWithExplicit(mergedSize,$jscomp$key$child,
sizeType,"")}else mergedSize=$jscomp$key$child}if(mergedSize){channel=$jscomp.makeIterator(model.children);for($jscomp$key$child=channel.next();!$jscomp$key$child.done;$jscomp$key$child=channel.next())resolve=$jscomp$key$child.value,model.renameSignal(resolve.getName(sizeType),model.getName(sizeType)),resolve.component.layoutSize.set(sizeType,"merged",!1);return mergedSize}return{explicit:!1,value:void 0}}function defaultUnitSize(model,sizeType){var config=model.config,scaleComponent=model.getScaleComponent("width"===
sizeType?"x":"y");return scaleComponent?(model=scaleComponent.get("type"),scaleComponent=scaleComponent.get("range"),model in DISCRETE_DOMAIN_INDEX&&isVgRangeStep(scaleComponent)?"range-step":config.view[sizeType]):model.hasProjection?config.view[sizeType]:"width"===sizeType&&"text"===model.mark?config.scale.textXRangeStep:config.scale.rangeStep||defaultScaleConfig.rangeStep}function replaceRepeat(o,repeater){var field=o.field;if(field&&!isString(field)&&"repeat"in field){if(o.field.repeat in repeater)return Object.assign({},
o,{field:repeater[o.field.repeat]});warn(message$jscomp$0.noSuchRepeatedValue(o.field.repeat))}else return o}function replaceRepeaterInFieldDef(fieldDef$jscomp$0,repeater){fieldDef$jscomp$0=replaceRepeat(fieldDef$jscomp$0,repeater);if(void 0!==fieldDef$jscomp$0){if(null===fieldDef$jscomp$0)return null;var fieldDef=fieldDef$jscomp$0;isTypedFieldDef(fieldDef)&&fieldDef.sort&&isSortField(fieldDef$jscomp$0.sort)&&(repeater=replaceRepeat(fieldDef$jscomp$0.sort,repeater),fieldDef$jscomp$0=Object.assign({},
fieldDef$jscomp$0,repeater?{sort:repeater}:{}));return fieldDef$jscomp$0}}function replaceRepeaterInChannelDef(channelDef,repeater){if(isFieldDef(channelDef)){if(repeater=replaceRepeaterInFieldDef(channelDef,repeater))return repeater;if(channelDef&&channelDef.condition)return{condition:channelDef.condition}}else return hasConditionalFieldDef(channelDef)?(repeater=replaceRepeaterInFieldDef(channelDef.condition,repeater))?Object.assign({},channelDef,{condition:repeater}):__rest(channelDef,["condition"]):
channelDef}function replaceRepeater(mapping,repeater){var out={},channel;for(channel in mapping)if(mapping.hasOwnProperty(channel)){var channelDef=mapping[channel];isArray(channelDef)?out[channel]=channelDef.map(function(cd){return replaceRepeaterInChannelDef(cd,repeater)}).filter(function(cd){return cd}):(channelDef=replaceRepeaterInChannelDef(channelDef,repeater),void 0!==channelDef&&(out[channel]=channelDef))}return out}function facetSortFieldName(fieldDef,sort,opt){return vgField(sort,Object.assign({suffix:"by_"+
vgField(fieldDef)},opt||{}))}function findSource(data,sources){sources=$jscomp.makeIterator(sources);for(var $jscomp$key$other=sources.next();!$jscomp$key$other.done;$jscomp$key$other=sources.next()){$jscomp$key$other=$jscomp$key$other.value;var otherData=$jscomp$key$other.data;if(!(data.name&&$jscomp$key$other.hasName()&&data.name!==$jscomp$key$other.dataName||data.format&&data.format.mesh&&otherData.format&&otherData.format.feature))if(data.values&&otherData.values){if(deepEqual(data.values,otherData.values))return $jscomp$key$other}else if(data.url&&
otherData.url){if(data.url===otherData.url)return $jscomp$key$other}else if(isNamedData(data)&&data.name===$jscomp$key$other.dataName)return $jscomp$key$other}return null}function parseRoot(model,sources){if(void 0===model.data&&model.parent)return model.parent.component.data.facetRoot?model.parent.component.data.facetRoot:model.parent.component.data.main;if(null===model.data)return model=new SourceNode([]),sources.push(model),model;var existingSource=findSource(model.data,sources);if(existingSource)return isGenerator(model.data)||
(existingSource.data.format=mergeDeep({},model.data.format,existingSource.data.format)),!existingSource.hasName()&&model.data.name&&(existingSource.dataName=model.data.name),existingSource;model=new SourceNode(model.data);sources.push(model);return model}function parseData(model){var head=parseRoot(model,model.component.data.sources),$jscomp$destructuring$var208=model.component.data,outputNodes=$jscomp$destructuring$var208.outputNodes;$jscomp$destructuring$var208=$jscomp$destructuring$var208.outputNodeRefCounts;
var ancestorParse=model.parent?model.parent.component.data.ancestorParse.clone():new AncestorParse,data=model.data;isGenerator(data)?(data.sequence?head=new SequenceNode(head,data.sequence):data.graticule&&(head=new GraticuleNode(head,data.graticule)),ancestorParse.parseNothing=!0):data&&data.format&&null===data.format.parse&&(ancestorParse.parseNothing=!0);head=ParseNode.makeExplicit(head,model,ancestorParse)||head;!requiresSelectionId(model)||!isUnitModel(model)&&!isLayerModel(model)||model.parent&&
isLayerModel(model.parent)||(head=new IdentifierNode(head));data=model.parent&&isLayerModel(model.parent);(isUnitModel(model)||isFacetModel(model))&&data&&(head=BinNode.makeFromEncoding(head,model)||head);if(0<model.transforms.length)for(var lookupCounter=0,$jscomp$inline_811=$jscomp.makeIterator(model.transforms),$jscomp$key$t=$jscomp$inline_811.next();!$jscomp$key$t.done;$jscomp$key$t=$jscomp$inline_811.next()){var t=$jscomp$key$t.value,transformNode=$jscomp$key$t=void 0;if(void 0!==t.calculate)transformNode=
head=new CalculateNode(head,t),$jscomp$key$t="derived";else if(void 0!==t.filter)transformNode=head=ParseNode.makeImplicitFromFilterTransform(head,t,ancestorParse)||head,head=new FilterNode(head,model,t.filter);else if(t.bin)transformNode=head=BinNode.makeFromTransform(head,t,model),$jscomp$key$t="number";else if(void 0!==t.timeUnit)$jscomp$key$t="date",void 0===ancestorParse.getWithExplicit(t.field).value&&(transformNode={},head=new ParseNode(head,(transformNode[t.field]=$jscomp$key$t,transformNode)),
ancestorParse.set(t.field,$jscomp$key$t,!1)),transformNode=head=TimeUnitNode.makeFromTransform(head,t);else if(void 0!==t.aggregate)transformNode=head=AggregateNode.makeFromTransform(head,t),$jscomp$key$t="number",requiresSelectionId(model)&&(head=new IdentifierNode(head));else if(void 0!==t.lookup)transformNode=head=LookupNode.make(head,model,t,lookupCounter++),$jscomp$key$t="derived";else if(void 0!==t.window)transformNode=head=new WindowTransformNode(head,t),$jscomp$key$t="number";else if(void 0!==
t.joinaggregate)transformNode=head=new JoinAggregateTransformNode(head,t),$jscomp$key$t="number";else if(void 0!==t.stack)transformNode=head=StackNode.makeFromTransform(head,t),$jscomp$key$t="derived";else if(void 0!==t.fold)transformNode=head=new FoldTransformNode(head,t),$jscomp$key$t="derived";else if(void 0!==t.flatten)transformNode=head=new FlattenTransformNode(head,t),$jscomp$key$t="derived";else if(void 0!==t.sample)head=new SampleTransformNode(head,t);else if(void 0!==t.impute)transformNode=
head=ImputeNode.makeFromTransform(head,t),$jscomp$key$t="derived";else{warn(message$jscomp$0.invalidTransformIgnored(t));continue}if(transformNode&&void 0!==$jscomp$key$t)for(t=$jscomp.makeIterator(transformNode.producedFields()),transformNode=t.next();!transformNode.done;transformNode=t.next())ancestorParse.set(transformNode.value,$jscomp$key$t,!1)}head=ParseNode.makeImplicitFromEncoding(head,model,ancestorParse)||head;isUnitModel(model)&&(head=GeoJSONNode.parseAll(head,model),head=GeoPointNode.parseAll(head,
model));if(isUnitModel(model)||isFacetModel(model))data||(head=BinNode.makeFromEncoding(head,model)||head),head=TimeUnitNode.makeFromEncoding(head,model)||head,head=CalculateNode.parseAllForSortIndex(head,model);lookupCounter=model.getName("raw");data=new OutputNode(head,lookupCounter,"raw",$jscomp$destructuring$var208);head=outputNodes[lookupCounter]=data;if(isUnitModel(model)){if(lookupCounter=AggregateNode.makeFromEncoding(head,model))head=lookupCounter,requiresSelectionId(model)&&(head=new IdentifierNode(head));
head=ImputeNode.makeFromEncoding(head,model)||head;head=StackNode.makeFromEncoding(head,model)||head}isUnitModel(model)&&(head=FilterInvalidNode.make(head,model)||head);$jscomp$inline_811=model.getName("main");lookupCounter=new OutputNode(head,$jscomp$inline_811,"main",$jscomp$destructuring$var208);head=outputNodes[$jscomp$inline_811]=lookupCounter;$jscomp$key$t=null;if(isFacetModel(model)){$jscomp$inline_811=model.getName("facet");head=CalculateNode.parseAllForSortIndex(head,model);$jscomp$key$t=
head;t=model.facet;transformNode=t.row;var column=t.column;if(transformNode&&column){t=null;transformNode=$jscomp.makeIterator([transformNode,column]);for(column=transformNode.next();!column.done;column=transformNode.next())column=column.value,isSortField(column.sort)&&(t=column.sort,$jscomp$key$t=t=new JoinAggregateTransformNode($jscomp$key$t,{joinaggregate:[{op:void 0===t.op?"mean":t.op,field:t.field,as:facetSortFieldName(column,column.sort,{forAs:!0})}],groupby:[vgField(column)]}));$jscomp$key$t=
t}else $jscomp$key$t=null;$jscomp$key$t=new FacetNode($jscomp$key$t||head,model,$jscomp$inline_811,lookupCounter.getSource());outputNodes[$jscomp$inline_811]=$jscomp$key$t}return Object.assign({},model.component.data,{outputNodes:outputNodes,outputNodeRefCounts:$jscomp$destructuring$var208,raw:data,main:lookupCounter,facetRoot:$jscomp$key$t,ancestorParse:ancestorParse})}function parseUnitAxes(model){return POSITION_SCALE_CHANNELS.reduce(function(axis,channel){model.component.scales[channel]&&model.axis(channel)&&
(axis[channel]=[parseAxis(channel,model)]);return axis},{})}function mergeAxisComponents(mergedAxisCmpts,childAxisCmpts){if(mergedAxisCmpts){if(mergedAxisCmpts.length!==childAxisCmpts.length)return;for(var length$320=mergedAxisCmpts.length,i=0;i<length$320;i++){var merged=mergedAxisCmpts[i],child=childAxisCmpts[i];if(!!merged!==!!child)return;if(merged&&child){var mergedOrient=merged.getWithExplicit("orient"),childOrient=child.getWithExplicit("orient");if(mergedOrient.explicit&&childOrient.explicit&&
mergedOrient.value!==childOrient.value)return;mergedAxisCmpts[i]=mergeAxisComponent(merged,child)}}}else return childAxisCmpts.map(function(axisComponent){return axisComponent.clone()});return mergedAxisCmpts}function mergeAxisComponent(merged,child){for(var $jscomp$loop$346={},$jscomp$iter$192=$jscomp.makeIterator(VG_AXIS_PROPERTIES),$jscomp$key$prop=$jscomp$iter$192.next();!$jscomp$key$prop.done;$jscomp$loop$346={$jscomp$loop$prop$prop$347:$jscomp$loop$346.$jscomp$loop$prop$prop$347},$jscomp$key$prop=
$jscomp$iter$192.next())$jscomp$loop$346.$jscomp$loop$prop$prop$347=$jscomp$key$prop.value,$jscomp$key$prop=mergeValuesWithExplicit(merged.getWithExplicit($jscomp$loop$346.$jscomp$loop$prop$prop$347),child.getWithExplicit($jscomp$loop$346.$jscomp$loop$prop$prop$347),$jscomp$loop$346.$jscomp$loop$prop$prop$347,"axis",function($jscomp$loop$346){return function(v1,v2){switch($jscomp$loop$346.$jscomp$loop$prop$prop$347){case "title":return mergeTitleComponent(v1,v2);case "gridScale":return{explicit:v1.explicit,
value:getFirstDefined(v1.value,v2.value)}}return defaultTieBreaker(v1,v2,$jscomp$loop$346.$jscomp$loop$prop$prop$347,"axis")}}($jscomp$loop$346)),merged.setWithExplicit($jscomp$loop$346.$jscomp$loop$prop$prop$347,$jscomp$key$prop);return merged}function getFieldDefTitle(model,channel){var channel2="x"===channel?"x2":"y2";channel=model.fieldDef(channel);model=model.fieldDef(channel2);channel2=channel?channel.title:void 0;model=model?model.title:void 0;if(channel2&&model)return channel2!==model&&model?
channel2?channel2+", "+model:model:channel2;if(channel2)return channel2;if(model)return model;if(void 0!==channel2)return channel2;if(void 0!==model)return model}function parseAxis(channel,model){var axis$jscomp$0=model.axis(channel),axisComponent=new AxisComponent;VG_AXIS_PROPERTIES.forEach(function(property){var value=getProperty$1(property,axis$jscomp$0,channel,model);if(void 0!==value){a:{switch(property){case "titleAngle":case "labelAngle":var JSCompiler_inline_result=value===(axis$jscomp$0[property]%
360+360)%360;break a;case "values":JSCompiler_inline_result=!!axis$jscomp$0.values;break a;case "encode":JSCompiler_inline_result=!!axis$jscomp$0.encoding||!!axis$jscomp$0.labelAngle;break a;case "title":if(value===getFieldDefTitle(model,channel)){JSCompiler_inline_result=!0;break a}}JSCompiler_inline_result=value===axis$jscomp$0[property]}var configValue=getAxisConfig(property,model.config,channel,axisComponent.get("orient"),model.getScaleComponent(channel).get("type"));JSCompiler_inline_result||
void 0===configValue?axisComponent.set(property,value,JSCompiler_inline_result):contains(["grid","orient"],property)&&configValue&&axisComponent.set(property,configValue,!1)}});var axisEncoding=axis$jscomp$0.encoding||{},axisEncode=AXIS_PARTS.reduce(function(e,part){if(!axisComponent.hasAxisPart(part))return e;var axisEncodingPart=guideEncodeEntry(axisEncoding[part]||{},model);if("labels"===part){var fieldDef=model.fieldDef(channel)||("x"===channel?model.fieldDef("x2"):"y"===channel?model.fieldDef("y2"):
void 0),axis=model.axis(channel),config=model.config,labelsSpec={};if(isTimeFormatFieldDef(fieldDef)){var isUTCScale=model.getScaleComponent(channel).get("type")===ScaleType.UTC;if(fieldDef=timeFormatExpression("datum.value",fieldDef.timeUnit,axis.format,config.axis.shortTimeLabels,null,isUTCScale))labelsSpec.text={signal:fieldDef}}labelsSpec=Object.assign({},labelsSpec,axisEncodingPart);axisEncodingPart=0===keys(labelsSpec).length?void 0:labelsSpec}void 0!==axisEncodingPart&&0<keys(axisEncodingPart).length&&
(e[part]={update:axisEncodingPart});return e},{});0<keys(axisEncode).length&&axisComponent.set("encode",axisEncode,!!axis$jscomp$0.encoding||void 0!==axis$jscomp$0.labelAngle);return axisComponent}function getProperty$1(property,specifiedAxis,channel,model){var fieldDef=model.fieldDef(channel);if(void 0!==specifiedAxis.labelAngle)var JSCompiler_inline_result=(specifiedAxis.labelAngle%360+360)%360;else JSCompiler_inline_result=getAxisConfig("labelAngle",model.config,channel,orient(channel),model.getScaleComponent(channel).get("type")),
JSCompiler_inline_result=void 0!==JSCompiler_inline_result?(JSCompiler_inline_result%360+360)%360:"x"===channel&&contains(["nominal","ordinal"],fieldDef.type)?270:void 0;var orient$1=getFirstDefined(specifiedAxis.orient,orient(channel));switch(property){case "scale":return model.scaleName(channel);case "gridScale":return fieldDef="x"===channel?"y":"x",fieldDef=model.getScaleComponent(fieldDef)?model.scaleName(fieldDef):void 0,fieldDef;case "format":return isTimeFormatFieldDef(fieldDef)?void 0:numberFormat(fieldDef,
specifiedAxis.format,model.config);case "formatType":return isTimeFormatFieldDef(fieldDef)?void 0:specifiedAxis.formatType;case "grid":if(isBinned(model.fieldDef(channel).bin))return!1;model=model.getScaleComponent(channel).get("type");return getFirstDefined(specifiedAxis.grid,!(model in DISCRETE_DOMAIN_INDEX)&&!isBinning(fieldDef.bin));case "labelAlign":return getFirstDefined(specifiedAxis.labelAlign,defaultLabelAlign(JSCompiler_inline_result,orient$1));case "labelAngle":return JSCompiler_inline_result;
case "labelBaseline":return getFirstDefined(specifiedAxis.labelBaseline,defaultLabelBaseline(JSCompiler_inline_result,orient$1));case "labelFlush":return specifiedAxis=specifiedAxis.labelFlush,fieldDef="x"===channel&&contains(["quantitative","temporal"],fieldDef.type)?!0:void 0,getFirstDefined(specifiedAxis,fieldDef);case "labelOverlap":return model=model.getScaleComponent(channel).get("type"),specifiedAxis=specifiedAxis.labelOverlap,fieldDef="nominal"!==fieldDef.type?"log"===model?"greedy":!0:void 0,
getFirstDefined(specifiedAxis,fieldDef);case "orient":return orient$1;case "tickCount":return property=model.getScaleComponent(channel).get("type"),model=(channel="x"===channel?"width":"y"===channel?"height":void 0)?model.getSizeSignalRef(channel):void 0,specifiedAxis=specifiedAxis.tickCount,fieldDef=property in DISCRETE_DOMAIN_INDEX||"log"===property||contains(["month","hours","day","quarter"],fieldDef.timeUnit)?void 0:isBinning(fieldDef.bin)?{signal:"ceil("+model.signal+"/10)"}:{signal:"ceil("+
model.signal+"/40)"},getFirstDefined(specifiedAxis,fieldDef);case "title":return property=model.fieldDef("x"===channel?"x2":"y2"),getFirstDefined(specifiedAxis.title,getFieldDefTitle(model,channel),mergeTitleFieldDefs([toFieldDefBase(fieldDef)],property?[toFieldDefBase(property)]:[]));case "values":return fieldDef=(specifiedAxis=specifiedAxis.values)?valueArray(fieldDef,specifiedAxis):void 0,fieldDef}return AXIS_PROPERTIES_INDEX[property]?specifiedAxis[property]:void 0}function orient$1(mark,encoding,
specifiedOrient){switch(mark){case "point":case "circle":case "square":case "text":case "rect":return}var x=encoding.x,y=encoding.y,x2=encoding.x2,y2=encoding.y2;switch(mark){case "bar":if(isFieldDef(x)&&isBinned(x.bin))break;if(isFieldDef(y)&&isBinned(y.bin))return"horizontal";if(y2||x2){if(specifiedOrient)return specifiedOrient;if(!x2&&isFieldDef(x)&&"quantitative"===x.type&&!isBinning(x.bin))return"horizontal";if(!y2&&isFieldDef(y)&&"quantitative"===y.type&&!isBinning(y.bin))break}case "rule":if(x2&&
y2)return;case "area":if(y2){if(isFieldDef(y)&&isBinned(y.bin))return"horizontal";break}else if(x2)if(isFieldDef(x)&&isBinned(x.bin))break;else return"horizontal";else if("rule"===mark)if(encoding.x&&!encoding.y)break;else if(encoding.y&&!encoding.x)return"horizontal";case "line":case "tick":x=isFieldDef(encoding.x)&&!isDiscrete(encoding.x);y=isFieldDef(encoding.y)&&!isDiscrete(encoding.y);if(x&&!y)return"tick"!==mark?"horizontal":"vertical";if(!x&&y)return"tick"!==mark?"vertical":"horizontal";if(x&&
y){x=encoding.x;encoding=encoding.y;y="temporal"===x.type;x2="temporal"===encoding.type;if(y&&!x2)return"tick"!==mark?"vertical":"horizontal";if(!y&&x2)return"tick"!==mark?"horizontal":"vertical";if(!x.aggregate&&encoding.aggregate)return"tick"!==mark?"vertical":"horizontal";if(x.aggregate&&!encoding.aggregate)return"tick"!==mark?"horizontal":"vertical";if(specifiedOrient)return specifiedOrient}else{if(specifiedOrient)return specifiedOrient;return}}return"vertical"}function rectPosition(model,channel,
mark){var config=model.config,encoding=model.encoding,markDef=model.markDef,channel2="x"===channel?"x2":"y2",sizeChannel="x"===channel?"width":"height",fieldDef=encoding[channel],fieldDef2=encoding[channel2],scale=model.getScaleComponent(channel),scaleType=scale?scale.get("type"):void 0,scaleName=model.scaleName(channel),orient=markDef.orient;encoding=encoding[sizeChannel]||encoding.size||markDef[sizeChannel]||markDef.size||getMarkConfig("size",markDef,config,{vgChannel:sizeChannel});orient="x"===
channel?"vertical"===orient:"horizontal"===orient;if(!isFieldDef(fieldDef)||!isBinning(fieldDef.bin)&&!isBinned(fieldDef.bin)||encoding||scaleType in DISCRETE_DOMAIN_INDEX){if((isFieldDef(fieldDef)&&scaleType in DISCRETE_DOMAIN_INDEX||orient)&&!fieldDef2){if(isFieldDef(fieldDef)&&scaleType===ScaleType.BAND){a:{mark=defaultSizeRef(mark,markDef,sizeChannel,scaleName,scale,config);fieldDef2=model.scaleName(channel);scaleName="x"===channel?"width":"height";if(model.encoding.size||void 0!==model.markDef.size||
mark&&void 0!==mark.value)if(model.markDef.orient)if(scale={},scale=(scale[channel+"c"]=fieldRef(fieldDef,fieldDef2,{},{band:.5}),scale),getTypedFieldDef(model.encoding.size)){channel=Object.assign({},scale,nonPosition("size",model,{vgChannel:scaleName}));break a}else if(isValueDef(model.encoding.size)){channel=Object.assign({},scale,nonPosition("size",model,{vgChannel:scaleName}));break a}else if(void 0!==model.markDef.size){channel={};channel=Object.assign({},scale,(channel[scaleName]={value:model.markDef.size},
channel));break a}else{if(mark&&void 0!==mark.value){channel={};channel=Object.assign({},scale,(channel[scaleName]=mark,channel));break a}}else warn(message$jscomp$0.cannotApplySizeToNonOrientedMark(model.markDef.type));model={};channel=(model[channel]=fieldRef(fieldDef,fieldDef2,{binSuffix:"range"},{}),model[scaleName]=mark||bandRef(fieldDef2),model)}return channel}fieldDef=mid(model[sizeChannel]);scaleName=defaultSizeRef(mark,markDef,sizeChannel,scaleName,scale,config);mark="x"===channel?"width":
"height";return Object.assign({},pointPosition(channel,model,fieldDef,"x"===channel?"xc":"yc"),nonPosition("size",model,{defaultRef:scaleName,vgChannel:mark}))}return Object.assign({},pointPosition(channel,model,"zeroOrMax"),pointPosition2(model,"zeroOrMin",channel2))}model=getFirstDefined(markDef.binSpacing,config[mark].binSpacing);scale=scale.get("reverse");model=void 0===model?0:model;model={x:scale?model:0,x2:scale?0:model,y:scale?0:model,y2:scale?model:0};scale="x"===channel?"x2":"y2";isBinning(fieldDef.bin)?
(fieldDef2={},channel=(fieldDef2[scale]=bin$1({channel:channel,fieldDef:fieldDef,scaleName:scaleName,mark:mark,side:"start",offset:model[channel+"2"]}),fieldDef2[channel]=bin$1({channel:channel,fieldDef:fieldDef,scaleName:scaleName,mark:mark,side:"end",offset:model[channel]}),fieldDef2)):isBinned(fieldDef.bin)&&isFieldDef(fieldDef2)?(mark={},channel=(mark[scale]=fieldRef(fieldDef,scaleName,{},{offset:model[channel+"2"]}),mark[channel]=fieldRef(fieldDef2,scaleName,{},{offset:model[channel]}),mark)):
(warn(message$jscomp$0.channelRequiredForBinned(scale)),channel=void 0);return channel}function defaultSizeRef(mark,markDef,sizeChannel,scaleName,scale,config){markDef=getFirstDefined(markDef[sizeChannel],markDef.size,getMarkConfig("size",markDef,config,{vgChannel:sizeChannel}));if(void 0!==markDef)return{value:markDef};if(scale)if(markDef=scale.get("type"),"point"===markDef||"band"===markDef){if(void 0!==config[mark].discreteBandSize)return{value:config[mark].discreteBandSize};if(markDef===ScaleType.POINT){scaleName=
scale.get("range");if(isVgRangeStep(scaleName)&&isNumber(scaleName.step))return{value:scaleName.step-1};warn(message$jscomp$0.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}else return bandRef(scaleName)}else return{value:config[mark].continuousBandSize};return{value:getFirstDefined(config[mark].discreteBandSize,config.scale.rangeStep?config.scale.rangeStep-1:void 0,20)}}function encodeEntry(model,fixedShape){var width=model.width,height=model.height;return Object.assign({},baseEncodeEntry(model,{size:"include",
orient:"ignore"}),pointPosition("x",model,mid(width)),pointPosition("y",model,mid(height)),nonPosition("size",model),fixedShape?{shape:{value:fixedShape}}:nonPosition("shape",model))}function align(markDef,encoding,config){if(void 0===(markDef.align||getMarkConfig("align",markDef,config)))return"center"}function baseline(markDef,encoding,config){if(void 0===(markDef.baseline||getMarkConfig("baseline",markDef,config)))return"middle"}function defaultSize(model){var config=model.config,markDef=model.markDef,
orient=markDef.orient,vgSizeChannel="horizontal"===orient?"width":"height";model=model.getScaleComponent("horizontal"===orient?"x":"y");markDef=getFirstDefined(markDef[vgSizeChannel],markDef.size,getMarkConfig("size",markDef,config,{vgChannel:vgSizeChannel}),config.tick.bandSize);if(void 0!==markDef)return markDef;config=(markDef=model?model.get("range"):void 0)&&isVgRangeStep(markDef)?markDef.step:config.scale.rangeStep;if("number"!==typeof config)throw Error("Function does not handle non-numeric rangeStep");
return 3*config/4}function getMarkGroups(model,opt){opt=void 0===opt?{fromPrefix:""}:opt;var mark=model.mark,JSCompiler_temp_const=model.markDef.clip;var JSCompiler_inline_result=model.getScaleComponent("x");var yScale=model.getScaleComponent("y");JSCompiler_inline_result=JSCompiler_inline_result&&JSCompiler_inline_result.get("domainRaw")||yScale&&yScale.get("domainRaw")?!0:void 0;yScale=model.component.projection;JSCompiler_temp_const=getFirstDefined(JSCompiler_temp_const,JSCompiler_inline_result,
yScale&&!yScale.isFit?!0:void 0);JSCompiler_inline_result=model.markDef;JSCompiler_inline_result=[].concat(JSCompiler_inline_result.type,JSCompiler_inline_result.style||[]);yScale=model.encoding.key;a:{var JSCompiler_inline_result$jscomp$0=model.encoding;var stack=model.stack,mark$jscomp$0=model.mark,markDef=model.markDef,config=model.config,order=JSCompiler_inline_result$jscomp$0.order;if(!(!isArray(order)&&isValueDef(order)&&isNullOrFalse(order.value)||!order&&isNullOrFalse(markDef.order)||isNullOrFalse(getMarkConfig("order",
markDef,config)))){if((isArray(order)||isFieldDef(order))&&!stack){JSCompiler_inline_result$jscomp$0=sortParams(order,{expr:"datum"});break a}if(isPathMark(mark$jscomp$0)&&(stack="horizontal"===markDef.orient?"y":"x",JSCompiler_inline_result$jscomp$0=JSCompiler_inline_result$jscomp$0[stack],isFieldDef(JSCompiler_inline_result$jscomp$0))){mark$jscomp$0=JSCompiler_inline_result$jscomp$0.sort;JSCompiler_inline_result$jscomp$0=isArray(mark$jscomp$0)?{field:vgField(JSCompiler_inline_result$jscomp$0,{prefix:stack,
suffix:"sort_index",expr:"datum"})}:isSortField(mark$jscomp$0)?{field:vgField({aggregate:isAggregate(model.encoding)?mark$jscomp$0.op:void 0,field:mark$jscomp$0.field},{expr:"datum"})}:{field:vgField(JSCompiler_inline_result$jscomp$0,{binSuffix:model.stack&&model.stack.impute?"mid":void 0,expr:"datum"})};break a}}JSCompiler_inline_result$jscomp$0=void 0}stack=markCompiler[mark].postEncodingTransform?markCompiler[mark].postEncodingTransform(model):null;return[Object.assign({name:model.getName("marks"),
type:markCompiler[mark].vgMark},JSCompiler_temp_const?{clip:!0}:{},JSCompiler_inline_result?{style:JSCompiler_inline_result}:{},yScale?{key:{field:yScale.field}}:{},JSCompiler_inline_result$jscomp$0?{sort:JSCompiler_inline_result$jscomp$0}:{},{from:{data:opt.fromPrefix+model.requestDataName("main")},encode:{update:markCompiler[mark].encodeEntry(model)}},stack?{transform:stack}:{})]}function parseUnitSelection(model,selDefs){var selCmpts={},selectionConfig=model.config.selection;selDefs&&(selDefs=
duplicate(selDefs));var $jscomp$loop$348={};for(name$325 in selDefs){if(selDefs.hasOwnProperty(name$325)){$jscomp$loop$348.$jscomp$loop$prop$selDef$349=selDefs[name$325];var cfg=__rest(selectionConfig[$jscomp$loop$348.$jscomp$loop$prop$selDef$349.type],["fields","encodings"]),key;for(key in cfg)"encodings"===key&&$jscomp$loop$348.$jscomp$loop$prop$selDef$349.fields||"fields"===key&&$jscomp$loop$348.$jscomp$loop$prop$selDef$349.encodings||("mark"===key&&($jscomp$loop$348.$jscomp$loop$prop$selDef$349[key]=
Object.assign({},cfg[key],$jscomp$loop$348.$jscomp$loop$prop$selDef$349[key])),void 0!==$jscomp$loop$348.$jscomp$loop$prop$selDef$349[key]&&!0!==$jscomp$loop$348.$jscomp$loop$prop$selDef$349[key])||($jscomp$loop$348.$jscomp$loop$prop$selDef$349[key]=cfg[key]||$jscomp$loop$348.$jscomp$loop$prop$selDef$349[key]);var name$325=varName(name$325);$jscomp$loop$348.$jscomp$loop$prop$selCmpt$350=selCmpts[name$325]=Object.assign({},$jscomp$loop$348.$jscomp$loop$prop$selDef$349,{name:name$325,events:isString($jscomp$loop$348.$jscomp$loop$prop$selDef$349.on)?
parseSelector($jscomp$loop$348.$jscomp$loop$prop$selDef$349.on,"scope"):$jscomp$loop$348.$jscomp$loop$prop$selDef$349.on});forEachTransform($jscomp$loop$348.$jscomp$loop$prop$selCmpt$350,function($jscomp$loop$348){return function(txCompiler){txCompiler.parse&&txCompiler.parse(model,$jscomp$loop$348.$jscomp$loop$prop$selDef$349,$jscomp$loop$348.$jscomp$loop$prop$selCmpt$350)}}($jscomp$loop$348))}$jscomp$loop$348={$jscomp$loop$prop$selDef$349:$jscomp$loop$348.$jscomp$loop$prop$selDef$349,$jscomp$loop$prop$selCmpt$350:$jscomp$loop$348.$jscomp$loop$prop$selCmpt$350}}return selCmpts}
function buildModel(spec,parent,parentGivenName,unitSize,repeater,config,fit){if(void 0!==spec.facet)return new FacetModel(spec,parent,parentGivenName,repeater,config);if(isLayerSpec(spec))return new LayerModel(spec,parent,parentGivenName,unitSize,repeater,config,fit);if(isUnitSpec(spec))return new UnitModel(spec,parent,parentGivenName,unitSize,repeater,config,fit);if(void 0!==spec.repeat)return new RepeatModel(spec,parent,parentGivenName,repeater,config);if(isVConcatSpec(spec)||isHConcatSpec(spec)||
void 0!==spec.concat)return new ConcatModel(spec,parent,parentGivenName,repeater,config);throw Error(message$jscomp$0.INVALID_SPEC);}function assembleTopLevelModel(model,topLevelProperties,datasets,usermeta){datasets=void 0===datasets?{}:datasets;var vgConfig=model.config?stripAndRedirectConfig(model.config):void 0;datasets=[].concat(model.assembleSelectionData([]),assembleRootData(model.component.data,datasets));var projections=model.assembleProjections(),title=model.assembleTitle(),style=model.assembleGroupStyle(),
encodeEntry=model.assembleGroupEncodeEntry(!0),layoutSignals=model.assembleLayoutSignals();layoutSignals=layoutSignals.filter(function(signal){return"width"!==signal.name&&"height"!==signal.name||void 0===signal.value?!0:(topLevelProperties[signal.name]=+signal.value,!1)});return{spec:Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},model.description?{description:model.description}:{},topLevelProperties,title?{title:title}:{},style?{style:style}:{},encodeEntry?{encode:{update:encodeEntry}}:
{},{data:datasets},0<projections.length?{projections:projections}:{},model.assembleGroup([].concat($jscomp.arrayFromIterable(layoutSignals),$jscomp.arrayFromIterable(model.assembleSelectionTopLevelSignals([])))),vgConfig?{config:vgConfig}:{},usermeta?{usermeta:usermeta}:{})}}var isArray=Array.isArray,empty=[];(function(field,name){var path=splitAccessPath(field),code="return _["+path.map($).join("][")+"];";return accessor(Function("_",code),[field=1===path.length?path[0]:field],name||field)})("id");
var identity=accessor(function(_){return _},empty,"identity");accessor(function(){return 0},empty,"zero");accessor(function(){return 1},empty,"one");accessor(function(){return!0},empty,"true");accessor(function(){return!1},empty,"false");var clone_1=function(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}(function(module){var clone$jscomp$0=function(){function _instanceof(obj,type){return null!=type&&obj instanceof type}function clone(parent$jscomp$0,circular,depth$jscomp$0,
prototype,includeNonEnumerable){function _clone(parent,depth){if(null===parent)return null;if(0===depth||"object"!=typeof parent)return parent;if(_instanceof(parent,nativeMap))var child=new nativeMap;else if(_instanceof(parent,nativeSet))child=new nativeSet;else if(_instanceof(parent,nativePromise))child=new nativePromise(function(resolve,reject){parent.then(function(value){resolve(_clone(value,depth-1))},function(err){reject(_clone(err,depth-1))})});else if(clone.__isArray(parent))child=[];else if(clone.__isRegExp(parent))child=
new RegExp(parent.source,__getRegExpFlags(parent)),parent.lastIndex&&(child.lastIndex=parent.lastIndex);else if(clone.__isDate(parent))child=new Date(parent.getTime());else{if(useBuffer&&shadow$shims.Buffer.isBuffer(parent))return child=shadow$shims.Buffer.allocUnsafe?shadow$shims.Buffer.allocUnsafe(parent.length):new shadow$shims.Buffer(parent.length),parent.copy(child),child;if(_instanceof(parent,Error))child=Object.create(parent);else if("undefined"==typeof prototype){var proto=Object.getPrototypeOf(parent);
child=Object.create(proto)}else child=Object.create(prototype),proto=prototype}if(circular){var index=allParents.indexOf(parent);if(-1!=index)return allChildren[index];allParents.push(parent);allChildren.push(child)}_instanceof(parent,nativeMap)&&parent.forEach(function(value,key){key=_clone(key,depth-1);value=_clone(value,depth-1);child.set(key,value)});_instanceof(parent,nativeSet)&&parent.forEach(function(value){value=_clone(value,depth-1);child.add(value)});for(var i in parent){var attrs;proto&&
(attrs=Object.getOwnPropertyDescriptor(proto,i));attrs&&null==attrs.set||(child[i]=_clone(parent[i],depth-1))}if(Object.getOwnPropertySymbols)for(index=Object.getOwnPropertySymbols(parent),i=0;i<index.length;i++)if(attrs=index[i],proto=Object.getOwnPropertyDescriptor(parent,attrs),!proto||proto.enumerable||includeNonEnumerable)child[attrs]=_clone(parent[attrs],depth-1),proto.enumerable||Object.defineProperty(child,attrs,{enumerable:!1});if(includeNonEnumerable)for(index=Object.getOwnPropertyNames(parent),
i=0;i<index.length;i++)attrs=index[i],proto=Object.getOwnPropertyDescriptor(parent,attrs),proto&&proto.enumerable||(child[attrs]=_clone(parent[attrs],depth-1),Object.defineProperty(child,attrs,{enumerable:!1}));return child}"object"===typeof circular&&(depth$jscomp$0=circular.depth,prototype=circular.prototype,includeNonEnumerable=circular.includeNonEnumerable,circular=circular.circular);var allParents=[],allChildren=[],useBuffer="undefined"!=typeof shadow$shims.Buffer;"undefined"==typeof circular&&
(circular=!0);"undefined"==typeof depth$jscomp$0&&(depth$jscomp$0=Infinity);return _clone(parent$jscomp$0,depth$jscomp$0)}function __objToStr(o){return Object.prototype.toString.call(o)}function __getRegExpFlags(re){var flags="";re.global&&(flags+="g");re.ignoreCase&&(flags+="i");re.multiline&&(flags+="m");return flags}try{var nativeMap=Map}catch(_){nativeMap=function(){}}try{var nativeSet=Set}catch(_$203){nativeSet=function(){}}try{var nativePromise=Promise}catch(_$204){nativePromise=function(){}}clone.clonePrototype=
function(parent){if(null===parent)return null;var c=function(){};c.prototype=parent;return new c};clone.__objToStr=__objToStr;clone.__isDate=function(o){return"object"===typeof o&&"[object Date]"===__objToStr(o)};clone.__isArray=function(o){return"object"===typeof o&&"[object Array]"===__objToStr(o)};clone.__isRegExp=function(o){return"object"===typeof o&&"[object RegExp]"===__objToStr(o)};clone.__getRegExpFlags=__getRegExpFlags;return clone}();module.exports&&(module.exports=clone$jscomp$0)}),isArray$1=
Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,fastJsonStableStringify=function(data,opts){opts||(opts={});"function"===typeof opts&&(opts={cmp:opts});var cycles="boolean"===typeof opts.cycles?opts.cycles:!1,cmp=opts.cmp&&function(f){return function(node){return function(a,b){return f({key:a,value:node[a]},{key:b,value:node[b]})}}}(opts.cmp),seen=[];return function stringify(node){node&&node.toJSON&&"function"===typeof node.toJSON&&(node=node.toJSON());if(void 0!==node){if("number"==
typeof node)return isFinite(node)?""+node:"null";if("object"!==typeof node)return JSON.stringify(node);var i;if(Array.isArray(node)){var out="[";for(i=0;i<node.length;i++)i&&(out+=","),out+=stringify(node[i])||"null";return out+"]"}if(null===node)return"null";if(-1!==seen.indexOf(node)){if(cycles)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var seenIndex=seen.push(node)-1,keys=Object.keys(node).sort(cmp&&cmp(node));out="";for(i=0;i<keys.length;i++){var key=
keys[i],value=stringify(node[key]);value&&(out&&(out+=","),out+=JSON.stringify(key)+":"+value)}seen.splice(seenIndex,1);return"{"+out+"}"}}(data)},deepEqual=function equal(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){var arrA=isArray$1(a),arrB=isArray$1(b);if(arrA&&arrB){var length=a.length;if(length!=b.length)return!1;for(arrA=length;0!==arrA--;)if(!equal(a[arrA],b[arrA]))return!1;return!0}if(arrA!=arrB)return!1;arrA=a instanceof Date;arrB=b instanceof Date;if(arrA!=arrB)return!1;
if(arrA&&arrB)return a.getTime()==b.getTime();arrA=a instanceof RegExp;arrB=b instanceof RegExp;if(arrA!=arrB)return!1;if(arrA&&arrB)return a.toString()==b.toString();arrB=keyList(a);length=arrB.length;if(length!==keyList(b).length)return!1;for(arrA=length;0!==arrA--;)if(!hasProp.call(b,arrB[arrA]))return!1;for(arrA=length;0!==arrA--;)if(length=arrB[arrA],!equal(a[length],b[length]))return!1;return!0}return a!==a&&b!==b},duplicate=clone_1;Set.prototype.toJSON=function(){return"Set("+[].concat($jscomp.arrayFromIterable(this)).map(function(x){return fastJsonStableStringify(x)}).join(",")+
")"};var stringify=fastJsonStableStringify,keys=Object.keys,idCounter=42,PRIMITIVE_MARKS=keys({area:1,bar:1,line:1,point:1,text:1,tick:1,trail:1,rect:1,geoshape:1,rule:1,circle:1,square:1});toSet(PRIMITIVE_MARKS);var FILL_STROKE_CONFIG=[].concat("stroke strokeWidth strokeDash strokeDashOffset strokeOpacity strokeJoin strokeMiterLimit".split(" "),["fill","fillOpacity"]),VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color","tooltip"],CompositeMarkNormalizer=function(name,run){this.name=name;this.run=run};
CompositeMarkNormalizer.prototype.hasMatchingType=function(spec){return isUnitSpec(spec)?(spec=spec.mark,(isMarkDef(spec)?spec.type:spec)===this.name):!1};var AGGREGATE_OP_INDEX={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},COUNTING_OPS=["count","valid","missing","distinct"],SUM_OPS=["count","sum","distinct","valid","missing"],SHARED_DOMAIN_OP_INDEX=toSet("mean average median q1 q3 min max".split(" ")),
GEOPOSITION_CHANNEL_INDEX={longitude:1,longitude2:1,latitude:1,latitude2:1},GEOPOSITION_CHANNELS=keys(GEOPOSITION_CHANNEL_INDEX),UNIT_CHANNEL_INDEX=Object.assign({},{x:1,y:1,x2:1,y2:1},GEOPOSITION_CHANNEL_INDEX,{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1}),FACET_CHANNEL_INDEX={row:1,column:1,facet:1},FACET_CHANNELS=keys(FACET_CHANNEL_INDEX),CHANNEL_INDEX=Object.assign({},UNIT_CHANNEL_INDEX,FACET_CHANNEL_INDEX),
CHANNELS=keys(CHANNEL_INDEX);__rest(CHANNEL_INDEX,["order","detail"]);var SINGLE_DEF_UNIT_CHANNEL_INDEX=__rest(CHANNEL_INDEX,["order","detail","row","column","facet"]),SECONDARY_RANGE_CHANNEL=["x2","y2","latitude2","longitude2"],NONPOSITION_CHANNEL_INDEX=__rest(UNIT_CHANNEL_INDEX,"x y x2 y2 latitude longitude latitude2 longitude2".split(" ")),NONPOSITION_CHANNELS=keys(NONPOSITION_CHANNEL_INDEX),POSITION_SCALE_CHANNEL_INDEX={x:1,y:1},POSITION_SCALE_CHANNELS=keys(POSITION_SCALE_CHANNEL_INDEX),NONPOSITION_SCALE_CHANNEL_INDEX=
__rest(NONPOSITION_CHANNEL_INDEX,"text tooltip href detail key order".split(" ")),NONPOSITION_SCALE_CHANNELS=keys(NONPOSITION_SCALE_CHANNEL_INDEX),SCALE_CHANNEL_INDEX=Object.assign({},POSITION_SCALE_CHANNEL_INDEX,NONPOSITION_SCALE_CHANNEL_INDEX),SCALE_CHANNELS=keys(SCALE_CHANNEL_INDEX),ALL_MARKS={area:"always",bar:"always",circle:"always",geoshape:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},ALL_MARKS_EXCEPT_GEOSHAPE=
__rest(ALL_MARKS,["geoshape"]),message$jscomp$0=Object.freeze({INVALID_SPEC:"Invalid spec",FIT_NON_SINGLE:'Autosize "fit" only works for single views and layered views.',CANNOT_FIX_RANGE_STEP_WITH_FIT:'Cannot use a fixed value of "rangeStep" when "autosize" is "fit".',cannotProjectOnChannelWithoutField:function(channel){return'Cannot project a selection on encoding channel "'+channel+'", which has no field.'},nearestNotSupportForContinuous:function(mark){return'The "nearest" transform is not supported for '+
mark+" marks."},selectionNotSupported:function(mark){return"Selection not supported for "+mark+" yet"},selectionNotFound:function(name){return'Cannot find a selection named "'+name+'"'},SCALE_BINDINGS_CONTINUOUS:"Scale bindings are currently only supported for scales with unbinned, continuous domains.",NO_INIT_SCALE_BINDINGS:"Selections bound to scales cannot be separately initialized.",noSuchRepeatedValue:function(field){return'Unknown repeated value "'+field+'".'},columnsNotSupportByRowCol:function(type){return'The "columns" property cannot be used when "'+
type+'" has nested row/column.'},CONCAT_CANNOT_SHARE_AXIS:"Axes cannot be shared in concatenated views yet (https://github.com/vega/vega-lite/issues/2415).",REPEAT_CANNOT_SHARE_AXIS:"Axes cannot be shared in repeated views yet (https://github.com/vega/vega-lite/issues/2415).",unrecognizedParse:function(p){return'Unrecognized parse "'+p+'".'},differentParse:function(field,local,ancestor){return'An ancestor parsed field "'+field+'" as '+ancestor+" but a child wants to parse the field as "+local+"."},
invalidTransformIgnored:function(transform){return"Ignoring an invalid transform: "+stringify(transform)+"."},NO_FIELDS_NEEDS_AS:'If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.',encodingOverridden:function(channels){return"Layer's shared "+channels.join(",")+" channel "+(1===channels.length?"is":"are")+" overriden"},projectionOverridden:function(opt){var projection=opt.projection;return"Layer's shared projection "+
stringify(opt.parentProjection)+" is overridden by a child projection "+stringify(projection)+"."},primitiveChannelDef:function(channel,type,value){return"Channel "+channel+" is a "+type+". Converted to {value: "+stringify(value)+"}."},invalidFieldType:function(type){return'Invalid field type "'+type+'"'},nonZeroScaleUsedWithLengthMark:function(mark,channel,opt){return"A "+(opt.scaleType?opt.scaleType+" scale":opt.zeroFalse?"scale with zero\x3dfalse":"scale with custom domain that excludes zero")+
" is used to encode "+mark+"'s "+channel+". This can be misleading as the "+("x"===channel?"width":"height")+" of the "+mark+" can be arbitrary based on the scale domain. You may want to use point mark instead."},invalidFieldTypeForCountAggregate:function(type,aggregate){return'Invalid field type "'+type+'" for aggregate: "'+aggregate+'", using "quantitative" instead.'},invalidAggregate:function(aggregate){return'Invalid aggregation operator "'+aggregate+'"'},missingFieldType:function(channel,newType){return'Missing type for channel "'+
channel+'", using "'+newType+'" instead.'},droppingColor:function(type,opt){var fill=opt.fill;opt=opt.stroke;return"Dropping color "+type+" as the plot also has "+(fill&&opt?"fill and stroke":fill?"fill":"stroke")},emptyFieldDef:function(fieldDef,channel){return"Dropping "+stringify(fieldDef)+' from channel "'+channel+'" since it does not contain data field or value.'},latLongDeprecated:function(channel,type,newChannel){return channel+"-encoding with type "+type+" is deprecated. Replacing with "+
newChannel+"-encoding."},LINE_WITH_VARYING_SIZE:"Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.",incompatibleChannel:function(channel,markOrFacet,when){return channel+' dropped as it is incompatible with "'+markOrFacet+'"'+(when?" when "+when:"")+"."},invalidEncodingChannel:function(channel){return channel+"-encoding is dropped as "+channel+" is not a valid encoding channel."},facetChannelShouldBeDiscrete:function(channel){return channel+" encoding should be discrete (ordinal / nominal / binned)."},
facetChannelDropped:function(channels){return"Facet encoding dropped as "+channels.join(" and ")+" "+(1<channels.length?"are":"is")+" also specified."},discreteChannelCannotEncode:function(channel,type){return'Using discrete channel "'+channel+'" to encode "'+type+'" field can be misleading as it does not encode '+("ordinal"===type?"order":"magnitude")+"."},BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL:"Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",
lineWithRange:function(hasX2,hasY2){return"Line mark is for continuous lines and thus cannot be used with "+(hasX2&&hasY2?"x2 and y2":hasX2?"x2":"y2")+". We will use the rule mark (line segments) instead."},orientOverridden:function(original,actual){return'Specified orient "'+original+'" overridden with "'+actual+'"'},CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN:"custom domain scale cannot be unioned with default field-based domain",cannotUseScalePropertyWithNonColor:function(prop){return'Cannot use the scale property "'+
prop+'" with non-color channel.'},unaggregateDomainHasNoEffectForRawField:function(fieldDef){return"Using unaggregated domain with raw field has no effect ("+stringify(fieldDef)+")."},unaggregateDomainWithNonSharedDomainOp:function(aggregate){return'Unaggregated domain not applicable for "'+aggregate+'" since it produces values outside the origin domain of the source data.'},unaggregatedDomainWithLogScale:function(fieldDef){return"Unaggregated domain is currently unsupported for log scale ("+stringify(fieldDef)+
")."},cannotApplySizeToNonOrientedMark:function(mark){return'Cannot apply size to non-oriented mark "'+mark+'".'},rangeStepDropped:function(channel){return'rangeStep for "'+channel+'" is dropped as top-level '+("x"===channel?"width":"height")+" is provided."},scaleTypeNotWorkWithChannel:function(channel,scaleType,defaultScaleType){return'Channel "'+channel+'" does not work with "'+scaleType+'" scale. We are using "'+defaultScaleType+'" scale instead.'},scaleTypeNotWorkWithFieldDef:function(scaleType,
defaultScaleType){return'FieldDef does not work with "'+scaleType+'" scale. We are using "'+defaultScaleType+'" scale instead.'},scalePropertyNotWorkWithScaleType:function(scaleType,propName,channel){return channel+"-scale's \""+propName+'" is dropped as it does not work with '+scaleType+" scale."},scaleTypeNotWorkWithMark:function(mark,scaleType){return'Scale type "'+scaleType+'" does not work with mark "'+mark+'".'},mergeConflictingProperty:function(property,propertyOf,v1,v2){return"Conflicting "+
propertyOf.toString()+' property "'+property.toString()+'" ('+stringify(v1)+" and "+stringify(v2)+").  Using "+stringify(v1)+"."},mergeConflictingDomainProperty:function(property,propertyOf,v1,v2){return"Conflicting "+propertyOf.toString()+' property "'+property.toString()+'" ('+stringify(v1)+" and "+stringify(v2)+").  Using the union of the two domains."},independentScaleMeansIndependentGuide:function(channel){return'Setting the scale to be independent for "'+channel+'" means we also have to set the guide (axis or legend) to be independent.'},
domainSortDropped:function(sort){return"Dropping sort property "+stringify(sort)+" as unioned domains only support boolean or op 'count'."},UNABLE_TO_MERGE_DOMAINS:"Unable to merge domains",MORE_THAN_ONE_SORT:"Domains that should be unioned has conflicting sort properties. Sort will be set to true.",INVALID_CHANNEL_FOR_AXIS:"Invalid channel for axis.",cannotStackRangedMark:function(channel){return'Cannot stack "'+channel+'" if there is already "'+channel+'2"'},cannotStackNonLinearScale:function(scaleType){return"Cannot stack non-linear scale ("+
scaleType+")"},stackNonSummativeAggregate:function(aggregate){return'Stacking is applied even though the aggregate function is non-summative ("'+aggregate+'")'},invalidTimeUnit:function(unitName,value){return"Invalid "+unitName+": "+stringify(value)},dayReplacedWithDate:function(fullTimeUnit){return'Time unit "'+fullTimeUnit+'" is not supported. We are replacing it with '+fullTimeUnit.replace("day","date")+"."},droppedDay:function(d){return"Dropping day from datetime "+stringify(d)+" as day cannot be combined with other units."},
errorBarCenterAndExtentAreNotNeeded:function(center,extent){return(extent?"extent ":"")+(extent&&center?"and ":"")+(center?"center ":"")+(extent&&center?"are ":"is ")+"not needed when data are aggregated."},errorBarCenterIsUsedWithWrongExtent:function(center,extent,mark){return center+" is not usually used with "+extent+" for "+mark+"."},errorBarContinuousAxisHasCustomizedAggregate:function(aggregate,compositeMark){return"Continuous axis should not have customized aggregation function "+aggregate+
"; "+compositeMark+" already agregates the axis."},errorBarCenterIsNotNeeded:function(extent,mark){return"Center is not needed to be specified in "+mark+" when extent is "+extent+"."},errorBand1DNotSupport:function(property){return"1D error band does not support "+property},channelRequiredForBinned:function(channel){return"Channel "+channel+' is required for "binned" bin'},domainRequiredForThresholdScale:function(channel){return"Domain for "+channel+" is required for threshold scale"}}),main$1=function(_$jscomp$0,
method){var level=_$jscomp$0||0;return{level:function(_){return arguments.length?(level=+_,this):level},error:function(){1<=level&&log(method||"error","ERROR",arguments);return this},warn:function(){2<=level&&log(method||"warn","WARN",arguments);return this},info:function(){3<=level&&log(method||"log","INFO",arguments);return this},debug:function(){4<=level&&log(method||"log","DEBUG",arguments);return this}}}(2),current=main$1,MONTHS="january february march april may june july august september october november december".split(" "),
SHORT_MONTHS=MONTHS.map(function(m){return m.substr(0,3)}),DAYS="sunday monday tuesday wednesday thursday friday saturday".split(" "),SHORT_DAYS=DAYS.map(function(d){return d.substr(0,3)}),TimeUnit;(function(TimeUnit){TimeUnit.YEAR="year";TimeUnit.MONTH="month";TimeUnit.DAY="day";TimeUnit.DATE="date";TimeUnit.HOURS="hours";TimeUnit.MINUTES="minutes";TimeUnit.SECONDS="seconds";TimeUnit.MILLISECONDS="milliseconds";TimeUnit.YEARMONTH="yearmonth";TimeUnit.YEARMONTHDATE="yearmonthdate";TimeUnit.YEARMONTHDATEHOURS=
"yearmonthdatehours";TimeUnit.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes";TimeUnit.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds";TimeUnit.MONTHDATE="monthdate";TimeUnit.MONTHDATEHOURS="monthdatehours";TimeUnit.HOURSMINUTES="hoursminutes";TimeUnit.HOURSMINUTESSECONDS="hoursminutesseconds";TimeUnit.MINUTESSECONDS="minutesseconds";TimeUnit.SECONDSMILLISECONDS="secondsmilliseconds";TimeUnit.QUARTER="quarter";TimeUnit.YEARQUARTER="yearquarter";TimeUnit.QUARTERMONTH="quartermonth";
TimeUnit.YEARQUARTERMONTH="yearquartermonth";TimeUnit.UTCYEAR="utcyear";TimeUnit.UTCMONTH="utcmonth";TimeUnit.UTCDAY="utcday";TimeUnit.UTCDATE="utcdate";TimeUnit.UTCHOURS="utchours";TimeUnit.UTCMINUTES="utcminutes";TimeUnit.UTCSECONDS="utcseconds";TimeUnit.UTCMILLISECONDS="utcmilliseconds";TimeUnit.UTCYEARMONTH="utcyearmonth";TimeUnit.UTCYEARMONTHDATE="utcyearmonthdate";TimeUnit.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours";TimeUnit.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes";TimeUnit.UTCYEARMONTHDATEHOURSMINUTESSECONDS=
"utcyearmonthdatehoursminutesseconds";TimeUnit.UTCMONTHDATE="utcmonthdate";TimeUnit.UTCMONTHDATEHOURS="utcmonthdatehours";TimeUnit.UTCHOURSMINUTES="utchoursminutes";TimeUnit.UTCHOURSMINUTESSECONDS="utchoursminutesseconds";TimeUnit.UTCMINUTESSECONDS="utcminutesseconds";TimeUnit.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds";TimeUnit.UTCQUARTER="utcquarter";TimeUnit.UTCYEARQUARTER="utcyearquarter";TimeUnit.UTCQUARTERMONTH="utcquartermonth";TimeUnit.UTCYEARQUARTERMONTH="utcyearquartermonth"})(TimeUnit||
(TimeUnit={}));var LOCAL_SINGLE_TIMEUNIT_INDEX={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},TIMEUNIT_PARTS=keys(LOCAL_SINGLE_TIMEUNIT_INDEX),UTC_SINGLE_TIMEUNIT_INDEX={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1},UTC_MULTI_TIMEUNIT_INDEX={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,
utcquartermonth:1,utcmonthdate:1,utcmonthdatehours:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},UTC_TIMEUNIT_INDEX=Object.assign({},UTC_SINGLE_TIMEUNIT_INDEX,UTC_MULTI_TIMEUNIT_INDEX);Object.assign({},LOCAL_SINGLE_TIMEUNIT_INDEX,UTC_SINGLE_TIMEUNIT_INDEX,{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,monthdatehours:1,hoursminutes:1,
hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},UTC_MULTI_TIMEUNIT_INDEX);var TYPE_INDEX={quantitative:1,ordinal:1,temporal:1,nominal:1,geojson:1},defaultTitleFormatter=function(fieldDef,config){switch(config.fieldTitle){case "plain":return fieldDef.field;case "functional":config=fieldDef.aggregate;var bin=fieldDef.bin,timeUnit=fieldDef.timeUnit;fieldDef=fieldDef.field;fieldDef=isArgmaxDef(config)?fieldDef+" for argmax("+config.argmax+")":isArgminDef(config)?fieldDef+" for argmin("+
config.argmin+")":(config=config||timeUnit||isBinning(bin)&&"bin")?config.toUpperCase()+"("+fieldDef+")":fieldDef;return fieldDef;default:return verbalTitleFormatter(fieldDef,config)}},titleFormatter=defaultTitleFormatter,COMPATIBLE={compatible:!0},BOXPLOT_PARTS=keys({box:1,median:1,outliers:1,rule:1,ticks:1}),boxPlotNormalizer=new CompositeMarkNormalizer("boxplot",normalizeBoxPlot),ERRORBAR_PARTS=keys({ticks:1,rule:1}),errorBarNormalizer=new CompositeMarkNormalizer("errorbar",normalizeErrorBar),
ERRORBAND_PARTS=keys({band:1,borders:1}),errorBandNormalizer=new CompositeMarkNormalizer("errorband",normalizeErrorBand),compositeMarkRegistry={};add("boxplot",normalizeBoxPlot,BOXPLOT_PARTS);add("errorbar",normalizeErrorBar,ERRORBAR_PARTS);add("errorband",normalizeErrorBand,ERRORBAND_PARTS);var VL_ONLY_GUIDE_CONFIG=["shortTimeLabels"],VL_ONLY_LEGEND_CONFIG=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength"],COMMON_LEGEND_PROPERTY_INDEX=
{clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,
symbolFillColor:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},VG_LEGEND_PROPERTY_INDEX=Object.assign({},COMMON_LEGEND_PROPERTY_INDEX,{opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,encode:1}),LEGEND_PROPERTIES=
keys(COMMON_LEGEND_PROPERTY_INDEX),VG_LEGEND_PROPERTIES=keys(VG_LEGEND_PROPERTY_INDEX),ScaleType;(function(ScaleType){ScaleType.LINEAR="linear";ScaleType.LOG="log";ScaleType.POW="pow";ScaleType.SQRT="sqrt";ScaleType.SYMLOG="symlog";ScaleType.TIME="time";ScaleType.UTC="utc";ScaleType.QUANTILE="quantile";ScaleType.QUANTIZE="quantize";ScaleType.THRESHOLD="threshold";ScaleType.BIN_ORDINAL="bin-ordinal";ScaleType.ORDINAL="ordinal";ScaleType.POINT="point";ScaleType.BAND="band"})(ScaleType||(ScaleType={}));
var SCALE_CATEGORY_INDEX={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},SCALE_TYPES=keys(SCALE_CATEGORY_INDEX),SCALE_PRECEDENCE_INDEX={linear:0,log:1,pow:1,sqrt:1,symlog:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0},CONTINUOUS_TO_CONTINUOUS_SCALES=
"linear log pow sqrt symlog time utc".split(" "),CONTINUOUS_TO_CONTINUOUS_INDEX=toSet(CONTINUOUS_TO_CONTINUOUS_SCALES),CONTINUOUS_TO_DISCRETE_INDEX=toSet(["quantile","quantize","threshold"]),CONTINUOUS_DOMAIN_SCALES=CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["quantile","quantize","threshold"]),CONTINUOUS_DOMAIN_INDEX=toSet(CONTINUOUS_DOMAIN_SCALES),DISCRETE_DOMAIN_INDEX=toSet(["ordinal","bin-ordinal","point","band"]),defaultScaleConfig={textXRangeStep:90,rangeStep:20,pointPadding:.5,barBandPaddingInner:.1,
rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTY_INDEX=__rest({type:1,domain:1,align:1,range:1,rangeStep:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","rangeStep","scheme"]),NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=
keys(NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTY_INDEX);(function(){for(var index={},$jscomp$iter$53=$jscomp.makeIterator(CHANNELS),$jscomp$key$channel=$jscomp$iter$53.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$53.next()){$jscomp$key$channel=$jscomp$key$channel.value;for(var $jscomp$iter$52=$jscomp.makeIterator(keys(TYPE_INDEX)),$jscomp$key$fieldDefType=$jscomp$iter$52.next();!$jscomp$key$fieldDefType.done;$jscomp$key$fieldDefType=$jscomp$iter$52.next()){$jscomp$key$fieldDefType=
$jscomp$key$fieldDefType.value;for(var $jscomp$iter$51=$jscomp.makeIterator(SCALE_TYPES),$jscomp$key$scaleType=$jscomp$iter$51.next();!$jscomp$key$scaleType.done;$jscomp$key$scaleType=$jscomp$iter$51.next()){$jscomp$key$scaleType=$jscomp$key$scaleType.value;var key=$jscomp$key$channel+"_"+$jscomp$key$fieldDefType;channelSupportScaleType($jscomp$key$channel,$jscomp$key$scaleType)&&scaleTypeSupportDataType($jscomp$key$scaleType,$jscomp$key$fieldDefType)&&(index[key]=index[key]||[],index[key].push($jscomp$key$scaleType))}}}return index})();
var COMPOSITION_LAYOUT_PROPERTIES=keys({align:1,bounds:1,center:1,columns:1,spacing:1}),defaultConfig$1={padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",invalidValues:"filter",view:{width:200,height:200},mark:{color:"#4c78a8",tooltip:{content:"encoding"}},area:{},bar:{binSpacing:1,continuousBandSize:5},circle:{},geoshape:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,
box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:defaultScaleConfig,projection:{},axis:{},axisX:{},axisY:{},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:{single:{on:"click",
fields:["_vgsid_"],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:["_vgsid_"],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] \x3e window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] \x3e window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}},style:{},title:{},facet:{spacing:20},repeat:{spacing:20},concat:{spacing:20}},
MARK_STYLES=["view"].concat($jscomp.arrayFromIterable(PRIMITIVE_MARKS)),VL_ONLY_CONFIG_PROPERTIES="padding facet concat repeat numberFormat timeFormat countTitle header stack scale selection invalidValues overlay".split(" "),VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX=Object.assign({view:["width","height"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],text:["shortTimeLabels"],tick:["bandSize",
"thickness"]}),SpecMapper=function(){};SpecMapper.prototype.map=function(spec,params){return void 0!==spec.facet?this.mapFacet(spec,params):void 0!==spec.repeat?this.mapRepeat(spec,params):isHConcatSpec(spec)?this.mapHConcat(spec,params):isVConcatSpec(spec)?this.mapVConcat(spec,params):void 0!==spec.concat?this.mapConcat(spec,params):this.mapLayerOrUnit(spec,params)};SpecMapper.prototype.mapLayerOrUnit=function(spec,params){if(isLayerSpec(spec))return this.mapLayer(spec,params);if(isUnitSpec(spec))return this.mapUnit(spec,
params);throw Error(message$jscomp$0.INVALID_SPEC);};SpecMapper.prototype.mapLayer=function(spec,params){var $jscomp$this=this;return Object.assign({},spec,{layer:spec.layer.map(function(subspec){return $jscomp$this.mapLayerOrUnit(subspec,params)})})};SpecMapper.prototype.mapHConcat=function(spec,params){var $jscomp$this=this;return Object.assign({},spec,{hconcat:spec.hconcat.map(function(subspec){return $jscomp$this.map(subspec,params)})})};SpecMapper.prototype.mapVConcat=function(spec,params){var $jscomp$this=
this;return Object.assign({},spec,{vconcat:spec.vconcat.map(function(subspec){return $jscomp$this.map(subspec,params)})})};SpecMapper.prototype.mapConcat=function(spec,params){var $jscomp$this=this,concat=spec.concat;spec=__rest(spec,["concat"]);return Object.assign({},spec,{concat:concat.map(function(subspec){return $jscomp$this.map(subspec,params)})})};SpecMapper.prototype.mapFacet=function(spec,params){return Object.assign({},spec,{spec:this.map(spec.spec,params)})};SpecMapper.prototype.mapRepeat=
function(spec,params){return Object.assign({},spec,{spec:this.map(spec.spec,params)})};var STACK_OFFSET_INDEX={zero:1,center:1,normalize:1},STACKABLE_MARKS="bar area rule point circle square line text tick".split(" "),STACK_BY_DEFAULT_MARKS=["bar","area"],PathOverlayNormalizer=function(){this.name="path-overlay"};PathOverlayNormalizer.prototype.hasMatchingType=function(spec,config){if(isUnitSpec(spec)){var mark=spec.mark;spec=spec.encoding;mark=isMarkDef(mark)?mark:{type:mark};switch(mark.type){case "line":case "rule":case "trail":return!!getPointOverlay(mark,
config[mark.type],spec);case "area":return!!getPointOverlay(mark,config[mark.type],spec)||!!getLineOverlay(mark,config[mark.type])}}return!1};PathOverlayNormalizer.prototype.run=function(spec,params,normalize){var config=params.config,selection=spec.selection,projection=spec.projection,encoding=spec.encoding,mark=spec.mark;spec=__rest(spec,["selection","projection","encoding","mark"]);mark=isMarkDef(mark)?mark:{type:mark};var pointOverlay=getPointOverlay(mark,config[mark.type],encoding),lineOverlay=
"area"===mark.type&&getLineOverlay(mark,config[mark.type]);selection=[Object.assign({},selection?{selection:selection}:{},{mark:dropLineAndPoint(Object.assign({},mark,"area"===mark.type?{opacity:.7}:{})),encoding:omit(encoding,["shape"])})];var stackProps=stack(mark,encoding,config?config.stack:void 0),overlayEncoding=encoding;if(stackProps){overlayEncoding=stackProps.fieldChannel;stackProps=stackProps.offset;var $jscomp$compprop5={};overlayEncoding=Object.assign({},encoding,($jscomp$compprop5[overlayEncoding]=
Object.assign({},encoding[overlayEncoding],stackProps?{stack:stackProps}:{}),$jscomp$compprop5))}lineOverlay&&selection.push(Object.assign({},projection?{projection:projection}:{},{mark:Object.assign({type:"line"},pick(mark,["clip","interpolate","tension","tooltip"]),lineOverlay),encoding:overlayEncoding}));pointOverlay&&selection.push(Object.assign({},projection?{projection:projection}:{},{mark:Object.assign({type:"point",opacity:1,filled:!0},pick(mark,["clip","tooltip"]),pointOverlay),encoding:overlayEncoding}));
return normalize(Object.assign({},spec,{layer:selection}),Object.assign({},params,{config:dropLineAndPointFromConfig(config)}))};var RuleForRangedLineNormalizer=function(){this.name="RuleForRangedLine"};RuleForRangedLineNormalizer.prototype.hasMatchingType=function(spec){if(isUnitSpec(spec)){var encoding=spec.encoding;if("line"===spec.mark){spec=$jscomp.makeIterator(SECONDARY_RANGE_CHANNEL);for(var $jscomp$key$channel=spec.next();!$jscomp$key$channel.done;$jscomp$key$channel=spec.next()){$jscomp$key$channel=
$jscomp$key$channel.value;var mainChannel=getMainRangeChannel($jscomp$key$channel);mainChannel=encoding[mainChannel];if(encoding[$jscomp$key$channel]&&isFieldDef(mainChannel)&&!isBinned(mainChannel.bin))return!0}}}return!1};RuleForRangedLineNormalizer.prototype.run=function(spec,params,normalize){var encoding=spec.encoding;warn(message$jscomp$0.lineWithRange(!!encoding.x2,!!encoding.y2));return normalize(Object.assign({},spec,{mark:"rule"}),params)};var CoreNormalizer=function(){var $jscomp$super$this=
SpecMapper.apply(this,arguments)||this;$jscomp$super$this.nonFacetUnitNormalizers=[boxPlotNormalizer,errorBarNormalizer,errorBandNormalizer,new PathOverlayNormalizer,new RuleForRangedLineNormalizer];return $jscomp$super$this};$jscomp.inherits(CoreNormalizer,SpecMapper);CoreNormalizer.prototype.map=function(spec,params){if(isUnitSpec(spec)){var hasRow=channelHasField(spec.encoding,"row"),hasColumn=channelHasField(spec.encoding,"column"),hasFacet=channelHasField(spec.encoding,"facet");if(hasRow||hasColumn||
hasFacet)return this.mapFacetedUnit(spec,params)}return SpecMapper.prototype.map.call(this,spec,params)};CoreNormalizer.prototype.mapUnit=function(spec,params){var parentProjection=params.parentProjection;if(params.parentEncoding||parentProjection)return this.mapUnitWithParentEncodingOrProjection(spec,params);parentProjection=this.mapLayerOrUnit.bind(this);for(var $jscomp$iter$66=$jscomp.makeIterator(this.nonFacetUnitNormalizers),$jscomp$key$unitNormalizer=$jscomp$iter$66.next();!$jscomp$key$unitNormalizer.done;$jscomp$key$unitNormalizer=
$jscomp$iter$66.next())if($jscomp$key$unitNormalizer=$jscomp$key$unitNormalizer.value,$jscomp$key$unitNormalizer.hasMatchingType(spec,params.config))return $jscomp$key$unitNormalizer.run(spec,params,parentProjection);return spec};CoreNormalizer.prototype.mapRepeat=function(spec,params){!isArray(spec.repeat)&&spec.columns&&(spec=omit(spec,["columns"]),warn(message$jscomp$0.columnsNotSupportByRowCol("repeat")));return Object.assign({},spec,{spec:this.map(spec.spec,params)})};CoreNormalizer.prototype.mapFacet=
function(spec,params){isFacetMapping(spec.facet)&&spec.columns&&(spec=omit(spec,["columns"]),warn(message$jscomp$0.columnsNotSupportByRowCol("facet")));return SpecMapper.prototype.mapFacet.call(this,spec,params)};CoreNormalizer.prototype.mapUnitWithParentEncodingOrProjection=function(spec,params){var encoding=spec.encoding,parentEncoding=params.parentEncoding,config=params.config;params=mergeProjection({parentProjection:params.parentProjection,projection:spec.projection});encoding=mergeEncoding({parentEncoding:parentEncoding,
encoding:encoding});return this.mapUnit(Object.assign({},spec,params?{projection:params}:{},encoding?{encoding:encoding}:{}),{config:config})};CoreNormalizer.prototype.mapFacetedUnit=function(spec,params){var _a=spec.encoding,row=_a.row,column=_a.column,facet=_a.facet;_a=__rest(_a,["row","column","facet"]);var mark=spec.mark,width=spec.width,projection=spec.projection,height=spec.height,selection=spec.selection;spec=__rest(spec,"mark width projection height selection encoding".split(" "));facet&&
(row||column)&&warn(message$jscomp$0.facetChannelDropped([].concat($jscomp.arrayFromIterable(row?["row"]:[]),$jscomp.arrayFromIterable(column?["column"]:[]))));return this.mapFacet(Object.assign({},spec,{facet:row||column?Object.assign({},row?{row:row}:{},column?{column:column}:{}):facet,spec:Object.assign({},projection?{projection:projection}:{},{mark:mark},width?{width:width}:{},height?{height:height}:{},{encoding:_a},selection?{selection:selection}:{})}),params)};CoreNormalizer.prototype.mapLayer=
function(spec,_a){var parentEncoding=_a.parentEncoding,parentProjection=_a.parentProjection;_a=__rest(_a,["parentEncoding","parentProjection"]);var encoding=spec.encoding,projection=spec.projection;spec=__rest(spec,["encoding","projection"]);parentEncoding=Object.assign({},_a,{parentEncoding:mergeEncoding({parentEncoding:parentEncoding,encoding:encoding}),parentProjection:mergeProjection({parentProjection:parentProjection,projection:projection})});return SpecMapper.prototype.mapLayer.call(this,spec,
parentEncoding)};var normalizer=new CoreNormalizer,TOP_LEVEL_PROPERTIES=["background","padding"],VG_MARK_CONFIGS=keys({opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeMiterLimit:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,cursor:1,href:1,tooltip:1,cornerRadius:1,x:1,y:1,x2:1,y2:1,
width:1,height:1}),AXIS_PARTS=["domain","grid","labels","ticks","title"],AXIS_PROPERTY_TYPE={grid:"grid",gridColor:"grid",gridDash:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",domain:"main",domainColor:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",
labelFontWeight:"main",labelLimit:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",maxExtent:"main",minExtent:"main",offset:"main",position:"main",tickColor:"main",tickExtra:"main",tickOffset:"both",tickOpacity:"main",tickRound:"main",ticks:"main",tickSize:"main",title:"main",titleAlign:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontWeight:"main",titleLimit:"main",titleOpacity:"main",titlePadding:"main",
titleX:"main",titleY:"main",tickWidth:"both",tickCount:"both",values:"both",scale:"both",zindex:"both"},COMMON_AXIS_PROPERTIES_INDEX={orient:1,bandPosition:1,domain:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,
labelLimit:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,values:1,zindex:1},AXIS_PROPERTIES_INDEX=
Object.assign({},COMMON_AXIS_PROPERTIES_INDEX,{encoding:1}),VG_AXIS_PROPERTIES_INDEX=Object.assign({gridScale:1,scale:1},COMMON_AXIS_PROPERTIES_INDEX,{encode:1}),VG_AXIS_PROPERTIES=keys(VG_AXIS_PROPERTIES_INDEX),HEADER_TITLE_PROPERTIES_MAP={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleOrient:"orient",titlePadding:"offset"},
HEADER_LABEL_PROPERTIES_MAP={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelLimit:"limit",labelOrient:"orient",labelPadding:"offset"},HEADER_TITLE_PROPERTIES=keys(HEADER_TITLE_PROPERTIES_MAP),HEADER_LABEL_PROPERTIES=keys(HEADER_LABEL_PROPERTIES_MAP),DataFlowNode=function(parent,debugName){this.debugName=debugName;this._children=[];this._parent=null;parent&&(this.parent=parent)};DataFlowNode.prototype.clone=
function(){throw Error("Cannot clone node");};DataFlowNode.prototype.hash=function(){void 0===this._hash&&(this._hash=++idCounter);return this._hash};DataFlowNode.prototype.producedFields=function(){return new Set};DataFlowNode.prototype.dependentFields=function(){return new Set};DataFlowNode.prototype.numChildren=function(){return this._children.length};DataFlowNode.prototype.addChild=function(child,loc){-1<this._children.indexOf(child)?console.warn("Attempt to add the same child twice."):void 0!==
loc?this._children.splice(loc,0,child):this._children.push(child)};DataFlowNode.prototype.removeChild=function(oldChild){oldChild=this._children.indexOf(oldChild);this._children.splice(oldChild,1);return oldChild};DataFlowNode.prototype.remove=function(){for(var loc=this._parent.removeChild(this),$jscomp$iter$74=$jscomp.makeIterator(this._children),$jscomp$key$child=$jscomp$iter$74.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$74.next())$jscomp$key$child=$jscomp$key$child.value,$jscomp$key$child._parent=
this._parent,this._parent.addChild($jscomp$key$child,loc++)};DataFlowNode.prototype.insertAsParentOf=function(other){var parent=other.parent;parent.removeChild(this);this.parent=parent;other.parent=this};DataFlowNode.prototype.swapWithParent=function(){for(var parent=this._parent,newParent=parent.parent,$jscomp$iter$75=$jscomp.makeIterator(this._children),$jscomp$key$child=$jscomp$iter$75.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$75.next())$jscomp$key$child.value.parent=parent;
this._children=[];parent.removeChild(this);parent.parent.removeChild(parent);this.parent=newParent;parent.parent=this};$jscomp.global.Object.defineProperties(DataFlowNode.prototype,{parent:{configurable:!0,enumerable:!0,get:function(){return this._parent},set:function(parent){(this._parent=parent)&&parent.addChild(this)}},children:{configurable:!0,enumerable:!0,get:function(){return this._children}}});var OutputNode=function(parent,source,type,refCounts){parent=DataFlowNode.call(this,parent,source)||
this;parent.type=type;parent.refCounts=refCounts;parent._source=parent._name=source;!parent.refCounts||parent._name in parent.refCounts||(parent.refCounts[parent._name]=0);return parent};$jscomp.inherits(OutputNode,DataFlowNode);OutputNode.prototype.clone=function(){var cloneObj=new this.constructor;cloneObj.debugName="clone_"+this.debugName;cloneObj._source=this._source;cloneObj._name="clone_"+this._name;cloneObj.type=this.type;cloneObj.refCounts=this.refCounts;cloneObj.refCounts[cloneObj._name]=
0;return cloneObj};OutputNode.prototype.getSource=function(){this.refCounts[this._name]++;return this._source};OutputNode.prototype.isRequired=function(){return!!this.refCounts[this._name]};OutputNode.prototype.setSource=function(source){this._source=source};ASTNode.prototype.visit=function(visitor){var n;if(visitor(this))return 1;var c=children(this);var i=0;for(n=c.length;i<n;++i)if(c[i].visit(visitor))return 1};var source$jscomp$0,index$jscomp$0,length$jscomp$0,lookahead,RegexNonAsciiIdentifierStart=
/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,
RegexNonAsciiIdentifierPart=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,
keywords={"if":1,"in":1,"do":1,"var":1,"for":1,"new":1,"try":1,let:1,"this":1,"else":1,"case":1,"void":1,"with":1,"enum":1,"while":1,"break":1,"catch":1,"throw":1,"const":1,yield:1,"class":1,"super":1,"return":1,"typeof":1,"delete":1,"switch":1,"export":1,"import":1,"public":1,"static":1,"default":1,"finally":1,"extends":1,"package":1,"private":1,"function":1,"continue":1,"debugger":1,"interface":1,"protected":1,"instanceof":1,"implements":1},legalKeywords={"if":1,"this":1},CalculateNode=function(parent,
transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent._dependentFields=getDependentFields(parent.transform.calculate);return parent};$jscomp.inherits(CalculateNode,DataFlowNode);CalculateNode.prototype.clone=function(){return new CalculateNode(null,duplicate(this.transform))};CalculateNode.parseAllForSortIndex=function(parent,model){model.forEachFieldDef(function(fieldDef,channel){if(isScaleFieldDef(fieldDef)&&isSortArray(fieldDef.sort)){var field$229=fieldDef.field,
timeUnit=fieldDef.timeUnit,sort=fieldDef.sort;sort=sort.map(function(sortValue,i){return fieldFilterExpression({field:field$229,timeUnit:timeUnit,equal:sortValue})+" ? "+i+" : "}).join("")+sort.length;parent=new CalculateNode(parent,{calculate:sort,as:sortArrayIndexField(fieldDef,channel,{forAs:!0})})}});return parent};CalculateNode.prototype.producedFields=function(){return new Set([this.transform.as])};CalculateNode.prototype.dependentFields=function(){return this._dependentFields};CalculateNode.prototype.assemble=
function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}};CalculateNode.prototype.hash=function(){return"Calculate "+hash(this.transform)};var HEADER_CHANNELS=["row","column"],HEADER_TYPES=["header","footer"],LAYOUT_TITLE_BAND={column:{start:0,end:1},row:{start:1,end:0}},VIEW="view",LBRACK="[",RBRACK="]",LBRACE="{",RBRACE="}",COLON=":",COMMA=",",NAME="@",GT="\x3e",ILLEGAL$1=/[[\]{}]/,DEFAULT_SOURCE,MARKS,DEFAULT_MARKS={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,
rule:1,shape:1,symbol:1,text:1,trail:1},TimeUnitNode=function(parent,formula){parent=DataFlowNode.call(this,parent)||this;parent.formula=formula;return parent};$jscomp.inherits(TimeUnitNode,DataFlowNode);TimeUnitNode.prototype.clone=function(){return new TimeUnitNode(null,duplicate(this.formula))};TimeUnitNode.makeFromEncoding=function(parent,model){model=model.reduceFieldDef(function(timeUnitComponent,fieldDef){var timeUnit=fieldDef.timeUnit,field=fieldDef.field;timeUnit&&(fieldDef={as:vgField(fieldDef,
{forAs:!0}),timeUnit:timeUnit,field:field},timeUnitComponent[hash(fieldDef)]=fieldDef);return timeUnitComponent},{});return 0===keys(model).length?null:new TimeUnitNode(parent,model)};TimeUnitNode.makeFromTransform=function(parent,t){t=Object.assign({},t);var $jscomp$compprop7={};return new TimeUnitNode(parent,($jscomp$compprop7[hash(t)]=t,$jscomp$compprop7))};TimeUnitNode.prototype.merge=function(other){this.formula=Object.assign({},this.formula,other.formula);for(var $jscomp$iter$81=$jscomp.makeIterator(other.children),
$jscomp$key$child=$jscomp$iter$81.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$81.next())$jscomp$key$child=$jscomp$key$child.value,other.removeChild($jscomp$key$child),$jscomp$key$child.parent=this;other.remove()};TimeUnitNode.prototype.producedFields=function(){return new Set(vals(this.formula).map(function(f){return f.as}))};TimeUnitNode.prototype.dependentFields=function(){return new Set(vals(this.formula).map(function(f){return f.field}))};TimeUnitNode.prototype.hash=function(){return"TimeUnit "+
hash(this.formula)};TimeUnitNode.prototype.assemble=function(){return vals(this.formula).map(function(c){return{type:"formula",as:c.as,expr:fieldExpr(c.timeUnit,c.field)}})};var scaleBindings={has:function(selCmpt){return"interval"===selCmpt.type&&"global"===selCmpt.resolve&&selCmpt.bind&&"scales"===selCmpt.bind},parse:function(model,selDef,selCmpt){selDef=varName(selCmpt.name);var bound=selCmpt.scales=[];selCmpt=$jscomp.makeIterator(selCmpt.project.items);for(var $jscomp$key$proj=selCmpt.next();!$jscomp$key$proj.done;$jscomp$key$proj=
selCmpt.next()){$jscomp$key$proj=$jscomp$key$proj.value;var channel=$jscomp$key$proj.channel;if(SCALE_CHANNEL_INDEX[channel]){var scale=model.getScaleComponent(channel),scaleType$232=scale?scale.get("type"):void 0;scale&&scaleType$232 in CONTINUOUS_DOMAIN_INDEX?(scale.set("domainRaw",{signal:accessPathWithDatum($jscomp$key$proj.field,selDef)},!0),bound.push($jscomp$key$proj),model.repeater&&model.repeater.row===model.repeater.column&&model.getScaleComponent("x"===channel?"y":"x").set("domainRaw",
{signal:accessPathWithDatum($jscomp$key$proj.field,selDef)},!0)):warn(message$jscomp$0.SCALE_BINDINGS_CONTINUOUS)}}},topLevelSignals:function(model,selCmpt,signals){var bound=selCmpt.scales.filter(function(proj){return!signals.filter(function(s){return s.name===proj.signals.data}).length});if(!model.parent||!bound.length)return signals;model=signals.filter(function(s){return s.name===selCmpt.name})[0];var update=model.update;if(0<=update.indexOf("vlSelectionResolve"))model.update="{"+bound.map(function(proj){return $(proj.field)+
": "+proj.signals.data}).join(", ")+"}";else for(var $jscomp$iter$83=$jscomp.makeIterator(bound),$jscomp$key$proj=$jscomp$iter$83.next();!$jscomp$key$proj.done;$jscomp$key$proj=$jscomp$iter$83.next())$jscomp$key$proj=$jscomp$key$proj.value,$jscomp$key$proj=", "+$($jscomp$key$proj.field)+": "+$jscomp$key$proj.signals.data,0>update.indexOf($jscomp$key$proj)&&(model.update=update.substring(0,update.length-1)+$jscomp$key$proj+"}");return signals.concat(bound.map(function(proj){return{name:proj.signals.data}}))},
signals:function(model,selCmpt,signals){if(model.parent){model={};selCmpt=$jscomp.makeIterator(selCmpt.scales);for(var $jscomp$key$proj=selCmpt.next();!$jscomp$key$proj.done;model={$jscomp$loop$prop$proj$337:model.$jscomp$loop$prop$proj$337},$jscomp$key$proj=selCmpt.next())model.$jscomp$loop$prop$proj$337=$jscomp$key$proj.value,$jscomp$key$proj=signals.filter(function($jscomp$loop$336){return function(s){return s.name===$jscomp$loop$336.$jscomp$loop$prop$proj$337.signals.data}}(model))[0],$jscomp$key$proj.push=
"outer",delete $jscomp$key$proj.value,delete $jscomp$key$proj.update}return signals}},SelectionProjectionComponent=function(items){for(var $jscomp$restParams=[],$jscomp$restIndex=0;$jscomp$restIndex<arguments.length;++$jscomp$restIndex)$jscomp$restParams[$jscomp$restIndex-0]=arguments[$jscomp$restIndex];this.items=$jscomp$restParams;this.has={}},compilers={single:{signals:singleOrMultiSignals,modifyExpr:function(model,selCmpt){return selCmpt.name+"_tuple, "+("global"===selCmpt.resolve?"true":"{unit: "+
unitName(model)+"}")}},multi:{signals:singleOrMultiSignals,modifyExpr:function(model,selCmpt){return selCmpt.name+"_tuple, "+("global"===selCmpt.resolve?"null":"{unit: "+unitName(model)+"}")}},interval:{signals:function(model,selCmpt){var name=selCmpt.name,fieldsSg=name+"_tuple_fields",hasScales=scaleBindings.has(selCmpt),signals=[],dataSignals=[],scaleTriggers=[];if(selCmpt.translate&&!hasScales){var filterExpr="!event.item || event.item.mark.name !\x3d\x3d "+$(name+"_brush");events(selCmpt,function(_,
evt){_=evt.between[0].filter||(evt.between[0].filter=[]);0>_.indexOf(filterExpr)&&_.push(filterExpr)})}selCmpt.project.items.forEach(function(proj,i){var channel=proj.channel;if("x"!==channel&&"y"!==channel)warn("Interval selections only support x and y encoding channels.");else{i=channelSignals(model,selCmpt,proj,selCmpt.init?selCmpt.init[i]:null);var dname=proj.signals.data;proj=proj.signals.visual;var scaleName=$(model.scaleName(channel)),toNum=model.getScaleComponent(channel).get("type")in CONTINUOUS_DOMAIN_INDEX?
"+":"";signals.push.apply(signals,$jscomp.arrayFromIterable(i));dataSignals.push(dname);scaleTriggers.push({scaleName:model.scaleName(channel),expr:"(!isArray("+dname+") || "+("("+toNum+"invert("+scaleName+", "+proj+")[0] \x3d\x3d\x3d "+toNum+dname+"[0] \x26\x26 ")+(toNum+"invert("+scaleName+", "+proj+")[1] \x3d\x3d\x3d "+toNum+dname+"[1]))")})}});hasScales||signals.push({name:name+"_scale_trigger",value:{},on:[{events:scaleTriggers.map(function(t){return{scale:t.scaleName}}),update:scaleTriggers.map(function(t){return t.expr}).join(" \x26\x26 ")+
(" ? "+(name+"_scale_trigger")+" : {}")}]});hasScales=selCmpt.init;fieldsSg="unit: "+unitName(model)+", fields: "+fieldsSg+", values";return signals.concat(Object.assign({name:name+"_tuple"},hasScales?{init:"{"+fieldsSg+": "+assembleInit(hasScales)+"}"}:{},{on:[{events:[{signal:dataSignals.join(" || ")}],update:dataSignals.join(" \x26\x26 ")+(" ? {"+fieldsSg+": ["+dataSignals+"]} : null")}]}))},modifyExpr:function(model,selCmpt){return selCmpt.name+"_tuple, "+("global"===selCmpt.resolve?"true":"{unit: "+
unitName(model)+"}")},marks:function(model,selCmpt,marks){var name=selCmpt.name,$jscomp$destructuring$var86=selCmpt.project.has,x=$jscomp$destructuring$var86.x,y=$jscomp$destructuring$var86.y,xvname=x&&x.signals.visual,yvname=y&&y.signals.visual,store="data("+$(selCmpt.name+"_store")+")";if(scaleBindings.has(selCmpt))return marks;$jscomp$destructuring$var86={x:void 0!==x?{signal:xvname+"[0]"}:{value:0},y:void 0!==y?{signal:yvname+"[0]"}:{value:0},x2:void 0!==x?{signal:xvname+"[1]"}:{field:{group:"width"}},
y2:void 0!==y?{signal:yvname+"[1]"}:{field:{group:"height"}}};if("global"===selCmpt.resolve)for(var $jscomp$iter$89=$jscomp.makeIterator(keys($jscomp$destructuring$var86)),$jscomp$key$key=$jscomp$iter$89.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$89.next())$jscomp$key$key=$jscomp$key$key.value,$jscomp$destructuring$var86[$jscomp$key$key]=[Object.assign({test:store+".length \x26\x26 "+store+"[0].unit \x3d\x3d\x3d "+unitName(model)},$jscomp$destructuring$var86[$jscomp$key$key]),{value:0}];
store=selCmpt.mark;model=store.fill;selCmpt=store.fillOpacity;var stroke=__rest(store,["fill","fillOpacity"]);store=keys(stroke).reduce(function(def,k){def[k]=[{test:[void 0!==x&&xvname+"[0] !\x3d\x3d "+xvname+"[1]",void 0!==y&&yvname+"[0] !\x3d\x3d "+yvname+"[1]"].filter(function(t){return t}).join(" \x26\x26 "),value:stroke[k]},{value:null}];return def},{});return[{name:name+"_brush_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:model},fillOpacity:{value:selCmpt}},update:$jscomp$destructuring$var86}}].concat($jscomp.arrayFromIterable(marks),
[{name:name+"_brush",type:"rect",clip:!0,encode:{enter:{fill:{value:"transparent"}},update:Object.assign({},$jscomp$destructuring$var86,store)}}])}}},nearest={has:function(selCmpt){return"interval"!==selCmpt.type&&selCmpt.nearest},marks:function(model,selCmpt,marks){var $jscomp$destructuring$var89=selCmpt.project.has;selCmpt=$jscomp$destructuring$var89.x;$jscomp$destructuring$var89=$jscomp$destructuring$var89.y;var markType=model.mark;if(isPathMark(markType))return warn(message$jscomp$0.nearestNotSupportForContinuous(markType)),
marks;selCmpt={name:model.getName("voronoi"),type:"path",from:{data:model.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},tooltip(model,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:selCmpt||!selCmpt&&!$jscomp$destructuring$var89?"datum.datum.x || 0":"0"},y:{expr:$jscomp$destructuring$var89||!selCmpt&&!$jscomp$destructuring$var89?"datum.datum.y || 0":"0"},size:[model.getSizeSignalRef("width"),
model.getSizeSignalRef("height")]}]};var index=0,exists=!1;marks.forEach(function(mark,i){mark=mark.name||"";mark===model.component.mark[0].name?index=i:0<=mark.indexOf("voronoi")&&(exists=!0)});exists||marks.splice(index+1,0,selCmpt);return marks}},inputBindings={has:function(selCmpt){return"single"===selCmpt.type&&"global"===selCmpt.resolve&&selCmpt.bind&&"scales"!==selCmpt.bind},topLevelSignals:function(model,selCmpt,signals){var name=selCmpt.name;model=selCmpt.project;var bind=selCmpt.bind,init=
selCmpt.init&&selCmpt.init[0],datum=nearest.has(selCmpt)?"(item().isVoronoi ? datum.datum : datum)":"datum";model.items.forEach(function(p,i){var sgname=varName(name+"_"+p.field);signals.filter(function(s){return s.name===sgname}).length||signals.unshift(Object.assign({name:sgname},init?{init:assembleInit(init[i])}:{value:null},{on:[{events:selCmpt.events,update:"datum \x26\x26 item().mark.marktype !\x3d\x3d 'group' ? "+accessPathWithDatum(p.field,datum)+" : null"}],bind:bind[p.field]||bind[p.channel]||
bind}))});return signals},signals:function(model,selCmpt,signals){var name=selCmpt.name,proj=selCmpt.project;model=signals.filter(function(s){return s.name===name+"_tuple"})[0];selCmpt=name+"_tuple_fields";proj=proj.items.map(function(p){return varName(name+"_"+p.field)});var valid=proj.map(function(v){return v+" !\x3d\x3d null"}).join(" \x26\x26 ");proj.length&&(model.update=valid+" ? {fields: "+selCmpt+", values: ["+proj.join(", ")+"]} : null");delete model.value;delete model.on;return signals}},
toggle={has:function(selCmpt){return"multi"===selCmpt.type&&selCmpt.toggle},signals:function(model,selCmpt,signals){return signals.concat({name:selCmpt.name+"_toggle",value:!1,on:[{events:selCmpt.events,update:selCmpt.toggle}]})},modifyExpr:function(model,selCmpt){var tpl=selCmpt.name+"_tuple",signal=selCmpt.name+"_toggle";return signal+" ? null : "+tpl+", "+("global"===selCmpt.resolve?signal+" ? null : true, ":signal+" ? null : {unit: "+unitName(model)+"}, ")+(signal+" ? "+tpl+" : null")}},compilers$1=
[{has:function(){return!0},parse:function(model,selDef,selCmpt){var name=selCmpt.name,proj=selCmpt.project||(selCmpt.project=new SelectionProjectionComponent),parsed={},timeUnits={},signals=new Set,signalName=function(p,range){var suffix="visual"===range?p.channel:p.field;p=varName(name+"_"+suffix);for(var counter=1;signals.has(p);counter++)p=varName(name+"_"+suffix+"_"+counter);signals.add(p);suffix={};return suffix[range]=p,suffix};if(!selDef.fields&&!selDef.encodings){var cfg=model.config.selection[selDef.type];
if(selDef.init)for(var $jscomp$iter$86=$jscomp.makeIterator(array$jscomp$0(selDef.init)),$jscomp$key$init=$jscomp$iter$86.next();!$jscomp$key$init.done;$jscomp$key$init=$jscomp$iter$86.next()){$jscomp$key$init=$jscomp.makeIterator(keys($jscomp$key$init.value));for(var $jscomp$key$key=$jscomp$key$init.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$key$init.next())$jscomp$key$key=$jscomp$key$key.value,SINGLE_DEF_UNIT_CHANNEL_INDEX[$jscomp$key$key]?(selDef.encodings||(selDef.encodings=[])).push($jscomp$key$key):
"interval"===selDef.type?(warn('Interval selections should be initialized using "x" and/or "y" keys.'),selDef.encodings=cfg.encodings):(selDef.fields||(selDef.fields=[])).push($jscomp$key$key)}else selDef.encodings=cfg.encodings,selDef.fields=cfg.fields}cfg=$jscomp.makeIterator(selDef.fields||[]);for($jscomp$iter$86=cfg.next();!$jscomp$iter$86.done;$jscomp$iter$86=cfg.next())$jscomp$iter$86={type:"E",field:$jscomp$iter$86.value},$jscomp$iter$86.signals=Object.assign({},signalName($jscomp$iter$86,
"data")),proj.items.push($jscomp$iter$86);cfg=$jscomp.makeIterator(selDef.encodings||[]);for($jscomp$iter$86=cfg.next();!$jscomp$iter$86.done;$jscomp$iter$86=cfg.next())if($jscomp$iter$86=$jscomp$iter$86.value,$jscomp$key$key=model.fieldDef($jscomp$iter$86)){$jscomp$key$init=$jscomp$key$key.field;if($jscomp$key$key.timeUnit){$jscomp$key$init=model.vgField($jscomp$iter$86);var component={as:$jscomp$key$init,field:$jscomp$key$key.field,timeUnit:$jscomp$key$key.timeUnit};timeUnits[hash(component)]=component}parsed[$jscomp$key$init]||
(component="E","interval"===selCmpt.type?model.getScaleComponent($jscomp$iter$86).get("type")in CONTINUOUS_DOMAIN_INDEX&&(component="R"):$jscomp$key$key.bin&&(component="R-RE"),$jscomp$key$key={field:$jscomp$key$init,channel:$jscomp$iter$86,type:component},$jscomp$key$key.signals=Object.assign({},signalName($jscomp$key$key,"data"),signalName($jscomp$key$key,"visual")),proj.items.push(parsed[$jscomp$key$init]=$jscomp$key$key),proj.has[$jscomp$iter$86]=parsed[$jscomp$key$init])}else warn(message$jscomp$0.cannotProjectOnChannelWithoutField($jscomp$iter$86));
selDef.init&&(scaleBindings.has(selCmpt)?warn(message$jscomp$0.NO_INIT_SCALE_BINDINGS):(model=function(i){return proj.items.map(function(p){return void 0!==i[p.channel]?i[p.channel]:i[p.field]})},"interval"===selDef.type?selCmpt.init=model(selDef.init):(selDef=isArray(selDef.init)?selDef.init:[selDef.init],selCmpt.init=selDef.map(model))));keys(timeUnits).length&&(proj.timeUnit=new TimeUnitNode(null,timeUnits))},signals:function(model,selCmpt,allSignals){var name=selCmpt.name+"_tuple_fields";return allSignals.filter(function(s){return s.name===
name}).length?allSignals:allSignals.concat({name:name,value:selCmpt.project.items.map(function(proj){return __rest(proj,["signals"])})})}},toggle,scaleBindings,{has:function(selCmpt){return"interval"===selCmpt.type&&selCmpt.translate},signals:function(model,selCmpt,signals){var name=selCmpt.name,hasScales=scaleBindings.has(selCmpt),anchor=name+"_translate_anchor",$jscomp$destructuring$var90=selCmpt.project.has,x=$jscomp$destructuring$var90.x;$jscomp$destructuring$var90=$jscomp$destructuring$var90.y;
var events=parseSelector(selCmpt.translate,"scope");hasScales||(events=events.map(function(e){return e.between[0].markname=name+"_brush",e}));signals.push({name:anchor,value:{},on:[{events:events.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit)"+(void 0!==x?", extent_x: "+(hasScales?"domain("+$(model.scaleName("x"))+")":"slice("+x.signals.visual+")"):"")+(void 0!==$jscomp$destructuring$var90?", extent_y: "+(hasScales?"domain("+$(model.scaleName("y"))+")":"slice("+$jscomp$destructuring$var90.signals.visual+
")"):"")+"}"}]},{name:name+"_translate_delta",value:{},on:[{events:events,update:"{x: "+anchor+".x - x(unit), y: "+anchor+".y - y(unit)}"}]});void 0!==x&&onDelta(model,selCmpt,x,"width",signals);void 0!==$jscomp$destructuring$var90&&onDelta(model,selCmpt,$jscomp$destructuring$var90,"height",signals);return signals}},{has:function(selCmpt){return"interval"===selCmpt.type&&selCmpt.zoom},signals:function(model,selCmpt,signals){var name=selCmpt.name,hasScales=scaleBindings.has(selCmpt),delta=name+"_zoom_delta",
$jscomp$destructuring$var91=selCmpt.project.has,x=$jscomp$destructuring$var91.x;$jscomp$destructuring$var91=$jscomp$destructuring$var91.y;var sx=$(model.scaleName("x")),sy=$(model.scaleName("y")),events=parseSelector(selCmpt.zoom,"scope");hasScales||(events=events.map(function(e){return e.markname=name+"_brush",e}));signals.push({name:name+"_zoom_anchor",on:[{events:events,update:hasScales?"{"+[sx?"x: invert("+sx+", x(unit))":"",sy?"y: invert("+sy+", y(unit))":""].filter(function(expr){return!!expr}).join(", ")+
"}":"{x: x(unit), y: y(unit)}"}]},{name:delta,on:[{events:events,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]});void 0!==x&&onDelta$1(model,selCmpt,x,"width",signals);void 0!==$jscomp$destructuring$var91&&onDelta$1(model,selCmpt,$jscomp$destructuring$var91,"height",signals);return signals}},inputBindings,nearest,{has:function(selCmpt){return!1!==selCmpt.clear},parse:function(model,selDef,selCmpt){selDef.clear&&(selCmpt.clear=parseSelector(selDef.clear,"scope"))},topLevelSignals:function(model,
selCmpt,signals){inputBindings.has(selCmpt)&&selCmpt.project.items.forEach(function(proj){var idx=signals.findIndex(function(n){return n.name===varName(selCmpt.name+"_"+proj.field)});-1!==idx&&signals[idx].on.push({events:selCmpt.clear,update:"null"})});return signals},signals:function(model,selCmpt,signals){function addClear(idx,update){-1!==idx&&signals[idx].on&&signals[idx].on.push({events:selCmpt.clear,update:update})}"interval"===selCmpt.type?selCmpt.project.items.forEach(function(proj){var vIdx=
signals.findIndex(function(n){return n.name===proj.signals.visual});addClear(vIdx,"[0, 0]");-1===vIdx&&(vIdx=signals.findIndex(function(n){return n.name===proj.signals.data}),addClear(vIdx,"null"))}):(model=signals.findIndex(function(n){return n.name===selCmpt.name+"_tuple"}),addClear(model,"null"),toggle.has(selCmpt)&&(model=signals.findIndex(function(n){return n.name===selCmpt.name+"_toggle"}),addClear(model,"false")));return signals}}],Split=function(explicit,implicit){explicit=void 0===explicit?
{}:explicit;implicit=void 0===implicit?{}:implicit;this.explicit=explicit;this.implicit=implicit};Split.prototype.clone=function(){return new Split(duplicate(this.explicit),duplicate(this.implicit))};Split.prototype.combine=function(){return Object.assign({},this.explicit,this.implicit)};Split.prototype.get=function(key){return getFirstDefined(this.explicit[key],this.implicit[key])};Split.prototype.getWithExplicit=function(key){return void 0!==this.explicit[key]?{explicit:!0,value:this.explicit[key]}:
void 0!==this.implicit[key]?{explicit:!1,value:this.implicit[key]}:{explicit:!1,value:void 0}};Split.prototype.setWithExplicit=function(key,value){void 0!==value.value&&this.set(key,value.value,value.explicit)};Split.prototype.set=function(key,value,explicit){delete this[explicit?"implicit":"explicit"][key];this[explicit?"explicit":"implicit"][key]=value;return this};Split.prototype.copyKeyFromSplit=function(key,s){void 0!==s.explicit[key]?this.set(key,s.explicit[key],!0):void 0!==s.implicit[key]&&
this.set(key,s.implicit[key],!1)};Split.prototype.copyKeyFromObject=function(key,s){void 0!==s[key]&&this.set(key,s[key],!0)};Split.prototype.copyAll=function(other){for(var $jscomp$iter$94=$jscomp.makeIterator(keys(other.combine())),$jscomp$key$key=$jscomp$iter$94.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$94.next()){$jscomp$key$key=$jscomp$key$key.value;var val=other.getWithExplicit($jscomp$key$key);this.setWithExplicit($jscomp$key$key,val)}};var LegendComponent=function(var_args){return Split.apply(this,
arguments)||this};$jscomp.inherits(LegendComponent,Split);var encode=Object.freeze({symbols:function(fieldDef,symbolsSpec,model,channel,legendCmp){if("symbol"===type$1(legendCmp,model,channel)){fieldDef=Object.assign({},applyMarkConfig({},model,FILL_STROKE_CONFIG),color$jscomp$0(model));var markDef=model.markDef,encoding=model.encoding,config=model.config,filled=markDef.filled;model=getMaxValue(encoding.opacity)||markDef.opacity;fieldDef.fill&&("fill"===channel||filled&&"color"===channel?delete fieldDef.fill:
fieldDef.fill.field?legendCmp.get("symbolFillColor")?delete fieldDef.fill:(fieldDef.fill={value:config.legend.symbolBaseFillColor||"black"},fieldDef.fillOpacity={value:model||1}):isArray(fieldDef.fill)&&(legendCmp=getFirstConditionValue(encoding.fill||encoding.color)||markDef.fill||filled&&markDef.color)&&(fieldDef.fill={value:legendCmp}));fieldDef.stroke&&("stroke"===channel||!filled&&"color"===channel?delete fieldDef.stroke:fieldDef.stroke.field?delete fieldDef.stroke:isArray(fieldDef.stroke)&&
(legendCmp=getFirstDefined(getFirstConditionValue(encoding.stroke||encoding.color),markDef.stroke,filled?markDef.color:void 0))&&(fieldDef.stroke={value:legendCmp}));"opacity"!==channel&&model&&(fieldDef.opacity={value:model});fieldDef=Object.assign({},fieldDef,symbolsSpec);return 0<keys(fieldDef).length?fieldDef:void 0}},gradient:function(fieldDef,gradientSpec,model,channel,legendCmp){if("gradient"===type$1(legendCmp,model,channel)){fieldDef={};if(model=getMaxValue(model.encoding.opacity)||model.markDef.opacity)fieldDef.opacity=
{value:model};fieldDef=Object.assign({},fieldDef,gradientSpec);return 0<keys(fieldDef).length?fieldDef:void 0}},labels:function(fieldDef,labelsSpec,model,channel){var legend=model.legend(channel),config=model.config,out={};isTimeFormatFieldDef(fieldDef)&&(model=model.getScaleComponent(channel).get("type")===ScaleType.UTC,fieldDef=timeFormatExpression("datum.value",fieldDef.timeUnit,legend.format,config.legend.shortTimeLabels,config.timeFormat,model),labelsSpec=Object.assign({},fieldDef?{text:{signal:fieldDef}}:
{},labelsSpec));out=Object.assign({},out,labelsSpec);return 0<keys(out).length?out:void 0},getFirstConditionValue:getFirstConditionValue}),PROJECTION_PROPERTIES="type clipAngle clipExtent center rotate precision reflectX reflectY coefficient distance fraction lobes parallel radius ratio spacing tilt".split(" "),ProjectionComponent=function(name,specifiedProjection,size,data){name=Split.call(this,Object.assign({},specifiedProjection),{name:name})||this;name.specifiedProjection=specifiedProjection;
name.size=size;name.data=data;name.merged=!1;return name};$jscomp.inherits(ProjectionComponent,Split);$jscomp.global.Object.defineProperties(ProjectionComponent.prototype,{isFit:{configurable:!0,enumerable:!0,get:function(){return!!this.data}}});var BinNode=function(parent,bins){parent=DataFlowNode.call(this,parent)||this;parent.bins=bins;return parent};$jscomp.inherits(BinNode,DataFlowNode);BinNode.prototype.clone=function(){return new BinNode(null,duplicate(this.bins))};BinNode.makeFromEncoding=
function(parent,model){var bins=model.reduceFieldDef(function(binComponentIndex,fieldDef,channel){if(isTypedFieldDef(fieldDef)&&isBinning(fieldDef.bin)){var $jscomp$destructuring$var140=createBinComponent(fieldDef,fieldDef.bin,model),key=$jscomp$destructuring$var140.key;binComponentIndex[key]=Object.assign({},$jscomp$destructuring$var140.binComponent,binComponentIndex[key],rangeFormula(model,fieldDef,channel,model.config))}return binComponentIndex},{});return 0===keys(bins).length?null:new BinNode(parent,
bins)};BinNode.makeFromTransform=function(parent,t,model){t=createBinComponent(t,t.bin,model);model={};return new BinNode(parent,(model[t.key]=t.binComponent,model))};BinNode.prototype.merge=function(other,renameSignal){for(var $jscomp$iter$101=$jscomp.makeIterator(keys(other.bins)),$jscomp$key$key=$jscomp$iter$101.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$101.next())$jscomp$key$key=$jscomp$key$key.value,$jscomp$key$key in this.bins?(renameSignal(other.bins[$jscomp$key$key].signal,
this.bins[$jscomp$key$key].signal),this.bins[$jscomp$key$key].as=unique([].concat($jscomp.arrayFromIterable(this.bins[$jscomp$key$key].as),$jscomp.arrayFromIterable(other.bins[$jscomp$key$key].as)),hash)):this.bins[$jscomp$key$key]=other.bins[$jscomp$key$key];renameSignal=$jscomp.makeIterator(other.children);for($jscomp$iter$101=renameSignal.next();!$jscomp$iter$101.done;$jscomp$iter$101=renameSignal.next())$jscomp$iter$101=$jscomp$iter$101.value,other.removeChild($jscomp$iter$101),$jscomp$iter$101.parent=
this;other.remove()};BinNode.prototype.producedFields=function(){return new Set(flatten(flatten(vals(this.bins).map(function(c){return c.as}))))};BinNode.prototype.dependentFields=function(){return new Set(vals(this.bins).map(function(c){return c.field}))};BinNode.prototype.hash=function(){return"Bin "+hash(this.bins)};BinNode.prototype.assemble=function(){return flatten(vals(this.bins).map(function(bin){var transform=[],$jscomp$destructuring$var142=$jscomp.makeIterator(bin.as),binAs=$jscomp$destructuring$var142.next().value;
$jscomp$destructuring$var142=$jscomp.arrayFromIterator($jscomp$destructuring$var142);var binTrans=Object.assign({type:"bin",field:replacePathInField(bin.field),as:binAs,signal:bin.signal},bin.bin);!bin.bin.extent&&bin.extentSignal&&(transform.push({type:"extent",field:replacePathInField(bin.field),signal:bin.extentSignal}),binTrans.extent={signal:bin.extentSignal});transform.push(binTrans);$jscomp$destructuring$var142=$jscomp.makeIterator($jscomp$destructuring$var142);for(binTrans=$jscomp$destructuring$var142.next();!binTrans.done;binTrans=
$jscomp$destructuring$var142.next()){binTrans=binTrans.value;for(var i=0;2>i;i++)transform.push({type:"formula",expr:vgField({field:binAs[i]},{expr:"datum"}),as:binTrans[i]})}bin.formula&&transform.push({type:"formula",expr:bin.formula,as:bin.formulaAs});return transform}))};var SourceNode=function(data){var $jscomp$super$this=DataFlowNode.call(this,null)||this;data=data||{name:"source"};var format;isGenerator(data)||(format=data.format?Object.assign({},omit(data.format,["parse"])):{});if(data.values)$jscomp$super$this._data=
{values:data.values};else if(data.url){if($jscomp$super$this._data={url:data.url},!format.type){var defaultExtension=/(?:\.([^.]+))?$/.exec(data.url)[1];contains(["json","csv","tsv","dsv","topojson"],defaultExtension)||(defaultExtension="json");format.type=defaultExtension}}else if(data.sphere)$jscomp$super$this._data={values:[{type:"Sphere"}]};else if(isNamedData(data)||isGenerator(data))$jscomp$super$this._data={};$jscomp$super$this._generator=isGenerator(data);data.name&&($jscomp$super$this._name=
data.name);format&&0<keys(format).length&&($jscomp$super$this._data.format=format);return $jscomp$super$this};$jscomp.inherits(SourceNode,DataFlowNode);SourceNode.prototype.hasName=function(){return!!this._name};SourceNode.prototype.remove=function(){throw Error("Source nodes are roots and cannot be removed.");};SourceNode.prototype.hash=function(){throw Error("Cannot hash sources");};SourceNode.prototype.assemble=function(){return Object.assign({name:this._name},this._data,{transform:[]})};$jscomp.global.Object.defineProperties(SourceNode.prototype,
{data:{configurable:!0,enumerable:!0,get:function(){return this._data}},isGenerator:{configurable:!0,enumerable:!0,get:function(){return this._generator}},dataName:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(name){this._name=name}},parent:{configurable:!0,enumerable:!0,set:function(parent){throw Error("Source nodes have to be roots.");}}});var GraticuleNode=function(parent,params){parent=DataFlowNode.call(this,parent)||this;parent.params=params;return parent};$jscomp.inherits(GraticuleNode,
DataFlowNode);GraticuleNode.prototype.clone=function(){return new GraticuleNode(null,this.params)};GraticuleNode.prototype.assemble=function(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)};var SequenceNode=function(parent,params){parent=DataFlowNode.call(this,parent)||this;parent.params=params;return parent};$jscomp.inherits(SequenceNode,DataFlowNode);SequenceNode.prototype.clone=function(){return new SequenceNode(null,this.params)};SequenceNode.prototype.producedFields=
function(){return new Set([this.params.as||"data"])};SequenceNode.prototype.assemble=function(){return Object.assign({type:"sequence"},this.params)};var OptimizerBase=function(){this._mutated=!1};OptimizerBase.prototype.setMutated=function(){this._mutated=!0};$jscomp.global.Object.defineProperties(OptimizerBase.prototype,{mutatedFlag:{configurable:!0,enumerable:!0,get:function(){return this._mutated}}});var BottomUpOptimizer=function(){this._continue=this._mutated=!1;return this};$jscomp.inherits(BottomUpOptimizer,
OptimizerBase);BottomUpOptimizer.prototype.setContinue=function(){this._continue=!0};BottomUpOptimizer.prototype.reset=function(){};BottomUpOptimizer.prototype.optimizeNextFromLeaves=function(node){if(isDataSourceNode(node))return!1;var next=node.parent;this.run(node).continueFlag&&this.optimizeNextFromLeaves(next);return this.mutatedFlag};$jscomp.global.Object.defineProperties(BottomUpOptimizer.prototype,{continueFlag:{configurable:!0,enumerable:!0,get:function(){return this._continue}},flags:{configurable:!0,
enumerable:!0,get:function(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}},set:function($jscomp$destructuring$var143){var mutatedFlag=$jscomp$destructuring$var143.mutatedFlag;$jscomp$destructuring$var143.continueFlag&&this.setContinue();mutatedFlag&&this.setMutated()}}});var TopDownOptimizer=function(var_args){return OptimizerBase.apply(this,arguments)||this};$jscomp.inherits(TopDownOptimizer,OptimizerBase);var AggregateNode=function(parent,dimensions,measures){parent=DataFlowNode.call(this,
parent)||this;parent.dimensions=dimensions;parent.measures=measures;return parent};$jscomp.inherits(AggregateNode,DataFlowNode);AggregateNode.prototype.clone=function(){return new AggregateNode(null,new Set(this.dimensions),duplicate(this.measures))};AggregateNode.makeFromEncoding=function(parent,model){var isAggregate=!1;model.forEachFieldDef(function(fd){fd.aggregate&&(isAggregate=!0)});var meas={},dims=new Set;if(!isAggregate)return null;model.forEachFieldDef(function(fieldDef,channel){var aggregate=
fieldDef.aggregate,field=fieldDef.field;aggregate?"count"===aggregate?(meas["*"]=meas["*"]||{},meas["*"].count=new Set([vgField(fieldDef,{forAs:!0})])):(isArgminDef(aggregate)||isArgmaxDef(aggregate)?(fieldDef=isArgminDef(aggregate)?"argmin":"argmax",aggregate=aggregate[fieldDef],meas[aggregate]=meas[aggregate]||{},meas[aggregate][fieldDef]=new Set([vgField({op:fieldDef,field:aggregate},{forAs:!0})])):(meas[field]=meas[field]||{},meas[field][aggregate]=new Set([vgField(fieldDef,{forAs:!0})])),SCALE_CHANNEL_INDEX[channel]&&
"unaggregated"===model.scaleDomain(channel)&&(meas[field]=meas[field]||{},meas[field].min=new Set([vgField({field:field,aggregate:"min"},{forAs:!0})]),meas[field].max=new Set([vgField({field:field,aggregate:"max"},{forAs:!0})]))):isTypedFieldDef(fieldDef)&&isBinning(fieldDef.bin)?(dims.add(vgField(fieldDef,{})),dims.add(vgField(fieldDef,{binSuffix:"end"})),binRequiresRange(fieldDef,channel)&&dims.add(vgField(fieldDef,{binSuffix:"range"}))):channel in GEOPOSITION_CHANNEL_INDEX?(channel=getPositionChannelFromLatLong(channel),
dims.add(model.getName(channel))):dims.add(vgField(fieldDef))});return 0===dims.size+keys(meas).length?null:new AggregateNode(parent,dims,meas)};AggregateNode.makeFromTransform=function(parent,t){for(var dims=new Set,meas={},$jscomp$iter$108=$jscomp.makeIterator(t.aggregate),$jscomp$key$s=$jscomp$iter$108.next();!$jscomp$key$s.done;$jscomp$key$s=$jscomp$iter$108.next()){var $jscomp$destructuring$var147=$jscomp$key$s=$jscomp$key$s.value,op=$jscomp$destructuring$var147.op,field$251=$jscomp$destructuring$var147.field;
$jscomp$destructuring$var147=$jscomp$destructuring$var147.as;op&&("count"===op?(meas["*"]=meas["*"]||{},meas["*"].count=new Set([$jscomp$destructuring$var147?$jscomp$destructuring$var147:vgField($jscomp$key$s,{forAs:!0})])):(meas[field$251]=meas[field$251]||{},meas[field$251][op]=new Set([$jscomp$destructuring$var147?$jscomp$destructuring$var147:vgField($jscomp$key$s,{forAs:!0})])))}t=$jscomp.makeIterator(t.groupby||[]);for($jscomp$key$s=t.next();!$jscomp$key$s.done;$jscomp$key$s=t.next())dims.add($jscomp$key$s.value);
return 0===dims.size+keys(meas).length?null:new AggregateNode(parent,dims,meas)};AggregateNode.prototype.merge=function(other){a:{var a=this.dimensions;var JSCompiler_inline_result=other.dimensions;if(a.size!==JSCompiler_inline_result.size)JSCompiler_inline_result=!1;else{a=$jscomp.makeIterator(a);for(var $jscomp$inline_960=a.next();!$jscomp$inline_960.done;$jscomp$inline_960=a.next())if(!JSCompiler_inline_result.has($jscomp$inline_960.value)){JSCompiler_inline_result=!1;break a}JSCompiler_inline_result=
!0}}if(JSCompiler_inline_result){JSCompiler_inline_result=this.measures;other=other.measures;a=$jscomp.makeIterator(keys(other));for($jscomp$inline_960=a.next();!$jscomp$inline_960.done;$jscomp$inline_960=a.next()){$jscomp$inline_960=$jscomp$inline_960.value;for(var ops=other[$jscomp$inline_960],$jscomp$inline_969=$jscomp.makeIterator(keys(ops)),$jscomp$inline_970=$jscomp$inline_969.next();!$jscomp$inline_970.done;$jscomp$inline_970=$jscomp$inline_969.next())if($jscomp$inline_970=$jscomp$inline_970.value,
$jscomp$inline_960 in JSCompiler_inline_result)JSCompiler_inline_result[$jscomp$inline_960][$jscomp$inline_970]=new Set([].concat($jscomp.arrayFromIterable(JSCompiler_inline_result[$jscomp$inline_960][$jscomp$inline_970]||[]),$jscomp.arrayFromIterable(ops[$jscomp$inline_970])));else{var $jscomp$inline_972={};JSCompiler_inline_result[$jscomp$inline_960]=($jscomp$inline_972[$jscomp$inline_970]=ops[$jscomp$inline_970],$jscomp$inline_972)}}return!0}debug("different dimensions, cannot merge");return!1};
AggregateNode.prototype.addDimensions=function(fields){fields.forEach(this.dimensions.add,this.dimensions)};AggregateNode.prototype.dependentFields=function(){return new Set([].concat($jscomp.arrayFromIterable(this.dimensions),$jscomp.arrayFromIterable(keys(this.measures))))};AggregateNode.prototype.producedFields=function(){for(var out=new Set,$jscomp$iter$111=$jscomp.makeIterator(keys(this.measures)),$jscomp$key$field=$jscomp$iter$111.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$111.next()){$jscomp$key$field=
$jscomp$key$field.value;for(var $jscomp$iter$110=$jscomp.makeIterator(keys(this.measures[$jscomp$key$field])),$jscomp$key$op=$jscomp$iter$110.next();!$jscomp$key$op.done;$jscomp$key$op=$jscomp$iter$110.next()){$jscomp$key$op=$jscomp$key$op.value;var m=this.measures[$jscomp$key$field][$jscomp$key$op];0===m.size?out.add($jscomp$key$op+"_"+$jscomp$key$field):m.forEach(out.add,out)}}return out};AggregateNode.prototype.hash=function(){return"Aggregate "+hash({dimensions:this.dimensions,measures:this.measures})};
AggregateNode.prototype.assemble=function(){for(var ops=[],fields=[],as=[],$jscomp$iter$114=$jscomp.makeIterator(keys(this.measures)),$jscomp$key$field=$jscomp$iter$114.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$114.next()){$jscomp$key$field=$jscomp$key$field.value;for(var $jscomp$iter$113=$jscomp.makeIterator(keys(this.measures[$jscomp$key$field])),$jscomp$key$op=$jscomp$iter$113.next();!$jscomp$key$op.done;$jscomp$key$op=$jscomp$iter$113.next()){$jscomp$key$op=$jscomp$key$op.value;
for(var $jscomp$iter$112=$jscomp.makeIterator(this.measures[$jscomp$key$field][$jscomp$key$op]),$jscomp$key$alias=$jscomp$iter$112.next();!$jscomp$key$alias.done;$jscomp$key$alias=$jscomp$iter$112.next())as.push($jscomp$key$alias.value),ops.push($jscomp$key$op),fields.push("*"===$jscomp$key$field?null:replacePathInField($jscomp$key$field))}}return{type:"aggregate",groupby:[].concat($jscomp.arrayFromIterable(this.dimensions)),ops:ops,fields:fields,as:as}};$jscomp.global.Object.defineProperties(AggregateNode.prototype,
{groupBy:{configurable:!0,enumerable:!0,get:function(){return this.dimensions}}});var FacetNode=function(parent,model,name,data){parent=DataFlowNode.call(this,parent)||this;parent.model=model;parent.name=name;parent.data=data;name=$jscomp.makeIterator(FACET_CHANNELS);for(data=name.next();!data.done;data=name.next()){data=data.value;var fieldDef=model.facet[data];if(fieldDef){var $jscomp$destructuring$var148=fieldDef,bin$255=$jscomp$destructuring$var148.bin;$jscomp$destructuring$var148=$jscomp$destructuring$var148.sort;
parent[data]=Object.assign({name:model.getName(data+"_domain"),fields:[vgField(fieldDef)].concat($jscomp.arrayFromIterable(isBinning(bin$255)?[vgField(fieldDef,{binSuffix:"end"})]:[]))},isSortField($jscomp$destructuring$var148)?{sortField:$jscomp$destructuring$var148}:isArray($jscomp$destructuring$var148)?{sortIndexField:sortArrayIndexField(fieldDef,data)}:{})}}parent.childModel=model.child;return parent};$jscomp.inherits(FacetNode,DataFlowNode);FacetNode.prototype.hash=function(){for(var out="Facet",
$jscomp$iter$116=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$116.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$116.next())$jscomp$key$channel=$jscomp$key$channel.value,this[$jscomp$key$channel]&&(out+=" "+$jscomp$key$channel.charAt(0)+":"+hash(this[$jscomp$key$channel]));return out};FacetNode.prototype.getSource=function(){return this.name};FacetNode.prototype.getChildIndependentFieldsWithStep=function(){for(var childIndependentFieldsWithStep={},$jscomp$iter$117=
$jscomp.makeIterator(["x","y"]),$jscomp$key$channel=$jscomp$iter$117.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$117.next()){$jscomp$key$channel=$jscomp$key$channel.value;var childScaleComponent=this.childModel.component.scales[$jscomp$key$channel];if(childScaleComponent&&!childScaleComponent.merged){var type$256=childScaleComponent.get("type");childScaleComponent=childScaleComponent.get("range");type$256 in DISCRETE_DOMAIN_INDEX&&isVgRangeStep(childScaleComponent)&&(type$256=
assembleDomain(this.childModel,$jscomp$key$channel),(type$256=getFieldFromDomain(type$256))?childIndependentFieldsWithStep[$jscomp$key$channel]=type$256:warn("Unknown field for ${channel}.  Cannot calculate view size."))}}return childIndependentFieldsWithStep};FacetNode.prototype.assembleRowColumnHeaderData=function(channel,crossedDataName,childIndependentFieldsWithStep){var childChannel={row:"y",column:"x"}[channel],fields=[],ops=[],as=[];childIndependentFieldsWithStep&&childIndependentFieldsWithStep[childChannel]&&
(crossedDataName?(fields.push("distinct_"+childIndependentFieldsWithStep[childChannel]),ops.push("max")):(fields.push(childIndependentFieldsWithStep[childChannel]),ops.push("distinct")),as.push("distinct_"+childIndependentFieldsWithStep[childChannel]));childChannel=this[channel];childIndependentFieldsWithStep=childChannel.sortField;childChannel=childChannel.sortIndexField;childIndependentFieldsWithStep?(childChannel=void 0===childIndependentFieldsWithStep.op?"mean":childIndependentFieldsWithStep.op,
fields.push(childIndependentFieldsWithStep.field),ops.push(childChannel),as.push(vgField(childIndependentFieldsWithStep,{forAs:!0}))):childChannel&&(fields.push(childChannel),ops.push("max"),as.push(childChannel));return{name:this[channel].name,source:crossedDataName||this.data,transform:[Object.assign({type:"aggregate",groupby:this[channel].fields},fields.length?{fields:fields,ops:ops,as:as}:{})]}};FacetNode.prototype.assembleFacetHeaderData=function(childIndependentFieldsWithStep){for(var columns=
this.model.layout.columns,layoutHeaders=this.model.component.layoutHeaders,data=[],hasSharedAxis={},$jscomp$iter$120=$jscomp.makeIterator(HEADER_CHANNELS),$jscomp$key$headerChannel=$jscomp$iter$120.next();!$jscomp$key$headerChannel.done;$jscomp$key$headerChannel=$jscomp$iter$120.next()){$jscomp$key$headerChannel=$jscomp$key$headerChannel.value;for(var $jscomp$iter$119=$jscomp.makeIterator(HEADER_TYPES),$jscomp$key$headerType=$jscomp$iter$119.next();!$jscomp$key$headerType.done;$jscomp$key$headerType=
$jscomp$iter$119.next()){$jscomp$key$headerType=$jscomp$key$headerType.value;$jscomp$key$headerType=$jscomp.makeIterator(layoutHeaders[$jscomp$key$headerChannel]&&layoutHeaders[$jscomp$key$headerChannel][$jscomp$key$headerType]||[]);for(var $jscomp$key$header=$jscomp$key$headerType.next();!$jscomp$key$header.done;$jscomp$key$header=$jscomp$key$headerType.next())if($jscomp$key$header=$jscomp$key$header.value,$jscomp$key$header.axes&&0<$jscomp$key$header.axes.length){hasSharedAxis[$jscomp$key$headerChannel]=
!0;break}}hasSharedAxis[$jscomp$key$headerChannel]&&($jscomp$iter$119='length(data("'+this.facet.name+'"))',data.push({name:this.facet.name+"_"+$jscomp$key$headerChannel,transform:[{type:"sequence",start:0,stop:"row"===$jscomp$key$headerChannel?columns?{signal:"ceil("+$jscomp$iter$119+" / "+columns+")"}:1:columns?{signal:"min("+$jscomp$iter$119+", "+columns+")"}:{signal:$jscomp$iter$119}}]}))}columns=hasSharedAxis.column;(hasSharedAxis.row||columns)&&data.unshift(this.assembleRowColumnHeaderData("facet",
null,childIndependentFieldsWithStep));return data};FacetNode.prototype.assemble=function(){var data=[],crossedDataName=null,childIndependentFieldsWithStep=this.getChildIndependentFieldsWithStep(),row=this.row,facet=this.facet;if(this.column&&row&&(childIndependentFieldsWithStep.x||childIndependentFieldsWithStep.y)){crossedDataName="cross_"+this.column.name+"_"+this.row.name;row=[].concat(childIndependentFieldsWithStep.x||[],childIndependentFieldsWithStep.y||[]);var ops=row.map(function(){return"distinct"});
data.push({name:crossedDataName,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:row,ops:ops}]})}row=$jscomp.makeIterator(["column","row"]);for(ops=row.next();!ops.done;ops=row.next())ops=ops.value,this[ops]&&data.push(this.assembleRowColumnHeaderData(ops,crossedDataName,childIndependentFieldsWithStep));facet&&(crossedDataName=this.assembleFacetHeaderData(childIndependentFieldsWithStep))&&data.push.apply(data,$jscomp.arrayFromIterable(crossedDataName));return data};$jscomp.global.Object.defineProperties(FacetNode.prototype,
{fields:{configurable:!0,enumerable:!0,get:function(){for(var f=[],$jscomp$iter$122=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$122.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$122.next())$jscomp$key$channel=$jscomp$key$channel.value,this[$jscomp$key$channel]&&this[$jscomp$key$channel].fields&&f.push.apply(f,$jscomp.arrayFromIterable(this[$jscomp$key$channel].fields));return f}}});var FilterNode=function(parent,model,filter){parent=DataFlowNode.call(this,
parent)||this;parent.model=model;parent.filter=filter;parent.expr=expression$jscomp$0(parent.model,parent.filter,parent);parent._dependentFields=getDependentFields(parent.expr);return parent};$jscomp.inherits(FilterNode,DataFlowNode);FilterNode.prototype.clone=function(){return new FilterNode(null,this.model,duplicate(this.filter))};FilterNode.prototype.dependentFields=function(){return this._dependentFields};FilterNode.prototype.assemble=function(){return{type:"filter",expr:this.expr}};FilterNode.prototype.hash=
function(){return"Filter "+this.expr};var ParseNode=function(parent,parse){parent=DataFlowNode.call(this,parent)||this;parent._parse=parse;return parent};$jscomp.inherits(ParseNode,DataFlowNode);ParseNode.prototype.clone=function(){return new ParseNode(null,duplicate(this._parse))};ParseNode.prototype.hash=function(){return"Parse "+hash(this._parse)};ParseNode.makeExplicit=function(parent,model,ancestorParse){var explicit={};model=model.data;!isGenerator(model)&&model&&model.format&&model.format.parse&&
(explicit=model.format.parse);return this.makeWithAncestors(parent,explicit,{},ancestorParse)};ParseNode.makeImplicitFromFilterTransform=function(parent,transform,ancestorParse){var parse={};forEachLeaf(transform.filter,function(filter){if(isFieldPredicate(filter)){var val=null;isFieldEqualPredicate(filter)?val=filter.equal:isFieldRangePredicate(filter)?val=filter.range[0]:isFieldOneOfPredicate(filter)&&(val=(filter.oneOf||filter["in"])[0]);val&&(isDateTime(val)?parse[filter.field]="date":isNumber(val)?
parse[filter.field]="number":isString(val)&&(parse[filter.field]="string"));filter.timeUnit&&(parse[filter.field]="date")}});return 0===keys(parse).length?null:this.makeWithAncestors(parent,{},parse,ancestorParse)};ParseNode.makeImplicitFromEncoding=function(parent,model,ancestorParse){function add(fieldDef){if(isTimeFormatFieldDef(fieldDef))implicit[fieldDef.field]="date";else{var JSCompiler_temp;if(JSCompiler_temp="quantitative"===fieldDef.type)JSCompiler_temp=(JSCompiler_temp=fieldDef.aggregate)&&
isString(JSCompiler_temp)&&contains(["min","max"],JSCompiler_temp);JSCompiler_temp?implicit[fieldDef.field]="number":1<accessPathDepth(fieldDef.field)?fieldDef.field in implicit||(implicit[fieldDef.field]="flatten"):isScaleFieldDef(fieldDef)&&isSortField(fieldDef.sort)&&1<accessPathDepth(fieldDef.sort.field)&&(fieldDef.sort.field in implicit||(implicit[fieldDef.sort.field]="flatten"))}}var implicit={};(isUnitModel(model)||isFacetModel(model))&&model.forEachFieldDef(function(fieldDef,channel){isTypedFieldDef(fieldDef)?
add(fieldDef):(channel=getMainRangeChannel(channel),channel=model.fieldDef(channel),add(Object.assign({},fieldDef,{type:channel.type})))});if(isUnitModel(model)){var markDef=model.markDef,encoding=model.encoding;isPathMark(model.mark)&&!model.encoding.order&&(markDef=encoding["horizontal"===markDef.orient?"y":"x"],!isFieldDef(markDef)||"quantitative"!==markDef.type||markDef.field in implicit||(implicit[markDef.field]="number"))}return this.makeWithAncestors(parent,{},implicit,ancestorParse)};ParseNode.makeWithAncestors=
function(parent,explicit,implicit,ancestorParse){for(var $jscomp$iter$123=$jscomp.makeIterator(keys(implicit)),$jscomp$key$field=$jscomp$iter$123.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$123.next()){$jscomp$key$field=$jscomp$key$field.value;var parsedAs=ancestorParse.getWithExplicit($jscomp$key$field);void 0!==parsedAs.value&&(parsedAs.explicit||parsedAs.value===implicit[$jscomp$key$field]||"derived"===parsedAs.value||"flatten"===implicit[$jscomp$key$field]?delete implicit[$jscomp$key$field]:
warn(message$jscomp$0.differentParse($jscomp$key$field,implicit[$jscomp$key$field],parsedAs.value)))}$jscomp$iter$123=$jscomp.makeIterator(keys(explicit));for($jscomp$key$field=$jscomp$iter$123.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$123.next())$jscomp$key$field=$jscomp$key$field.value,parsedAs=ancestorParse.get($jscomp$key$field),void 0!==parsedAs&&(parsedAs===explicit[$jscomp$key$field]?delete explicit[$jscomp$key$field]:warn(message$jscomp$0.differentParse($jscomp$key$field,
explicit[$jscomp$key$field],parsedAs)));explicit=new Split(explicit,implicit);ancestorParse.copyAll(explicit);implicit={};$jscomp$iter$123=$jscomp.makeIterator(keys(explicit.combine()));for($jscomp$key$field=$jscomp$iter$123.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$123.next())$jscomp$key$field=$jscomp$key$field.value,parsedAs=explicit.get($jscomp$key$field),null!==parsedAs&&(implicit[$jscomp$key$field]=parsedAs);return 0===keys(implicit).length||ancestorParse.parseNothing?null:
new ParseNode(parent,implicit)};ParseNode.prototype.merge=function(other){this._parse=Object.assign({},this._parse,other.parse);other.remove()};ParseNode.prototype.assembleFormatParse=function(){for(var formatParse={},$jscomp$iter$126=$jscomp.makeIterator(keys(this._parse)),$jscomp$key$field=$jscomp$iter$126.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$126.next()){$jscomp$key$field=$jscomp$key$field.value;var p=this._parse[$jscomp$key$field];1===accessPathDepth($jscomp$key$field)&&
(formatParse[$jscomp$key$field]=p)}return formatParse};ParseNode.prototype.producedFields=function(){return new Set(keys(this._parse))};ParseNode.prototype.dependentFields=function(){return new Set(keys(this._parse))};ParseNode.prototype.assembleTransforms=function(onlyNested){var $jscomp$this=this;onlyNested=void 0===onlyNested?!1:onlyNested;return keys(this._parse).filter(function(field){return onlyNested?1<accessPathDepth(field):!0}).map(function(field){var expr=parseExpression$1(field,$jscomp$this._parse[field]);
return expr?{type:"formula",expr:expr,as:""+splitAccessPath(field).join(".")}:null}).filter(function(t){return null!==t})};$jscomp.global.Object.defineProperties(ParseNode.prototype,{parse:{configurable:!0,enumerable:!0,get:function(){return this._parse}}});var JoinAggregateTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;return parent};$jscomp.inherits(JoinAggregateTransformNode,DataFlowNode);JoinAggregateTransformNode.prototype.clone=
function(){return new JoinAggregateTransformNode(null,duplicate(this.transform))};JoinAggregateTransformNode.prototype.addDimensions=function(fields){this.transform.groupby=unique(this.transform.groupby.concat(fields),function(d){return d})};JoinAggregateTransformNode.prototype.dependentFields=function(){var out=new Set;this.transform.groupby&&this.transform.groupby.forEach(function(f){return out.add(f)});this.transform.joinaggregate.map(function(w){return w.field}).filter(function(f){return void 0!==
f}).forEach(function(f){return out.add(f)});return out};JoinAggregateTransformNode.prototype.producedFields=function(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))};JoinAggregateTransformNode.prototype.getDefaultName=function(joinAggregateFieldDef){return joinAggregateFieldDef.as||vgField(joinAggregateFieldDef)};JoinAggregateTransformNode.prototype.hash=function(){return"JoinAggregateTransform "+hash(this.transform)};JoinAggregateTransformNode.prototype.assemble=function(){for(var fields=
[],ops=[],as=[],$jscomp$iter$127=$jscomp.makeIterator(this.transform.joinaggregate),$jscomp$key$joinaggregate=$jscomp$iter$127.next();!$jscomp$key$joinaggregate.done;$jscomp$key$joinaggregate=$jscomp$iter$127.next())$jscomp$key$joinaggregate=$jscomp$key$joinaggregate.value,ops.push($jscomp$key$joinaggregate.op),as.push(this.getDefaultName($jscomp$key$joinaggregate)),fields.push(void 0===$jscomp$key$joinaggregate.field?null:$jscomp$key$joinaggregate.field);$jscomp$iter$127=this.transform.groupby;return Object.assign({type:"joinaggregate",
as:as,ops:ops,fields:fields},void 0!==$jscomp$iter$127?{groupby:$jscomp$iter$127}:{})};var StackNode=function(parent,stack){parent=DataFlowNode.call(this,parent)||this;parent._stack=stack;return parent};$jscomp.inherits(StackNode,DataFlowNode);StackNode.prototype.clone=function(){return new StackNode(null,duplicate(this._stack))};StackNode.makeFromTransform=function(parent,stackTransform){var stack=stackTransform.stack,groupby=stackTransform.groupby,as=stackTransform.as,offset=void 0===stackTransform.offset?
"zero":stackTransform.offset,sortFields=[],sortOrder=[];if(void 0!==stackTransform.sort)for(var $jscomp$iter$128=$jscomp.makeIterator(stackTransform.sort),$jscomp$key$sortField=$jscomp$iter$128.next();!$jscomp$key$sortField.done;$jscomp$key$sortField=$jscomp$iter$128.next())$jscomp$key$sortField=$jscomp$key$sortField.value,sortFields.push($jscomp$key$sortField.field),sortOrder.push(getFirstDefined($jscomp$key$sortField.order,"ascending"));sortFields={field:sortFields,order:sortOrder};stackTransform=
isValidAsArray(as)?as:isString(as)?[as,as+"_end"]:[stackTransform.stack+"_start",stackTransform.stack+"_end"];return new StackNode(parent,{stackField:stack,groupby:groupby,offset:offset,sort:sortFields,facetby:[],as:stackTransform})};StackNode.makeFromEncoding=function(parent,model){var stackProperties=model.stack,encoding=model.encoding;if(!stackProperties)return null;var dimensionFieldDef;stackProperties.groupbyChannel&&(dimensionFieldDef=getTypedFieldDef(encoding[stackProperties.groupbyChannel]));
encoding=getStackByFields(model);var orderDef=model.encoding.order;orderDef=isArray(orderDef)||isFieldDef(orderDef)?sortParams(orderDef):encoding.reduce(function(s,field){s.field.push(field);s.order.push("descending");return s},{field:[],order:[]});return new StackNode(parent,{dimensionFieldDef:dimensionFieldDef,stackField:model.vgField(stackProperties.fieldChannel),facetby:[],stackby:encoding,sort:orderDef,offset:stackProperties.offset,impute:stackProperties.impute,as:[model.vgField(stackProperties.fieldChannel,
{suffix:"start",forAs:!0}),model.vgField(stackProperties.fieldChannel,{suffix:"end",forAs:!0})]})};StackNode.prototype.addDimensions=function(fields){this._stack.facetby.push.apply(this._stack.facetby,$jscomp.arrayFromIterable(fields))};StackNode.prototype.dependentFields=function(){var out=new Set;out.add(this._stack.stackField);this.getGroupbyFields().forEach(function(f){return out.add(f)});this._stack.facetby.forEach(function(f){return out.add(f)});this._stack.sort.field.forEach(function(f){return out.add(f)});
return out};StackNode.prototype.producedFields=function(){return new Set(this._stack.as)};StackNode.prototype.hash=function(){return"Stack "+hash(this._stack)};StackNode.prototype.getGroupbyFields=function(){var $jscomp$destructuring$var158=this._stack,dimensionFieldDef=$jscomp$destructuring$var158.dimensionFieldDef,impute=$jscomp$destructuring$var158.impute;$jscomp$destructuring$var158=$jscomp$destructuring$var158.groupby;return dimensionFieldDef?dimensionFieldDef.bin?impute?[vgField(dimensionFieldDef,
{binSuffix:"mid"})]:[vgField(dimensionFieldDef,{}),vgField(dimensionFieldDef,{binSuffix:"end"})]:[vgField(dimensionFieldDef)]:$jscomp$destructuring$var158||[]};StackNode.prototype.assemble=function(){var transform=[],$jscomp$destructuring$var159=this._stack,facetby=$jscomp$destructuring$var159.facetby,dimensionFieldDef=$jscomp$destructuring$var159.dimensionFieldDef,field=$jscomp$destructuring$var159.stackField,stackby=$jscomp$destructuring$var159.stackby,sort=$jscomp$destructuring$var159.sort,offset=
$jscomp$destructuring$var159.offset,as=$jscomp$destructuring$var159.as;$jscomp$destructuring$var159.impute&&dimensionFieldDef&&(dimensionFieldDef.bin&&transform.push({type:"formula",expr:"0.5*"+vgField(dimensionFieldDef,{expr:"datum"})+"+0.5*"+vgField(dimensionFieldDef,{expr:"datum",binSuffix:"end"}),as:vgField(dimensionFieldDef,{binSuffix:"mid",forAs:!0})}),transform.push({type:"impute",field:field,groupby:[].concat($jscomp.arrayFromIterable(stackby),$jscomp.arrayFromIterable(facetby)),key:vgField(dimensionFieldDef,
{binSuffix:"mid"}),method:"value",value:0}));transform.push({type:"stack",groupby:[].concat($jscomp.arrayFromIterable(this.getGroupbyFields()),$jscomp.arrayFromIterable(facetby)),field:field,sort:sort,as:as,offset:offset});return transform};$jscomp.global.Object.defineProperties(StackNode.prototype,{stack:{configurable:!0,enumerable:!0,get:function(){return this._stack}}});var WindowTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;return parent};
$jscomp.inherits(WindowTransformNode,DataFlowNode);WindowTransformNode.prototype.clone=function(){return new WindowTransformNode(null,duplicate(this.transform))};WindowTransformNode.prototype.addDimensions=function(fields){this.transform.groupby=unique(this.transform.groupby.concat(fields),function(d){return d})};WindowTransformNode.prototype.dependentFields=function(){var out=new Set;(this.transform.groupby||[]).forEach(function(f){return out.add(f)});(this.transform.sort||[]).forEach(function(m){return out.add(m.field)});
this.transform.window.map(function(w){return w.field}).filter(function(f){return void 0!==f}).forEach(function(f){return out.add(f)});return out};WindowTransformNode.prototype.producedFields=function(){return new Set(this.transform.window.map(this.getDefaultName))};WindowTransformNode.prototype.getDefaultName=function(windowFieldDef){return windowFieldDef.as||vgField(windowFieldDef)};WindowTransformNode.prototype.hash=function(){return"WindowTransform "+hash(this.transform)};WindowTransformNode.prototype.assemble=
function(){for(var fields=[],ops=[],as=[],params=[],$jscomp$iter$129=$jscomp.makeIterator(this.transform.window),$jscomp$key$window=$jscomp$iter$129.next();!$jscomp$key$window.done;$jscomp$key$window=$jscomp$iter$129.next())$jscomp$key$window=$jscomp$key$window.value,ops.push($jscomp$key$window.op),as.push(this.getDefaultName($jscomp$key$window)),params.push(void 0===$jscomp$key$window.param?null:$jscomp$key$window.param),fields.push(void 0===$jscomp$key$window.field?null:$jscomp$key$window.field);
$jscomp$iter$129=this.transform.frame;$jscomp$key$window=this.transform.groupby;if($jscomp$iter$129&&null===$jscomp$iter$129[0]&&null===$jscomp$iter$129[1]&&ops.every(function(o){return isString(o)&&!!AGGREGATE_OP_INDEX[o]}))return Object.assign({type:"joinaggregate",as:as,ops:ops,fields:fields},void 0!==$jscomp$key$window?{groupby:$jscomp$key$window}:{});var sortFields=[],sortOrder=[];if(void 0!==this.transform.sort)for(var $jscomp$iter$130=$jscomp.makeIterator(this.transform.sort),$jscomp$key$sortField=
$jscomp$iter$130.next();!$jscomp$key$sortField.done;$jscomp$key$sortField=$jscomp$iter$130.next())$jscomp$key$sortField=$jscomp$key$sortField.value,sortFields.push($jscomp$key$sortField.field),sortOrder.push($jscomp$key$sortField.order||"ascending");$jscomp$iter$130=this.transform.ignorePeers;return Object.assign({type:"window",params:params,as:as,ops:ops,fields:fields,sort:{field:sortFields,order:sortOrder}},void 0!==$jscomp$iter$130?{ignorePeers:$jscomp$iter$130}:{},void 0!==$jscomp$key$window?
{groupby:$jscomp$key$window}:{},void 0!==$jscomp$iter$129?{frame:$jscomp$iter$129}:{})};var MoveParseUp=function(var_args){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MoveParseUp,BottomUpOptimizer);MoveParseUp.prototype.run=function(node){var parent=node.parent;if(node instanceof ParseNode){if(isDataSourceNode(parent))return this.flags;if(1<parent.numChildren())return this.setContinue(),this.flags;if(parent instanceof ParseNode)this.setMutated(),parent.merge(node);else{parent=
parent.producedFields();var b=node.dependentFields();if(hasIntersection(prefixGenerator(parent),prefixGenerator(b)))return this.setContinue(),this.flags;this.setMutated();node.swapWithParent()}}this.setContinue();return this.flags};var MergeIdenticalNodes=function(var_args){return TopDownOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeIdenticalNodes,TopDownOptimizer);MergeIdenticalNodes.prototype.mergeNodes=function(parent,nodes){var mergedNode=nodes.shift();nodes=$jscomp.makeIterator(nodes);
for(var $jscomp$key$node=nodes.next();!$jscomp$key$node.done;$jscomp$key$node=nodes.next())$jscomp$key$node=$jscomp$key$node.value,parent.removeChild($jscomp$key$node),$jscomp$key$node.parent=mergedNode,$jscomp$key$node.remove()};MergeIdenticalNodes.prototype.run=function(node){for(var hashes=node.children.map(function(x){return x.hash()}),buckets={},i=0;i<hashes.length;i++)void 0===buckets[hashes[i]]?buckets[hashes[i]]=[node.children[i]]:buckets[hashes[i]].push(node.children[i]);hashes=$jscomp.makeIterator(keys(buckets));
for(i=hashes.next();!i.done;i=hashes.next())i=i.value,1<buckets[i].length&&(this.setMutated(),this.mergeNodes(node,buckets[i]));node=$jscomp.makeIterator(node.children);for(buckets=node.next();!buckets.done;buckets=node.next())this.run(buckets.value);return this.mutatedFlag};var RemoveUnusedSubtrees=function(var_args){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(RemoveUnusedSubtrees,BottomUpOptimizer);RemoveUnusedSubtrees.prototype.run=function(node){node instanceof OutputNode||
0<node.numChildren()||node instanceof FacetNode||(this.setMutated(),node.remove());return this.flags};var RemoveDuplicateTimeUnits=function(){var $jscomp$super$this=BottomUpOptimizer.apply(this,arguments)||this;$jscomp$super$this.fields=new Set;return $jscomp$super$this};$jscomp.inherits(RemoveDuplicateTimeUnits,BottomUpOptimizer);RemoveDuplicateTimeUnits.prototype.run=function(node){this.setContinue();if(node instanceof TimeUnitNode){var pfields=node.producedFields();hasIntersection(pfields,this.fields)?
(this.setMutated(),node.remove()):this.fields=new Set([].concat($jscomp.arrayFromIterable(this.fields),$jscomp.arrayFromIterable(pfields)))}return this.flags};RemoveDuplicateTimeUnits.prototype.reset=function(){this.fields.clear()};var MergeTimeUnits=function(var_args){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeTimeUnits,BottomUpOptimizer);MergeTimeUnits.prototype.run=function(node){this.setContinue();var timeUnitChildren=node.parent.children.filter(function(x){return x instanceof
TimeUnitNode});node=timeUnitChildren.pop();timeUnitChildren=$jscomp.makeIterator(timeUnitChildren);for(var $jscomp$key$timeUnit=timeUnitChildren.next();!$jscomp$key$timeUnit.done;$jscomp$key$timeUnit=timeUnitChildren.next())$jscomp$key$timeUnit=$jscomp$key$timeUnit.value,this.setMutated(),node.merge($jscomp$key$timeUnit);return this.flags};var RemoveUnnecessaryNodes=function(var_args){return TopDownOptimizer.apply(this,arguments)||this};$jscomp.inherits(RemoveUnnecessaryNodes,TopDownOptimizer);RemoveUnnecessaryNodes.prototype.run=
function(node){node instanceof OutputNode&&!node.isRequired()&&(this.setMutated(),node.remove());node=$jscomp.makeIterator(node.children);for(var $jscomp$key$child=node.next();!$jscomp$key$child.done;$jscomp$key$child=node.next())this.run($jscomp$key$child.value);return this.mutatedFlag};var MergeParse=function(var_args){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeParse,BottomUpOptimizer);MergeParse.prototype.run=function(node){node=node.parent;var originalChildren=
[].concat($jscomp.arrayFromIterable(node.children)),parseChildren=node.children.filter(function(child){return child instanceof ParseNode});if(1<node.numChildren()&&1<=parseChildren.length){var commonParse={},conflictingParse=new Set;parseChildren=$jscomp.makeIterator(parseChildren);for(var $jscomp$key$parseNode=parseChildren.next();!$jscomp$key$parseNode.done;$jscomp$key$parseNode=parseChildren.next()){$jscomp$key$parseNode=$jscomp$key$parseNode.value.parse;for(var $jscomp$iter$137=$jscomp.makeIterator(keys($jscomp$key$parseNode)),
$jscomp$key$k=$jscomp$iter$137.next();!$jscomp$key$k.done;$jscomp$key$k=$jscomp$iter$137.next())$jscomp$key$k=$jscomp$key$k.value,$jscomp$key$k in commonParse?commonParse[$jscomp$key$k]!==$jscomp$key$parseNode[$jscomp$key$k]&&conflictingParse.add($jscomp$key$k):commonParse[$jscomp$key$k]=$jscomp$key$parseNode[$jscomp$key$k]}conflictingParse=$jscomp.makeIterator(conflictingParse);for(parseChildren=conflictingParse.next();!parseChildren.done;parseChildren=conflictingParse.next())delete commonParse[parseChildren.value];
if(0!==keys(commonParse).length)for(this.setMutated(),conflictingParse=new ParseNode(node,commonParse),originalChildren=$jscomp.makeIterator(originalChildren),parseChildren=originalChildren.next();!parseChildren.done;parseChildren=originalChildren.next()){parseChildren=parseChildren.value;if(parseChildren instanceof ParseNode)for($jscomp$key$parseNode=$jscomp.makeIterator(keys(commonParse)),$jscomp$iter$137=$jscomp$key$parseNode.next();!$jscomp$iter$137.done;$jscomp$iter$137=$jscomp$key$parseNode.next())delete parseChildren.parse[$jscomp$iter$137.value];
node.removeChild(parseChildren);parseChildren.parent=conflictingParse;parseChildren instanceof ParseNode&&0===keys(parseChildren.parse).length&&parseChildren.remove()}}this.setContinue();return this.flags};var MergeAggregates=function(var_args){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeAggregates,BottomUpOptimizer);MergeAggregates.prototype.run=function(node){node=node.parent;var aggChildren=node.children.filter(function(child){return child instanceof AggregateNode}),
groupedAggregates={};aggChildren=$jscomp.makeIterator(aggChildren);for(var $jscomp$key$agg=aggChildren.next();!$jscomp$key$agg.done;$jscomp$key$agg=aggChildren.next()){var agg=$jscomp$key$agg.value;$jscomp$key$agg=hash(agg.groupBy);$jscomp$key$agg in groupedAggregates||(groupedAggregates[$jscomp$key$agg]=[]);groupedAggregates[$jscomp$key$agg].push(agg)}aggChildren=$jscomp.makeIterator(keys(groupedAggregates));for(agg=aggChildren.next();!agg.done;agg=aggChildren.next())if($jscomp$key$agg=groupedAggregates[agg.value],
1<$jscomp$key$agg.length){agg=$jscomp$key$agg.pop();var $jscomp$iter$143=$jscomp.makeIterator($jscomp$key$agg);for($jscomp$key$agg=$jscomp$iter$143.next();!$jscomp$key$agg.done;$jscomp$key$agg=$jscomp$iter$143.next())$jscomp$key$agg=$jscomp$key$agg.value,agg.merge($jscomp$key$agg)&&(node.removeChild($jscomp$key$agg),$jscomp$key$agg.parent=agg,$jscomp$key$agg.remove(),this.setMutated())}this.setContinue();return this.flags};var MergeBins=function(model){var $jscomp$super$this=BottomUpOptimizer.call(this)||
this;$jscomp$super$this.model=model;return $jscomp$super$this};$jscomp.inherits(MergeBins,BottomUpOptimizer);MergeBins.prototype.run=function(node){var parent=node.parent,moveBinsUp=!(isDataSourceNode(parent)||parent instanceof FilterNode||parent instanceof ParseNode),promotableBins=[];node=[];for(var $jscomp$iter$145=$jscomp.makeIterator(parent.children),$jscomp$key$child=$jscomp$iter$145.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$145.next())if($jscomp$key$child=$jscomp$key$child.value,
$jscomp$key$child instanceof BinNode){var JSCompiler_temp;if(JSCompiler_temp=moveBinsUp){JSCompiler_temp=parent.producedFields();var b=$jscomp$key$child.dependentFields();JSCompiler_temp=!hasIntersection(prefixGenerator(JSCompiler_temp),prefixGenerator(b))}JSCompiler_temp?promotableBins.push($jscomp$key$child):node.push($jscomp$key$child)}if(0<promotableBins.length){moveBinsUp=promotableBins.pop();$jscomp$iter$145=$jscomp.makeIterator(promotableBins);for(promotableBins=$jscomp$iter$145.next();!promotableBins.done;promotableBins=
$jscomp$iter$145.next())moveBinsUp.merge(promotableBins.value,this.model.renameSignal.bind(this.model));this.setMutated();parent instanceof BinNode?parent.merge(moveBinsUp,this.model.renameSignal.bind(this.model)):moveBinsUp.swapWithParent()}if(1<node.length){parent=node.pop();node=$jscomp.makeIterator(node);for(promotableBins=node.next();!promotableBins.done;promotableBins=node.next())parent.merge(promotableBins.value,this.model.renameSignal.bind(this.model));this.setMutated()}this.setContinue();
return this.flags};var MergeOutputs=function(var_args){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeOutputs,BottomUpOptimizer);MergeOutputs.prototype.run=function(node){node=node.parent;var children=[].concat($jscomp.arrayFromIterable(node.children));if(!some(children,function(child){return child instanceof OutputNode})||1>=node.numChildren())return this.setContinue(),this.flags;var otherChildren=[];children=$jscomp.makeIterator(children);for(var $jscomp$key$child=children.next();!$jscomp$key$child.done;$jscomp$key$child=
children.next())if($jscomp$key$child=$jscomp$key$child.value,$jscomp$key$child instanceof OutputNode){for(var lastOutput=$jscomp$key$child;1===lastOutput.numChildren();){var theChild=lastOutput.children[0];if(theChild instanceof OutputNode)lastOutput=theChild;else break}otherChildren.push.apply(otherChildren,$jscomp.arrayFromIterable(lastOutput.children));if(mainOutput)node.removeChild($jscomp$key$child),$jscomp$key$child.parent=mainOutput.parent,mainOutput.parent.removeChild(mainOutput),mainOutput.parent=
lastOutput,this.setMutated();else var mainOutput=lastOutput}else otherChildren.push($jscomp$key$child);if(otherChildren.length)for(this.setMutated(),node=$jscomp.makeIterator(otherChildren),$jscomp$key$child=node.next();!$jscomp$key$child.done;$jscomp$key$child=node.next())otherChildren=$jscomp$key$child.value,otherChildren.parent.removeChild(otherChildren),otherChildren.parent=mainOutput;this.setContinue();return this.flags};var SignalRefWrapper=function(exprGenerator){Object.defineProperty(this,
"signal",{enumerable:!0,get:exprGenerator})};SignalRefWrapper.fromName=function(rename,signalName){return new SignalRefWrapper(function(){return rename(signalName)})};var ScaleComponent=function(name,typeWithExplicit){name=Split.call(this,{},{name:name})||this;name.merged=!1;name.setWithExplicit("type",typeWithExplicit);return name};$jscomp.inherits(ScaleComponent,Split);ScaleComponent.prototype.domainDefinitelyIncludesZero=function(){return!1!==this.get("zero")?!0:some(this.get("domains"),function(d){return isArray(d)&&
2===d.length&&0>=d[0]&&0<=d[1]})};var RANGE_PROPERTIES=["range","rangeStep","scheme"],scaleTypeTieBreaker=tieBreakByComparing(function(st1,st2){return SCALE_PRECEDENCE_INDEX[st1]-SCALE_PRECEDENCE_INDEX[st2]}),NameMap=function(){this.nameMap={}};NameMap.prototype.rename=function(oldName,newName){this.nameMap[oldName]=newName};NameMap.prototype.has=function(name){return void 0!==this.nameMap[name]};NameMap.prototype.get=function(name){for(;this.nameMap[name]&&name!==this.nameMap[name];)name=this.nameMap[name];
return name};var Model=function(spec,type,parent,parentGivenName,config,repeater,resolve,view){var $jscomp$this=this;this.type=type;this.parent=parent;this.config=config;this.repeater=repeater;this.view=view;this.children=[];this.correctDataNames=function(mark){mark.from&&mark.from.data&&(mark.from.data=$jscomp$this.lookupDataSource(mark.from.data));mark.from&&mark.from.facet&&mark.from.facet.data&&(mark.from.facet.data=$jscomp$this.lookupDataSource(mark.from.facet.data));return mark};this.parent=
parent;this.config=config;this.repeater=repeater;this.name=spec.name||parentGivenName;this.title=isString(spec.title)?{text:spec.title}:spec.title;this.scaleNameMap=parent?parent.scaleNameMap:new NameMap;this.projectionNameMap=parent?parent.projectionNameMap:new NameMap;this.signalNameMap=parent?parent.signalNameMap:new NameMap;this.data=spec.data;this.description=spec.description;this.transforms=normalizeTransform(spec.transform||[]);this.layout=isUnitSpec(spec)||isLayerSpec(spec)?{}:extractCompositionLayout(spec,
type,config);this.component={data:{sources:parent?parent.component.data.sources:[],outputNodes:parent?parent.component.data.outputNodes:{},outputNodeRefCounts:parent?parent.component.data.outputNodeRefCounts:{},isFaceted:void 0!==spec.facet||parent&&parent.component.data.isFaceted&&void 0===spec.data},layoutSize:new Split,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},resolve?duplicate(resolve):{}),selection:null,scales:null,projection:null,
axes:{},legends:{}}};Model.prototype.initSize=function(size){var width=size.width;size=size.height;width&&this.component.layoutSize.set("width",width,!0);size&&this.component.layoutSize.set("height",size,!0)};Model.prototype.parse=function(){this.parseScale();this.parseLayoutSize();this.renameTopLevelLayoutSizeSignal();this.parseSelections();this.parseProjection();this.parseData();this.parseAxesAndHeaders();this.parseLegends();this.parseMarkGroup()};Model.prototype.parseScale=function(){parseScaleCore(this);
parseScaleDomain(this);for(var $jscomp$inline_985=$jscomp.makeIterator(NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES),$jscomp$key$prop=$jscomp$inline_985.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$inline_985.next())parseScaleProperty(this,$jscomp$key$prop.value);isUnitModel(this)?parseUnitScaleRange(this):parseNonUnitScaleProperty(this,"range")};Model.prototype.parseProjection=function(){this.component.projection=isUnitModel(this)?parseUnitProjection(this):parseNonUnitProjections(this)};
Model.prototype.renameTopLevelLayoutSizeSignal=function(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width");"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")};Model.prototype.parseLegends=function(){parseLegend(this)};Model.prototype.assembleGroupStyle=function(){if("unit"===this.type||"layer"===this.type)return this.view&&this.view.style||"cell"};Model.prototype.assembleEncodeFromView=function(view){view=__rest(view,["style"]);var e=
{},property;for(property in view)if(view.hasOwnProperty(property)){var value=view[property];void 0!==value&&(e[property]={value:value})}return e};Model.prototype.assembleGroupEncodeEntry=function(isTopLevel){var encodeEntry=void 0;this.view&&(encodeEntry=this.assembleEncodeFromView(this.view));return isTopLevel||"unit"!==this.type&&"layer"!==this.type?encodeEntry:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},encodeEntry||{})};Model.prototype.assembleLayout=
function(){if(this.layout){var _a=this.layout,spacing=_a.spacing;_a=__rest(_a,["spacing"]);for(var config=this.config,headerComponentIndex=this.component.layoutHeaders,titleBand={},$jscomp$inline_994=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$inline_994.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$inline_994.next()){$jscomp$key$channel=$jscomp$key$channel.value;var headerComponent=headerComponentIndex[$jscomp$key$channel];if(headerComponent&&headerComponent.facetFieldDef){var $jscomp$inline_998=
getHeaderProperties(["titleAnchor","titleOrient"],headerComponent.facetFieldDef,config,$jscomp$key$channel);headerComponent=$jscomp$inline_998.titleAnchor;$jscomp$key$channel=getHeaderChannel($jscomp$key$channel,$jscomp$inline_998.titleOrient);headerComponent=LAYOUT_TITLE_BAND[$jscomp$key$channel][headerComponent];void 0!==headerComponent&&(titleBand[$jscomp$key$channel]=headerComponent)}}config=0<keys(titleBand).length?titleBand:void 0;return Object.assign({padding:spacing},this.assembleDefaultLayout(),
_a,config?{titleBand:config}:{})}};Model.prototype.assembleDefaultLayout=function(){return{}};Model.prototype.assembleHeaderMarks=function(){for(var layoutHeaders=this.component.layoutHeaders,headerMarks=[],$jscomp$iter$162=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$162.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$162.next())$jscomp$key$channel=$jscomp$key$channel.value,layoutHeaders[$jscomp$key$channel].title&&headerMarks.push(assembleTitleGroup(this,
$jscomp$key$channel));layoutHeaders=$jscomp.makeIterator(HEADER_CHANNELS);for($jscomp$key$channel=layoutHeaders.next();!$jscomp$key$channel.done;$jscomp$key$channel=layoutHeaders.next())headerMarks=headerMarks.concat(assembleHeaderGroups(this,$jscomp$key$channel.value));return headerMarks};Model.prototype.assembleAxes=function(){return assembleAxes(this.component.axes,this.config)};Model.prototype.assembleLegends=function(){return assembleLegends(this)};Model.prototype.assembleProjections=function(){var JSCompiler_inline_result=
isLayerModel(this)||this&&"concat"===this.type||this&&"repeat"===this.type?assembleProjectionsForModelAndChildren(this):assembleProjectionForModel(this);return JSCompiler_inline_result};Model.prototype.assembleTitle=function(){var _a=this.title||{},encoding=_a.encoding;_a=__rest(_a,["encoding"]);encoding=Object.assign({},extractTitleConfig(this.config.title).nonMark,_a,encoding?{encode:{update:encoding}}:{});if(encoding.text)return contains(["unit","layer"],this.type)?contains(["middle",void 0],encoding.anchor)&&
(encoding.frame=encoding.frame||"group"):encoding.anchor=encoding.anchor||"start",0<keys(encoding).length?encoding:void 0};Model.prototype.assembleGroup=function(signals){signals=void 0===signals?[]:signals;var group={};signals=signals.concat(this.assembleSignals());0<signals.length&&(group.signals=signals);if(signals=this.assembleLayout())group.layout=signals;group.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());signals=!this.parent||isFacetModel(this.parent)?assembleScales(this):
[];0<signals.length&&(group.scales=signals);signals=this.assembleAxes();0<signals.length&&(group.axes=signals);signals=this.assembleLegends();0<signals.length&&(group.legends=signals);return group};Model.prototype.hasDescendantWithFieldOnChannel=function(channel){for(var $jscomp$iter$164=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$164.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$164.next())if($jscomp$key$child=$jscomp$key$child.value,isUnitModel($jscomp$key$child)){if($jscomp$key$child.channelHasField(channel))return!0}else if($jscomp$key$child.hasDescendantWithFieldOnChannel(channel))return!0;
return!1};Model.prototype.getName=function(text){return varName((this.name?this.name+"_":"")+text)};Model.prototype.requestDataName=function(name){name=this.getName(name);var refCounts=this.component.data.outputNodeRefCounts;refCounts[name]=(refCounts[name]||0)+1;return name};Model.prototype.getSizeSignalRef=function(sizeType){if(isFacetModel(this.parent)){var channel="width"===sizeType?"x":"y",scaleComponent=this.component.scales[channel];if(scaleComponent&&!scaleComponent.merged){var type$293=scaleComponent.get("type"),
range=scaleComponent.get("range");if(type$293 in DISCRETE_DOMAIN_INDEX&&isVgRangeStep(range)){sizeType=scaleComponent.get("name");channel=assembleDomain(this,channel);if(channel=getFieldFromDomain(channel))return channel=vgField({aggregate:"distinct",field:channel},{expr:"datum"}),{signal:sizeExpr(sizeType,scaleComponent,channel)};warn("Unknown field for ${channel}.  Cannot calculate view size.");return null}}}return{signal:this.signalNameMap.get(this.getName(sizeType))}};Model.prototype.lookupDataSource=
function(name){var node=this.component.data.outputNodes[name];return node?node.getSource():name};Model.prototype.getSignalName=function(oldSignalName){return this.signalNameMap.get(oldSignalName)};Model.prototype.renameSignal=function(oldName,newName){this.signalNameMap.rename(oldName,newName)};Model.prototype.renameScale=function(oldName,newName){this.scaleNameMap.rename(oldName,newName)};Model.prototype.renameProjection=function(oldName,newName){this.projectionNameMap.rename(oldName,newName)};Model.prototype.scaleName=
function(originalScaleName,parse){if(parse)return this.getName(originalScaleName);if(CHANNEL_INDEX[originalScaleName]&&SCALE_CHANNEL_INDEX[originalScaleName]&&this.component.scales[originalScaleName]||this.scaleNameMap.has(this.getName(originalScaleName)))return this.scaleNameMap.get(this.getName(originalScaleName))};Model.prototype.projectionName=function(parse){if(parse)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))};
Model.prototype.getScaleComponent=function(channel){if(!this.component.scales)throw Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var localScaleComponent=this.component.scales[channel];return localScaleComponent&&!localScaleComponent.merged?localScaleComponent:this.parent?this.parent.getScaleComponent(channel):void 0};Model.prototype.getSelectionComponent=function(variableName,origName){var sel=this.component.selection[variableName];
!sel&&this.parent&&(sel=this.parent.getSelectionComponent(variableName,origName));if(!sel)throw Error(message$jscomp$0.selectionNotFound(origName));return sel};$jscomp.global.Object.defineProperties(Model.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this.getSizeSignalRef("width")}},height:{configurable:!0,enumerable:!0,get:function(){return this.getSizeSignalRef("height")}}});var ModelWithField=function(var_args){return Model.apply(this,arguments)||this};$jscomp.inherits(ModelWithField,
Model);ModelWithField.prototype.vgField=function(channel,opt){opt=void 0===opt?{}:opt;if(channel=this.fieldDef(channel))return vgField(channel,opt)};ModelWithField.prototype.reduceFieldDef=function(f,init,t){return reduce(this.getMapping(),function(acc,cd,c){return(cd=getFieldDef(cd))?f(acc,cd,c):acc},init,t)};ModelWithField.prototype.forEachFieldDef=function(f,t){forEach(this.getMapping(),function(cd,c){(cd=getFieldDef(cd))&&f(cd,c)},t)};var FilterInvalidNode=function(parent,filter){parent=DataFlowNode.call(this,
parent)||this;parent.filter=filter;return parent};$jscomp.inherits(FilterInvalidNode,DataFlowNode);FilterInvalidNode.prototype.clone=function(){return new FilterInvalidNode(null,Object.assign({},this.filter))};FilterInvalidNode.make=function(parent,model){var mark=model.mark;if("filter"!==model.config.invalidValues)return null;var filter=model.reduceFieldDef(function(aggregator,fieldDef,channel){channel=!!SCALE_CHANNEL_INDEX[channel]&&model.getScaleComponent(channel);!channel||channel.get("type")in
CONTINUOUS_DOMAIN_INDEX&&!fieldDef.aggregate&&!isPathMark(mark)&&(aggregator[fieldDef.field]=fieldDef);return aggregator},{});return keys(filter).length?new FilterInvalidNode(parent,filter):null};FilterInvalidNode.prototype.dependentFields=function(){return new Set(keys(this.filter))};FilterInvalidNode.prototype.assemble=function(){var $jscomp$this=this,filters=keys(this.filter).reduce(function(vegaFilters,field){field=$jscomp$this.filter[field];var ref=vgField(field,{expr:"datum"});null!==field&&
(vegaFilters.push(ref+" !\x3d\x3d null"),vegaFilters.push("!isNaN("+ref+")"));return vegaFilters},[]);return 0<filters.length?{type:"filter",expr:filters.join(" \x26\x26 ")}:null};var FlattenTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent.transform=duplicate(transform);transform=parent.transform;var as=void 0===transform.as?[]:transform.as;parent.transform.as=transform.flatten.map(function(f,i){return as[i]||f});return parent};
$jscomp.inherits(FlattenTransformNode,DataFlowNode);FlattenTransformNode.prototype.clone=function(){return new FlattenTransformNode(this.parent,duplicate(this.transform))};FlattenTransformNode.prototype.producedFields=function(){return new Set(this.transform.as)};FlattenTransformNode.prototype.hash=function(){return"FlattenTransform "+hash(this.transform)};FlattenTransformNode.prototype.assemble=function(){var $jscomp$destructuring$var185=this.transform;return{type:"flatten",fields:$jscomp$destructuring$var185.flatten,
as:$jscomp$destructuring$var185.as}};var FoldTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent.transform=duplicate(transform);transform=parent.transform.as||[void 0,void 0];parent.transform.as=[transform[0]||"key",transform[1]||"value"];return parent};$jscomp.inherits(FoldTransformNode,DataFlowNode);FoldTransformNode.prototype.clone=function(){return new FoldTransformNode(null,duplicate(this.transform))};FoldTransformNode.prototype.producedFields=
function(){return new Set(this.transform.as)};FoldTransformNode.prototype.hash=function(){return"FoldTransform "+hash(this.transform)};FoldTransformNode.prototype.assemble=function(){var $jscomp$destructuring$var186=this.transform;return{type:"fold",fields:$jscomp$destructuring$var186.fold,as:$jscomp$destructuring$var186.as}};var GeoJSONNode=function(parent,fields,geojson,signal){parent=DataFlowNode.call(this,parent)||this;parent.fields=fields;parent.geojson=geojson;parent.signal=signal;return parent};
$jscomp.inherits(GeoJSONNode,DataFlowNode);GeoJSONNode.prototype.clone=function(){return new GeoJSONNode(null,duplicate(this.fields),this.geojson,this.signal)};GeoJSONNode.parseAll=function(parent,model){if(model.component.projection&&!model.component.projection.isFit)return parent;var geoJsonCounter=0;[["longitude","latitude"],["longitude2","latitude2"]].forEach(function(coordinates){coordinates=coordinates.map(function(channel){return model.channelHasField(channel)?model.fieldDef(channel).field:
isValueDef(model.encoding[channel])?{expr:model.encoding[channel].value+""}:void 0});if(coordinates[0]||coordinates[1])parent=new GeoJSONNode(parent,coordinates,null,model.getName("geojson_"+geoJsonCounter++))});if(model.channelHasField("shape")){var fieldDef=model.fieldDef("shape");"geojson"===fieldDef.type&&(parent=new GeoJSONNode(parent,null,fieldDef.field,model.getName("geojson_"+geoJsonCounter++)))}return parent};GeoJSONNode.prototype.assemble=function(){return Object.assign({type:"geojson"},
this.fields?{fields:this.fields}:{},this.geojson?{geojson:this.geojson}:{},{signal:this.signal})};var GeoPointNode=function(parent,projection,fields,as){parent=DataFlowNode.call(this,parent)||this;parent.projection=projection;parent.fields=fields;parent.as=as;return parent};$jscomp.inherits(GeoPointNode,DataFlowNode);GeoPointNode.prototype.clone=function(){return new GeoPointNode(null,this.projection,duplicate(this.fields),duplicate(this.as))};GeoPointNode.parseAll=function(parent,model){if(!model.projectionName())return parent;
[["longitude","latitude"],["longitude2","latitude2"]].forEach(function(coordinates){var pair=coordinates.map(function(channel){return model.channelHasField(channel)?model.fieldDef(channel).field:isValueDef(model.encoding[channel])?{expr:model.encoding[channel].value+""}:void 0});coordinates="longitude2"===coordinates[0]?"2":"";if(pair[0]||pair[1])parent=new GeoPointNode(parent,model.projectionName(),pair,[model.getName("x"+coordinates),model.getName("y"+coordinates)])});return parent};GeoPointNode.prototype.assemble=
function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}};var IdentifierNode=function(parent){return DataFlowNode.call(this,parent)||this};$jscomp.inherits(IdentifierNode,DataFlowNode);IdentifierNode.prototype.clone=function(){return new IdentifierNode(null)};IdentifierNode.prototype.producedFields=function(){return new Set(["_vgsid_"])};IdentifierNode.prototype.hash=function(){return"Identifier"};IdentifierNode.prototype.assemble=function(){return{type:"identifier",
as:"_vgsid_"}};var ImputeNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;return parent};$jscomp.inherits(ImputeNode,DataFlowNode);ImputeNode.prototype.clone=function(){return new ImputeNode(null,duplicate(this.transform))};ImputeNode.prototype.producedFields=function(){return new Set([this.transform.impute])};ImputeNode.prototype.processSequence=function(keyvals){var step=keyvals.step;return{signal:"sequence("+[void 0===keyvals.start?0:keyvals.start,
keyvals.stop].concat($jscomp.arrayFromIterable(step?[step]:[])).join(",")+")"}};ImputeNode.makeFromTransform=function(parent,imputeTransform){return new ImputeNode(parent,imputeTransform)};ImputeNode.makeFromEncoding=function(parent,model){var encoding=model.encoding,xDef=encoding.x,yDef=encoding.y;if(isFieldDef(xDef)&&isFieldDef(yDef)){var imputedChannel=xDef.impute?xDef:yDef.impute?yDef:void 0;if(void 0===imputedChannel)return;xDef=xDef.impute?yDef:yDef.impute?xDef:void 0;var $jscomp$destructuring$var188=
imputedChannel.impute;yDef=$jscomp$destructuring$var188.method;var value=$jscomp$destructuring$var188.value,frame=$jscomp$destructuring$var188.frame;$jscomp$destructuring$var188=$jscomp$destructuring$var188.keyvals;model=pathGroupingFields(model.mark,encoding);return new ImputeNode(parent,Object.assign({impute:imputedChannel.field,key:xDef.field},yDef?{method:yDef}:{},void 0!==value?{value:value}:{},frame?{frame:frame}:{},void 0!==$jscomp$destructuring$var188?{keyvals:$jscomp$destructuring$var188}:
{},model.length?{groupby:model}:{}))}return null};ImputeNode.prototype.hash=function(){return"Impute "+hash(this.transform)};ImputeNode.prototype.assemble=function(){var $jscomp$destructuring$var189=this.transform,impute=$jscomp$destructuring$var189.impute,keyvals=$jscomp$destructuring$var189.keyvals,method=$jscomp$destructuring$var189.method,groupby=$jscomp$destructuring$var189.groupby,value=$jscomp$destructuring$var189.value,frame=void 0===$jscomp$destructuring$var189.frame?[null,null]:$jscomp$destructuring$var189.frame;
$jscomp$destructuring$var189=Object.assign({type:"impute",field:impute,key:$jscomp$destructuring$var189.key},keyvals?{keyvals:keyvals&&void 0!==keyvals.stop?this.processSequence(keyvals):keyvals}:{},{method:"value"},groupby?{groupby:groupby}:{},{value:null});impute=method&&"value"!==method?[Object.assign({type:"window",as:["imputed_"+impute+"_value"],ops:[method],fields:[impute],frame:frame,ignorePeers:!1},groupby?{groupby:groupby}:{}),{type:"formula",expr:"datum."+impute+" \x3d\x3d\x3d null ? datum.imputed_"+
impute+"_value : datum."+impute,as:impute}]:[{type:"formula",expr:"datum."+impute+" \x3d\x3d\x3d null ? "+value+" : datum."+impute,as:impute}];return[$jscomp$destructuring$var189].concat($jscomp.arrayFromIterable(impute))};var AncestorParse=function(explicit,implicit,parseNothing){explicit=void 0===explicit?{}:explicit;implicit=void 0===implicit?{}:implicit;parseNothing=void 0===parseNothing?!1:parseNothing;var $jscomp$super$this=Split.call(this,explicit,implicit)||this;$jscomp$super$this.explicit=
explicit;$jscomp$super$this.implicit=implicit;$jscomp$super$this.parseNothing=parseNothing;return $jscomp$super$this};$jscomp.inherits(AncestorParse,Split);AncestorParse.prototype.clone=function(){var clone=Split.prototype.clone.call(this);clone.parseNothing=this.parseNothing;return clone};var LookupNode=function(parent,transform,secondary){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent.secondary=secondary;return parent};$jscomp.inherits(LookupNode,DataFlowNode);LookupNode.prototype.clone=
function(){return new LookupNode(null,duplicate(this.transform),this.secondary)};LookupNode.make=function(parent,model,transform,counter){var sources=model.component.data.sources,fromSource=findSource(transform.from.data,sources);fromSource||(fromSource=new SourceNode(transform.from.data),sources.push(fromSource));counter=model.getName("lookup_"+counter);fromSource=new OutputNode(fromSource,counter,"lookup",model.component.data.outputNodeRefCounts);model.component.data.outputNodes[counter]=fromSource;
return new LookupNode(parent,transform,fromSource.getSource())};LookupNode.prototype.producedFields=function(){return new Set(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))};LookupNode.prototype.hash=function(){return"Lookup "+hash({transform:this.transform,secondary:this.secondary})};LookupNode.prototype.assemble=function(){if(this.transform.from.fields)var foreign=Object.assign({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof
Array?this.transform.as:[this.transform.as]}:{});else foreign=this.transform.as,isString(foreign)||(warn(message$jscomp$0.NO_FIELDS_NEEDS_AS),foreign="_lookup"),foreign={as:[foreign]};return Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},foreign,this.transform.default?{default:this.transform.default}:{})};var SampleTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;return parent};
$jscomp.inherits(SampleTransformNode,DataFlowNode);SampleTransformNode.prototype.clone=function(){return new SampleTransformNode(null,duplicate(this.transform))};SampleTransformNode.prototype.hash=function(){return"SampleTransform "+hash(this.transform)};SampleTransformNode.prototype.assemble=function(){return{type:"sample",size:this.transform.sample}};var SIZE_TYPE_TO_MERGE={vconcat:"width",hconcat:"height"},FacetModel=function(spec,parent,parentGivenName,repeater,config){parent=ModelWithField.call(this,
spec,"facet",parent,parentGivenName,config,repeater,spec.resolve)||this;parent.child=buildModel(spec.spec,parent,parent.getName("child"),void 0,repeater,config,!1);parent.children=[parent.child];spec=spec.facet;repeater=isFacetMapping(spec)?replaceRepeater(spec,repeater):replaceRepeaterInFieldDef(spec,repeater);parent.facet=parent.initFacet(repeater);return parent};$jscomp.inherits(FacetModel,ModelWithField);FacetModel.prototype.initFacet=function(facet){return isFacetMapping(facet)?reduce(facet,
function(normalizedFacet,fieldDef,channel){if(!contains(["row","column"],channel))return warn(message$jscomp$0.incompatibleChannel(channel,"facet")),normalizedFacet;if(void 0===fieldDef.field)return warn(message$jscomp$0.emptyFieldDef(fieldDef,channel)),normalizedFacet;normalizedFacet[channel]=normalize(fieldDef,channel);return normalizedFacet},{}):{facet:normalize(facet,"facet")}};FacetModel.prototype.channelHasField=function(channel){return!!this.facet[channel]};FacetModel.prototype.fieldDef=function(channel){return this.facet[channel]};
FacetModel.prototype.parseData=function(){this.component.data=parseData(this);this.child.parseData()};FacetModel.prototype.parseLayoutSize=function(){parseChildrenLayoutSize(this)};FacetModel.prototype.parseSelections=function(){this.child.parseSelections();this.component.selection=this.child.component.selection};FacetModel.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()};FacetModel.prototype.parseAxesAndHeaders=function(){this.child.parseAxesAndHeaders();for(var $jscomp$inline_1010=
$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$inline_1010.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$inline_1010.next())if($jscomp$key$channel=$jscomp$key$channel.value,this.channelHasField($jscomp$key$channel)){var fieldDef=this.facet[$jscomp$key$channel],titleConfig=getHeaderProperty("title",null,this.config,$jscomp$key$channel);titleConfig=title$jscomp$0(fieldDef,this.config,{allowDisabling:!0,includeDefault:void 0===titleConfig||!!titleConfig});this.child.component.layoutHeaders[$jscomp$key$channel].title&&
(titleConfig+=" / "+this.child.component.layoutHeaders[$jscomp$key$channel].title,this.child.component.layoutHeaders[$jscomp$key$channel].title=null);var labelOrient=getHeaderProperty("labelOrient",fieldDef,this.config,$jscomp$key$channel),labels$302=getFirstDefined((fieldDef.header||{}).labels,!0);labelOrient=contains(["bottom","right"],labelOrient)?"footer":"header";var $jscomp$inline_1281={};this.component.layoutHeaders[$jscomp$key$channel]=($jscomp$inline_1281.title=titleConfig,$jscomp$inline_1281.facetFieldDef=
fieldDef,$jscomp$inline_1281[labelOrient]="facet"===$jscomp$key$channel?[]:[makeHeaderComponent(this,$jscomp$key$channel,labels$302)],$jscomp$inline_1281)}mergeChildAxis(this,"x");mergeChildAxis(this,"y")};FacetModel.prototype.assembleSelectionTopLevelSignals=function(signals){return this.child.assembleSelectionTopLevelSignals(signals)};FacetModel.prototype.assembleSignals=function(){this.child.assembleSignals();return[]};FacetModel.prototype.assembleSelectionData=function(data){return this.child.assembleSelectionData(data)};
FacetModel.prototype.getHeaderLayoutMixins=function(){for(var layoutMixins={},$jscomp$iter$175=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$175.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$175.next()){$jscomp$key$channel=$jscomp$key$channel.value;for(var $jscomp$iter$174=$jscomp.makeIterator(HEADER_TYPES),$jscomp$key$headerType=$jscomp$iter$174.next();!$jscomp$key$headerType.done;$jscomp$key$headerType=$jscomp$iter$174.next()){var headerType=$jscomp$key$headerType.value;
$jscomp$key$headerType=this.component.layoutHeaders[$jscomp$key$channel];var headerComponent=$jscomp$key$headerType[headerType],facetFieldDef=$jscomp$key$headerType.facetFieldDef;facetFieldDef&&(facetFieldDef=getHeaderProperty("titleOrient",facetFieldDef,this.config,$jscomp$key$channel),contains(["right","bottom"],facetFieldDef)&&(facetFieldDef=getHeaderChannel($jscomp$key$channel,facetFieldDef),layoutMixins.titleAnchor=layoutMixins.titleAnchor||{},layoutMixins.titleAnchor[facetFieldDef]="end"));
headerComponent&&headerComponent[0]&&(headerComponent="row"===$jscomp$key$channel?"height":"width",headerType="header"===headerType?"headerBand":"footerBand","facet"===$jscomp$key$channel||this.child.component.layoutSize.get(headerComponent)||(layoutMixins[headerType]=layoutMixins[headerType]||{},layoutMixins[headerType][$jscomp$key$channel]=.5),$jscomp$key$headerType.title&&(layoutMixins.offset=layoutMixins.offset||{},layoutMixins.offset["row"===$jscomp$key$channel?"rowTitle":"columnTitle"]=10))}}return layoutMixins};
FacetModel.prototype.assembleDefaultLayout=function(){var $jscomp$destructuring$var195=this.facet,column=$jscomp$destructuring$var195.column;$jscomp$destructuring$var195=$jscomp$destructuring$var195.row;var columns=column?this.columnDistinctSignal():$jscomp$destructuring$var195?1:void 0,align="all";$jscomp$destructuring$var195||"independent"!==this.component.resolve.scale.x?column||"independent"!==this.component.resolve.scale.y||(align="none"):align="none";return Object.assign({},this.getHeaderLayoutMixins(),
columns?{columns:columns}:{},{bounds:"full",align:align})};FacetModel.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()};FacetModel.prototype.columnDistinctSignal=function(){if(!(this.parent&&this.parent instanceof FacetModel))return{signal:"length(data('"+this.getName("column_domain")+"'))"}};FacetModel.prototype.assembleGroup=function(signals){return this.parent&&this.parent instanceof FacetModel?Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:vgField(this.facet.column,
{prefix:"distinct"})}}}}:{},ModelWithField.prototype.assembleGroup.call(this,signals)):ModelWithField.prototype.assembleGroup.call(this,signals)};FacetModel.prototype.getCardinalityAggregateForChild=function(){var fields=[],ops=[],as=[];if(this.child instanceof FacetModel){if(this.child.channelHasField("column")){var field$306=vgField(this.child.facet.column);fields.push(field$306);ops.push("distinct");as.push("distinct_"+field$306)}}else{field$306=$jscomp.makeIterator(["x","y"]);for(var $jscomp$key$channel=
field$306.next();!$jscomp$key$channel.done;$jscomp$key$channel=field$306.next()){$jscomp$key$channel=$jscomp$key$channel.value;var childScaleComponent=this.child.component.scales[$jscomp$key$channel];if(childScaleComponent&&!childScaleComponent.merged){var type$307=childScaleComponent.get("type");childScaleComponent=childScaleComponent.get("range");type$307 in DISCRETE_DOMAIN_INDEX&&isVgRangeStep(childScaleComponent)&&($jscomp$key$channel=assembleDomain(this.child,$jscomp$key$channel),($jscomp$key$channel=
getFieldFromDomain($jscomp$key$channel))?(fields.push($jscomp$key$channel),ops.push("distinct"),as.push("distinct_"+$jscomp$key$channel)):warn("Unknown field for ${channel}.  Cannot calculate view size."))}}}return{fields:fields,ops:ops,as:as}};FacetModel.prototype.assembleFacet=function(){var $jscomp$destructuring$var196=this.component.data.facetRoot,name=$jscomp$destructuring$var196.name;$jscomp$destructuring$var196=$jscomp$destructuring$var196.data;var $jscomp$destructuring$var197=this.facet,row=
$jscomp$destructuring$var197.row,column=$jscomp$destructuring$var197.column,$jscomp$destructuring$var198=this.getCardinalityAggregateForChild();$jscomp$destructuring$var197=$jscomp$destructuring$var198.fields;var ops=$jscomp$destructuring$var198.ops;$jscomp$destructuring$var198=$jscomp$destructuring$var198.as;for(var groupby=[],$jscomp$iter$177=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$177.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$177.next()){var channel=
$jscomp$key$channel.value;if($jscomp$key$channel=this.facet[channel]){groupby.push(vgField($jscomp$key$channel));var $jscomp$destructuring$var199=$jscomp$key$channel,sort=$jscomp$destructuring$var199.sort;isBinning($jscomp$destructuring$var199.bin)&&groupby.push(vgField($jscomp$key$channel,{binSuffix:"end"}));isSortField(sort)?($jscomp$destructuring$var199=sort,channel=$jscomp$destructuring$var199.field,$jscomp$destructuring$var199=void 0===$jscomp$destructuring$var199.op?"mean":$jscomp$destructuring$var199.op,
$jscomp$key$channel=facetSortFieldName($jscomp$key$channel,sort),row&&column?($jscomp$destructuring$var197.push($jscomp$key$channel),ops.push("max")):($jscomp$destructuring$var197.push(channel),ops.push($jscomp$destructuring$var199)),$jscomp$destructuring$var198.push($jscomp$key$channel)):isArray(sort)&&($jscomp$key$channel=sortArrayIndexField($jscomp$key$channel,channel),$jscomp$destructuring$var197.push($jscomp$key$channel),ops.push("max"),$jscomp$destructuring$var198.push($jscomp$key$channel))}}row=
!!row&&!!column;return Object.assign({name:name,data:$jscomp$destructuring$var196,groupby:groupby},row||$jscomp$destructuring$var197.length?{aggregate:Object.assign({},row?{cross:row}:{},$jscomp$destructuring$var197.length?{fields:$jscomp$destructuring$var197,ops:ops,as:$jscomp$destructuring$var198}:{})}:{})};FacetModel.prototype.facetSortFields=function(channel){var fieldDef=this.facet[channel];return fieldDef?isSortField(fieldDef.sort)?[facetSortFieldName(fieldDef,fieldDef.sort,{expr:"datum"})]:
isArray(fieldDef.sort)?[sortArrayIndexField(fieldDef,channel,{expr:"datum"})]:[vgField(fieldDef,{expr:"datum"})]:[]};FacetModel.prototype.facetSortOrder=function(channel){return(channel=this.facet[channel])?(channel=channel.sort,[(isSortField(channel)?channel.order:!isArray(channel)&&channel)||"ascending"]):[]};FacetModel.prototype.assembleLabelTitle=function(){var facet=this.facet,config=this.config;if(facet.facet)return assembleLabelTitle(facet.facet,"facet",config);for(var ORTHOGONAL_ORIENT={row:["top",
"bottom"],column:["left","right"]},$jscomp$iter$178=$jscomp.makeIterator(HEADER_CHANNELS),$jscomp$key$channel=$jscomp$iter$178.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$178.next())if($jscomp$key$channel=$jscomp$key$channel.value,facet[$jscomp$key$channel]){var labelOrient=getHeaderProperty("labelOrient",facet[$jscomp$key$channel],config,$jscomp$key$channel);if(contains(ORTHOGONAL_ORIENT[$jscomp$key$channel],labelOrient))return assembleLabelTitle(facet[$jscomp$key$channel],
$jscomp$key$channel,config)}};FacetModel.prototype.assembleMarks=function(){var $jscomp$this=this,child=this.child,data=assembleFacetData(this.component.data.facetRoot),encodeEntry=child.assembleGroupEncodeEntry(!1),title=this.assembleLabelTitle()||child.assembleTitle(),style=child.assembleGroupStyle();return[Object.assign({name:this.getName("cell"),type:"group"},title?{title:title}:{},style?{style:style}:{},{from:{facet:this.assembleFacet()},sort:{field:flatten(FACET_CHANNELS.map(function(c){return $jscomp$this.facetSortFields(c)})),
order:flatten(FACET_CHANNELS.map(function(c){return $jscomp$this.facetSortOrder(c)}))}},0<data.length?{data:data}:{},encodeEntry?{encode:{update:encodeEntry}}:{},child.assembleGroup(assembleFacetSignals(this,[])))]};FacetModel.prototype.getMapping=function(){return this.facet};var BaseConcatModel=function(spec,specType,parent,parentGivenName,config,repeater,resolve){return Model.call(this,spec,specType,parent,parentGivenName,config,repeater,resolve)||this};$jscomp.inherits(BaseConcatModel,Model);
BaseConcatModel.prototype.parseData=function(){this.component.data=parseData(this);this.children.forEach(function(child){child.parseData()})};BaseConcatModel.prototype.parseSelections=function(){var $jscomp$this=this;this.component.selection={};for(var $jscomp$loop$344={},$jscomp$iter$183=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$183.next();!$jscomp$key$child.done;$jscomp$loop$344={$jscomp$loop$prop$child$345:$jscomp$loop$344.$jscomp$loop$prop$child$345},$jscomp$key$child=
$jscomp$iter$183.next())$jscomp$loop$344.$jscomp$loop$prop$child$345=$jscomp$key$child.value,$jscomp$loop$344.$jscomp$loop$prop$child$345.parseSelections(),keys($jscomp$loop$344.$jscomp$loop$prop$child$345.component.selection).forEach(function($jscomp$loop$344){return function(key){$jscomp$this.component.selection[key]=$jscomp$loop$344.$jscomp$loop$prop$child$345.component.selection[key]}}($jscomp$loop$344))};BaseConcatModel.prototype.parseMarkGroup=function(){for(var $jscomp$iter$184=$jscomp.makeIterator(this.children),
$jscomp$key$child=$jscomp$iter$184.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$184.next())$jscomp$key$child.value.parseMarkGroup()};BaseConcatModel.prototype.parseAxesAndHeaders=function(){for(var $jscomp$iter$185=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$185.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$185.next())$jscomp$key$child.value.parseAxesAndHeaders()};BaseConcatModel.prototype.assembleSelectionTopLevelSignals=function(signals){return this.children.reduce(function(sg,
child){return child.assembleSelectionTopLevelSignals(sg)},signals)};BaseConcatModel.prototype.assembleSignals=function(){this.children.forEach(function(child){return child.assembleSignals()});return[]};BaseConcatModel.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(signals,child){return[].concat($jscomp.arrayFromIterable(signals),$jscomp.arrayFromIterable(child.assembleLayoutSignals()))},assembleLayoutSignals(this))};BaseConcatModel.prototype.assembleSelectionData=
function(data){return this.children.reduce(function(db,child){return child.assembleSelectionData(db)},data)};BaseConcatModel.prototype.assembleMarks=function(){return this.children.map(function(child){var title=child.assembleTitle(),style=child.assembleGroupStyle(),encodeEntry=child.assembleGroupEncodeEntry(!1);return Object.assign({type:"group",name:child.getName("group")},title?{title:title}:{},style?{style:style}:{},encodeEntry?{encode:{update:encodeEntry}}:{},child.assembleGroup())})};var ConcatModel=
function(spec,parent,parentGivenName,repeater,config){var $jscomp$super$this=BaseConcatModel.call(this,spec,"concat",parent,parentGivenName,config,repeater,spec.resolve)||this;spec.resolve&&spec.resolve.axis&&("shared"===spec.resolve.axis.x||"shared"===spec.resolve.axis.y)&&warn(message$jscomp$0.CONCAT_CANNOT_SHARE_AXIS);$jscomp$super$this.concatType=isVConcatSpec(spec)?"vconcat":isHConcatSpec(spec)?"hconcat":"concat";$jscomp$super$this.children=$jscomp$super$this.getChildren(spec).map(function(child,
i){return buildModel(child,$jscomp$super$this,$jscomp$super$this.getName("concat_"+i),void 0,repeater,config,!1)});return $jscomp$super$this};$jscomp.inherits(ConcatModel,BaseConcatModel);ConcatModel.prototype.getChildren=function(spec){return isVConcatSpec(spec)?spec.vconcat:isHConcatSpec(spec)?spec.hconcat:spec.concat};ConcatModel.prototype.parseLayoutSize=function(){parseChildrenLayoutSize(this);var layoutSizeCmpt=this.component.layoutSize,sizeTypeToMerge=SIZE_TYPE_TO_MERGE[this.concatType];sizeTypeToMerge&&
layoutSizeCmpt.setWithExplicit(sizeTypeToMerge,parseNonUnitLayoutSizeForChannel(this,sizeTypeToMerge))};ConcatModel.prototype.parseAxisGroup=function(){return null};ConcatModel.prototype.assembleDefaultLayout=function(){return Object.assign({},"vconcat"===this.concatType?{columns:1}:{},{bounds:"full",align:"each"})};var AxisComponent=function(explicit,implicit,mainExtracted){explicit=void 0===explicit?{}:explicit;implicit=void 0===implicit?{}:implicit;mainExtracted=void 0===mainExtracted?!1:mainExtracted;
var $jscomp$super$this=Split.call(this)||this;$jscomp$super$this.explicit=explicit;$jscomp$super$this.implicit=implicit;$jscomp$super$this.mainExtracted=mainExtracted;return $jscomp$super$this};$jscomp.inherits(AxisComponent,Split);AxisComponent.prototype.clone=function(){return new AxisComponent(duplicate(this.explicit),duplicate(this.implicit),this.mainExtracted)};AxisComponent.prototype.hasAxisPart=function(part){if("axis"===part)return!0;if("grid"===part||"title"===part)return!!this.get(part);
part=this.get(part);return!(!1===part||null===part)};var OPPOSITE_ORIENT={bottom:"top",top:"bottom",left:"right",right:"left"},markCompiler={area:{vgMark:"area",encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{size:"ignore",orient:"include"}),pointPosition("x",model,"zeroOrMin"),pointPosition("y",model,"zeroOrMin"),pointPosition2(model,"zeroOrMin","horizontal"===model.markDef.orient?"x2":"y2"),defined(model))}},bar:{vgMark:"rect",encodeEntry:function(model){return Object.assign({},
baseEncodeEntry(model,{size:"ignore",orient:"ignore"}),rectPosition(model,"x","bar"),rectPosition(model,"y","bar"))}},circle:{vgMark:"symbol",encodeEntry:function(model){return encodeEntry(model,"circle")}},geoshape:{vgMark:"shape",encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{size:"ignore",orient:"ignore"}))},postEncodingTransform:function(model){var shapeDef=model.encoding.shape;return[Object.assign({type:"geoshape",projection:model.projectionName()},shapeDef&&isFieldDef(shapeDef)&&
"geojson"===shapeDef.type?{field:vgField(shapeDef,{expr:"datum"})}:{})]}},line:{vgMark:"line",encodeEntry:function(model){var width=model.width,height=model.height;return Object.assign({},baseEncodeEntry(model,{size:"ignore",orient:"ignore"}),pointPosition("x",model,mid(width)),pointPosition("y",model,mid(height)),nonPosition("size",model,{vgChannel:"strokeWidth"}),defined(model))}},point:{vgMark:"symbol",encodeEntry:function(model){return encodeEntry(model)}},rect:{vgMark:"rect",encodeEntry:function(model){return Object.assign({},
baseEncodeEntry(model,{size:"ignore",orient:"ignore"}),rectPosition(model,"x","rect"),rectPosition(model,"y","rect"))}},rule:{vgMark:"rule",encodeEntry:function(model){var width=model.width,height=model.height,orient=model.markDef.orient;return model.encoding.x||model.encoding.y||model.encoding.latitude||model.encoding.longitude?Object.assign({},baseEncodeEntry(model,{size:"ignore",orient:"ignore"}),pointPosition("x",model,"horizontal"===orient?"zeroOrMin":mid(width)),pointPosition("y",model,"vertical"===
orient?"zeroOrMin":mid(height)),"vertical"!==orient?pointPosition2(model,"zeroOrMax","x2"):{},"horizontal"!==orient?pointPosition2(model,"zeroOrMax","y2"):{},nonPosition("size",model,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:function(model){return encodeEntry(model,"square")}},text:{vgMark:"text",encodeEntry:function(model){var config=model.config,encoding=model.encoding,width=model.width,height=model.height;return Object.assign({},baseEncodeEntry(model,{size:"ignore",orient:"ignore"}),
pointPosition("x",model,mid(width)),pointPosition("y",model,mid(height)),text$1(model),nonPosition("size",model,{vgChannel:"fontSize"}),valueIfDefined("align",align(model.markDef,encoding,config)),valueIfDefined("baseline",baseline(model.markDef,encoding,config)))}},tick:{vgMark:"rect",encodeEntry:function(model){var config=model.config,markDef=model.markDef,width=model.width,height=model.height,orient=markDef.orient,vgSizeChannel="horizontal"===orient?"width":"height";orient="horizontal"===orient?
"height":"width";var $jscomp$compprop34={};return Object.assign({},baseEncodeEntry(model,{size:"ignore",orient:"ignore"}),pointPosition("x",model,mid(width),"xc"),pointPosition("y",model,mid(height),"yc"),nonPosition("size",model,{defaultValue:defaultSize(model),vgChannel:vgSizeChannel}),($jscomp$compprop34[orient]={value:getFirstDefined(markDef.thickness,config.tick.thickness)},$jscomp$compprop34))}},trail:{vgMark:"trail",encodeEntry:function(model){var width=model.width,height=model.height;return Object.assign({},
baseEncodeEntry(model,{size:"include",orient:"ignore"}),pointPosition("x",model,mid(width)),pointPosition("y",model,mid(height)),nonPosition("size",model),defined(model))}}},UnitModel=function(spec,parent,parentGivenName,parentGivenSize,repeater,config,fit){parentGivenSize=void 0===parentGivenSize?{}:parentGivenSize;parent=ModelWithField.call(this,spec,"unit",parent,parentGivenName,config,repeater,void 0,spec.view)||this;parent.fit=fit;parent.specifiedScales={};parent.specifiedAxes={};parent.specifiedLegends=
{};parent.specifiedProjection={};parent.selection={};parent.children=[];parent.initSize(Object.assign({},parentGivenSize,spec.width?{width:spec.width}:{},spec.height?{height:spec.height}:{}));parentGivenSize=isMarkDef(spec.mark)?spec.mark.type:spec.mark;repeater=replaceRepeater(spec.encoding||{},repeater);repeater=parent.encoding=normalizeEncoding(repeater,parentGivenSize);fit=spec.mark;fit=isMarkDef(fit)?Object.assign({},fit):{type:fit};parentGivenName=fit.orient||getMarkConfig("orient",fit,config);
fit.orient=orient$1(fit.type,repeater,parentGivenName);void 0!==parentGivenName&&parentGivenName!==fit.orient&&warn(message$jscomp$0.orientOverridden(fit.orient,parentGivenName));void 0===getFirstDefined(fit.opacity,getMarkConfig("opacity",fit,config))&&(parentGivenName=contains(["point","tick","circle","square"],fit.type)&&!isAggregate(repeater)?.7:void 0,fit.opacity=parentGivenName);if(void 0===fit.filled){parentGivenName=getMarkConfig("filled",fit,config);var mark=fit.type;parentGivenName=getFirstDefined(parentGivenName,
"point"!==mark&&"line"!==mark&&"rule"!==mark);fit.filled=parentGivenName}void 0===(fit.cursor||getMarkConfig("cursor",fit,config))&&(fit.cursor=repeater.href||fit.href||getMarkConfig("href",fit,config)?"pointer":fit.cursor);parent.markDef=fit;parent.stack=stack(parentGivenSize,repeater,parent.config.stack);parent.specifiedScales=parent.initScales(parentGivenSize,repeater);parent.specifiedAxes=parent.initAxes(repeater);parent.specifiedLegends=parent.initLegend(repeater);parent.specifiedProjection=
spec.projection;parent.selection=spec.selection;return parent};$jscomp.inherits(UnitModel,ModelWithField);UnitModel.prototype.scaleDomain=function(channel){return(channel=this.specifiedScales[channel])?channel.domain:void 0};UnitModel.prototype.axis=function(channel){return this.specifiedAxes[channel]};UnitModel.prototype.legend=function(channel){return this.specifiedLegends[channel]};UnitModel.prototype.initScales=function(mark,encoding){return SCALE_CHANNELS.reduce(function(scales,channel){var channelDef=
encoding[channel];if(isFieldDef(channelDef)){var fieldDef=channelDef;var specifiedScale=channelDef.scale}else hasConditionalFieldDef(channelDef)&&(fieldDef=channelDef.condition,specifiedScale=channelDef.condition.scale);fieldDef&&(scales[channel]=specifiedScale||{});return scales},{})};UnitModel.prototype.initAxes=function(encoding){return["x","y"].reduce(function(_axis,channel){var channelDef=encoding[channel];if(isFieldDef(channelDef)||"x"===channel&&isFieldDef(encoding.x2)||"y"===channel&&isFieldDef(encoding.y2))channelDef=
isFieldDef(channelDef)?channelDef.axis:null,null!==channelDef&&(_axis[channel]=Object.assign({},channelDef));return _axis},{})};UnitModel.prototype.initLegend=function(encoding){return NONPOSITION_SCALE_CHANNELS.reduce(function(_legend,channel){var channelDef=encoding[channel];if(channelDef){channelDef=isFieldDef(channelDef)?channelDef.legend:hasConditionalFieldDef(channelDef)?channelDef.condition.legend:null;var JSCompiler_temp;if(JSCompiler_temp=null!==channelDef&&!1!==channelDef)a:{switch(channel){case "color":case "fill":case "stroke":case "size":case "shape":case "opacity":case "strokeWidth":JSCompiler_temp=
!0;break a;case "fillOpacity":case "strokeOpacity":JSCompiler_temp=!1;break a}JSCompiler_temp=void 0}JSCompiler_temp&&(_legend[channel]=Object.assign({},channelDef))}return _legend},{})};UnitModel.prototype.parseData=function(){this.component.data=parseData(this)};UnitModel.prototype.parseLayoutSize=function(){var layoutSizeComponent=this.component.layoutSize;if(!layoutSizeComponent.explicit.width){var width=defaultUnitSize(this,"width");layoutSizeComponent.set("width",width,!1)}layoutSizeComponent.explicit.height||
(width=defaultUnitSize(this,"height"),layoutSizeComponent.set("height",width,!1))};UnitModel.prototype.parseSelections=function(){this.component.selection=parseUnitSelection(this,this.selection)};UnitModel.prototype.parseMarkGroup=function(){var JSCompiler_temp_const=this.component;if(contains(["line","area","trail"],this.mark)){var JSCompiler_temp=pathGroupingFields(this.mark,this.encoding);var pathMarks=getMarkGroups(this,{fromPrefix:0<JSCompiler_temp.length?"faceted_path_":""});JSCompiler_temp=
0<JSCompiler_temp.length?[{name:this.getName("pathgroup"),type:"group",from:{facet:{name:"faceted_path_"+this.requestDataName("main"),data:this.requestDataName("main"),groupby:JSCompiler_temp}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:pathMarks}]:pathMarks}else JSCompiler_temp=getMarkGroups(this);JSCompiler_temp_const.mark=JSCompiler_temp};UnitModel.prototype.parseAxesAndHeaders=function(){this.component.axes=parseUnitAxes(this)};UnitModel.prototype.assembleSelectionTopLevelSignals=
function(signals){return assembleTopLevelSignals(this,signals)};UnitModel.prototype.assembleSignals=function(){return[].concat($jscomp.arrayFromIterable(assembleAxisSignals(this)),$jscomp.arrayFromIterable(assembleUnitSelectionSignals(this,[])))};UnitModel.prototype.assembleSelectionData=function(data){return assembleUnitSelectionData(this,data)};UnitModel.prototype.assembleLayout=function(){return null};UnitModel.prototype.assembleLayoutSignals=function(){return assembleLayoutSignals(this)};UnitModel.prototype.assembleMarks=
function(){var marks=this.component.mark||[];this.parent&&isLayerModel(this.parent)||(marks=assembleUnitSelectionMarks(this,marks));return marks.map(this.correctDataNames)};UnitModel.prototype.getMapping=function(){return this.encoding};UnitModel.prototype.channelHasField=function(channel){return channelHasField(this.encoding,channel)};UnitModel.prototype.fieldDef=function(channel){return getTypedFieldDef(this.encoding[channel])};$jscomp.global.Object.defineProperties(UnitModel.prototype,{hasProjection:{configurable:!0,
enumerable:!0,get:function(){var encoding=this.encoding,isGeoShapeMark="geoshape"===this.mark,hasGeoPosition=encoding&&GEOPOSITION_CHANNELS.some(function(channel){return isFieldDef(encoding[channel])});return isGeoShapeMark||hasGeoPosition}},mark:{configurable:!0,enumerable:!0,get:function(){return this.markDef.type}}});var LayerModel=function(spec,parent,parentGivenName,parentGivenSize,repeater,config,fit){var $jscomp$super$this=Model.call(this,spec,"layer",parent,parentGivenName,config,repeater,
spec.resolve,spec.view)||this;var layoutSize=Object.assign({},parentGivenSize,spec.width?{width:spec.width}:{},spec.height?{height:spec.height}:{});$jscomp$super$this.initSize(layoutSize);$jscomp$super$this.children=spec.layer.map(function(layer,i){if(isLayerSpec(layer))return new LayerModel(layer,$jscomp$super$this,$jscomp$super$this.getName("layer_"+i),layoutSize,repeater,config,fit);if(isUnitSpec(layer))return new UnitModel(layer,$jscomp$super$this,$jscomp$super$this.getName("layer_"+i),layoutSize,
repeater,config,fit);throw Error(message$jscomp$0.INVALID_SPEC);});return $jscomp$super$this};$jscomp.inherits(LayerModel,Model);LayerModel.prototype.parseData=function(){this.component.data=parseData(this);for(var $jscomp$iter$193=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$193.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$193.next())$jscomp$key$child.value.parseData()};LayerModel.prototype.parseLayoutSize=function(){parseLayerLayoutSize(this)};LayerModel.prototype.parseSelections=
function(){var $jscomp$this=this;this.component.selection={};for(var $jscomp$loop$351={},$jscomp$iter$194=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$194.next();!$jscomp$key$child.done;$jscomp$loop$351={$jscomp$loop$prop$child$352:$jscomp$loop$351.$jscomp$loop$prop$child$352},$jscomp$key$child=$jscomp$iter$194.next())$jscomp$loop$351.$jscomp$loop$prop$child$352=$jscomp$key$child.value,$jscomp$loop$351.$jscomp$loop$prop$child$352.parseSelections(),keys($jscomp$loop$351.$jscomp$loop$prop$child$352.component.selection).forEach(function($jscomp$loop$351){return function(key){$jscomp$this.component.selection[key]=
$jscomp$loop$351.$jscomp$loop$prop$child$352.component.selection[key]}}($jscomp$loop$351))};LayerModel.prototype.parseMarkGroup=function(){for(var $jscomp$iter$195=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$195.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$195.next())$jscomp$key$child.value.parseMarkGroup()};LayerModel.prototype.parseAxesAndHeaders=function(){var $jscomp$inline_1042=this.component,axes=$jscomp$inline_1042.axes;$jscomp$inline_1042=$jscomp$inline_1042.resolve;
for(var axisCount={top:0,bottom:0,right:0,left:0},$jscomp$inline_1046=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$inline_1046.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$inline_1046.next()){var child=$jscomp$key$child.value;child.parseAxesAndHeaders();var $jscomp$inline_1049=$jscomp.makeIterator(keys(child.component.axes));for($jscomp$key$child=$jscomp$inline_1049.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$inline_1049.next())$jscomp$key$child=$jscomp$key$child.value,
$jscomp$inline_1042.axis[$jscomp$key$child]=parseGuideResolve(this.component.resolve,$jscomp$key$child),"shared"===$jscomp$inline_1042.axis[$jscomp$key$child]&&(axes[$jscomp$key$child]=mergeAxisComponents(axes[$jscomp$key$child],child.component.axes[$jscomp$key$child]),axes[$jscomp$key$child]||($jscomp$inline_1042.axis[$jscomp$key$child]="independent",delete axes[$jscomp$key$child]))}$jscomp$inline_1046=$jscomp.makeIterator(["x","y"]);for($jscomp$key$child=$jscomp$inline_1046.next();!$jscomp$key$child.done;$jscomp$key$child=
$jscomp$inline_1046.next()){child=$jscomp$key$child.value;$jscomp$inline_1049=$jscomp.makeIterator(this.children);for($jscomp$key$child=$jscomp$inline_1049.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$inline_1049.next())if($jscomp$key$child=$jscomp$key$child.value,$jscomp$key$child.component.axes[child]){if("independent"===$jscomp$inline_1042.axis[child]){axes[child]=(axes[child]||[]).concat($jscomp$key$child.component.axes[child]);for(var $jscomp$inline_1056=$jscomp.makeIterator($jscomp$key$child.component.axes[child]),
$jscomp$key$axisComponent=$jscomp$inline_1056.next();!$jscomp$key$axisComponent.done;$jscomp$key$axisComponent=$jscomp$inline_1056.next()){$jscomp$key$axisComponent=$jscomp$key$axisComponent.value;var $jscomp$inline_1059=$jscomp$key$axisComponent.getWithExplicit("orient"),orient$319=$jscomp$inline_1059.value;$jscomp$inline_1059=$jscomp$inline_1059.explicit;0<axisCount[orient$319]&&!$jscomp$inline_1059&&($jscomp$inline_1059=OPPOSITE_ORIENT[orient$319],axisCount[orient$319]>axisCount[$jscomp$inline_1059]&&
$jscomp$key$axisComponent.set("orient",$jscomp$inline_1059,!1));axisCount[orient$319]++}}delete $jscomp$key$child.component.axes[child]}if("independent"===$jscomp$inline_1042.axis[child]&&axes[child]&&1<axes[child].length)for(child=$jscomp.makeIterator(axes[child]),$jscomp$inline_1049=child.next();!$jscomp$inline_1049.done;$jscomp$inline_1049=child.next())$jscomp$inline_1049=$jscomp$inline_1049.value,$jscomp$inline_1049.get("grid")&&!$jscomp$inline_1049.explicit.grid&&($jscomp$inline_1049.implicit.grid=
!1)}};LayerModel.prototype.assembleSelectionTopLevelSignals=function(signals){return this.children.reduce(function(sg,child){return child.assembleSelectionTopLevelSignals(sg)},signals)};LayerModel.prototype.assembleSignals=function(){return this.children.reduce(function(signals,child){return signals.concat(child.assembleSignals())},assembleAxisSignals(this))};LayerModel.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(signals,child){return signals.concat(child.assembleLayoutSignals())},
assembleLayoutSignals(this))};LayerModel.prototype.assembleSelectionData=function(data){return this.children.reduce(function(db,child){return child.assembleSelectionData(db)},data)};LayerModel.prototype.assembleTitle=function(){var title=Model.prototype.assembleTitle.call(this);if(title)return title;var $jscomp$iter$196=$jscomp.makeIterator(this.children);for(title=$jscomp$iter$196.next();!title.done;title=$jscomp$iter$196.next())if(title=title.value.assembleTitle())return title};LayerModel.prototype.assembleLayout=
function(){return null};LayerModel.prototype.assembleMarks=function(){return assembleLayerSelectionMarks(this,flatten(this.children.map(function(child){return child.assembleMarks()})))};LayerModel.prototype.assembleLegends=function(){return this.children.reduce(function(legends,child){return legends.concat(child.assembleLegends())},assembleLegends(this))};var RepeatModel=function(spec,parent,parentGivenName,repeatValues,config){parent=BaseConcatModel.call(this,spec,"repeat",parent,parentGivenName,
config,repeatValues,spec.resolve)||this;spec.resolve&&spec.resolve.axis&&("shared"===spec.resolve.axis.x||"shared"===spec.resolve.axis.y)&&warn(message$jscomp$0.REPEAT_CANNOT_SHARE_AXIS);parent.repeat=spec.repeat;parent.children=parent._initChildren(spec,parent.repeat,repeatValues,config);return parent};$jscomp.inherits(RepeatModel,BaseConcatModel);RepeatModel.prototype._initChildren=function(spec,repeat,repeater,config){var children=[],row=!isArray(repeat)&&repeat.row||[repeater?repeater.row:null],
column=!isArray(repeat)&&repeat.column||[repeater?repeater.column:null];repeat=isArray(repeat)&&repeat||[repeater?repeater.repeat:null];repeat=$jscomp.makeIterator(repeat);for(repeater=repeat.next();!repeater.done;repeater=repeat.next()){repeater=repeater.value;for(var $jscomp$iter$198=$jscomp.makeIterator(row),$jscomp$key$rowValue=$jscomp$iter$198.next();!$jscomp$key$rowValue.done;$jscomp$key$rowValue=$jscomp$iter$198.next()){$jscomp$key$rowValue=$jscomp$key$rowValue.value;for(var $jscomp$iter$197=
$jscomp.makeIterator(column),$jscomp$key$columnValue=$jscomp$iter$197.next();!$jscomp$key$columnValue.done;$jscomp$key$columnValue=$jscomp$iter$197.next()){$jscomp$key$columnValue=$jscomp$key$columnValue.value;var childRepeat={repeat:repeater,row:$jscomp$key$rowValue,column:$jscomp$key$columnValue};children.push(buildModel(spec.spec,this,this.getName("child"+((repeater?"__repeat_repeat_"+repeater:"")+($jscomp$key$rowValue?"__repeat_row_"+$jscomp$key$rowValue:"")+($jscomp$key$columnValue?"__repeat_column_"+
$jscomp$key$columnValue:""))),void 0,childRepeat,config,!1))}}}return children};RepeatModel.prototype.parseLayoutSize=function(){parseLayerLayoutSize(this)};RepeatModel.prototype.assembleDefaultLayout=function(){var repeat=this.repeat;repeat=isArray(repeat)?void 0:repeat.column?repeat.column.length:1;return Object.assign({},repeat?{columns:repeat}:{},{bounds:"full",align:"all"})};var TransformExtractMapper=function(var_args){return SpecMapper.apply(this,arguments)||this};$jscomp.inherits(TransformExtractMapper,
SpecMapper);TransformExtractMapper.prototype.mapUnit=function(spec,$jscomp$destructuring$var225){var config=$jscomp$destructuring$var225.config;if(spec.encoding){$jscomp$destructuring$var225=spec.transform;var $jscomp$destructuring$var228=extractTransformsFromEncoding(spec.encoding,config);config=$jscomp$destructuring$var228.bins;var timeUnits=$jscomp$destructuring$var228.timeUnits,aggregate=$jscomp$destructuring$var228.aggregate,groupby=$jscomp$destructuring$var228.groupby;$jscomp$destructuring$var228=
$jscomp$destructuring$var228.encoding;$jscomp$destructuring$var225=[].concat($jscomp.arrayFromIterable($jscomp$destructuring$var225?$jscomp$destructuring$var225:[]),$jscomp.arrayFromIterable(config),$jscomp.arrayFromIterable(timeUnits),$jscomp.arrayFromIterable(aggregate.length?[{aggregate:aggregate,groupby:groupby}]:[]));return Object.assign({},spec,0<$jscomp$destructuring$var225.length?{transform:$jscomp$destructuring$var225}:{},{encoding:$jscomp$destructuring$var228})}return spec};var extractor=
new TransformExtractMapper;exports.compile=function(inputSpec,opt){opt=void 0===opt?{}:opt;opt.logger&&(current=opt.logger);opt.fieldTitle&&(titleFormatter=opt.fieldTitle);try{var config=initConfig(mergeDeep({},opt.config,inputSpec.config)),spec=normalize$1(inputSpec,config),topLevelAutosize=inputSpec.autosize,isUnitOrLayer=isLayerSpec(spec)||isUnitSpec(spec);isUnitOrLayer=void 0===isUnitOrLayer?!0:isUnitOrLayer;var autosize=Object.assign({type:"pad"},_normalizeAutoSize(config.autosize),_normalizeAutoSize(topLevelAutosize));
"fit"!==autosize.type||isUnitOrLayer||(warn(message$jscomp$0.FIT_NON_SINGLE),autosize.type="pad");var model=buildModel(spec,null,"",void 0,void 0,config,"fit"===autosize.type);model.parse();var data=model.component.data;checkLinks(data.sources);for(isUnitOrLayer=topLevelAutosize=spec=0;5>isUnitOrLayer&&optimizationDataflowHelper(data,model);isUnitOrLayer++)spec++;data.sources.map(moveFacetDown);for(isUnitOrLayer=0;5>isUnitOrLayer&&optimizationDataflowHelper(data,model);isUnitOrLayer++)topLevelAutosize++;
checkLinks(data.sources);5===Math.max(spec,topLevelAutosize)&&warn("Maximum optimization runs(5) reached.");var JSCompiler_inline_result=Object.assign({autosize:1===keys(autosize).length&&autosize.type?autosize.type:autosize},extractTopLevelProperties(config),extractTopLevelProperties(inputSpec));return assembleTopLevelModel(model,JSCompiler_inline_result,inputSpec.datasets,inputSpec.usermeta)}finally{opt.logger&&(current=main$1),opt.fieldTitle&&(titleFormatter=defaultTitleFormatter)}};exports.extractTransforms=
function(spec,config){return extractor.map(spec,{config:config})};exports.normalize=normalize$1;exports.version="3.4.0";Object.defineProperty(exports,"__esModule",{value:!0})})}
//# sourceMappingURL=module$node_modules$vega_lite$build$vega_lite.js.map
